import{c as Re,j as e,C as T,d as w,a2 as oe,a3 as xe,a4 as me,af as Me,e as ge,q as Ce,R as ie,am as Gs,an as Us,ao as Ks,ap as Ds,aq as Ss,ar as _s,as as Vs,at as Ys,ae as ds,r as D,l as K,au as Ws,B as A,D as ze,f as Ae,g as Fe,h as Te,i as we,a as se,b as ae,P as Se,L as Y,x as ns,k as Pe,a7 as Cs,y as Q,a9 as Oe,aa as Le,F as qs,T as os,S as He,t as re,G as Xs,E as xs,v as vs,m as zs,n as As,o as be,p as ke,ag as Js,H as ys,J as gs,K as Ee,M as Z,N as Ns,O as q,ab as Zs,av as Qs}from"./index-B0KDE8pz.js";import{C as De}from"./circle-x-CYTj_F-g.js";import{S as ea,M as sa}from"./smartphone-CW61Outg.js";import{D as ms}from"./dollar-sign-DoT4Nf7I.js";import{C as $e}from"./circle-alert-BColZMCl.js";import{C as Ie,a as aa}from"./ColumnVisibilityDropdown-ByH42Kf_.js";import{F as as,a as ta,C as ia}from"./FilterDropdown-bMbRwlaQ.js";import{utils as ts,writeFile as na}from"./xlsx-D_0l8YDs.js";import{c as Fs,R as la,T as ra,b as ca}from"./index-DT2FB_rg.js";import{C as Ts}from"./chevron-down-BiFBo6-a.js";import{S as Ue,a as Ke,b as _e,c as Ve,d as pe}from"./select-B7kGhMx-.js";import{B as Ye,P as da}from"./play-DdzXaEw9.js";import{S as oa}from"./save-2XSCaFh2.js";import{P as xa}from"./progress-BDUzr-gD.js";import{m as Xe}from"./domainMatching-DnE2bFev.js";import{C as ls}from"./clock-7gicNhvX.js";import{T as hs}from"./trending-down-CiL3vurg.js";import{C as rs}from"./calendar-C6HWCdHQ.js";import"./scroll-area-BWfeK-bJ.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=Re("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=Re("CircleArrowDown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=Re("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=Re("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Re("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=Re("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function ha({stats:l}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(T,{className:"border-green-300 bg-green-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Aidat KazancÄ± (Beklenen)"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("p",{className:"text-2xl text-green-600 mt-1 cursor-help",children:[l.totalMonthlyRevenue.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs",children:"Banka atamalÄ± aktif cihazlarÄ±n aylÄ±k aidat bedelleri toplamÄ±"}),e.jsxs("p",{className:"text-xs opacity-75",children:[l.totalActiveDevices," aktif cihaz (banka tanÄ±mlÄ±)"]})]})})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.activeCustomers," aktif mÃ¼ÅŸteri"]})]}),e.jsx(Me,{className:"text-green-600",size:32})]})})}),e.jsx(T,{className:l.devicesWithoutBank>0?"border-red-300 bg-red-50":"",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Aidat KaybÄ± (Banka TanÄ±msÄ±z)"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("p",{className:`text-2xl mt-1 cursor-help ${l.devicesWithoutBank>0?"text-red-600":"text-gray-400"}`,children:[l.banklessRevenueLoss.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs",children:"Banka tanÄ±msÄ±z cihaz sayÄ±sÄ±:"}),e.jsxs("p",{className:"text-xs",children:[l.devicesWithoutBank," cihaz"]}),e.jsx("p",{className:"text-xs opacity-75",children:"Bu cihazlar Ã¶deme alÄ±namadÄ±ÄŸÄ± iÃ§in gelir hesabÄ±na dahil edilmiyor"})]})})]}),e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:[l.devicesWithoutBank," cihaz banka tanÄ±msÄ±z"]})]}),e.jsx(De,{className:l.devicesWithoutBank>0?"text-red-600":"text-gray-400",size:32})]})})}),e.jsx(T,{className:"border-blue-300 bg-blue-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ã–deme AlÄ±nan Fatura SayÄ±sÄ±"}),e.jsx("p",{className:"text-2xl text-blue-600 mt-1",children:l.confirmedPayments}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Bu dÃ¶nem"})]}),e.jsx(ge,{className:"text-blue-600",size:32})]})})}),e.jsx(T,{className:l.suspendedCustomers>0?"border-orange-300 bg-orange-50":"",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Hizmeti DondurulmuÅŸ Cihaz"}),e.jsx("p",{className:`text-2xl mt-1 ${l.suspendedCustomers>0?"text-orange-600":"text-gray-400"}`,children:l.totalSuspendedDevices}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.suspendedCustomers," mÃ¼ÅŸteri"]})]}),e.jsx(Ce,{className:l.suspendedCustomers>0?"text-orange-600":"text-gray-400",size:32})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(T,{className:"border-blue-200 bg-blue-50",children:e.jsx(w,{className:"pt-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ea,{className:"text-blue-600",size:20}),e.jsx("p",{className:"text-sm text-gray-700",children:"Cihaz DaÄŸÄ±lÄ±mÄ±"})]}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsx("p",{className:"text-3xl text-blue-700 cursor-help mb-2",children:l.totalDevices})}),e.jsx(me,{side:"bottom",className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Toplam cihaz sayÄ±sÄ± - Cihaz envanterini gÃ¶sterir"})})]}),e.jsxs("div",{className:"space-y-1.5 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bankaya TanÄ±mlÄ±:"}),e.jsx("span",{className:"text-green-700",children:l.devicesWithBank})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Banka TanÄ±msÄ±z:"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsx("span",{className:"text-orange-600 cursor-help",children:l.devicesWithoutBank})}),e.jsx(me,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"âš ï¸ Risk - Banka tanÄ±mÄ± olmayan cihazlar"})})]})]})]})]})})})}),e.jsx(T,{className:"border-purple-200 bg-purple-50",children:e.jsx(w,{className:"pt-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ms,{className:"text-purple-600",size:20}),e.jsx("p",{className:"text-sm text-gray-700",children:"Gelir Tipi DaÄŸÄ±lÄ±mÄ±"})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"border-b border-purple-200 pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"AylÄ±k Aidat (GÃ¼ncel):"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("span",{className:"text-green-700 cursor-help",children:[l.monthlySubscriptionRevenue.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"AylÄ±k aidatlÄ± cihazlarÄ±n beklenen kazancÄ±"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"AylÄ±k KayÄ±p:"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("span",{className:"text-red-600 cursor-help",children:[l.monthlySubscriptionLoss.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"ðŸš¨ Risk - AylÄ±k aidatlÄ± cihazlarÄ±n gelir kaybÄ±"})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"YÄ±llÄ±k Aidat (Toplam):"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("span",{className:"text-green-700 cursor-help",children:[l.yearlySubscriptionRevenue.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"YÄ±llÄ±k aidatlÄ± cihazlarÄ±n beklenen kazancÄ±"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"YÄ±llÄ±k KayÄ±p:"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("span",{className:"text-red-600 cursor-help",children:[l.yearlySubscriptionLoss.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"ðŸš¨ Risk - YÄ±llÄ±k aidatlÄ± cihazlarÄ±n gelir kaybÄ±"})})]})]})]})]})]})})})}),e.jsx(T,{className:l.overduePaymentAmount>0?"border-red-200 bg-red-50":"border-green-200 bg-green-50",children:e.jsx(w,{className:"pt-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($e,{className:l.overduePaymentAmount>0?"text-red-600":"text-green-600",size:20}),e.jsx("p",{className:"text-sm text-gray-700",children:"Ã–deme PerformansÄ±"})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Beklenen Toplam:"}),e.jsxs("span",{className:"text-gray-800",children:[l.totalExpectedPayment.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"GecikmiÅŸ (1-9. GÃ¼n):"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("span",{className:`cursor-help ${l.overduePaymentAmount>0?"text-red-700":"text-gray-500"}`,children:[l.overduePaymentAmount.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"ðŸš¨ Tahsilat aciliyeti - Vade geÃ§miÅŸ Ã¶demeler (9. gÃ¼ne kadar)"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"DondurulmuÅŸ Cihaz:"}),e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs("span",{className:`cursor-help ${l.suspendedDeviceRevenue>0?"text-orange-600":"text-gray-500"}`,children:[l.suspendedDeviceRevenue.toFixed(2)," â‚¬"]})}),e.jsx(me,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"âš ï¸ Potansiyel kayÄ±p - Hizmeti dondurulmuÅŸ cihazlarÄ±n tutarÄ±"})})]})]})]})]})})})})]})]})}var je="Accordion",ua=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[us,pa,ja]=Gs(je),[Je]=Us(je,[ja,Fs]),ps=Fs(),ws=ie.forwardRef((l,k)=>{const{type:u,...f}=l,z=f,t=f;return e.jsx(us.Provider,{scope:l.__scopeAccordion,children:u==="multiple"?e.jsx(Na,{...t,ref:k}):e.jsx(ga,{...z,ref:k})})});ws.displayName=je;var[Ps,va]=Je(je),[Is,ya]=Je(je,{collapsible:!1}),ga=ie.forwardRef((l,k)=>{const{value:u,defaultValue:f,onValueChange:z=()=>{},collapsible:t=!1,...m}=l,[S,I]=Ss({prop:u,defaultProp:f??"",onChange:z,caller:je});return e.jsx(Ps,{scope:l.__scopeAccordion,value:ie.useMemo(()=>S?[S]:[],[S]),onItemOpen:I,onItemClose:ie.useCallback(()=>t&&I(""),[t,I]),children:e.jsx(Is,{scope:l.__scopeAccordion,collapsible:t,children:e.jsx(Ms,{...m,ref:k})})})}),Na=ie.forwardRef((l,k)=>{const{value:u,defaultValue:f,onValueChange:z=()=>{},...t}=l,[m,S]=Ss({prop:u,defaultProp:f??[],onChange:z,caller:je}),I=ie.useCallback(o=>S((x=[])=>[...x,o]),[S]),h=ie.useCallback(o=>S((x=[])=>x.filter(C=>C!==o)),[S]);return e.jsx(Ps,{scope:l.__scopeAccordion,value:m,onItemOpen:I,onItemClose:h,children:e.jsx(Is,{scope:l.__scopeAccordion,collapsible:!0,children:e.jsx(Ms,{...t,ref:k})})})}),[fa,Ze]=Je(je),Ms=ie.forwardRef((l,k)=>{const{__scopeAccordion:u,disabled:f,dir:z,orientation:t="vertical",...m}=l,S=ie.useRef(null),I=_s(S,k),h=pa(u),x=Vs(z)==="ltr",C=Ys(l.onKeyDown,v=>{var _;if(!ua.includes(v.key))return;const s=v.target,c=h().filter(E=>{var U;return!((U=E.ref.current)!=null&&U.disabled)}),g=c.findIndex(E=>E.ref.current===s),n=c.length;if(g===-1)return;v.preventDefault();let p=g;const r=0,R=n-1,M=()=>{p=g+1,p>R&&(p=r)},F=()=>{p=g-1,p<r&&(p=R)};switch(v.key){case"Home":p=r;break;case"End":p=R;break;case"ArrowRight":t==="horizontal"&&(x?M():F());break;case"ArrowDown":t==="vertical"&&M();break;case"ArrowLeft":t==="horizontal"&&(x?F():M());break;case"ArrowUp":t==="vertical"&&F();break}const G=p%n;(_=c[G].ref.current)==null||_.focus()});return e.jsx(fa,{scope:u,disabled:f,direction:z,orientation:t,children:e.jsx(us.Slot,{scope:u,children:e.jsx(Ds.div,{...m,"data-orientation":t,ref:I,onKeyDown:f?void 0:C})})})}),qe="AccordionItem",[ba,js]=Je(qe),Rs=ie.forwardRef((l,k)=>{const{__scopeAccordion:u,value:f,...z}=l,t=Ze(qe,u),m=va(qe,u),S=ps(u),I=Ks(),h=f&&m.value.includes(f)||!1,o=t.disabled||l.disabled;return e.jsx(ba,{scope:u,open:h,disabled:o,triggerId:I,children:e.jsx(la,{"data-orientation":t.orientation,"data-state":Hs(h),...S,...z,ref:k,disabled:o,open:h,onOpenChange:x=>{x?m.onItemOpen(f):m.onItemClose(f)}})})});Rs.displayName=qe;var Bs="AccordionHeader",Es=ie.forwardRef((l,k)=>{const{__scopeAccordion:u,...f}=l,z=Ze(je,u),t=js(Bs,u);return e.jsx(Ds.h3,{"data-orientation":z.orientation,"data-state":Hs(t.open),"data-disabled":t.disabled?"":void 0,...f,ref:k})});Es.displayName=Bs;var cs="AccordionTrigger",Os=ie.forwardRef((l,k)=>{const{__scopeAccordion:u,...f}=l,z=Ze(je,u),t=js(cs,u),m=ya(cs,u),S=ps(u);return e.jsx(us.ItemSlot,{scope:u,children:e.jsx(ra,{"aria-disabled":t.open&&!m.collapsible||void 0,"data-orientation":z.orientation,id:t.triggerId,...S,...f,ref:k})})});Os.displayName=cs;var Ls="AccordionContent",$s=ie.forwardRef((l,k)=>{const{__scopeAccordion:u,...f}=l,z=Ze(je,u),t=js(Ls,u),m=ps(u);return e.jsx(ca,{role:"region","aria-labelledby":t.triggerId,"data-orientation":z.orientation,...m,...f,ref:k,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...l.style}})});$s.displayName=Ls;function Hs(l){return l?"open":"closed"}var ka=ws,Da=Rs,Sa=Es,Ca=Os,za=$s;function Aa({...l}){return e.jsx(ka,{"data-slot":"accordion",...l})}function Fa({className:l,...k}){return e.jsx(Da,{"data-slot":"accordion-item",className:ds("border-b last:border-b-0",l),...k})}function Ta({className:l,children:k,...u}){return e.jsx(Sa,{className:"flex",children:e.jsxs(Ca,{"data-slot":"accordion-trigger",className:ds("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",l),...u,children:[k,e.jsx(Ts,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function wa({className:l,children:k,...u}){return e.jsx(za,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...u,children:e.jsx("div",{className:ds("pt-0 pb-4",l),children:k})})}function Pa({customer:l,onUpdate:k}){var h;const[u,f]=D.useState(!1),z=((h=l.serviceFeeSettings)==null?void 0:h.reminderSettings)||{day3Enabled:!0,day5Enabled:!0,day10AutoSuspend:!0,customMessage:""},[t,m]=D.useState(z),S=()=>{if(!l.serviceFeeSettings){Q.error("MÃ¼ÅŸteri aidat ayarlarÄ± bulunamadÄ±");return}const o={...l,serviceFeeSettings:{...l.serviceFeeSettings,reminderSettings:t}};k(o),Q.success("âœ… HatÄ±rlatma ayarlarÄ± kaydedildi"),f(!1)},I=()=>{m(z),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>f(!0),className:"flex items-center gap-2",children:[e.jsx(Ws,{size:16}),e.jsx("span",{children:"HatÄ±rlatma AyarlarÄ±"}),(!z.day3Enabled||!z.day5Enabled)&&e.jsx(A,{variant:"outline",className:"ml-1 bg-yellow-50 text-yellow-700",children:"DeÄŸiÅŸtirilmiÅŸ"})]}),e.jsx(ze,{open:u,onOpenChange:f,children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsxs(Fe,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(Ye,{size:20}),"HatÄ±rlatma AyarlarÄ± - ",l.cariAdi]}),e.jsx(we,{children:"MÃ¼ÅŸteriye gÃ¶nderilecek Ã¶deme hatÄ±rlatmalarÄ±nÄ± ve otomatik dondurma kurallarÄ±nÄ± yÃ¶netin."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{className:t.day3Enabled?"border-green-300 bg-green-50":"border-gray-200",children:[e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ae,{className:"text-base",children:"3. GÃ¼n HatÄ±rlatmasÄ±"}),e.jsx(Se,{checked:t.day3Enabled,onCheckedChange:o=>m({...t,day3Enabled:o})})]})}),e.jsx(w,{children:e.jsx("p",{className:"text-sm text-gray-600",children:t.day3Enabled?e.jsx("span",{className:"text-green-700",children:"âœ“ Ã–deme vadesi 3 gÃ¼n kala mÃ¼ÅŸteriye otomatik hatÄ±rlatma gÃ¶nderilecek"}):e.jsx("span",{className:"text-red-700",children:"âœ— 3. gÃ¼n hatÄ±rlatmasÄ± devre dÄ±ÅŸÄ± - sistem bu hatÄ±rlatmayÄ± es geÃ§ecek"})})})]}),e.jsxs(T,{className:t.day5Enabled?"border-orange-300 bg-orange-50":"border-gray-200",children:[e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ae,{className:"text-base",children:"5. GÃ¼n HatÄ±rlatmasÄ±"}),e.jsx(Se,{checked:t.day5Enabled,onCheckedChange:o=>m({...t,day5Enabled:o})})]})}),e.jsx(w,{children:e.jsx("p",{className:"text-sm text-gray-600",children:t.day5Enabled?e.jsx("span",{className:"text-orange-700",children:"âœ“ Ã–deme vadesi 5 gÃ¼n geÃ§ince mÃ¼ÅŸteriye uyarÄ± hatÄ±rlatmasÄ± gÃ¶nderilecek"}):e.jsx("span",{className:"text-red-700",children:"âœ— 5. gÃ¼n hatÄ±rlatmasÄ± devre dÄ±ÅŸÄ± - sistem bu hatÄ±rlatmayÄ± es geÃ§ecek"})})})]}),e.jsxs(T,{className:t.day10AutoSuspend?"border-red-300 bg-red-50":"border-gray-200",children:[e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ae,{className:"text-base",children:"10. GÃ¼n Otomatik Dondurma"}),e.jsx(Se,{checked:t.day10AutoSuspend,onCheckedChange:o=>m({...t,day10AutoSuspend:o})})]})}),e.jsx(w,{children:e.jsx("p",{className:"text-sm text-gray-600",children:t.day10AutoSuspend?e.jsx("span",{className:"text-red-700",children:"âš ï¸ Ã–deme vadesi 10 gÃ¼n geÃ§ince mÃ¼ÅŸteri hizmeti otomatik olarak dondurulacak"}):e.jsx("span",{className:"text-gray-700",children:"â„¹ï¸ 10. gÃ¼nde otomatik dondurma yapÄ±lmayacak - manuel iÅŸlem gerekir"})})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"customMessage",children:"Ã–zel HatÄ±rlatma MesajÄ± (Opsiyonel)"}),e.jsx(ns,{id:"customMessage",placeholder:"Ã–rn: SayÄ±n mÃ¼ÅŸterimiz, aylÄ±k aidat bedeliniz iÃ§in Ã¶deme beklenmektedir...",value:t.customMessage||"",onChange:o=>m({...t,customMessage:o.target.value}),rows:3}),e.jsx("p",{className:"text-xs text-gray-500",children:"BoÅŸ bÄ±rakÄ±rsanÄ±z varsayÄ±lan mesaj kullanÄ±lacaktÄ±r"})]})]}),e.jsxs(Pe,{children:[e.jsxs(K,{variant:"outline",onClick:I,children:[e.jsx(Cs,{size:16,className:"mr-2"}),"Ä°ptal"]}),e.jsxs(K,{onClick:S,children:[e.jsx(oa,{size:16,className:"mr-2"}),"Kaydet"]})]})]})})]})}function Ia({devices:l,selectedPeriod:k,onApprove:u,onCancel:f}){const[z,t]=D.useState(!0),[m,S]=D.useState(!1),[I,h]=D.useState(0),o=l.reduce((s,c)=>s+c.monthlyFee,0),x=new Set(l.map(s=>s.customerId)).size,C=async()=>{S(!0),h(0);for(let s=0;s<=100;s+=10)await new Promise(c=>setTimeout(c,50)),h(s);u(l,z),S(!1)};l.filter(s=>s.currentInvoice);const v=l.filter(s=>!s.currentInvoice);return e.jsx(ze,{open:!0,onOpenChange:s=>!s&&f(),children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsxs(Fe,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(ge,{size:20,className:"text-green-600"}),"Toplu Ã–deme OnayÄ±"]}),e.jsxs(we,{children:["SeÃ§ili ",l.length," cihaz iÃ§in Ã¶deme onayÄ± yapÄ±lacak"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Toplam Cihaz"}),e.jsx("p",{className:"text-2xl text-blue-600",children:l.length})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"MÃ¼ÅŸteri SayÄ±sÄ±"}),e.jsx("p",{className:"text-2xl text-green-600",children:x})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Toplam Tutar"}),e.jsxs("p",{className:"text-2xl text-purple-600",children:[o.toFixed(2)," â‚¬"]})]})]}),v.length>0&&e.jsxs(Oe,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsxs(Le,{children:[e.jsxs("strong",{children:[v.length," cihaz"]})," iÃ§in bu dÃ¶nem faturasÄ± bulunmuyor.",z?e.jsx("span",{className:"text-green-700",children:" Otomatik olarak fatura oluÅŸturulacak."}):e.jsx("span",{className:"text-orange-700",children:" Fatura oluÅŸturulmadan sadece Ã¶deme durumu gÃ¼ncellenecek."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",children:[e.jsx(Ie,{id:"createInvoice",checked:z,onCheckedChange:s=>t(s),disabled:m}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Y,{htmlFor:"createInvoice",className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qs,{size:16}),e.jsx("span",{children:"Fatura KayÄ±tlarÄ±na Ekle"})]})}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:z?e.jsx("span",{children:"âœ“ Onaylanan Ã¶demeler iÃ§in fatura kayÄ±tlarÄ± oluÅŸturulacak ve Fatura KayÄ±tlarÄ± sayfasÄ±na eklenecek"}):e.jsx("span",{children:"Sadece Ã¶deme durumu gÃ¼ncellenecek, fatura kaydÄ± oluÅŸturulmayacak"})})]})]}),e.jsxs("div",{className:"border rounded-lg",style:{maxHeight:"60vh",overflowY:"auto"},children:[e.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b sticky top-0",children:e.jsx("p",{className:"text-sm",children:"Onaylanacak Cihazlar"})}),e.jsx("div",{className:"divide-y",children:l.map((s,c)=>e.jsx("div",{className:"px-4 py-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:s.customerName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.deviceSerial,s.currentInvoice&&e.jsxs(A,{variant:"outline",className:"ml-2 text-xs bg-blue-50",children:["Fatura: ",s.currentInvoice.invoiceNumber]})]})]}),e.jsxs("p",{className:"text-sm text-green-600",children:[s.monthlyFee.toFixed(2)," â‚¬"]})]})},c))})]}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ä°ÅŸleniyor..."}),e.jsxs("span",{className:"text-blue-600",children:[I,"%"]})]}),e.jsx(xa,{value:I,className:"w-full"})]}),e.jsxs(Oe,{className:"bg-blue-50 border-blue-200",children:[e.jsx($e,{className:"h-4 w-4 text-blue-600"}),e.jsxs(Le,{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Senkronizasyon:"})," Bu iÅŸlem tÃ¼m sistemi gÃ¼ncelleyecektir:",e.jsxs("ul",{className:"list-disc list-inside mt-1 text-xs space-y-1",children:[e.jsx("li",{children:"MÃ¼ÅŸteri Cari KartlarÄ±ndaki Ã¶deme durumlarÄ±"}),z&&e.jsx("li",{children:"Fatura KayÄ±tlarÄ± sayfasÄ±na yeni kayÄ±tlar"}),e.jsx("li",{children:"Gelir modÃ¼lÃ¼ istatistikleri"}),e.jsx("li",{children:"Banka/PF iliÅŸkilendirme raporlarÄ±"})]})]})]})]}),e.jsxs(Pe,{children:[e.jsxs(K,{variant:"outline",onClick:f,disabled:m,children:[e.jsx(Cs,{size:16,className:"mr-2"}),"Ä°ptal"]}),e.jsxs(K,{onClick:C,disabled:m,children:[e.jsx(ge,{size:16,className:"mr-2"}),m?"Ä°ÅŸleniyor...":`${l.length} Ã–demeyi Onayla`]})]})]})})}function Ma({customers:l,payterProducts:k,selectedPeriod:u,onSuspendDevices:f}){const[z,t]=D.useState(""),[m,S]=D.useState(new Set),I=D.useMemo(()=>{const s=[];return l.forEach(c=>{if(!c.serviceFeeSettings)return;const g=c.serviceFeeSettings,n=c.domain||c.guncelMyPayterDomain;if(!n)return;k.filter(r=>r.domain?Xe(r.domain,n,c.ignoreMainDomain||!1,c.domainHierarchy):!1).forEach(r=>{var _;const M=g.deviceSubscriptions.find(E=>E.deviceId===r.id)||{deviceId:r.id,deviceSerialNumber:r.serialNumber||"",deviceName:r.name||"",monthlyFee:g.customFeePerDevice||g.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending"},F=g.invoices.find(E=>E.period===u),G=(_=c.bankDeviceAssignments)==null?void 0:_.find(E=>E.deviceIds.includes(r.id));if(F&&!F.paymentConfirmed&&!F.isSuspended){const E=new Date(F.dueDate),ee=Math.floor((new Date().getTime()-E.getTime())/(1e3*60*60*24));ee>=10&&M.isActive&&s.push({customer:c,device:M,deviceDomain:r.domain||"",monthlyFee:M.monthlyFee,daysOverdue:ee,bankName:(G==null?void 0:G.bankName)||null})}})}),s.sort((c,g)=>g.daysOverdue-c.daysOverdue)},[l,k,u]),h=D.useMemo(()=>{if(!z)return I;const s=z.toLowerCase();return I.filter(c=>c.customer.cariAdi.toLowerCase().includes(s)||c.customer.cariHesapKodu.toLowerCase().includes(s)||c.device.deviceSerialNumber.toLowerCase().includes(s)||c.deviceDomain.toLowerCase().includes(s))},[I,z]),o=D.useMemo(()=>{const s=new Map;return h.forEach(c=>{const g=c.customer.id;s.has(g)||s.set(g,{customer:c.customer,devices:[],totalDevices:0,totalAmount:0,maxDaysOverdue:0});const n=s.get(g);n.devices.push(c),n.totalDevices++,n.totalAmount+=c.monthlyFee,n.maxDaysOverdue=Math.max(n.maxDaysOverdue,c.daysOverdue)}),Array.from(s.values()).sort((c,g)=>g.maxDaysOverdue-c.maxDaysOverdue)},[h]),x=(s,c)=>{const g=`${s}-${c}`,n=new Set(m);n.has(g)?n.delete(g):n.add(g),S(n)},C=(s,c)=>{const g=new Set(m),n=c.every(p=>g.has(`${s}-${p.device.deviceId}`));c.forEach(p=>{const r=`${s}-${p.device.deviceId}`;n?g.delete(r):g.add(r)}),S(g)},v=()=>{const s=h.filter(c=>m.has(`${c.customer.id}-${c.device.deviceId}`));if(s.length===0){Q.error("LÃ¼tfen en az bir cihaz seÃ§in");return}f(s),S(new Set)};return I.length===0?null:e.jsxs(T,{className:"border-red-300 bg-red-50",children:[e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(os,{size:24,className:"text-red-600"}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-red-900",children:"Hizmeti Dondurulacak Firmalar (10+ GÃ¼n Gecikme)"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:[o.length," firma, ",I.length," cihaz"]})]})]}),m.size>0&&e.jsxs(K,{variant:"destructive",onClick:v,className:"flex items-center gap-2",children:[e.jsx(Ce,{size:16}),e.jsxs("span",{children:[m.size," CihazÄ± Dondur"]})]})]})}),e.jsxs(w,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx(re,{placeholder:"MÃ¼ÅŸteri, cihaz seri no, domain ara...",value:z,onChange:s=>t(s.target.value),className:"pl-10 bg-white"})]})}),e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",children:h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-600",children:"Arama kriterine uygun kayÄ±t bulunamadÄ±"}):e.jsx("div",{className:"space-y-2 p-4",children:o.map(s=>{const c=s.devices.every(g=>m.has(`${s.customer.id}-${g.device.deviceId}`));return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-red-100 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{checked:c,onCheckedChange:()=>C(s.customer.id,s.devices)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-900",children:s.customer.cariAdi}),e.jsx("p",{className:"text-xs text-red-700",children:s.customer.cariHesapKodu})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ls,{size:14}),s.maxDaysOverdue," gÃ¼n gecikme"]}),e.jsxs(A,{variant:"outline",className:"bg-white",children:[s.totalDevices," cihaz"]}),e.jsxs("span",{className:"text-red-900",children:[s.totalAmount.toFixed(2)," â‚¬"]})]})]}),e.jsx("div",{className:"divide-y bg-white",children:s.devices.map(g=>e.jsx("div",{className:"px-4 py-2 flex items-center justify-between hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(Ie,{checked:m.has(`${s.customer.id}-${g.device.deviceId}`),onCheckedChange:()=>x(s.customer.id,g.device.deviceId)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:g.device.deviceSerialNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:g.deviceDomain})]}),g.bankName&&e.jsx(A,{variant:"outline",className:"text-xs",children:g.bankName}),e.jsxs("span",{className:"text-sm text-gray-900 min-w-[80px] text-right",children:[g.monthlyFee.toFixed(2)," â‚¬"]}),e.jsxs(A,{variant:"destructive",className:"min-w-[100px] text-center",children:[g.daysOverdue," gÃ¼n gecikti"]})]})},g.device.deviceId))})]},s.customer.id)})})})]})]})}const Ra=[{key:"customerName",label:"MÃ¼ÅŸteri AdÄ±",defaultVisible:!0},{key:"customerCode",label:"Cari Hesap Kodu",defaultVisible:!0},{key:"domain",label:"Domain",defaultVisible:!0},{key:"serialNumber",label:"Seri No",defaultVisible:!0},{key:"bankName",label:"Banka",defaultVisible:!0},{key:"subscriptionType",label:"Abonelik Tipi",defaultVisible:!0},{key:"monthlyFee",label:"Ãœcret",defaultVisible:!0},{key:"status",label:"Durum",defaultVisible:!0},{key:"payment",label:"Ã–deme",defaultVisible:!0},{key:"reminder",label:"HatÄ±rlatma",defaultVisible:!0},{key:"actions",label:"Aksiyon",defaultVisible:!0}];function Ba({customers:l,payterProducts:k,onUpdateCustomer:u,selectedPeriod:f,suspensionReasons:z}){const[t,m]=D.useState(""),[S,I]=D.useState("all"),[h,o]=D.useState("all"),[x,C]=D.useState("all"),[v,s]=D.useState(new Set),[c,g]=D.useState("customerName"),[n,p]=D.useState("asc"),[r,R]=D.useState({}),[M,F]=D.useState({open:!1,devices:[]}),[G,_]=D.useState(""),[E,U]=D.useState(""),[ee,V]=D.useState({open:!1}),O=a=>{R(a)},ce=a=>a?a.toLowerCase().trim().replace(/^https?:\/\//,"").replace(/\/$/,""):"",i=(a,d,y=!1)=>{const j=ce(a),B=ce(d);return!j||!B?!1:y?j===B?!1:j.endsWith("."+B):j===B},N=D.useMemo(()=>{const a=[];return l.forEach(d=>{if(!d.serviceFeeSettings)return;const y=d.serviceFeeSettings,j=d.domain||d.guncelMyPayterDomain;if(!j)return;k.filter(P=>P.domain?i(P.domain,j,d.ignoreMainDomain||!1):!1).forEach(P=>{var Be;const H=y.deviceSubscriptions.find(ye=>ye.deviceId===P.id)||{deviceId:P.id,deviceSerialNumber:P.serialNumber||"",deviceName:P.name||"",monthlyFee:y.customFeePerDevice||y.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending"},le=(Be=d.bankDeviceAssignments)==null?void 0:Be.find(ye=>ye.deviceIds.includes(P.id)),W=y.invoices.find(ye=>ye.period===f);let he;if(W){const ye=new Date(W.dueDate),ue=new Date;he=Math.floor((ye.getTime()-ue.getTime())/(1e3*60*60*24))}a.push({customer:d,device:H,deviceDomain:P.domain||"",bankName:(le==null?void 0:le.bankName)||null,bankCode:(le==null?void 0:le.bankCode)||null,monthlyFee:H.monthlyFee,subscriptionType:y.paymentType,isActive:H.isActive&&!(W!=null&&W.isSuspended),hasBankAssignment:!!le,currentInvoice:W,daysUntilDue:he,paymentConfirmed:(W==null?void 0:W.paymentConfirmed)||!1})})}),a},[l,k,f]),L=D.useMemo(()=>{const a={active:0,suspended:0,bankless:0};return N.forEach(d=>{d.isActive&&d.hasBankAssignment&&a.active++,d.isActive||a.suspended++,d.hasBankAssignment||a.bankless++}),[{value:"active",label:"Aktif",count:a.active},{value:"suspended",label:"DondurulmuÅŸ",count:a.suspended},{value:"bankless",label:"Banka TanÄ±msÄ±z",count:a.bankless}]},[N]),te=D.useMemo(()=>{const a={confirmed:0,pending:0,overdue:0};return N.forEach(d=>{d.paymentConfirmed?a.confirmed++:d.daysUntilDue&&d.daysUntilDue<0?a.overdue++:a.pending++}),[{value:"confirmed",label:"OnaylandÄ±",count:a.confirmed},{value:"pending",label:"Bekliyor",count:a.pending},{value:"overdue",label:"GecikmiÅŸ",count:a.overdue}]},[N]),X=D.useMemo(()=>{const a={monthly:0,yearly:0};return N.forEach(d=>{d.subscriptionType==="monthly"&&a.monthly++,d.subscriptionType==="yearly"&&a.yearly++}),[{value:"monthly",label:"AylÄ±k",count:a.monthly},{value:"yearly",label:"YÄ±llÄ±k",count:a.yearly}]},[N]),$=D.useMemo(()=>{let a=N.filter(d=>{if(t){const y=t.toLowerCase();if(!(d.customer.cariAdi.toLowerCase().includes(y)||d.customer.cariHesapKodu.toLowerCase().includes(y)||d.device.deviceSerialNumber.toLowerCase().includes(y)||d.deviceDomain.toLowerCase().includes(y)||d.bankName&&d.bankName.toLowerCase().includes(y)))return!1}return!(S==="active"&&!d.isActive||S==="suspended"&&d.isActive||S==="bankless"&&d.hasBankAssignment||h==="confirmed"&&!d.paymentConfirmed||h==="pending"&&(d.paymentConfirmed||d.daysUntilDue&&d.daysUntilDue<0)||h==="overdue"&&(!d.daysUntilDue||d.daysUntilDue>=0)||x==="monthly"&&d.subscriptionType!=="monthly"||x==="yearly"&&d.subscriptionType!=="yearly")});return a.sort((d,y)=>{let j,B;switch(c){case"customerName":j=d.customer.cariAdi,B=y.customer.cariAdi;break;case"domain":j=d.deviceDomain,B=y.deviceDomain;break;case"serialNumber":j=d.device.deviceSerialNumber,B=y.device.deviceSerialNumber;break;case"bankName":j=d.bankName||"",B=y.bankName||"";break;case"monthlyFee":return j=d.monthlyFee,B=y.monthlyFee,n==="asc"?j-B:B-j;default:j=d.customer.cariAdi,B=y.customer.cariAdi}return typeof j=="string"&&typeof B=="string"?n==="asc"?j.localeCompare(B,"tr"):B.localeCompare(j,"tr"):0}),a},[N,t,S,h,x,c,n]),Ne=D.useMemo(()=>{const a=new Map;return $.forEach(d=>{const y=d.customer.id;a.has(y)||a.set(y,{customer:d.customer,devices:[],totalDevices:0,activeDevices:0,suspendedDevices:0,totalRevenue:0,confirmedPayments:0,pendingPayments:0,overduePayments:0,banklessDevices:0});const j=a.get(y);j.devices.push(d),j.totalDevices++,d.isActive?(j.activeDevices++,d.hasBankAssignment&&(j.totalRevenue+=d.monthlyFee)):j.suspendedDevices++,d.hasBankAssignment||j.banklessDevices++,d.paymentConfirmed?j.confirmedPayments++:d.daysUntilDue!==void 0&&(d.daysUntilDue<0?j.overduePayments++:j.pendingPayments++)}),Array.from(a.values()).sort((d,y)=>d.customer.cariAdi.localeCompare(y.customer.cariAdi,"tr"))},[$]),J=(a,d)=>{if(!a.currentInvoice){Q.error("Bu dÃ¶nem iÃ§in fatura bulunamadÄ±");return}const y={...a.customer};if(!y.serviceFeeSettings)return;const j=y.serviceFeeSettings.invoices.findIndex(B=>B.id===a.currentInvoice.id);j!==-1&&(y.serviceFeeSettings.invoices[j]={...a.currentInvoice,paymentConfirmed:d,paymentConfirmedDate:d?new Date().toISOString().split("T")[0]:void 0,status:d?"paid":"pending"},u(y),Q.success(d?"âœ… Ã–deme onaylandÄ±":"âŒ Ã–deme onayÄ± kaldÄ±rÄ±ldÄ±"))},ve=(a,d)=>{if(!a.currentInvoice)return;const y={...a.customer};if(!y.serviceFeeSettings)return;const j=y.serviceFeeSettings.invoices.findIndex(P=>P.id===a.currentInvoice.id);if(j===-1)return;const B=a.currentInvoice.remindersSent||[];if(B.includes(d)){Q.info(`${d}. gÃ¼n hatÄ±rlatmasÄ± zaten gÃ¶nderildi`);return}y.serviceFeeSettings.invoices[j]={...a.currentInvoice,remindersSent:[...B,d]},u(y),console.log("ðŸ“§ HATIRLATMA GÃ–NDERÄ°LDÄ°:",{mÃ¼ÅŸteri:a.customer.cariAdi,email:a.customer.email,telefon:a.customer.tel,gÃ¼n:d,mesaj:`SayÄ±n ${a.customer.yetkili}, ${f} dÃ¶nemi aidat bedeliniz (${a.monthlyFee.toFixed(2)} â‚¬) iÃ§in Ã¶deme beklenmektedir.`}),Q.success(`ðŸ“§ ${d}. gÃ¼n hatÄ±rlatmasÄ± gÃ¶nderildi (simÃ¼lasyon)`)},ne=()=>{try{const a=$.map(P=>({"MÃ¼ÅŸteri AdÄ±":P.customer.cariAdi,"Cari Hesap Kodu":P.customer.cariHesapKodu,Domain:P.deviceDomain,"Seri No":P.device.deviceSerialNumber,Banka:P.bankName||"TanÄ±msÄ±z","Banka Kodu":P.bankCode||"-","Abonelik Tipi":P.subscriptionType==="monthly"?"AylÄ±k":"YÄ±llÄ±k","AylÄ±k Ãœcret (â‚¬)":P.monthlyFee.toFixed(2),Durum:P.isActive?"Aktif":"AskÄ±da","Ã–deme Durumu":P.paymentConfirmed?"AlÄ±ndÄ±":P.daysUntilDue&&P.daysUntilDue<0?"GecikmiÅŸ":"Bekliyor","Kalan GÃ¼n":P.daysUntilDue||"-",DÃ¶nem:f})),d=ts.json_to_sheet(a),y=ts.book_new();ts.book_append_sheet(y,d,"Aidat Cihaz Listesi");const j=[{wch:30},{wch:20},{wch:25},{wch:15},{wch:25},{wch:15},{wch:15},{wch:15},{wch:12},{wch:15},{wch:12},{wch:12}];d["!cols"]=j;const B=`Aidat_Cihaz_Listesi_${f}_${new Date().toISOString().split("T")[0]}.xlsx`;na(y,B),Q.success(`âœ… ${$.length} kayÄ±t Excel'e aktarÄ±ldÄ±`)}catch(a){console.error("Excel export hatasÄ±:",a),Q.error("Excel export sÄ±rasÄ±nda hata oluÅŸtu")}},Qe=()=>{const a=$.filter(d=>v.has(`${d.customer.id}-${d.device.deviceId}`));if(a.length===0){Q.error("LÃ¼tfen en az bir cihaz seÃ§in");return}F({open:!0,devices:a})},de=()=>{M.devices.forEach(a=>{const d={...a.customer};if(!d.serviceFeeSettings||!a.currentInvoice)return;const y=d.serviceFeeSettings.invoices.findIndex(j=>j.id===a.currentInvoice.id);y!==-1&&(d.serviceFeeSettings.invoices[y]={...a.currentInvoice,isSuspended:!0,suspensionDate:new Date().toISOString().split("T")[0],manualSuspensionReason:G,suspensionUntilDate:E||void 0},u(d),console.log("ðŸš« HÄ°ZMET DONDURMA BÄ°LDÄ°RÄ°MÄ°:",{mÃ¼ÅŸteri:a.customer.cariAdi,cihaz:a.device.deviceSerialNumber,sebep:G,tarih:E}))}),Q.success(`ðŸš« ${M.devices.length} cihaz donduruldu`),F({open:!1,devices:[]}),_(""),U(""),s(new Set)},Ge=a=>{V({open:!0,customerId:a})},fe=(a,d)=>{a.forEach(y=>{const j=l.find(b=>b.id===y.customerId);if(!j||!j.serviceFeeSettings)return;const B={...j};let P=B.serviceFeeSettings.invoices.findIndex(b=>b.id===y.invoiceId);if(P===-1&&d){const b={id:`INV-${Date.now()}-${Math.random().toString(36).substring(7)}`,invoiceNumber:`AI-${f}-${j.cariHesapKodu}`,invoiceDate:new Date().toISOString().split("T")[0],period:f,deviceCount:1,totalAmount:y.monthlyFee,status:"paid",paymentDate:new Date().toISOString().split("T")[0],dueDate:new Date().toISOString().split("T")[0],devices:[y],paymentConfirmed:!0,paymentConfirmedDate:new Date().toISOString().split("T")[0]};B.serviceFeeSettings.invoices.push(b)}else P!==-1&&(B.serviceFeeSettings.invoices[P]={...B.serviceFeeSettings.invoices[P],paymentConfirmed:!0,paymentConfirmedDate:new Date().toISOString().split("T")[0],status:"paid",paymentDate:new Date().toISOString().split("T")[0]});u(B)}),Q.success(`âœ… ${a.length} cihaz Ã¶demesi onaylandÄ±${d?" ve fatura kayÄ±tlarÄ± oluÅŸturuldu":""}`),V({open:!1}),s(new Set)},es=a=>{F({open:!0,devices:a}),_("10 gÃ¼n Ã¶deme gecikmesi - otomatik dondurma")};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ma,{customers:l,payterProducts:k,selectedPeriod:f,onSuspendDevices:es}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(A,{variant:"outline",className:"text-sm px-3 py-1",children:["Toplam: ",N.length," cihaz"]}),$.length!==N.length&&e.jsxs(A,{variant:"outline",className:"text-sm px-3 py-1",children:["FiltrelenmiÅŸ: ",$.length," cihaz"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(K,{variant:"outline",size:"sm",onClick:ne,className:"flex items-center gap-2",title:"Cihaz listesini Excel'e aktar",children:[e.jsx(Xs,{size:16}),e.jsx("span",{children:"Excel Ä°ndir"})]})})]}),e.jsx(T,{children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"relative col-span-2",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx(re,{placeholder:"MÃ¼ÅŸteri, cihaz seri no, domain, banka ara...",value:t,onChange:a=>m(a.target.value),className:"pl-10"})]}),e.jsx(as,{label:"Durum",options:L,value:S,onChange:I,allLabel:"TÃ¼m Durumlar",showCount:!0}),e.jsx(as,{label:"Ã–deme Durumu",options:te,value:h,onChange:o,allLabel:"TÃ¼m Ã–demeler",showCount:!0}),e.jsx(as,{label:"Abonelik Tipi",options:X,value:x,onChange:C,allLabel:"TÃ¼m Abonelikler",showCount:!0}),e.jsxs(K,{variant:"outline",onClick:()=>{m(""),I("all"),o("all"),C("all")},children:[e.jsx(ta,{size:16,className:"mr-2"}),"SÄ±fÄ±rla"]})]}),e.jsx("div",{className:"flex justify-start",children:e.jsx(aa,{columns:Ra,storageKey:"subscriptionFeesTable",onVisibilityChange:O})})]})})}),v.size>0&&e.jsx(T,{className:"border-orange-300 bg-orange-50",children:e.jsx(w,{className:"pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:v.size})," cihaz seÃ§ildi"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{variant:"outline",size:"sm",onClick:()=>s(new Set),children:"SeÃ§imi Temizle"}),e.jsxs(K,{variant:"destructive",size:"sm",onClick:Qe,children:[e.jsx(Ce,{size:16,className:"mr-2"}),"Toplu Dondur"]})]})]})})}),e.jsxs(T,{children:[e.jsxs(se,{children:[e.jsxs(ae,{children:["Aidat Bedelleri - Cihaz DetaylÄ± Liste (",$.length," cihaz, ",Ne.length," mÃ¼ÅŸteri)"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["DÃ¶nem: ",f]})]}),e.jsx(w,{children:$.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:"Filtreye uygun kayÄ±t bulunamadÄ±"})}):e.jsx(Aa,{type:"multiple",className:"space-y-2",children:Ne.map(a=>{var P;const d=a.customer.id,y=a.devices.reduce((b,H)=>H.daysUntilDue===void 0?b:b===void 0?H.daysUntilDue:Math.min(b,H.daysUntilDue),void 0),j=((P=a.customer.serviceFeeSettings)==null?void 0:P.reminderSettings)||{day3Enabled:!0,day5Enabled:!0,day10AutoSuspend:!0},B=a.devices.filter(b=>!b.paymentConfirmed&&b.isActive&&b.hasBankAssignment);return e.jsxs(Fa,{value:d,className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 border-b border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:`font-medium ${a.customer.durum==="Pasif"?"line-through text-gray-500":"text-gray-900"}`,children:a.customer.cariAdi}),e.jsx("p",{className:`text-xs ${a.customer.durum==="Pasif"?"line-through text-gray-400":"text-gray-500"}`,children:a.customer.cariHesapKodu})]}),y!==void 0&&y<0&&e.jsxs(A,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ls,{size:14}),"Ã–deme Gecikmesi: ",Math.abs(y)," GÃ¼n"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",className:"bg-blue-50",children:[a.totalDevices," cihaz"]}),a.activeDevices>0&&e.jsxs(A,{className:"bg-green-100 text-green-700",children:[a.activeDevices," aktif"]}),a.suspendedDevices>0&&e.jsxs(A,{className:"bg-orange-100 text-orange-700",children:[a.suspendedDevices," askÄ±da"]})]}),e.jsxs("div",{className:"flex items-center gap-2",onClick:b=>b.stopPropagation(),children:[B.length>0&&e.jsxs(oe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(K,{size:"sm",variant:"outline",className:"bg-blue-50 border-blue-300 text-blue-700 hover:bg-blue-100",onClick:()=>Ge(a.customer.id),children:[e.jsx(ge,{size:16,className:"mr-2"}),"Ã–demeyi Toplu Onayla (",B.length,")"]})}),e.jsx(me,{children:"TÃ¼m cihazlarÄ±n Ã¶demesini onayla ve fatura kayÄ±tlarÄ± oluÅŸtur"})]}),e.jsx(Pa,{customer:a.customer,onUpdate:u})]})]}),e.jsxs("div",{className:"px-4 py-2 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{checked:j.day3Enabled,disabled:!0,className:"h-4 w-8"}),e.jsxs("span",{className:`text-xs ${j.day3Enabled?"text-green-700":"text-gray-400"}`,children:[j.day3Enabled?e.jsx(Ye,{size:14,className:"inline mr-1"}):e.jsx(fs,{size:14,className:"inline mr-1"}),"3. GÃ¼n HatÄ±rlat"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{checked:j.day5Enabled,disabled:!0,className:"h-4 w-8"}),e.jsxs("span",{className:`text-xs ${j.day5Enabled?"text-orange-700":"text-gray-400"}`,children:[j.day5Enabled?e.jsx(Ye,{size:14,className:"inline mr-1"}):e.jsx(fs,{size:14,className:"inline mr-1"}),"5. GÃ¼n HatÄ±rlat"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{checked:j.day10AutoSuspend,disabled:!0,className:"h-4 w-8"}),e.jsxs("span",{className:`text-xs ${j.day10AutoSuspend?"text-red-700":"text-gray-400"}`,children:[j.day10AutoSuspend?e.jsx(Ce,{size:14,className:"inline mr-1"}):"","10. GÃ¼n Otomatik Dondur"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"text-green-600",children:[a.totalRevenue.toFixed(2)," â‚¬"]})," / ",e.jsxs("span",{className:"text-xs",children:["âœ“ ",a.confirmedPayments," | â± ",a.pendingPayments," | ! ",a.overduePayments]})]})]})]}),e.jsx(Ta,{className:"px-4 py-2 hover:bg-gray-50 hover:no-underline",children:e.jsx("div",{className:"text-sm text-gray-600",children:"Cihaz DetaylarÄ±nÄ± GÃ¶ster / Gizle"})}),e.jsx(wa,{className:"px-0 pb-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-3 w-8",children:e.jsx(Ie,{checked:a.devices.every(b=>v.has(`${b.customer.id}-${b.device.deviceId}`)),onCheckedChange:b=>{const H=new Set(v);a.devices.forEach(le=>{const W=`${le.customer.id}-${le.device.deviceId}`;b?H.add(W):H.delete(W)}),s(H)}})}),r.domain!==!1&&e.jsx("th",{className:"text-left py-2 px-3",children:"Domain"}),r.serialNumber!==!1&&e.jsx("th",{className:"text-left py-2 px-3",children:"Seri No"}),r.bankName!==!1&&e.jsx("th",{className:"text-left py-2 px-3",children:"Banka"}),r.subscriptionType!==!1&&e.jsx("th",{className:"text-left py-2 px-3",children:"Abonelik"}),r.monthlyFee!==!1&&e.jsx("th",{className:"text-left py-2 px-3",children:"Ãœcret"}),r.status!==!1&&e.jsx("th",{className:"text-center py-2 px-3",children:"Durum"}),r.payment!==!1&&e.jsx("th",{className:"text-center py-2 px-3",children:"Ã–deme"}),r.reminder!==!1&&e.jsx("th",{className:"text-center py-2 px-3",children:"HatÄ±rlatma"}),r.actions!==!1&&e.jsx("th",{className:"text-center py-2 px-3",children:"Aksiyon"})]})}),e.jsx("tbody",{children:a.devices.map(b=>{var he,Be,ye;const H=`${b.customer.id}-${b.device.deviceId}`,le=v.has(H),W=((he=b.currentInvoice)==null?void 0:he.remindersSent)||[];return e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${b.isActive?"":"bg-orange-50"} ${b.hasBankAssignment?"":"bg-purple-50"}`,children:[e.jsx("td",{className:"py-2 px-3",children:e.jsx(Ie,{checked:le,onCheckedChange:ue=>{const ss=new Set(v);ue?ss.add(H):ss.delete(H),s(ss)}})}),r.domain!==!1&&e.jsx("td",{className:"py-2 px-3",children:e.jsx("p",{className:"text-xs",children:b.deviceDomain})}),r.serialNumber!==!1&&e.jsx("td",{className:"py-2 px-3",children:e.jsx("p",{className:"text-xs",children:b.device.deviceSerialNumber})}),r.bankName!==!1&&e.jsx("td",{className:"py-2 px-3",children:b.hasBankAssignment?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",children:b.bankName}),e.jsx("p",{className:"text-xs text-gray-500",children:b.bankCode})]}):e.jsx(A,{variant:"destructive",className:"text-xs",children:"TanÄ±msÄ±z"})}),r.subscriptionType!==!1&&e.jsx("td",{className:"py-2 px-3",children:e.jsx(A,{variant:"outline",className:"text-xs",children:b.subscriptionType==="monthly"?"AylÄ±k":"YÄ±llÄ±k"})}),r.monthlyFee!==!1&&e.jsx("td",{className:"py-2 px-3",children:e.jsxs("p",{className:"text-green-600 text-xs",children:[b.monthlyFee.toFixed(2)," â‚¬"]})}),r.status!==!1&&e.jsx("td",{className:"py-2 px-3 text-center",children:b.isActive?e.jsxs(A,{className:"bg-green-100 text-green-700 text-xs",children:[e.jsx(da,{size:10,className:"mr-1"}),"Aktif"]}):e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsxs(A,{className:"bg-orange-100 text-orange-700 text-xs",children:[e.jsx(We,{size:10,className:"mr-1"}),"AskÄ±da"]})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs",children:["Sebep: ",((Be=b.currentInvoice)==null?void 0:Be.manualSuspensionReason)||"-"]}),((ye=b.currentInvoice)==null?void 0:ye.suspensionUntilDate)&&e.jsxs("p",{className:"text-xs",children:["BitiÅŸ: ",b.currentInvoice.suspensionUntilDate]})]})})]})}),r.payment!==!1&&e.jsx("td",{className:"py-2 px-3 text-center",children:b.hasBankAssignment?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(Ie,{checked:b.paymentConfirmed,onCheckedChange:ue=>J(b,ue)}),b.paymentConfirmed?e.jsxs(A,{className:"bg-green-100 text-green-700 text-xs",children:[e.jsx(ge,{size:10,className:"mr-1"}),"AlÄ±ndÄ±"]}):b.daysUntilDue!==void 0&&b.daysUntilDue<0?e.jsxs(A,{variant:"destructive",className:"text-xs",children:[e.jsx(os,{size:10,className:"mr-1"}),Math.abs(b.daysUntilDue)," gÃ¼n geÃ§ti"]}):e.jsxs(A,{variant:"outline",className:"text-xs",children:[e.jsx(ls,{size:10,className:"mr-1"}),b.daysUntilDue," gÃ¼n kaldÄ±"]})]}):e.jsx(A,{variant:"secondary",className:"text-xs",children:"Hesaplanamaz"})}),r.reminder!==!1&&e.jsx("td",{className:"py-2 px-3",children:e.jsx("div",{className:"flex flex-col gap-1",children:[3,5].map(ue=>e.jsxs(K,{variant:W.includes(ue)?"secondary":"outline",size:"sm",disabled:!b.hasBankAssignment||b.paymentConfirmed,onClick:()=>ve(b,ue),className:"text-xs h-6",children:[e.jsx(Ye,{size:10,className:"mr-1"}),ue,". gÃ¼n ",W.includes(ue)?"âœ“":""]},ue))})}),r.actions!==!1&&e.jsx("td",{className:"py-2 px-3 text-center",children:b.isActive&&b.hasBankAssignment&&!b.paymentConfirmed&&b.daysUntilDue!==void 0&&b.daysUntilDue<0&&e.jsxs(K,{variant:"destructive",size:"sm",onClick:()=>{s(new Set([H])),Qe()},className:"h-7 text-xs",children:[e.jsx(Ce,{size:12,className:"mr-1"}),"Dondur"]})})]},H)})})]})})})]},d)})})})]}),ee.open&&(()=>{const a=ee.customerId;let d=[];if(a){const y=l.find(j=>j.id===a);if(y&&y.serviceFeeSettings){const j=y.domain||y.guncelMyPayterDomain;(j?k.filter(P=>P.domain?i(P.domain,j,y.ignoreMainDomain||!1):!1):[]).forEach(P=>{var W;const b=y.serviceFeeSettings.deviceSubscriptions.find(he=>he.deviceId===P.id),H=y.serviceFeeSettings.invoices.find(he=>he.period===f),le=(W=y.bankDeviceAssignments)==null?void 0:W.find(he=>he.deviceIds.includes(P.id));b&&b.isActive&&le&&(!H||!H.paymentConfirmed)&&d.push({customerId:y.id,customerName:y.cariAdi,deviceId:P.id,deviceSerial:b.deviceSerialNumber,monthlyFee:b.monthlyFee,invoiceId:H==null?void 0:H.id,currentInvoice:H})})}}return d.length>0?e.jsx(Ia,{devices:d,selectedPeriod:f,onApprove:fe,onCancel:()=>V({open:!1})}):null})(),e.jsx(ze,{open:M.open,onOpenChange:a=>!a&&F({open:!1,devices:[]}),children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsxs(Fe,{children:[e.jsx(Te,{children:"ðŸš« Hizmet Dondurma"}),e.jsxs(we,{children:[M.devices.length," cihaz iÃ§in hizmet dondurulacak"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Y,{children:"Dondurma Sebebi"}),e.jsxs(Ue,{value:G,onValueChange:_,children:[e.jsx(Ke,{children:e.jsx(_e,{placeholder:"Sebep seÃ§in..."})}),e.jsx(Ve,{children:z.filter(a=>a.aktif).map(a=>e.jsx(pe,{value:a.reason,children:a.reason},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"Dondurma BitiÅŸ Tarihi (Opsiyonel)"}),e.jsx(re,{type:"date",value:E,onChange:a=>U(a.target.value),min:new Date().toISOString().split("T")[0]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"BoÅŸ bÄ±rakÄ±lÄ±rsa belirsiz sÃ¼relidir"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded p-3",children:[e.jsx("p",{className:"text-sm",children:e.jsx("strong",{children:"Dondurulacak Cihazlar:"})}),e.jsxs("ul",{className:"text-xs space-y-1 mt-2",children:[M.devices.slice(0,5).map((a,d)=>e.jsxs("li",{children:["â€¢ ",a.customer.cariAdi," - ",a.device.deviceSerialNumber]},d)),M.devices.length>5&&e.jsxs("li",{className:"text-gray-500",children:["... ve ",M.devices.length-5," cihaz daha"]})]})]})]}),e.jsxs(Pe,{children:[e.jsx(K,{variant:"outline",onClick:()=>F({open:!1,devices:[]}),children:"Ä°ptal"}),e.jsxs(K,{variant:"destructive",onClick:de,disabled:!G,children:[e.jsx(Ce,{size:16,className:"mr-2"}),"Dondur"]})]})]})})]})}function Ea({customers:l,payterProducts:k}){const u=D.useMemo(()=>{const t=[];return l.forEach(m=>{if(!m.serviceFeeSettings)return;const S=m.serviceFeeSettings,I=m.domain||m.guncelMyPayterDomain;if(!I)return;k.filter(o=>o.domain?Xe(o.domain,I,m.ignoreMainDomain||!1,m.domainHierarchy):!1).forEach(o=>{var s;if((s=m.bankDeviceAssignments)==null?void 0:s.some(c=>c.deviceIds.includes(o.id)))return;const v=S.deviceSubscriptions.find(c=>c.deviceId===o.id)||{deviceId:o.id,deviceSerialNumber:o.serialNumber||"",deviceName:o.name||"",monthlyFee:S.customFeePerDevice||S.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending"};t.push({customer:m,device:v,deviceDomain:o.domain||"",monthlyFee:v.monthlyFee,subscriptionType:S.paymentType})})}),t},[l,k]),f=D.useMemo(()=>u.reduce((t,m)=>t+m.monthlyFee,0),[u]),z=f*12;return u.length===0?e.jsx(T,{className:"border-green-300 bg-green-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-600 text-white rounded-full p-3",children:e.jsx(De,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"âœ… TÃ¼m cihazlar bankaya atanmÄ±ÅŸ"}),e.jsx("p",{className:"text-sm text-green-700",children:"Gelir kaybÄ± bulunmuyor"})]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{className:"border-purple-300 bg-purple-50",children:[e.jsx(os,{className:"text-purple-600",size:20}),e.jsx(Le,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-purple-900",children:"âš ï¸ Banka tanÄ±msÄ±z cihazlar tespit edildi"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Bu cihazlar iÃ§in Ã¶deme alÄ±namadÄ±ÄŸÄ±ndan aidat bedelleri tablosuna yansÄ±tÄ±lmamaktadÄ±r. LÃ¼tfen mÃ¼ÅŸteri detay sayfasÄ±ndan bu cihazlarÄ± bir bankaya atayÄ±n."})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(T,{className:"border-purple-300 bg-purple-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Banka TanÄ±msÄ±z Cihaz"}),e.jsx("p",{className:"text-3xl text-purple-900 mt-1",children:u.length})]}),e.jsx(De,{className:"text-purple-600",size:40})]})})}),e.jsx(T,{className:"border-red-300 bg-red-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-700",children:"AylÄ±k Gelir KaybÄ±"}),e.jsxs("p",{className:"text-3xl text-red-900 mt-1",children:[f.toFixed(2)," â‚¬"]})]}),e.jsx(hs,{className:"text-red-600",size:40})]})})}),e.jsx(T,{className:"border-orange-300 bg-orange-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-700",children:"YÄ±llÄ±k Gelir KaybÄ±"}),e.jsxs("p",{className:"text-3xl text-orange-900 mt-1",children:[z.toFixed(2)," â‚¬"]})]}),e.jsx(xs,{className:"text-orange-600",size:40})]})})})]}),e.jsxs(T,{children:[e.jsx(se,{children:e.jsxs(ae,{className:"text-purple-900 flex items-center gap-2",children:[e.jsx(De,{size:20}),"Banka TanÄ±msÄ±z Cihazlar - Gelir KaybÄ± Raporu"]})}),e.jsxs(w,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-3",children:"MÃ¼ÅŸteri"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Domain"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Seri No"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Abonelik Tipi"}),e.jsx("th",{className:"text-left py-3 px-3",children:"AylÄ±k Ãœcret"}),e.jsx("th",{className:"text-left py-3 px-3",children:"YÄ±llÄ±k KayÄ±p"}),e.jsx("th",{className:"text-center py-3 px-3",children:"Durum"})]})}),e.jsx("tbody",{children:u.map((t,m)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-purple-50",children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{children:[e.jsx("p",{className:t.customer.durum==="Pasif"?"line-through text-gray-500":"",children:t.customer.cariAdi}),e.jsx("p",{className:`text-xs ${t.customer.durum==="Pasif"?"line-through text-gray-400":"text-gray-500"}`,children:t.customer.cariHesapKodu})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("p",{className:"text-xs",children:t.deviceDomain})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("p",{className:"text-xs",children:t.device.deviceSerialNumber})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx(A,{variant:"outline",children:t.subscriptionType==="monthly"?"AylÄ±k":"YÄ±llÄ±k"})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("p",{className:"text-red-600",children:[t.monthlyFee.toFixed(2)," â‚¬"]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("p",{className:"text-orange-600",children:[(t.monthlyFee*12).toFixed(2)," â‚¬"]})}),e.jsx("td",{className:"py-3 px-3 text-center",children:e.jsxs(A,{variant:"destructive",className:"text-xs",children:[e.jsx(De,{size:12,className:"mr-1"}),"Banka TanÄ±msÄ±z"]})})]},m))})]})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded border border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"ðŸ’¡ Ã‡Ã¶zÃ¼m:"})," Bu cihazlarÄ± mÃ¼ÅŸteri detay sayfasÄ±ndan"," ",e.jsx("strong",{children:'"Banka/PF YÃ¶netimi"'})," sekmesinde bir bankaya atayarak gelir kaybÄ±nÄ± Ã¶nleyebilirsiniz."]})})]})]})]})}function Oa({customers:l,payterProducts:k}){const[u,f]=D.useState(""),z=D.useMemo(()=>{const h=[];return l.forEach(o=>{if(!o.serviceFeeSettings)return;const x=o.serviceFeeSettings,C=o.domain||o.guncelMyPayterDomain;if(!C)return;k.filter(s=>s.domain?Xe(s.domain,C,o.ignoreMainDomain||!1,o.domainHierarchy):!1).forEach(s=>{var p;const c=(p=o.bankDeviceAssignments)==null?void 0:p.find(r=>r.deviceIds.includes(s.id));if(!c)return;const n=x.deviceSubscriptions.find(r=>r.deviceId===s.id)||{deviceId:s.id,deviceSerialNumber:s.serialNumber||"",deviceName:s.name||"",monthlyFee:x.customFeePerDevice||x.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending"};h.push({customer:o,device:n,deviceDomain:s.domain||"",monthlyFee:n.monthlyFee,subscriptionType:x.paymentType,bankName:c.bankName,bankCode:c.bankCode})})}),h},[l,k]),t=D.useMemo(()=>{if(!u.trim())return z;const h=u.toLowerCase();return z.filter(o=>{var x,C,v,s,c,g;return((x=o.customer.cariAdi)==null?void 0:x.toLowerCase().includes(h))||((C=o.customer.cariHesapKodu)==null?void 0:C.toLowerCase().includes(h))||((v=o.deviceDomain)==null?void 0:v.toLowerCase().includes(h))||((s=o.device.deviceSerialNumber)==null?void 0:s.toLowerCase().includes(h))||((c=o.bankName)==null?void 0:c.toLowerCase().includes(h))||((g=o.bankCode)==null?void 0:g.toLowerCase().includes(h))})},[z,u]),m=D.useMemo(()=>t.reduce((h,o)=>h+o.monthlyFee,0),[t]),S=m*12,I=D.useMemo(()=>{const h=new Map;return t.forEach(o=>{const x=`${o.bankCode} - ${o.bankName}`;h.has(x)||h.set(x,[]),h.get(x).push(o)}),h},[t]);return z.length===0?e.jsx(T,{className:"border-yellow-300 bg-yellow-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-yellow-600 text-white rounded-full p-3",children:e.jsx(vs,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-900",children:"âš ï¸ Banka atanmÄ±ÅŸ cihaz bulunamadÄ±"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"HenÃ¼z hiÃ§bir cihaza banka atamasÄ± yapÄ±lmamÄ±ÅŸ"})]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{className:"border-green-300 bg-green-50",children:[e.jsx(ge,{className:"text-green-600",size:20}),e.jsx(Le,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-green-900",children:"âœ… Banka tanÄ±mlÄ± cihazlar listesi"}),e.jsx("p",{className:"text-sm text-green-700",children:"Bu cihazlar iÃ§in Ã¶deme alÄ±nabilmekte ve aidat bedelleri tablosuna yansÄ±tÄ±lmaktadÄ±r."})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(T,{className:"border-green-300 bg-green-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Banka TanÄ±mlÄ± Cihaz"}),e.jsx("p",{className:"text-3xl text-green-900 mt-1",children:t.length})]}),e.jsx(ge,{className:"text-green-600",size:40})]})})}),e.jsx(T,{className:"border-blue-300 bg-blue-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Banka SayÄ±sÄ±"}),e.jsx("p",{className:"text-3xl text-blue-900 mt-1",children:I.size})]}),e.jsx(vs,{className:"text-blue-600",size:40})]})})}),e.jsx(T,{className:"border-emerald-300 bg-emerald-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-emerald-700",children:"AylÄ±k Gelir"}),e.jsxs("p",{className:"text-3xl text-emerald-900 mt-1",children:[m.toFixed(2)," â‚¬"]})]}),e.jsx(xs,{className:"text-emerald-600",size:40})]})})}),e.jsx(T,{className:"border-teal-300 bg-teal-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-teal-700",children:"YÄ±llÄ±k Gelir"}),e.jsxs("p",{className:"text-3xl text-teal-900 mt-1",children:[S.toFixed(2)," â‚¬"]})]}),e.jsx(Me,{className:"text-teal-600",size:40})]})})})]}),e.jsx(T,{children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{size:20,className:"text-gray-400"}),e.jsx(re,{placeholder:"MÃ¼ÅŸteri, domain, seri no veya banka ara...",value:u,onChange:h=>f(h.target.value),className:"flex-1"})]})})}),e.jsxs(T,{children:[e.jsx(se,{children:e.jsxs(ae,{className:"text-green-900 flex items-center gap-2",children:[e.jsx(ge,{size:20}),"Banka TanÄ±mlÄ± Cihazlar - Gelir Raporu",e.jsxs(A,{variant:"secondary",className:"ml-2",children:[t.length," Cihaz"]})]})}),e.jsxs(w,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-3",children:"MÃ¼ÅŸteri"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Domain"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Seri No"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Banka"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Abonelik Tipi"}),e.jsx("th",{className:"text-left py-3 px-3",children:"AylÄ±k Ãœcret"}),e.jsx("th",{className:"text-left py-3 px-3",children:"YÄ±llÄ±k Gelir"}),e.jsx("th",{className:"text-center py-3 px-3",children:"Durum"})]})}),e.jsx("tbody",{children:t.map((h,o)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-green-50",children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{children:[e.jsx("p",{className:h.customer.durum==="Pasif"?"line-through text-gray-500":"",children:h.customer.cariAdi}),e.jsx("p",{className:`text-xs ${h.customer.durum==="Pasif"?"line-through text-gray-400":"text-gray-500"}`,children:h.customer.cariHesapKodu})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("p",{className:"text-xs",children:h.deviceDomain})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("p",{className:"text-xs",children:h.device.deviceSerialNumber})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:h.bankCode}),e.jsx("p",{className:"text-xs text-gray-500",children:h.bankName})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx(A,{variant:"outline",children:h.subscriptionType==="monthly"?"AylÄ±k":"YÄ±llÄ±k"})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("p",{className:"text-green-600",children:[h.monthlyFee.toFixed(2)," â‚¬"]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("p",{className:"text-teal-600",children:[(h.monthlyFee*12).toFixed(2)," â‚¬"]})}),e.jsx("td",{className:"py-3 px-3 text-center",children:e.jsxs(A,{variant:"default",className:"text-xs bg-green-600",children:[e.jsx(ge,{size:12,className:"mr-1"}),"AtanmÄ±ÅŸ"]})})]},o))})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"font-medium text-blue-900 mb-3",children:"ðŸ“Š Banka BazlÄ± DaÄŸÄ±lÄ±m:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Array.from(I.entries()).map(([h,o])=>{const x=o.reduce((C,v)=>C+v.monthlyFee,0);return e.jsxs("div",{className:"bg-white p-3 rounded border border-blue-200",children:[e.jsx("p",{className:"text-sm text-gray-900",children:h}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs(A,{variant:"secondary",children:[o.length," cihaz"]}),e.jsxs("p",{className:"text-sm text-green-600",children:[x.toFixed(2)," â‚¬/ay"]})]})]},h)})})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded border border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"ðŸ’¡ Not:"})," Bu liste sadece gerÃ§ek banka atamasÄ± yapÄ±lmÄ±ÅŸ cihazlarÄ± gÃ¶sterir."," ",e.jsx("strong",{children:"PAYTER DEMO BANK"}),' atamalÄ± cihazlar "Banka TanÄ±msÄ±z Cihazlar" sekmesinde gÃ¶rÃ¼ntÃ¼lenir.']})})]})]})]})}function La({customers:l,payterProducts:k}){const[u,f]=D.useState(""),[z,t]=D.useState(new Set),m=D.useMemo(()=>{const n=[];return l.forEach(p=>{const r=p.domain||p.guncelMyPayterDomain;if(!r)return;k.filter(M=>M.domain?Xe(M.domain,r,p.ignoreMainDomain||!1,p.domainHierarchy):!1).forEach(M=>{var U,ee,V;const F=p.serviceFeeSettings,G=(U=F==null?void 0:F.deviceSubscriptions)==null?void 0:U.find(O=>O.deviceId===M.id),_=(F==null?void 0:F.customFeePerDevice)||(F==null?void 0:F.standardFeePerDevice)||0,E=G||{deviceId:M.id,deviceSerialNumber:M.serialNumber||"",deviceName:M.name||"",monthlyFee:_,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending"};if(p.durum==="Pasif"){const O=(ee=p.bankDeviceAssignments)==null?void 0:ee.find(ce=>ce.deviceIds.includes(M.id));n.push({customer:p,device:E,deviceDomain:M.domain||"",monthlyFee:E.monthlyFee,subscriptionType:(F==null?void 0:F.paymentType)||"monthly",hasBankAssignment:!!O,bankName:O==null?void 0:O.bankName,bankCode:O==null?void 0:O.bankCode,suspensionType:"customer_inactive",suspensionReason:"MÃ¼ÅŸteri Pasif",suspensionDate:void 0})}else if(G&&!G.isActive){const O=(V=p.bankDeviceAssignments)==null?void 0:V.find(ce=>ce.deviceIds.includes(M.id));n.push({customer:p,device:E,deviceDomain:M.domain||"",monthlyFee:E.monthlyFee,subscriptionType:(F==null?void 0:F.paymentType)||"monthly",hasBankAssignment:!!O,bankName:O==null?void 0:O.bankName,bankCode:O==null?void 0:O.bankCode,suspensionType:"device_suspended",suspensionReason:E.suspensionReason||"Sebep belirtilmemiÅŸ",suspensionDate:E.suspensionDate})}})}),n},[l,k]),S=D.useMemo(()=>m.filter(n=>n.suspensionType==="customer_inactive"),[m]),I=D.useMemo(()=>{const n=m.filter(r=>r.suspensionType==="device_suspended"),p=new Map;return n.forEach(r=>{const R=r.suspensionReason||"Sebep belirtilmemiÅŸ";p.has(R)||p.set(R,[]),p.get(R).push(r)}),Array.from(p.entries()).map(([r,R])=>({reason:r,count:R.length,devices:R,totalMonthlyLoss:R.reduce((M,F)=>M+F.monthlyFee,0)})).sort((r,R)=>R.count-r.count)},[m]),h=n=>{if(!u.trim())return n;const p=u.toLowerCase();return n.filter(r=>{var R,M,F,G,_,E,U;return((R=r.customer.cariAdi)==null?void 0:R.toLowerCase().includes(p))||((M=r.customer.cariHesapKodu)==null?void 0:M.toLowerCase().includes(p))||((F=r.deviceDomain)==null?void 0:F.toLowerCase().includes(p))||((G=r.device.deviceSerialNumber)==null?void 0:G.toLowerCase().includes(p))||((_=r.bankName)==null?void 0:_.toLowerCase().includes(p))||((E=r.bankCode)==null?void 0:E.toLowerCase().includes(p))||((U=r.suspensionReason)==null?void 0:U.toLowerCase().includes(p))})},o=D.useMemo(()=>h(S),[S,u]),x=D.useMemo(()=>I.map(n=>({...n,devices:h(n.devices)})).filter(n=>n.devices.length>0),[I,u]),C=m.length,v=m.reduce((n,p)=>n+p.monthlyFee,0),s=v*12,c=n=>{const p=new Set(z);p.has(n)?p.delete(n):p.add(n),t(p)};if(C===0)return e.jsx(T,{className:"border-green-300 bg-green-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-600 text-white rounded-full p-3",children:e.jsx(We,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-900",children:"âœ… HiÃ§ pasif cihaz yok"}),e.jsx("p",{className:"text-sm text-green-700",children:"TÃ¼m cihazlar aktif durumda"})]})]})})});const g=({devices:n,showCustomerColumn:p=!0})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[p&&e.jsx("th",{className:"text-left py-3 px-3",children:"MÃ¼ÅŸteri"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Domain"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Seri No"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Banka Durumu"}),p&&e.jsx("th",{className:"text-left py-3 px-3",children:"Pasif Sebebi"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Pasif Tarihi"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Abonelik"}),e.jsx("th",{className:"text-right py-3 px-3",children:"AylÄ±k Ãœcret"}),e.jsx("th",{className:"text-right py-3 px-3",children:"YÄ±llÄ±k KayÄ±p"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:p?9:8,className:"text-center py-8 text-gray-500",children:"Arama kriterlerine uygun cihaz bulunamadÄ±"})}):n.map((r,R)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-orange-50",children:[p&&e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{children:[e.jsx("p",{className:r.customer.durum==="Pasif"?"text-gray-500":"",children:r.customer.cariAdi}),e.jsx("p",{className:"text-xs text-gray-500",children:r.customer.cariHesapKodu})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("p",{className:"text-xs",children:r.deviceDomain})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("p",{className:"text-xs",children:r.device.deviceSerialNumber})}),e.jsx("td",{className:"py-3 px-3",children:r.hasBankAssignment?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:r.bankCode}),e.jsx("p",{className:"text-xs text-gray-500",children:r.bankName})]}):e.jsx(A,{variant:"outline",className:"text-xs",children:"Banka TanÄ±msÄ±z"})}),p&&e.jsx("td",{className:"py-3 px-3",children:e.jsx("div",{children:e.jsx("p",{className:"text-xs text-orange-700",children:r.suspensionType==="customer_inactive"?"ðŸ‘¤ MÃ¼ÅŸteri Pasif":`ðŸš« ${r.suspensionReason}`})})}),e.jsx("td",{className:"py-3 px-3",children:r.suspensionDate?e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ“… ",new Date(r.suspensionDate).toLocaleDateString("tr-TR")]}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx(A,{variant:"outline",children:r.subscriptionType==="monthly"?"AylÄ±k":"YÄ±llÄ±k"})}),e.jsx("td",{className:"py-3 px-3 text-right",children:e.jsxs("p",{className:"text-red-600",children:[r.monthlyFee.toFixed(2)," â‚¬"]})}),e.jsx("td",{className:"py-3 px-3 text-right",children:e.jsxs("p",{className:"text-red-700",children:[(r.monthlyFee*12).toFixed(2)," â‚¬"]})})]},R))}),n.length>0&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 bg-gray-50",children:[e.jsx("td",{colSpan:p?7:6,className:"py-3 px-3 text-right",children:e.jsxs("strong",{children:["Toplam (",n.length," cihaz):"]})}),e.jsx("td",{className:"py-3 px-3 text-right",children:e.jsxs("strong",{className:"text-red-600",children:[n.reduce((r,R)=>r+R.monthlyFee,0).toFixed(2)," â‚¬"]})}),e.jsx("td",{className:"py-3 px-3 text-right",children:e.jsxs("strong",{className:"text-red-700",children:[n.reduce((r,R)=>r+R.monthlyFee*12,0).toFixed(2)," â‚¬"]})})]})})]})});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{className:"border-orange-300 bg-orange-50",children:[e.jsx($e,{className:"text-orange-600",size:20}),e.jsx(Le,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-orange-900",children:"âš ï¸ Pasif cihazlar tespit edildi"}),e.jsxs("p",{className:"text-sm text-orange-700",children:["Bu cihazlar iÃ§in aidat bedeli tahsil edilmemekte ve gelir hesaplamalarÄ±na dahil edilmemektedir.",e.jsx("strong",{children:" Grup 1 - Pasif MÃ¼ÅŸteri:"}),' MÃ¼ÅŸteri durumu "Pasif" olduÄŸu iÃ§in tÃ¼m cihazlarÄ± otomatik pasif.',e.jsx("strong",{children:" Grup 2 - Pasif Cihaz:"})," Cihaz bazlÄ± pasifleÅŸtirme sebebi ile pasif."]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(T,{className:"border-orange-300 bg-orange-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-700",children:"Toplam Pasif Cihaz"}),e.jsx("p",{className:"text-3xl text-orange-900 mt-1",children:C}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(A,{variant:"outline",className:"text-xs bg-white",children:[e.jsx(is,{size:12,className:"mr-1"}),S.length," MÃ¼ÅŸteri Pasif"]}),e.jsxs(A,{variant:"outline",className:"text-xs bg-white",children:[e.jsx(De,{size:12,className:"mr-1"}),m.filter(n=>n.suspensionType==="device_suspended").length," Cihaz Pasif"]})]})]}),e.jsx(We,{className:"text-orange-600",size:40})]})})}),e.jsx(T,{className:"border-red-300 bg-red-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-700",children:"AylÄ±k Potansiyel KayÄ±p"}),e.jsxs("p",{className:"text-3xl text-red-900 mt-1",children:[v.toFixed(2)," â‚¬"]})]}),e.jsx(hs,{className:"text-red-600",size:40})]})})}),e.jsx(T,{className:"border-purple-300 bg-purple-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"YÄ±llÄ±k Potansiyel KayÄ±p"}),e.jsxs("p",{className:"text-3xl text-purple-900 mt-1",children:[s.toFixed(2)," â‚¬"]})]}),e.jsx(xs,{className:"text-purple-600",size:40})]})})}),e.jsx(T,{className:"border-blue-300 bg-blue-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Pasif Sebep SayÄ±sÄ±"}),e.jsx("p",{className:"text-3xl text-blue-900 mt-1",children:I.length+1}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"+1 MÃ¼ÅŸteri Pasif"})]}),e.jsx($e,{className:"text-blue-600",size:40})]})})})]}),e.jsx(T,{children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{size:20,className:"text-gray-400"}),e.jsx(re,{placeholder:"MÃ¼ÅŸteri, domain, seri no, banka veya pasif sebebi ara...",value:u,onChange:n=>f(n.target.value),className:"flex-1"})]})})}),e.jsxs(zs,{defaultValue:"customer-inactive",className:"w-full",children:[e.jsxs(As,{className:"grid w-full grid-cols-2",children:[e.jsxs(be,{value:"customer-inactive",className:"flex items-center gap-2",children:[e.jsx(is,{size:16}),"Grup 1: Pasif MÃ¼ÅŸteri",e.jsx(A,{variant:"secondary",className:"ml-2",children:o.length})]}),e.jsxs(be,{value:"device-suspended",className:"flex items-center gap-2",children:[e.jsx(De,{size:16}),"Grup 2: Pasif Cihaz",e.jsx(A,{variant:"secondary",className:"ml-2",children:x.reduce((n,p)=>n+p.devices.length,0)})]})]}),e.jsx(ke,{value:"customer-inactive",children:e.jsxs(T,{children:[e.jsxs(se,{children:[e.jsxs(ae,{className:"text-orange-900 flex items-center gap-2",children:[e.jsx(is,{size:20}),'Grup 1: Pasif MÃ¼ÅŸteri - MÃ¼ÅŸteri durumu "Pasif" olan firmalar',e.jsxs(A,{variant:"secondary",className:"ml-2",children:[o.length," Cihaz"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:'Bu gruptaki cihazlar, mÃ¼ÅŸteri cari kartÄ±nda durum "Pasif" olarak iÅŸaretlendiÄŸi iÃ§in otomatik olarak pasif kabul edilir.'})]}),e.jsx(w,{children:e.jsx(g,{devices:o})})]})}),e.jsx(ke,{value:"device-suspended",children:e.jsx("div",{className:"space-y-4",children:x.length===0?e.jsx(T,{children:e.jsx(w,{className:"pt-6",children:e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Cihaz bazlÄ± pasifleÅŸtirme bulunamadÄ±"})})}):x.map(n=>e.jsxs(T,{children:[e.jsx(se,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>c(n.reason),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(ae,{className:"text-orange-900 flex items-center gap-2",children:[z.has(n.reason)?e.jsx(Ts,{size:20}):e.jsx(ia,{size:20}),"ðŸš« ",n.reason,e.jsxs(A,{variant:"secondary",className:"ml-2",children:[n.devices.length," Cihaz"]}),e.jsxs(A,{variant:"outline",className:"ml-2 bg-red-50 text-red-700",children:[n.totalMonthlyLoss.toFixed(2)," â‚¬ / ay"]})]})})}),z.has(n.reason)&&e.jsx(w,{children:e.jsx(g,{devices:n.devices,showCustomerColumn:!0})})]},n.reason))})})]})]})}function $a({customers:l,payterProducts:k,currentPeriod:u}){const f=D.useMemo(()=>{const x=[],C=new Date(u+"-01");for(let v=5;v>=0;v--){const s=new Date(C);s.setMonth(s.getMonth()-v),x.push(s.toISOString().substring(0,7))}return x},[u]),z=x=>x?x.toLowerCase().trim().replace(/^https?:\/\//,"").replace(/\/$/,""):"",t=(x,C,v=!1)=>{const s=z(x),c=z(C);return!s||!c?!1:v?s===c?!1:s.endsWith("."+c):s===c},m=D.useMemo(()=>f.map(x=>{let C=0,v=0,s=0,c=0,g=0;return l.forEach(n=>{if(!n.serviceFeeSettings)return;const p=n.serviceFeeSettings,r=n.domain||n.guncelMyPayterDomain;if(!r)return;const R=k.filter(F=>F.domain?t(F.domain,r,n.ignoreMainDomain||!1):!1);let M=0;R.forEach(F=>{var ee;if(!((ee=n.bankDeviceAssignments)==null?void 0:ee.some(V=>V.deviceIds.includes(F.id))))return;const E=p.deviceSubscriptions.find(V=>V.deviceId===F.id)||{deviceId:F.id,deviceSerialNumber:F.serialNumber||"",deviceName:F.name||"",monthlyFee:p.customFeePerDevice||p.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0]};if(!E.isActive)return;const U=p.invoices.find(V=>V.period===x);if((!U||!U.isSuspended)&&(C+=E.monthlyFee,v++,M++,U))if(U.paymentConfirmed)c++;else{const V=new Date(U.dueDate),O=new Date;Math.floor((V.getTime()-O.getTime())/(1e3*60*60*24))<0&&g++}}),M>0&&s++}),{period:x,totalRevenue:C,activeDevices:v,activeCustomers:s,confirmedPayments:c,overduePayments:g}}),[f,l,k]),S=D.useMemo(()=>{if(m.length<2)return{revenue:0,devices:0};const x=m[m.length-1],C=m[m.length-2],v=x.totalRevenue-C.totalRevenue,s=x.activeDevices-C.activeDevices;return{revenue:v,revenuePercent:C.totalRevenue>0?v/C.totalRevenue*100:0,devices:s,devicesPercent:C.activeDevices>0?s/C.activeDevices*100:0}},[m]),I=x=>{const[C,v]=x.split("-");return`${["Oca","Åžub","Mar","Nis","May","Haz","Tem","AÄŸu","Eyl","Eki","Kas","Ara"][parseInt(v)-1]} ${C}`},h=x=>x>0?e.jsx(Me,{className:"text-green-600",size:16}):x<0?e.jsx(hs,{className:"text-red-600",size:16}):e.jsx(sa,{className:"text-gray-600",size:16}),o=x=>x>0?"text-green-600":x<0?"text-red-600":"text-gray-600";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(T,{className:"border-blue-300 bg-blue-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Gelir Trendi (AylÄ±k)"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[h(S.revenue),e.jsxs("p",{className:`text-2xl ${o(S.revenue)}`,children:[Math.abs(S.revenue).toFixed(2)," â‚¬"]})]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[S.revenuePercent>=0?"+":"",S.revenuePercent.toFixed(1),"% deÄŸiÅŸim"]})]}),e.jsx(Me,{className:"text-blue-600",size:40})]})})}),e.jsx(T,{className:"border-purple-300 bg-purple-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Cihaz Trendi"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[h(S.devices),e.jsx("p",{className:`text-2xl ${o(S.devices)}`,children:Math.abs(S.devices)})]}),e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[S.devicesPercent>=0?"+":"",S.devicesPercent.toFixed(1),"% deÄŸiÅŸim"]})]}),e.jsx(rs,{className:"text-purple-600",size:40})]})})})]}),e.jsxs(T,{children:[e.jsx(se,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(rs,{size:20}),"DÃ¶nemsel GeliÅŸim Raporu (Son 6 Ay)"]})}),e.jsxs(w,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-3",children:"DÃ¶nem"}),e.jsx("th",{className:"text-right py-3 px-3",children:"Gelir (â‚¬)"}),e.jsx("th",{className:"text-center py-3 px-3",children:"Cihaz"}),e.jsx("th",{className:"text-center py-3 px-3",children:"MÃ¼ÅŸteri"}),e.jsx("th",{className:"text-center py-3 px-3",children:"Ã–deme OnayÄ±"}),e.jsx("th",{className:"text-center py-3 px-3",children:"GecikmiÅŸ"}),e.jsx("th",{className:"text-right py-3 px-3",children:"DeÄŸiÅŸim"})]})}),e.jsx("tbody",{children:m.map((x,C)=>{const v=x.period===u,s=C>0?m[C-1].totalRevenue:0,c=s>0?x.totalRevenue-s:0,g=s>0?c/s*100:0;return e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${v?"bg-blue-50 border-blue-200":""}`,children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{children:I(x.period)}),v&&e.jsx(A,{className:"bg-blue-600 text-white text-xs",children:"GÃ¼ncel"})]})}),e.jsx("td",{className:"py-3 px-3 text-right",children:e.jsxs("p",{className:"text-green-600",children:[x.totalRevenue.toFixed(2)," â‚¬"]})}),e.jsx("td",{className:"py-3 px-3 text-center",children:e.jsx(A,{variant:"outline",children:x.activeDevices})}),e.jsx("td",{className:"py-3 px-3 text-center",children:e.jsx(A,{variant:"outline",children:x.activeCustomers})}),e.jsx("td",{className:"py-3 px-3 text-center",children:e.jsx(A,{className:"bg-green-100 text-green-700",children:x.confirmedPayments})}),e.jsx("td",{className:"py-3 px-3 text-center",children:x.overduePayments>0?e.jsx(A,{variant:"destructive",children:x.overduePayments}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-3 text-right",children:C>0?e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[h(c),e.jsxs("span",{className:o(c),children:[g>=0?"+":"",g.toFixed(1),"%"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},x.period)})})]})}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Ortalama AylÄ±k Gelir"}),e.jsxs("p",{className:"text-green-600 mt-1",children:[(m.reduce((x,C)=>x+C.totalRevenue,0)/m.length).toFixed(2)," â‚¬"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"En YÃ¼ksek Gelir"}),e.jsxs("p",{className:"text-blue-600 mt-1",children:[Math.max(...m.map(x=>x.totalRevenue)).toFixed(2)," â‚¬"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"En DÃ¼ÅŸÃ¼k Gelir"}),e.jsxs("p",{className:"text-orange-600 mt-1",children:[Math.min(...m.map(x=>x.totalRevenue)).toFixed(2)," â‚¬"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Toplam (6 Ay)"}),e.jsxs("p",{className:"text-purple-600 mt-1",children:[m.reduce((x,C)=>x+C.totalRevenue,0).toFixed(2)," â‚¬"]})]})]})})]})]})]})}const Ha=ie.memo(function({customers:k,onUpdateCustomer:u}){var V,O,ce;const[f,z]=D.useState(""),[t,m]=D.useState(null),[S,I]=D.useState(!1),[h,o]=D.useState(!1),[x,C]=D.useState(!1),[v,s]=D.useState(new Set),[c,g]=D.useState({customerId:"",newPrice:0,changeReason:"",effectiveDate:new Date().toISOString().split("T")[0],notes:"",updatePaymentType:!1,newPaymentType:void 0}),[n,p]=D.useState({updateType:"percentage",percentage:0,fixedAmount:0,changeReason:"",effectiveDate:new Date().toISOString().split("T")[0],notes:"",applyToAll:!1,selectedCustomerIds:[]}),r=D.useMemo(()=>k.filter(i=>i.serviceFeeSettings).map(i=>{var X;const N=i.serviceFeeSettings,L=N.customFeePerDevice??N.standardFeePerDevice,te=N.priceHistory&&N.priceHistory.length>0?N.priceHistory[N.priceHistory.length-1]:null;return{customer:i,settings:N,currentPrice:L,lastChange:te,changeCount:((X=N.priceHistory)==null?void 0:X.length)??0}}).filter(i=>{if(!f)return!0;const N=f.toLowerCase();return i.customer.cariAdi.toLowerCase().includes(N)||i.customer.cariHesapKodu.toLowerCase().includes(N)}),[k,f]),R=D.useMemo(()=>{const i=r.length,N=i>0?r.reduce((J,ve)=>J+ve.currentPrice,0)/i:0,L=r.filter(J=>J.settings.paymentType==="monthly").length,te=r.filter(J=>J.settings.paymentType==="yearly").length,X=r.filter(J=>J.settings.customFeePerDevice!==void 0).length,$=i-X,Ne=r.filter(J=>{if(!J.lastChange)return!1;const ve=new Date(J.lastChange.changeDate),ne=new Date;return ne.setDate(ne.getDate()-30),ve>=ne}).length;return{totalCustomers:i,avgPrice:N,monthlyCustomers:L,yearlyCustomers:te,customPriceCustomers:X,standardPriceCustomers:$,recentChanges:Ne}},[r]),M=i=>{const N=i.serviceFeeSettings,L=N.customFeePerDevice??N.standardFeePerDevice;m(i),g({customerId:i.id,newPrice:L,changeReason:"",effectiveDate:new Date().toISOString().split("T")[0],notes:"",updatePaymentType:!1,newPaymentType:N.paymentType}),I(!0)},F=()=>{if(!t||!c.changeReason){Q.error("LÃ¼tfen gerekli alanlarÄ± doldurun");return}const i=t.serviceFeeSettings,N=i.customFeePerDevice??i.standardFeePerDevice,L=i.paymentType,te={id:`price_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,changeDate:new Date().toISOString(),oldPrice:N,newPrice:c.newPrice,changeType:"manual",changeReason:c.changeReason,effectiveDate:c.effectiveDate,notes:c.notes,increasePercentage:(c.newPrice-N)/N*100,oldPaymentType:L,newPaymentType:c.updatePaymentType?c.newPaymentType:L},X={...i,customFeePerDevice:c.newPrice,paymentType:c.updatePaymentType&&c.newPaymentType?c.newPaymentType:i.paymentType,priceHistory:[...i.priceHistory||[],te]},$={...t,serviceFeeSettings:X};u($),Q.success(`${t.cariAdi} iÃ§in fiyat gÃ¼ncellendi`),I(!1),m(null)},G=()=>{p({updateType:"percentage",percentage:0,fixedAmount:0,changeReason:"",effectiveDate:new Date().toISOString().split("T")[0],notes:"",applyToAll:v.size===0,selectedCustomerIds:Array.from(v)}),o(!0)},_=()=>{if(!n.changeReason){Q.error("LÃ¼tfen deÄŸiÅŸiklik sebebini girin");return}const i=n.applyToAll?r:r.filter(L=>v.has(L.customer.id));if(i.length===0){Q.error("LÃ¼tfen en az bir mÃ¼ÅŸteri seÃ§in");return}let N=0;i.forEach(L=>{const te=L.settings,X=te.customFeePerDevice??te.standardFeePerDevice;let $;n.updateType==="percentage"?$=X*(1+(n.percentage||0)/100):$=X+(n.fixedAmount||0),$=Math.round($*100)/100;const Ne={id:`price_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,changeDate:new Date().toISOString(),oldPrice:X,newPrice:$,changeType:"bulk",changeReason:n.changeReason,effectiveDate:n.effectiveDate,notes:n.notes,increasePercentage:($-X)/X*100},J={...te,customFeePerDevice:$,priceHistory:[...te.priceHistory||[],Ne]},ve={...L.customer,serviceFeeSettings:J};u(ve),N++}),Q.success(`${N} mÃ¼ÅŸteri iÃ§in fiyat gÃ¼ncellendi`),o(!1),s(new Set)},E=i=>{m(i),C(!0)},U=i=>{const N=new Set(v);N.has(i)?N.delete(i):N.add(i),s(N)},ee=()=>{v.size===r.length?s(new Set):s(new Set(r.map(i=>i.customer.id)))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsx(ae,{className:"text-sm text-gray-600",children:"Toplam MÃ¼ÅŸteri"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"text-blue-600",size:20}),e.jsx("span",{className:"text-2xl",children:R.totalCustomers})]})})]}),e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsx(ae,{className:"text-sm text-gray-600",children:"Ortalama Fiyat"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"text-green-600",size:20}),e.jsxs("span",{className:"text-2xl",children:["â‚¬",R.avgPrice.toFixed(2)]})]})})]}),e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsx(ae,{className:"text-sm text-gray-600",children:"Ã–deme Tipleri"})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"AylÄ±k:"}),e.jsx(A,{variant:"outline",children:R.monthlyCustomers})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"YÄ±llÄ±k:"}),e.jsx(A,{variant:"outline",children:R.yearlyCustomers})]})]})})]}),e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsx(ae,{className:"text-sm text-gray-600",children:"Son 30 GÃ¼n"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"text-orange-600",size:20}),e.jsx("span",{className:"text-2xl",children:R.recentChanges}),e.jsx("span",{className:"text-sm text-gray-600",children:"deÄŸiÅŸiklik"})]})})]})]}),e.jsx(T,{children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx(re,{placeholder:"MÃ¼ÅŸteri ara (ad, kod)...",value:f,onChange:i=>z(i.target.value),className:"pl-10"})]}),v.size>0&&e.jsxs(A,{variant:"secondary",children:[v.size," mÃ¼ÅŸteri seÃ§ili"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(K,{variant:"outline",size:"sm",onClick:G,disabled:!n.applyToAll&&v.size===0,children:[e.jsx(ma,{size:16,className:"mr-2"}),"Toplu GÃ¼ncelle"]})})]})})}),e.jsxs(T,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Fiyat Listesi"})}),e.jsx(w,{children:e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(ys,{children:[e.jsx(gs,{children:e.jsxs(Ee,{children:[e.jsx(Z,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:v.size===r.length&&r.length>0,onChange:ee,className:"rounded"})}),e.jsx(Z,{children:"MÃ¼ÅŸteri Kodu"}),e.jsx(Z,{children:"MÃ¼ÅŸteri AdÄ±"}),e.jsx(Z,{children:"Ã–deme Tipi"}),e.jsx(Z,{children:"GÃ¼ncel Fiyat"}),e.jsx(Z,{children:"Fiyat Tipi"}),e.jsx(Z,{children:"Son DeÄŸiÅŸiklik"}),e.jsx(Z,{children:"DeÄŸiÅŸim"}),e.jsx(Z,{className:"text-right",children:"Ä°ÅŸlemler"})]})}),e.jsx(Ns,{children:r.length===0?e.jsx(Ee,{children:e.jsx(q,{colSpan:9,className:"text-center text-gray-500 py-8",children:"Hizmet bedeli tanÄ±mlÄ± mÃ¼ÅŸteri bulunamadÄ±"})}):r.map(i=>{const N=i.lastChange?i.lastChange.newPrice-i.lastChange.oldPrice:0,L=i.lastChange&&i.lastChange.increasePercentage?i.lastChange.increasePercentage:0;return e.jsxs(Ee,{children:[e.jsx(q,{children:e.jsx("input",{type:"checkbox",checked:v.has(i.customer.id),onChange:()=>U(i.customer.id),className:"rounded"})}),e.jsx(q,{children:e.jsx("span",{className:i.customer.durum==="Pasif"?"line-through text-gray-500":"",children:i.customer.cariHesapKodu})}),e.jsx(q,{children:e.jsx("span",{className:i.customer.durum==="Pasif"?"line-through text-gray-500":"",children:i.customer.cariAdi})}),e.jsx(q,{children:e.jsx(A,{variant:i.settings.paymentType==="monthly"?"default":"secondary",children:i.settings.paymentType==="monthly"?"AylÄ±k":"YÄ±llÄ±k"})}),e.jsx(q,{children:e.jsxs("span",{className:"font-medium",children:["â‚¬",i.currentPrice.toFixed(2)]})}),e.jsx(q,{children:i.settings.customFeePerDevice!==void 0?e.jsx(A,{variant:"outline",children:"Ã–zel"}):e.jsx(A,{variant:"secondary",children:"Standart"})}),e.jsx(q,{children:i.lastChange?e.jsx("span",{className:"text-sm text-gray-600",children:new Date(i.lastChange.changeDate).toLocaleDateString("tr-TR")}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx(q,{children:i.lastChange?e.jsxs("div",{className:"flex items-center gap-1",children:[N>0?e.jsx(ks,{size:16,className:"text-green-600"}):N<0?e.jsx(bs,{size:16,className:"text-red-600"}):null,e.jsxs("span",{className:`text-sm ${N>0?"text-green-600":N<0?"text-red-600":"text-gray-600"}`,children:[L>0?"+":"",L.toFixed(1),"%"]})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx(q,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(K,{variant:"ghost",size:"sm",onClick:()=>M(i.customer),children:[e.jsx(Zs,{size:14,className:"mr-1"}),"DÃ¼zenle"]}),i.changeCount>0&&e.jsxs(K,{variant:"ghost",size:"sm",onClick:()=>E(i.customer),children:[e.jsx(Qs,{size:14,className:"mr-1"}),"GeÃ§miÅŸ (",i.changeCount,")"]})]})})]},i.customer.id)})})]})})})]}),e.jsx(ze,{open:S,onOpenChange:I,children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsxs(Fe,{children:[e.jsx(Te,{children:"Fiyat GÃ¼ncelle"}),e.jsxs(we,{children:[t==null?void 0:t.cariAdi," iÃ§in fiyat gÃ¼ncelleme"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Y,{children:"Mevcut Fiyat"}),e.jsx(re,{value:`â‚¬${(((V=t==null?void 0:t.serviceFeeSettings)==null?void 0:V.customFeePerDevice)??((O=t==null?void 0:t.serviceFeeSettings)==null?void 0:O.standardFeePerDevice)??0).toFixed(2)}`,disabled:!0,className:"bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"Yeni Fiyat *"}),e.jsx(re,{type:"number",step:"0.01",value:c.newPrice,onChange:i=>g({...c,newPrice:parseFloat(i.target.value)||0}),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"DeÄŸiÅŸiklik Sebebi *"}),e.jsxs(Ue,{value:c.changeReason,onValueChange:i=>g({...c,changeReason:i}),children:[e.jsx(Ke,{children:e.jsx(_e,{placeholder:"Sebep seÃ§in"})}),e.jsxs(Ve,{children:[e.jsx(pe,{value:"price-increase",children:"Fiyat ArtÄ±ÅŸÄ±"}),e.jsx(pe,{value:"contract-renewal",children:"SÃ¶zleÅŸme Yenileme"}),e.jsx(pe,{value:"service-upgrade",children:"Hizmet YÃ¼kseltme"}),e.jsx(pe,{value:"market-adjustment",children:"Piyasa Uyumu"}),e.jsx(pe,{value:"special-discount",children:"Ã–zel Ä°ndirim"}),e.jsx(pe,{value:"other",children:"DiÄŸer"})]})]})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"GeÃ§erlilik Tarihi"}),e.jsx(re,{type:"date",value:c.effectiveDate,onChange:i=>g({...c,effectiveDate:i.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{checked:c.updatePaymentType,onCheckedChange:i=>g({...c,updatePaymentType:i})}),e.jsx(Y,{children:"Ã–deme tipini de gÃ¼ncelle"})]}),c.updatePaymentType&&e.jsxs("div",{children:[e.jsx(Y,{children:"Yeni Ã–deme Tipi"}),e.jsxs(Ue,{value:c.newPaymentType,onValueChange:i=>g({...c,newPaymentType:i}),children:[e.jsx(Ke,{children:e.jsx(_e,{placeholder:"Ã–deme tipi seÃ§in"})}),e.jsxs(Ve,{children:[e.jsx(pe,{value:"monthly",children:"AylÄ±k"}),e.jsx(pe,{value:"yearly",children:"YÄ±llÄ±k"})]})]})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"Notlar"}),e.jsx(ns,{value:c.notes,onChange:i=>g({...c,notes:i.target.value}),placeholder:"Ek aÃ§Ä±klamalar...",rows:3})]})]}),e.jsxs(Pe,{children:[e.jsx(K,{variant:"outline",onClick:()=>I(!1),children:"Ä°ptal"}),e.jsx(K,{onClick:F,children:"Kaydet"})]})]})}),e.jsx(ze,{open:h,onOpenChange:o,children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsxs(Fe,{children:[e.jsx(Te,{children:"Toplu Fiyat GÃ¼ncelleme"}),e.jsxs(we,{children:[n.applyToAll?`TÃ¼m mÃ¼ÅŸteriler (${r.length})`:`SeÃ§ili mÃ¼ÅŸteriler (${v.size})`," iÃ§in fiyat gÃ¼ncelleme"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{checked:n.applyToAll,onCheckedChange:i=>p({...n,applyToAll:i})}),e.jsx(Y,{children:"TÃ¼m mÃ¼ÅŸterilere uygula"})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"GÃ¼ncelleme Tipi"}),e.jsxs(Ue,{value:n.updateType,onValueChange:i=>p({...n,updateType:i}),children:[e.jsx(Ke,{children:e.jsx(_e,{})}),e.jsxs(Ve,{children:[e.jsx(pe,{value:"percentage",children:"YÃ¼zde ArtÄ±ÅŸÄ±"}),e.jsx(pe,{value:"fixed",children:"Sabit Tutar ArtÄ±ÅŸÄ±"})]})]})]}),n.updateType==="percentage"?e.jsxs("div",{children:[e.jsx(Y,{children:"ArtÄ±ÅŸ YÃ¼zdesi (%)"}),e.jsx(re,{type:"number",step:"0.1",value:n.percentage,onChange:i=>p({...n,percentage:parseFloat(i.target.value)||0}),placeholder:"Ã–rn: 10 (â‚¬10 â†’ â‚¬11)"})]}):e.jsxs("div",{children:[e.jsx(Y,{children:"ArtÄ±ÅŸ TutarÄ± (â‚¬)"}),e.jsx(re,{type:"number",step:"0.01",value:n.fixedAmount,onChange:i=>p({...n,fixedAmount:parseFloat(i.target.value)||0}),placeholder:"Ã–rn: 2.50"})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"DeÄŸiÅŸiklik Sebebi *"}),e.jsx(re,{value:n.changeReason,onChange:i=>p({...n,changeReason:i.target.value}),placeholder:"Ã–rn: YÄ±llÄ±k fiyat artÄ±ÅŸÄ±"})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"GeÃ§erlilik Tarihi"}),e.jsx(re,{type:"date",value:n.effectiveDate,onChange:i=>p({...n,effectiveDate:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"Notlar"}),e.jsx(ns,{value:n.notes,onChange:i=>p({...n,notes:i.target.value}),placeholder:"Ek aÃ§Ä±klamalar...",rows:3})]})]}),e.jsxs(Pe,{children:[e.jsx(K,{variant:"outline",onClick:()=>o(!1),children:"Ä°ptal"}),e.jsx(K,{onClick:_,children:"Uygula"})]})]})}),e.jsx(ze,{open:x,onOpenChange:C,children:e.jsxs(Ae,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Fe,{children:[e.jsx(Te,{children:"Fiyat DeÄŸiÅŸiklik GeÃ§miÅŸi"}),e.jsxs(we,{children:[t==null?void 0:t.cariAdi," - ",t==null?void 0:t.cariHesapKodu]})]}),e.jsx("div",{className:"space-y-4",children:(ce=t==null?void 0:t.serviceFeeSettings)!=null&&ce.priceHistory&&t.serviceFeeSettings.priceHistory.length>0?e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(ys,{children:[e.jsx(gs,{children:e.jsxs(Ee,{children:[e.jsx(Z,{children:"Tarih"}),e.jsx(Z,{children:"Eski Fiyat"}),e.jsx(Z,{children:"Yeni Fiyat"}),e.jsx(Z,{children:"DeÄŸiÅŸim"}),e.jsx(Z,{children:"Tip"}),e.jsx(Z,{children:"Sebep"}),e.jsx(Z,{children:"GeÃ§erlilik"}),e.jsx(Z,{children:"Notlar"})]})}),e.jsx(Ns,{children:[...t.serviceFeeSettings.priceHistory].reverse().map(i=>{const N=i.newPrice-i.oldPrice,L=i.increasePercentage||0;return e.jsxs(Ee,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:new Date(i.changeDate).toLocaleDateString("tr-TR")}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(i.changeDate).toLocaleTimeString("tr-TR")})]})}),e.jsxs(q,{children:["â‚¬",i.oldPrice.toFixed(2)]}),e.jsxs(q,{children:["â‚¬",i.newPrice.toFixed(2)]}),e.jsx(q,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[N>0?e.jsx(ks,{size:16,className:"text-green-600"}):N<0?e.jsx(bs,{size:16,className:"text-red-600"}):null,e.jsxs("span",{className:`text-sm ${N>0?"text-green-600":N<0?"text-red-600":"text-gray-600"}`,children:[N>0?"+":"",N.toFixed(2),"â‚¬",e.jsx("br",{}),"(",L>0?"+":"",L.toFixed(1),"%)"]})]})}),e.jsx(q,{children:e.jsx(A,{variant:"outline",children:i.changeType==="manual"?"Manuel":i.changeType==="bulk"?"Toplu":"Otomatik"})}),e.jsx(q,{children:e.jsx("span",{className:"text-sm",children:i.changeReason})}),e.jsx(q,{children:i.effectiveDate?e.jsx("span",{className:"text-sm",children:new Date(i.effectiveDate).toLocaleDateString("tr-TR")}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx(q,{children:i.notes?e.jsx("span",{className:"text-sm text-gray-600",children:i.notes}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})})]},i.id)})})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"HenÃ¼z fiyat deÄŸiÅŸikliÄŸi kaydÄ± bulunmuyor"})}),e.jsx(Pe,{children:e.jsx(K,{variant:"outline",onClick:()=>C(!1),children:"Kapat"})})]})})]})}),rt=ie.memo(function({customers:k,payterProducts:u,onUpdateCustomer:f,suspensionReasons:z}){const[t,m]=D.useState(new Date().toISOString().substring(0,7)),S=o=>o?o.toLowerCase().trim().replace(/^https?:\/\//,"").replace(/\/$/,""):"",I=(o,x,C=!1)=>{const v=S(o),s=S(x);return!v||!s?!1:C?v===s?!1:v.endsWith("."+s):v===s},h=D.useMemo(()=>{let o=0,x=0,C=0,v=0,s=0,c=0,g=0,n=0,p=0,r=0,R=0,M=0,F=0,G=0,_=0,E=0,U=0,ee=0,V=0,O=0,ce=0;k.forEach(N=>{if(!N.serviceFeeSettings)return;const L=N.serviceFeeSettings,te=N.domain||N.guncelMyPayterDomain;if(!te)return;const X=u.filter(ne=>ne.domain?I(ne.domain,te,N.ignoreMainDomain||!1):!1);let $=0,Ne=0,J=0,ve=0;X.forEach(ne=>{var y;const de=L.deviceSubscriptions.find(j=>j.deviceId===ne.id)||{deviceId:ne.id,deviceSerialNumber:ne.serialNumber||"",deviceName:ne.name||"",monthlyFee:L.customFeePerDevice||L.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0]};M++;const Ge=(y=N.bankDeviceAssignments)==null?void 0:y.some(j=>j.deviceIds.includes(ne.id));Ge?F++:G++;const fe=L.invoices.find(j=>j.period===t),es=(fe==null?void 0:fe.isSuspended)||!1,a=de.isActive&&!es,d=de.subscriptionType==="yearly";if(a)if($++,C++,Ge)if(o+=de.monthlyFee,d?U+=de.monthlyFee*12:_+=de.monthlyFee,V+=de.monthlyFee,fe)if(fe.paymentConfirmed)s++;else{const j=new Date(fe.dueDate),P=Math.floor((new Date().getTime()-j.getTime())/(1e3*60*60*24));P>0&&P<=9&&(O+=de.monthlyFee),P>0?g++:c++}else c++;else J++,ve+=de.monthlyFee,d?ee+=de.monthlyFee*12:E+=de.monthlyFee;else Ne++,v++,ce+=de.monthlyFee}),n+=J,p+=ve,$>0&&r++,Ne>0&&R++}),x=o*12;const i=k.filter(N=>N.durum==="Aktif").length;return{totalMonthlyRevenue:o,totalYearlyRevenue:x,totalActiveDevices:C,totalSuspendedDevices:v,confirmedPayments:s,pendingPayments:c,overduePayments:g,banklessDevices:n,banklessRevenueLoss:p,activeCustomers:i,customersWithActiveSubscriptions:r,suspendedCustomers:R,totalDevices:M,devicesWithBank:F,devicesWithoutBank:G,monthlySubscriptionRevenue:_,monthlySubscriptionLoss:E,yearlySubscriptionRevenue:U,yearlySubscriptionLoss:ee,totalExpectedPayment:V,overduePaymentAmount:O,suspendedDeviceRevenue:ce}},[k,u,t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-gray-900",children:"ðŸ’° Gelir YÃ¶netimi"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"MÃ¼ÅŸteri aidat bedelleri, Ã¶deme takibi ve gelir raporlarÄ±"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(rs,{size:16}),"DÃ¶nem:"]}),e.jsx(re,{type:"month",value:t,onChange:o=>m(o.target.value),className:"w-40"})]})]}),e.jsxs(zs,{defaultValue:"subscription-fees",className:"w-full",children:[e.jsxs(As,{children:[e.jsxs(be,{value:"subscription-fees",children:["Aidat Bedelleri",h.totalActiveDevices>0&&e.jsx(A,{variant:"secondary",className:"ml-2",children:h.totalActiveDevices})]}),e.jsxs(be,{value:"price-list",children:[e.jsx(ms,{size:16,className:"mr-2"}),"Fiyat Listesi"]}),e.jsxs(be,{value:"periodical-report",children:[e.jsx(Me,{size:16,className:"mr-2"}),"DÃ¶nemsel GeliÅŸim"]}),e.jsxs(be,{value:"bank-assigned-report",children:[e.jsx(ge,{size:16,className:"mr-2"}),"Banka TanÄ±mlÄ± Cihazlar",h.devicesWithBank>0&&e.jsx(A,{variant:"default",className:"ml-2 bg-green-600",children:h.devicesWithBank})]}),e.jsxs(be,{value:"bankless-report",children:[e.jsx(De,{size:16,className:"mr-2"}),"Banka TanÄ±msÄ±z Cihazlar",h.devicesWithoutBank>0&&e.jsx(A,{variant:"destructive",className:"ml-2",children:h.devicesWithoutBank})]}),e.jsxs(be,{value:"suspended-report",children:[e.jsx(We,{size:16,className:"mr-2"}),"Pasif Cihazlar",h.totalSuspendedDevices>0&&e.jsx(A,{variant:"secondary",className:"ml-2 bg-orange-500 text-white",children:h.totalSuspendedDevices})]})]}),e.jsxs(ke,{value:"subscription-fees",className:"space-y-6 mt-6",children:[e.jsx(ha,{stats:h}),e.jsxs(T,{children:[e.jsx(se,{children:e.jsx(ae,{className:"text-base",children:"Son 6 Ay Aidat GeliÅŸimi"})}),e.jsx(w,{children:e.jsx("p",{className:"text-sm text-gray-600",children:'ðŸ“Š DetaylÄ± dÃ¶nemsel analiz iÃ§in "DÃ¶nemsel GeliÅŸim" sekmesine bakÄ±n'})})]}),e.jsx(Ba,{customers:k,payterProducts:u,onUpdateCustomer:f,selectedPeriod:t,suspensionReasons:z})]}),e.jsx(ke,{value:"price-list",className:"space-y-6 mt-6",children:e.jsx(Ha,{customers:k,onUpdateCustomer:f})}),e.jsx(ke,{value:"periodical-report",className:"space-y-6 mt-6",children:e.jsx($a,{customers:k,payterProducts:u,currentPeriod:t})}),e.jsx(ke,{value:"bank-assigned-report",className:"space-y-6 mt-6",children:e.jsx(Oa,{customers:k,payterProducts:u})}),e.jsx(ke,{value:"bankless-report",className:"space-y-6 mt-6",children:e.jsx(Ea,{customers:k,payterProducts:u})}),e.jsx(ke,{value:"suspended-report",className:"space-y-6 mt-6",children:e.jsx(La,{customers:k,payterProducts:u})})]})]})});export{rt as RevenueModule};
