import{c as Ye,r as p,j as e,C as Y,a as fe,b as be,T as Ue,d as V,B as ne,I as $a,e as He,D as la,f as na,g as ta,h as ra,i as ca,k as oa,l as B,F as fa,m as Ha,n as Oa,o as Ve,p as Ge,q as Je,s as Xe,L as le,t as ye,u as ua,U as is,v as sa,w as ba,E as Ra,x as ma,y as f,z as ls,R as Ua,S as aa,A as ns,G as Ya,H as ts,J as rs,K as ga,M as Fe,N as cs,O as Ce,P as ka,Q as $e,V as Va,W as Ga,X as _a,Y as Wa,Z as Xa,_ as Za,$ as qa,a0 as Ja,a1 as os,a2 as ds,a3 as ms,a4 as hs,a5 as xs,a6 as Qa,a7 as us,a8 as Da,a9 as Qe,aa as ea}from"./index-B0KDE8pz.js";import{m as va}from"./domainMatching-DnE2bFev.js";import{C as Oe,a as gs}from"./ColumnVisibilityDropdown-ByH42Kf_.js";import{F as _e,C as ps}from"./FilterDropdown-bMbRwlaQ.js";import{S as Sa,a as wa,b as Ca,c as za,d as pa}from"./select-B7kGhMx-.js";import{S as Re}from"./scroll-area-BWfeK-bJ.js";import{C as ia}from"./circle-alert-BColZMCl.js";import{u as js,P as ys,A as fs,a as bs,b as ks}from"./usePagination-Mp5X40TE.js";import{utils as Te,writeFile as ha,read as Ns}from"./xlsx-D_0l8YDs.js";import{E as vs}from"./eye-yIxuUw_s.js";import{A as As}from"./arrow-up-down-Bmlmjhnz.js";import{M as We}from"./monitor-Dbl9eXY6.js";import{C as da}from"./circle-x-CYTj_F-g.js";import{F as Fa,E as Ma,a as ja}from"./jspdf.plugin.autotable-CdshmCxa.js";import{C as Na}from"./chevron-down-BiFBo6-a.js";import{C as Ds}from"./clock-7gicNhvX.js";import{S as Ia}from"./save-2XSCaFh2.js";import{D as Ss}from"./dollar-sign-DoT4Nf7I.js";import{F as es}from"./file-spreadsheet-CfN0RQj_.js";import{B as Ba,P as ws}from"./play-DdzXaEw9.js";import{P as Cs}from"./progress-BDUzr-gD.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=Ye("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=Ye("CirclePause",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=Ye("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=Ye("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=Ye("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=Ye("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=Ye("SquareCheckBig",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=Ye("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=Ye("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=Ye("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);function Bs({customers:w,payterProducts:O}){const C=p.useMemo(()=>{const D=[];return w.forEach(M=>{const K=M.guncelMyPayterDomain||M.domain,S=[];M.guncelMyPayterDomain&&M.guncelMyPayterDomain.trim()&&S.push(M.guncelMyPayterDomain.trim().toLowerCase());const q=he=>{he==null||he.forEach(se=>{se.name&&se.name.trim()&&S.push(se.name.trim().toLowerCase()),se.children&&se.children.length>0&&q(se.children)})};M.domainHierarchy&&M.domainHierarchy.length>0&&q(M.domainHierarchy);const ue=O.filter(he=>!he.domain||!he.domain.trim()||!K?!1:va(he.domain,K,M.ignoreMainDomain||!1,M.domainHierarchy)),me=ue.length;let R="ok";K&&K.trim()&&me===0?R="warning":(!K||!K.trim())&&(R="critical"),(me>0||R!=="ok")&&D.push({cariKodu:M.cariKodu||"",cariAdi:M.cariAdi||"",guncelDomain:M.guncelMyPayterDomain||"",allDomains:S,domainMatchCount:me,ignoreMainDomain:M.ignoreMainDomain||!1,status:R,sampleDevices:ue.slice(0,3).map(he=>({serialNumber:he.serialNumber||"",domain:he.domain||"",terminalModel:he.terminalModel||""}))})}),D.sort((M,K)=>{const S={critical:0,warning:1,ok:2};return S[M.status]-S[K.status]})},[w,O]),$=p.useMemo(()=>{const D=C.filter(S=>S.status==="critical").length,M=C.filter(S=>S.status==="warning").length,K=C.filter(S=>S.status==="ok").length;return{critical:D,warning:M,ok:K,total:C.length}},[C]);return e.jsxs(Y,{className:"w-full",children:[e.jsx(fe,{children:e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"text-orange-600",size:20}),"Cihaz Adedi Analizi (Domain EÅŸleÅŸtirme)"]})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:$.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"Toplam MÃ¼ÅŸteri"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:$.critical}),e.jsx("div",{className:"text-xs text-gray-600",children:"Kritik Sorun"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:$.warning}),e.jsx("div",{className:"text-xs text-gray-600",children:"UyarÄ±"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:$.ok}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sorunsuz"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded text-sm space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"bg-red-600",children:"KRÄ°TÄ°K"}),"Domain bilgisi eksik veya yanlÄ±ÅŸ"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"bg-orange-600",children:"UYARI"}),"Domain var ama eÅŸleÅŸen cihaz bulunamadÄ±"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"bg-green-600",children:"SORUNSUZ"}),"Domain eÅŸleÅŸmesi baÅŸarÄ±lÄ±"]})]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:C.map((D,M)=>e.jsxs("div",{className:`p-3 rounded border ${D.status==="critical"?"bg-red-50 border-red-200":D.status==="warning"?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[D.status==="critical"?e.jsx(Ue,{size:16,className:"text-red-600"}):D.status==="warning"?e.jsx($a,{size:16,className:"text-orange-600"}):e.jsx(He,{size:16,className:"text-green-600"}),e.jsx("span",{className:"font-semibold",children:D.cariAdi})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-6",children:D.cariKodu})]}),e.jsx(ne,{className:D.status==="critical"?"bg-red-600":D.status==="warning"?"bg-orange-600":"bg-green-600",children:D.status==="critical"?"KRÄ°TÄ°K":D.status==="warning"?"UYARI":"OK"})]}),e.jsxs("div",{className:"ml-6 space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ana Domain:"})," ",D.guncelDomain||"âŒ YOK"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:["TÃ¼m Domain'ler (",D.allDomains.length,"):"]})," ",D.allDomains.length>0?e.jsx("span",{className:"text-xs font-mono",children:D.allDomains.join(", ")}):e.jsx("span",{className:"text-red-600",children:"âŒ HiÃ§ domain tanÄ±mlÄ± deÄŸil!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-2 bg-white rounded mt-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Cihaz Adedi"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:D.domainMatchCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"ignoreMainDomain"}),e.jsx("div",{className:"text-xl font-bold text-orange-600",children:D.ignoreMainDomain?"âœ“ Aktif":"â—‹ KapalÄ±"})]})]}),D.sampleDevices.length>0&&e.jsxs("details",{className:"mt-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs text-blue-600 hover:underline",children:["Ã–rnek cihazlar (",D.sampleDevices.length,"/",D.domainMatchCount,")"]}),e.jsx("ul",{className:"mt-1 ml-4 space-y-1",children:D.sampleDevices.map((K,S)=>e.jsxs("li",{className:"text-xs font-mono bg-white p-1 rounded",children:[K.serialNumber," | ",K.domain," | ",K.terminalModel]},S))})]}),D.status==="critical"&&e.jsxs("div",{className:"mt-2 p-2 bg-red-100 rounded text-xs text-red-800",children:[e.jsx("strong",{children:"âŒ SORUN:"}),' Bu mÃ¼ÅŸteri iÃ§in domain bilgisi eksik veya yanlÄ±ÅŸ! LÃ¼tfen "GÃ¼ncel Mypayter Domain" ve "Domain HiyerarÅŸisi" bilgilerini kontrol edin.']}),D.status==="warning"&&e.jsxs("div",{className:"mt-2 p-2 bg-orange-100 rounded text-xs text-orange-800",children:[e.jsx("strong",{children:"âš ï¸ UYARI:"})," Domain bilgisi var (",D.guncelDomain,") ama hiÃ§ cihaz eÅŸleÅŸmesi bulunamadÄ±. Domain bilgisini veya PayterProducts listesini kontrol edin."]})]})]},M))})]})})]})}function Ls({isOpen:w,onClose:O,selectedCustomers:C,onApplyBatchOperation:$,bankPFRecords:D=[],banks:M=[],epkList:K=[],okList:S=[],salesReps:q=[]}){const[ue,me]=p.useState("status"),[R,he]=p.useState(!1),[se,W]=p.useState(!1),[Q,i]=p.useState(null),[J,pe]=p.useState(""),[N,Be]=p.useState([]),[ve,ke]=p.useState([]),[v,xe]=p.useState([]),[ie,je]=p.useState([]),[Se,Ie]=p.useState(""),[De,Ee]=p.useState(""),[z,m]=p.useState(""),[u,F]=p.useState(""),[L,A]=p.useState(""),[T,ae]=p.useState("monthly"),[b,P]=p.useState(10),[H,E]=p.useState(""),[ge,te]=p.useState(new Date().toISOString().split("T")[0]),[ce,Le]=p.useState(""),de=()=>{R||(W(!1),i(null),pe(""),Be([]),ke([]),xe([]),je([]),Ie(""),Ee(""),m(""),F(""),A(""),ae("monthly"),P(10),E(""),te(new Date().toISOString().split("T")[0]),Le(""),me("status"),O())},U=async(c,Z)=>{he(!0);try{const _=await $(c,Z);i(_),W(!0),ls("UPDATE","MÃ¼ÅŸteri",{delete:"Toplu Silme",activate:"Toplu AktifleÅŸtirme",deactivate:"Toplu PasifleÅŸtirme",block:"Toplu Blokaj",unblock:"Toplu Blokaj KaldÄ±rma","assign-domain":"Toplu Domain Atama","assign-bankpf":"Toplu Banka/PF Atama","assign-bank":"Toplu Banka Atama","assign-epk":"Toplu EPK Atama","assign-ok":"Toplu Ã–K Atama","assign-mcc":"Toplu MCC Atama","assign-sector":"Toplu SektÃ¶r Atama","assign-salesrep":"Toplu SatÄ±ÅŸ Temsilcisi Atama","assign-user":"Toplu KullanÄ±cÄ± Atama","assign-group":"Toplu Grup Atama","update-service-fee":"Toplu Hizmet Bedeli GÃ¼ncelleme","activate-service-fee":"Toplu Hizmet Bedeli AktifleÅŸtirme","deactivate-service-fee":"Toplu Hizmet Bedeli Durdurma","suspend-service-fee":"Toplu Hizmet Bedeli Dondurma","resume-service-fee":"Toplu Hizmet Bedeli Devam Ettirme"}[c],{details:`${C.length} mÃ¼ÅŸteri Ã¼zerinde toplu iÅŸlem yapÄ±ldÄ±`,metadata:{operation:c,customerCount:C.length,successCount:_.success,failedCount:_.failed,...Z}}),_.success>0?f.success(`âœ… ${_.success} kayÄ±t baÅŸarÄ±yla iÅŸlendi${_.failed>0?`, ${_.failed} kayÄ±t baÅŸarÄ±sÄ±z`:""}`):f.error("âŒ TÃ¼m kayÄ±tlar baÅŸarÄ±sÄ±z oldu")}catch(_){f.error("Ä°ÅŸlem sÄ±rasÄ±nda bir hata oluÅŸtu"),console.error("Batch operation error:",_)}finally{he(!1)}},Pe=()=>{confirm(`âš ï¸ ${C.length} cari kaydÄ± SÄ°LÄ°NECEK! Emin misiniz?`)&&U("delete")},re=()=>{U("activate")},G=()=>{U("deactivate")},ze=()=>{confirm(`âš ï¸ ${C.length} cari kaydÄ± BLOKE EDÄ°LECEK! Emin misiniz?`)&&U("block")},Ne=()=>{U("unblock")},Me=()=>{if(!J.trim()){f.error("LÃ¼tfen domain deÄŸeri girin!");return}U("assign-domain",{domain:J.trim()})},l=()=>{if(N.length===0){f.error("LÃ¼tfen en az bir Banka/PF seÃ§in!");return}U("assign-bankpf",{bankPFIds:N})},x=()=>{if(ve.length===0){f.error("LÃ¼tfen en az bir Banka seÃ§in!");return}U("assign-bank",{bankIds:ve})},j=()=>{if(v.length===0){f.error("LÃ¼tfen en az bir EPK seÃ§in!");return}U("assign-epk",{epkIds:v})},s=()=>{if(ie.length===0){f.error("LÃ¼tfen en az bir Ã–K seÃ§in!");return}U("assign-ok",{okIds:ie})},t=()=>{if(!Se){f.error("LÃ¼tfen bir SatÄ±ÅŸ Temsilcisi seÃ§in!");return}U("assign-salesrep",{salesRepId:Se})},I=()=>{if(!De.trim()){f.error("LÃ¼tfen MCC kodu girin!");return}U("assign-mcc",{mcc:De.trim()})},ee=()=>{if(!z.trim()){f.error("LÃ¼tfen sektÃ¶r adÄ± girin!");return}U("assign-sector",{sector:z.trim()})},y=()=>{const c={paymentType:T,standardFeePerDevice:b,customFeePerDevice:H?Number(H):void 0,contractStartDate:ge,isActive:!0};U("update-service-fee",c)},X=()=>{U("activate-service-fee")},oe=()=>{confirm(`âš ï¸ ${C.length} cari kaydÄ±nÄ±n hizmet bedeli DURDURULACAK! Emin misiniz?`)&&U("deactivate-service-fee")},a=()=>{if(!ce.trim()){f.error("LÃ¼tfen dondurma sebebini girin!");return}U("suspend-service-fee",{suspensionStartDate:new Date().toISOString().split("T")[0],suspensionReason:ce.trim()})},n=()=>{U("resume-service-fee")},r=(c,Z,_)=>{Z.includes(c)?_(Z.filter(Ae=>Ae!==c)):_([...Z,c])};if(se&&Q)return e.jsx(la,{open:w,onOpenChange:de,children:e.jsxs(na,{className:"max-w-2xl",children:[e.jsxs(ta,{children:[e.jsxs(ra,{className:"flex items-center gap-2",children:[Q.success>0&&Q.failed===0&&e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"h-5 w-5 text-green-600"}),"Ä°ÅŸlem BaÅŸarÄ±lÄ±"]}),Q.success>0&&Q.failed>0&&e.jsxs(e.Fragment,{children:[e.jsx(ia,{className:"h-5 w-5 text-orange-600"}),"KÄ±smi BaÅŸarÄ±"]}),Q.success===0&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"h-5 w-5 text-red-600"}),"Ä°ÅŸlem BaÅŸarÄ±sÄ±z"]})]}),e.jsx(ca,{children:"Toplu iÅŸlem tamamlandÄ±"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Y,{className:"bg-green-50 border-green-200",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:Q.success}),e.jsx("div",{className:"text-sm text-green-700 mt-1",children:"BaÅŸarÄ±lÄ±"})]})})}),e.jsx(Y,{className:"bg-red-50 border-red-200",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:Q.failed}),e.jsx("div",{className:"text-sm text-red-700 mt-1",children:"BaÅŸarÄ±sÄ±z"})]})})})]}),Q.errors.length>0&&e.jsxs(Y,{className:"border-red-200",children:[e.jsx(fe,{children:e.jsx(be,{className:"text-sm text-red-900",children:"Hatalar"})}),e.jsx(V,{children:e.jsx(Re,{className:"h-48",children:e.jsx("div",{className:"space-y-2",children:Q.errors.map((c,Z)=>e.jsxs("div",{className:"text-sm p-2 bg-red-50 rounded border border-red-200",children:[e.jsx("div",{className:"font-medium text-red-900",children:c.customerName}),e.jsx("div",{className:"text-red-700 text-xs mt-1",children:c.error})]},Z))})})})]})]}),e.jsx(oa,{children:e.jsx(B,{onClick:de,children:"Kapat"})})]})});const d=D.filter(c=>!c.isDeleted),g=M.filter(c=>c.aktif),k=K.filter(c=>c.aktif),h=S.filter(c=>c.aktif),o=q.filter(c=>c.aktif);return e.jsx(la,{open:w,onOpenChange:de,children:e.jsxs(na,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(ta,{children:[e.jsxs(ra,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5 text-blue-600"}),"Toplu Ä°ÅŸlemler"]}),e.jsxs(ca,{children:[C.length," cari kayda toplu iÅŸlem uygula"]})]}),e.jsxs(Y,{className:"bg-blue-50 border-blue-200",children:[e.jsx(fe,{className:"pb-3",children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(fa,{className:"h-4 w-4"}),"SeÃ§ili Cari Kartlar (",C.length,")"]})}),e.jsx(V,{children:e.jsx(Re,{className:"h-20",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[C.slice(0,10).map(c=>e.jsx(ne,{variant:"secondary",className:"text-xs",children:c.cariAdi},c.id)),C.length>10&&e.jsxs(ne,{variant:"outline",className:"text-xs",children:["+",C.length-10," daha..."]})]})})})]}),e.jsxs(Ha,{value:ue,onValueChange:me,className:"w-full",children:[e.jsxs(Oa,{className:"grid w-full grid-cols-4",children:[e.jsx(Ve,{value:"status",children:"Durum YÃ¶netimi"}),e.jsx(Ve,{value:"assignment",children:"Veri Atama"}),e.jsx(Ve,{value:"bankpf",children:"Banka/PF Atama"}),e.jsx(Ve,{value:"service-fee",children:"Hizmet Bedeli"})]}),e.jsx(Ge,{value:"status",className:"space-y-4 mt-4",children:e.jsx(Re,{className:"h-96",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ea,{className:"h-4 w-4 text-blue-600"}),"Durum DeÄŸiÅŸtirme"]})}),e.jsx(V,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(B,{onClick:re,disabled:R,className:"w-full gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(ya,{className:"h-4 w-4"}),"Aktif Yap"]}),e.jsxs(B,{onClick:G,disabled:R,variant:"outline",className:"w-full gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"Pasif Yap"]})]})})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4 text-orange-600"}),"Blokaj Ä°ÅŸlemleri"]})}),e.jsx(V,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(B,{onClick:ze,disabled:R,variant:"destructive",className:"w-full gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"Bloke Et"]}),e.jsxs(B,{onClick:Ne,disabled:R,variant:"outline",className:"w-full gap-2",children:[e.jsx(ya,{className:"h-4 w-4"}),"Blokeyi KaldÄ±r"]})]})})]}),e.jsxs(Y,{className:"border-red-300 bg-red-50",children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2 text-red-900",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Tehlikeli BÃ¶lge"]})}),e.jsx(V,{children:e.jsxs(B,{onClick:Pe,disabled:R,variant:"destructive",className:"w-full gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"SeÃ§ili KayÄ±tlarÄ± Sil"]})})]})]})})}),e.jsx(Ge,{value:"assignment",className:"space-y-4 mt-4",children:e.jsx(Re,{className:"h-96",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(zs,{className:"h-4 w-4 text-blue-600"}),"Domain Atama"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"domain",children:"Domain"}),e.jsx(ye,{id:"domain",placeholder:"Ã¶rn: example.payter.com",value:J,onChange:c=>pe(c.target.value),disabled:R})]}),e.jsx(B,{onClick:Me,disabled:R||!J.trim(),className:"w-full",children:"Domain Ata"})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(Pa,{className:"h-4 w-4 text-purple-600"}),"MCC Kodu Atama"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"mcc",children:"MCC Kodu"}),e.jsx(ye,{id:"mcc",placeholder:"Ã¶rn: 5411",value:De,onChange:c=>Ee(c.target.value),disabled:R})]}),e.jsx(B,{onClick:I,disabled:R||!De.trim(),className:"w-full",children:"MCC Ata"})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(ua,{className:"h-4 w-4 text-indigo-600"}),"SektÃ¶r Atama"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"sector",children:"SektÃ¶r"}),e.jsx(ye,{id:"sector",placeholder:"Ã¶rn: Perakende",value:z,onChange:c=>m(c.target.value),disabled:R})]}),e.jsx(B,{onClick:ee,disabled:R||!z.trim(),className:"w-full",children:"SektÃ¶r Ata"})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4 text-pink-600"}),"SatÄ±ÅŸ Temsilcisi Atama"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"salesrep",children:"SatÄ±ÅŸ Temsilcisi"}),e.jsxs(Sa,{value:Se,onValueChange:Ie,disabled:R,children:[e.jsx(wa,{children:e.jsx(Ca,{placeholder:"SatÄ±ÅŸ temsilcisi seÃ§in"})}),e.jsx(za,{children:o.map(c=>e.jsx(pa,{value:c.id,children:c.adSoyad},c.id))})]})]}),e.jsx(B,{onClick:t,disabled:R||!Se,className:"w-full",children:"Temsilci Ata"})]})]})]})})}),e.jsx(Ge,{value:"bankpf",className:"space-y-4 mt-4",children:e.jsx(Re,{className:"h-96",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(Y,{children:[e.jsxs(fe,{children:[e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(sa,{className:"h-4 w-4 text-green-600"}),"Banka/PF Atama (Ã‡oklu)"]}),e.jsx(ba,{className:"text-xs",children:"SeÃ§ili cari kartlara toplu olarak Banka/Ã–deme PlanÄ± atayÄ±n"})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Banka/PF SeÃ§in (Ã‡oklu):"}),e.jsx(Re,{className:"h-48 border rounded-lg p-3",children:e.jsxs("div",{className:"space-y-2",children:[d.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Aktif Banka/PF kaydÄ± bulunamadÄ±"}),d.map(c=>e.jsxs("div",{className:"flex items-center space-x-2 hover:bg-gray-50 p-2 rounded",children:[e.jsx(Oe,{id:`bp-${c.id}`,checked:N.includes(c.id),onCheckedChange:()=>r(c.id,N,Be),disabled:R}),e.jsxs(le,{htmlFor:`bp-${c.id}`,className:"flex-1 cursor-pointer text-sm",children:[e.jsx("div",{className:"font-medium",children:c.firmaUnvan}),e.jsx("div",{className:"text-xs text-gray-500",children:c.bankaOrPF==="PF"?`PF - ${c.odemeKurulusuTipi||"BelirtilmemiÅŸ"}`:`Banka - ${c.selectedBanka||"BelirtilmemiÅŸ"}`})]})]},c.id))]})}),N.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-2",children:e.jsxs("p",{className:"text-xs text-blue-900",children:[e.jsx("strong",{children:N.length})," Banka/PF seÃ§ildi"]})}),e.jsxs(B,{onClick:l,disabled:R||N.length===0,className:"w-full gap-2",children:[e.jsx(Fs,{className:"h-4 w-4"}),"Banka/PF Ata (",N.length,")"]})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(sa,{className:"h-4 w-4 text-blue-600"}),"Banka Atama (Ã‡oklu)"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsx(Re,{className:"h-32 border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:g.map(c=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Oe,{id:`bank-${c.id}`,checked:ve.includes(c.id),onCheckedChange:()=>r(c.id,ve,ke),disabled:R}),e.jsx(le,{htmlFor:`bank-${c.id}`,className:"flex-1 cursor-pointer text-sm",children:c.ad})]},c.id))})}),e.jsxs(B,{onClick:x,disabled:R||ve.length===0,className:"w-full",children:["Banka Ata (",ve.length,")"]})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(ua,{className:"h-4 w-4 text-purple-600"}),"EPK Atama (Ã‡oklu)"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsx(Re,{className:"h-32 border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:k.map(c=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Oe,{id:`epk-${c.id}`,checked:v.includes(c.id),onCheckedChange:()=>r(c.id,v,xe),disabled:R}),e.jsxs(le,{htmlFor:`epk-${c.id}`,className:"flex-1 cursor-pointer text-sm",children:[c.kod," - ",c.kurumAdi]})]},c.id))})}),e.jsxs(B,{onClick:j,disabled:R||v.length===0,className:"w-full",children:["EPK Ata (",v.length,")"]})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(ua,{className:"h-4 w-4 text-orange-600"}),"Ã–K Atama (Ã‡oklu)"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsx(Re,{className:"h-32 border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:h.map(c=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Oe,{id:`ok-${c.id}`,checked:ie.includes(c.id),onCheckedChange:()=>r(c.id,ie,je),disabled:R}),e.jsxs(le,{htmlFor:`ok-${c.id}`,className:"flex-1 cursor-pointer text-sm",children:[c.kod," - ",c.kurumAdi]})]},c.id))})}),e.jsxs(B,{onClick:s,disabled:R||ie.length===0,className:"w-full",children:["Ã–K Ata (",ie.length,")"]})]})]})]})})}),e.jsx(Ge,{value:"service-fee",className:"space-y-4 mt-4",children:e.jsx(Re,{className:"h-96",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ea,{className:"h-4 w-4 text-blue-600"}),"Hizmet Bedeli Durumu"]})}),e.jsx(V,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(B,{onClick:X,disabled:R,className:"w-full gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(Ta,{className:"h-4 w-4"}),"Aktif Yap"]}),e.jsxs(B,{onClick:oe,disabled:R,variant:"destructive",className:"w-full gap-2",children:[e.jsx(La,{className:"h-4 w-4"}),"Durdur"]})]})})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ra,{className:"h-4 w-4 text-green-600"}),"Hizmet Bedeli GÃ¼ncelleme"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"paymentType",children:"Ã–deme Tipi"}),e.jsxs(Sa,{value:T,onValueChange:c=>ae(c),disabled:R,children:[e.jsx(wa,{children:e.jsx(Ca,{})}),e.jsxs(za,{children:[e.jsx(pa,{value:"monthly",children:"AylÄ±k"}),e.jsx(pa,{value:"yearly",children:"YÄ±llÄ±k"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"standardFee",children:"Standart Ãœcret (â‚¬)"}),e.jsx(ye,{id:"standardFee",type:"number",value:b,onChange:c=>P(Number(c.target.value)),disabled:R})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"customFee",children:"Ã–zel Ãœcret (â‚¬)"}),e.jsx(ye,{id:"customFee",type:"number",placeholder:"Opsiyonel",value:H,onChange:c=>E(c.target.value),disabled:R})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"contractStartDate",children:"SÃ¶zleÅŸme BaÅŸlangÄ±Ã§"}),e.jsx(ye,{id:"contractStartDate",type:"date",value:ge,onChange:c=>te(c.target.value),disabled:R})]}),e.jsx(B,{onClick:y,disabled:R,className:"w-full",children:"Hizmet Bedeli GÃ¼ncelle"})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs(be,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4 text-orange-600"}),"Hizmet Bedeli Dondurma"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"suspensionReason",children:"Dondurma Sebebi"}),e.jsx(ma,{id:"suspensionReason",placeholder:"Neden donduruldu?",value:ce,onChange:c=>Le(c.target.value),disabled:R,rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(B,{onClick:a,disabled:R||!ce.trim(),variant:"outline",className:"w-full gap-2",children:[e.jsx(La,{className:"h-4 w-4"}),"Dondur"]}),e.jsxs(B,{onClick:n,disabled:R,className:"w-full gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(Ta,{className:"h-4 w-4"}),"Devam Ettir"]})]})]})]})]})})})]}),e.jsx(oa,{children:e.jsx(B,{variant:"outline",onClick:de,disabled:R,children:"Ä°ptal"})})]})})}const Ts=[{key:"cariHesapKodu",label:"Cari Hesap Kodu",defaultVisible:!0},{key:"sektor",label:"SEKTÃ–R",defaultVisible:!0},{key:"mcc",label:"MCC",defaultVisible:!0},{key:"cariAdi",label:"Cari AdÄ±",defaultVisible:!0},{key:"domain",label:"GÃ¼ncel Mypayter Domain",defaultVisible:!0},{key:"cihazAdedi",label:"Cihaz Adedi",defaultVisible:!0},{key:"domainMatchCount",label:"Domain EÅŸleÅŸmesi (Debug)",defaultVisible:!1},{key:"bankaPF",label:"Banka/PF",defaultVisible:!0},{key:"salesRep",label:"SatÄ±ÅŸ Temsilcisi",defaultVisible:!0},{key:"yetkili",label:"Yetkili",defaultVisible:!0},{key:"tel",label:"Tel",defaultVisible:!0},{key:"email",label:"Email",defaultVisible:!1},{key:"vergiDairesi",label:"Vergi Dairesi",defaultVisible:!1},{key:"vergiNo",label:"Vergi No",defaultVisible:!1},{key:"adres",label:"Adres",defaultVisible:!1},{key:"ilce",label:"Ä°lÃ§e",defaultVisible:!0},{key:"postaKodu",label:"Posta Kodu",defaultVisible:!1},{key:"p6x",label:"P6X",defaultVisible:!1},{key:"apollo",label:"APOLLO",defaultVisible:!1},{key:"durum",label:"Durum",defaultVisible:!0}],Ps=Ua.memo(function({customers:O,onSelectCustomer:C,onUpdateCustomer:$,onUpdateCustomers:D,payterProducts:M=[],bankPFRecords:K=[],salesReps:S=[],banks:q=[],epkList:ue=[],okList:me=[]}){const[R,he]=p.useState(""),[se,W]=p.useState("all"),[Q,i]=p.useState("all"),[J,pe]=p.useState("all"),[N,Be]=p.useState("cariAdi"),[ve,ke]=p.useState("asc"),[v,xe]=p.useState({}),[ie,je]=p.useState([]),[Se,Ie]=p.useState(!1),[De,Ee]=p.useState(!1),z=s=>{N===s?ke(ve==="asc"?"desc":"asc"):(Be(s),ke("asc"))},m=({field:s})=>N!==s?e.jsx(As,{size:14,className:"text-gray-400"}):ve==="asc"?e.jsx(fs,{size:14,className:"text-blue-600"}):e.jsx(bs,{size:14,className:"text-blue-600"}),u=p.useCallback(s=>{if(!M||M.length===0)return 0;const t=s.guncelMyPayterDomain||s.domain;return!t||!t.trim()?0:M.filter(ee=>!ee.domain||!ee.domain.trim()?!1:va(ee.domain,t,s.ignoreMainDomain||!1,s.domainHierarchy)).length},[M]),F=p.useCallback(s=>u(s),[u]),L=p.useCallback(s=>{const t=new Set;return s.linkedBankPFIds&&s.linkedBankPFIds.length>0&&s.linkedBankPFIds.forEach(I=>{const ee=K.find(y=>y.id===I);ee&&ee.firmaUnvan&&t.add(ee.firmaUnvan)}),s.bankDeviceAssignments&&s.bankDeviceAssignments.length>0&&s.bankDeviceAssignments.forEach(I=>{I.bankName&&t.add(I.bankName)}),t.size===0?"-":Array.from(t).join(", ")},[K]),A=p.useCallback(s=>{if(!s||s.length===0)return[];const t=[],I=ee=>{t.push(ee.name.toLowerCase()),ee.children&&ee.children.length>0&&ee.children.forEach(y=>I(y))};return s.forEach(ee=>I(ee)),t},[]),T=p.useMemo(()=>O.filter(s=>{const t=R.toLowerCase(),I=(s.guncelMyPayterDomain||"").toLowerCase().includes(t),y=A(s.domainHierarchy).some(d=>d.includes(t)),X=(s.cariAdi||"").toLowerCase().includes(t)||(s.cariHesapKodu||"").toLowerCase().includes(t)||(s.sektor||"").toLowerCase().includes(t)||String(s.mcc||"").toLowerCase().includes(t)||(s.ilce||"").toLowerCase().includes(t)||String(s.vergiNo||"").toLowerCase().includes(t)||(s.yetkili||"").toLowerCase().includes(t)||(s.email||"").toLowerCase().includes(t)||I||y,oe=se==="all"||s.durum===se,a=F(s);let n=!0;Q==="0"?n=a===0:Q==="1-4"?n=a>=1&&a<=4:Q==="5-9"?n=a>=5&&a<=9:Q==="10+"&&(n=a>=10);const r=J==="all"||J==="unassigned"&&!s.salesRepId||s.salesRepId===J;return X&&oe&&n&&r}).sort((s,t)=>{const I=s.durum==="Aktif"?0:1,ee=t.durum==="Aktif"?0:1;if(I!==ee)return I-ee;if(N==="cihazAdedi"){const oe=F(s),a=F(t);return ve==="asc"?oe-a:a-oe}if(N==="bankaPF"){const oe=L(s),a=L(t);return ve==="asc"?oe.localeCompare(a,"tr"):a.localeCompare(oe,"tr")}if(N==="salesRep"){const oe=s.salesRepName||"",a=t.salesRepName||"";return ve==="asc"?oe.localeCompare(a,"tr"):a.localeCompare(oe,"tr")}const y=s[N],X=t[N];return typeof y=="string"&&typeof X=="string"?ve==="asc"?y.localeCompare(X,"tr"):X.localeCompare(y,"tr"):typeof y=="number"&&typeof X=="number"?ve==="asc"?y-X:X-y:0}),[O,R,se,Q,J,N,ve,A,F,L]),{paginatedItems:ae,currentPage:b,totalPages:P,itemsPerPage:H,startIndex:E,endIndex:ge,goToPage:te,setItemsPerPage:ce}=js(T,50),Le=p.useMemo(()=>[{value:"Aktif",label:"Aktif",count:O.filter(s=>s.durum==="Aktif").length},{value:"Pasif",label:"Pasif",count:O.filter(s=>s.durum==="Pasif").length}],[O]),de=p.useMemo(()=>{const s={0:0,"1-4":0,"5-9":0,"10+":0};return O.forEach(t=>{const I=F(t);I===0?s[0]++:I>=1&&I<=4?s["1-4"]++:I>=5&&I<=9?s["5-9"]++:I>=10&&s["10+"]++}),[{value:"0",label:"CihazÄ± Yok (0)",count:s[0]},{value:"1-4",label:"1-4 Cihaz",count:s["1-4"]},{value:"5-9",label:"5-9 Cihaz",count:s["5-9"]},{value:"10+",label:"10+ Cihaz",count:s["10+"]}]},[O,F]),U=p.useMemo(()=>{const t=[{value:"unassigned",label:"AtanmamÄ±ÅŸ",count:O.filter(I=>!I.salesRepId).length}];return S.forEach(I=>{const ee=O.filter(y=>y.salesRepId===I.id).length;(ee>0||I.aktif)&&t.push({value:I.id,label:I.adSoyad,count:ee})}),t},[O,S]),Pe=p.useCallback(s=>{xe(s)},[]),re=p.useCallback(s=>{const t={...s,durum:s.durum==="Aktif"?"Pasif":"Aktif"};$&&($(t),f.success(`${s.cariAdi} durumu ${t.durum} olarak gÃ¼ncellendi`))},[$]),G=p.useCallback(s=>{je(s?T.map(t=>t.id):[])},[T]),ze=p.useCallback((s,t)=>{je(t?I=>[...I,s]:I=>I.filter(ee=>ee!==s))},[]),Ne=p.useMemo(()=>T.length>0&&ie.length===T.length,[T.length,ie.length]),Me=p.useMemo(()=>ie.length>0&&ie.length<T.length,[ie.length,T.length]),l=p.useMemo(()=>O.filter(s=>ie.includes(s.id)),[O,ie]),x=async(s,t)=>{const I={success:0,failed:0,errors:[]};if(!$)return I.failed=l.length,I.errors=l.map(y=>({customerId:y.id,customerName:y.cariAdi,error:"onUpdateCustomer fonksiyonu tanÄ±mlÄ± deÄŸil"})),I;const ee=[];for(const y of l)try{let X={...y};switch(s){case"delete":X={...y,durum:"Pasif"};break;case"activate":X.durum="Aktif";break;case"deactivate":X.durum="Pasif";break;case"block":X.blokeDurumu=!0;break;case"unblock":X.blokeDurumu=!1;break;case"assign-domain":t!=null&&t.domain&&(X.guncelMyPayterDomain=t.domain);break;case"assign-bankpf":if(t!=null&&t.bankPFIds){const oe=[...y.linkedBankPFIds||[],...t.bankPFIds];X.linkedBankPFIds=[...new Set(oe)];const a=t.bankPFIds.filter(n=>!(y.linkedBankPFIds||[]).includes(n));if(a.length>0&&K){console.log(`ðŸ”— Toplu Ä°ÅŸlem - ${y.cariAdi}: ${a.length} yeni Banka/PF kategorisi oluÅŸturuluyor...`);const n=a.map(r=>{const d=K.find(k=>k.id===r);if(!d)return null;let g="";return d.tip==="Banka"?g=`bank-${d.id}`:d.tip==="EPK"?g=`ok-epk-${d.id}`:d.tip==="Ã–K"?g=`ok-ok-${d.id}`:g=`bank-${d.id}`,console.log(`  âž• ${d.tip} kategorisi: ${d.firmaUnvan} (${g})`),{id:`assignment-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,bankId:g,bankName:d.firmaUnvan,bankCode:d.kod||"",deviceIds:[],createdAt:new Date().toISOString()}}).filter(Boolean);X.bankDeviceAssignments=[...y.bankDeviceAssignments||[],...n]}}break;case"assign-user":t!=null&&t.user&&(X.sorumluKisi=t.user);break;case"assign-group":t!=null&&t.group&&(X.cariGrubu=t.group);break;case"update-service-fee":{const oe=y.serviceFeeSettings?{...y.serviceFeeSettings,deviceSubscriptions:y.serviceFeeSettings.deviceSubscriptions||[],invoices:y.serviceFeeSettings.invoices||[],reminders:y.serviceFeeSettings.reminders||[]}:{customerId:y.id,paymentType:"monthly",standardFeePerDevice:10,contractStartDate:new Date().toISOString().split("T")[0],isActive:!0,deviceSubscriptions:[],invoices:[],reminders:[]};X.serviceFeeSettings={...oe,paymentType:t.paymentType||oe.paymentType,standardFeePerDevice:t.standardFeePerDevice??oe.standardFeePerDevice,customFeePerDevice:t.customFeePerDevice,contractStartDate:t.contractStartDate||oe.contractStartDate,isActive:t.isActive??oe.isActive}}break;case"activate-service-fee":y.serviceFeeSettings?X.serviceFeeSettings={...y.serviceFeeSettings,deviceSubscriptions:y.serviceFeeSettings.deviceSubscriptions||[],invoices:y.serviceFeeSettings.invoices||[],reminders:y.serviceFeeSettings.reminders||[],isActive:!0,suspensionStartDate:void 0,suspensionReason:void 0}:X.serviceFeeSettings={customerId:y.id,paymentType:"monthly",standardFeePerDevice:10,contractStartDate:new Date().toISOString().split("T")[0],isActive:!0,deviceSubscriptions:[],invoices:[],reminders:[]};break;case"deactivate-service-fee":y.serviceFeeSettings&&(X.serviceFeeSettings={...y.serviceFeeSettings,deviceSubscriptions:y.serviceFeeSettings.deviceSubscriptions||[],invoices:y.serviceFeeSettings.invoices||[],reminders:y.serviceFeeSettings.reminders||[],isActive:!1});break;case"suspend-service-fee":y.serviceFeeSettings&&(X.serviceFeeSettings={...y.serviceFeeSettings,deviceSubscriptions:y.serviceFeeSettings.deviceSubscriptions||[],invoices:y.serviceFeeSettings.invoices||[],reminders:y.serviceFeeSettings.reminders||[],suspensionStartDate:(t==null?void 0:t.suspensionStartDate)||new Date().toISOString().split("T")[0],suspensionReason:(t==null?void 0:t.suspensionReason)||"Toplu iÅŸlem ile donduruldu"});break;case"resume-service-fee":y.serviceFeeSettings&&(X.serviceFeeSettings={...y.serviceFeeSettings,deviceSubscriptions:y.serviceFeeSettings.deviceSubscriptions||[],invoices:y.serviceFeeSettings.invoices||[],reminders:y.serviceFeeSettings.reminders||[],suspensionStartDate:void 0,suspensionReason:void 0});break;case"assign-bank":t!=null&&t.bankIds&&Array.isArray(t.bankIds)&&console.log(`ðŸ¦ Toplu Banka Atama: ${t.bankIds.length} banka`);break;case"assign-epk":t!=null&&t.epkIds&&Array.isArray(t.epkIds)&&console.log(`ðŸ“Š Toplu EPK Atama: ${t.epkIds.length} EPK`);break;case"assign-ok":t!=null&&t.okIds&&Array.isArray(t.okIds)&&console.log(`ðŸ” Toplu Ã–K Atama: ${t.okIds.length} Ã–K`);break;case"assign-mcc":t!=null&&t.mcc&&(X.mcc=t.mcc);break;case"assign-sector":t!=null&&t.sector&&(X.sektor=t.sector);break;case"assign-salesrep":t!=null&&t.salesRepId&&(X.salesRepId=t.salesRepId);break}ee.push(X),I.success++}catch(X){I.failed++,I.errors.push({customerId:y.id,customerName:y.cariAdi,error:X instanceof Error?X.message:"Bilinmeyen hata"})}if(ee.length>0){const y=new Map(ee.map(oe=>[oe.id,oe])),X=O.map(oe=>y.has(oe.id)?y.get(oe.id):oe);D?(D(X),console.log(`âœ… Toplu iÅŸlem tamamlandÄ±: ${ee.length} mÃ¼ÅŸteri gÃ¼ncellendi (toplu)`)):$&&(X.forEach(oe=>{y.has(oe.id)&&$(oe)}),console.log(`âœ… Toplu iÅŸlem tamamlandÄ±: ${ee.length} mÃ¼ÅŸteri gÃ¼ncellendi (tek tek)`))}return je([]),I},j=()=>{try{const s=T.map(y=>({"Cari Hesap Kodu":y.cariHesapKodu,SEKTÃ–R:y.sektor,MCC:y.mcc,"Cari AdÄ±":y.cariAdi,"GÃ¼ncel Mypayter Domain":y.guncelMyPayterDomain||"","Cihaz Adedi":F(y),"Domain EÅŸleÅŸmesi (Debug)":u(y),"Banka/PF":L(y),"SatÄ±ÅŸ Temsilcisi":y.salesRepName||"",Yetkili:y.yetkili,Tel:y.tel,Email:y.email,"Vergi Dairesi":y.vergiDairesi,"Vergi No":y.vergiNo,Adres:y.adres,Ä°lÃ§e:y.ilce,"Posta Kodu":y.postaKodu,P6X:y.p6x||"",APOLLO:y.apollo||"",Durum:y.durum})),t=Te.json_to_sheet(s);t["!cols"]=[{wch:18},{wch:15},{wch:8},{wch:25},{wch:30},{wch:18},{wch:18},{wch:15},{wch:35},{wch:20},{wch:20},{wch:15},{wch:25},{wch:15},{wch:12},{wch:40},{wch:15},{wch:12},{wch:10},{wch:10},{wch:10}];const I=Te.book_new();Te.book_append_sheet(I,t,"MÃ¼ÅŸteri Listesi");const ee=`musteri-listesi-${new Date().toISOString().split("T")[0]}.xlsx`;ha(I,ee),f.success(`âœ… ${T.length} mÃ¼ÅŸteri Excel'e aktarÄ±ldÄ±`)}catch(s){console.error("Excel export hatasÄ±:",s),f.error("Excel export baÅŸarÄ±sÄ±z!")}};return e.jsxs("div",{className:"space-y-6",children:[De&&e.jsx(Bs,{customers:O,payterProducts:M}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs(ne,{variant:"secondary",className:"text-sm px-3 py-1",children:["Toplam: ",O.length," mÃ¼ÅŸteri"]}),e.jsxs(ne,{variant:"default",className:"text-sm px-3 py-1 bg-green-600 hover:bg-green-700",children:["Aktif: ",O.filter(s=>s.durum==="Aktif").length]}),e.jsxs(ne,{variant:"outline",className:"text-sm px-3 py-1 border-orange-300 text-orange-700",children:["Pasif: ",O.filter(s=>s.durum==="Pasif").length]}),T.length!==O.length&&e.jsxs(ne,{variant:"outline",className:"text-sm px-3 py-1 border-blue-300 text-blue-700",children:["FiltrelenmiÅŸ: ",T.length," mÃ¼ÅŸteri"]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(aa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx(ye,{id:"customer-search",type:"text",placeholder:"Cari ara (adÄ±, kod, sektÃ¶r, MCC, ilÃ§e, yetkili, ana domain, alt domain)...",value:R,onChange:s=>he(s.target.value),className:"pl-10"})]}),ie.length>0&&e.jsxs(B,{variant:"default",size:"sm",onClick:()=>Ie(!0),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ms,{size:16}),e.jsxs("span",{children:["Toplu Ä°ÅŸlemler (",ie.length,")"]})]}),e.jsxs(B,{variant:De?"default":"outline",size:"sm",onClick:()=>Ee(!De),className:"flex items-center gap-2",title:"Cihaz Adedi tutarlÄ±lÄ±k analizi - Domain eÅŸleÅŸtirme vs Manuel atama karÅŸÄ±laÅŸtÄ±rmasÄ±",children:[e.jsx(ns,{size:16}),e.jsx("span",{children:De?"Analizi Kapat":"Cihaz Analizi"})]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:j,className:"flex items-center gap-2",title:"MÃ¼ÅŸteri listesini Excel'e aktar (Cihaz Adedi ve Banka/PF dahil)",children:[e.jsx(Ya,{size:16}),e.jsx("span",{children:"Excel Ä°ndir"})]}),e.jsx(gs,{columns:Ts,storageKey:"customerList",onVisibilityChange:Pe}),e.jsx(_e,{label:"Durum",options:Le,value:se,onChange:W,allLabel:"TÃ¼m Durumlar",showCount:!0}),e.jsx(_e,{label:"Cihaz SayÄ±sÄ±",options:de,value:Q,onChange:i,allLabel:"TÃ¼m Cihazlar",showCount:!0}),e.jsx(_e,{label:"SatÄ±ÅŸ Temsilcisi",options:U,value:J,onChange:pe,allLabel:"TÃ¼m Temsilciler",showCount:!0,className:"min-w-[160px]"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ts,{children:[e.jsx(rs,{children:e.jsxs(ga,{children:[e.jsx(Fe,{className:"w-12",children:e.jsx(Oe,{checked:Ne,onCheckedChange:G,"aria-label":"TÃ¼mÃ¼nÃ¼ seÃ§",className:Me?"opacity-50":""})}),v.cariHesapKodu!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="cariHesapKodu"?"bg-blue-50":""}`,onClick:()=>z("cariHesapKodu"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="cariHesapKodu"?"text-blue-600":"",children:"Cari Hesap Kodu"}),e.jsx(m,{field:"cariHesapKodu"})]})}),v.sektor!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="sektor"?"bg-blue-50":""}`,onClick:()=>z("sektor"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="sektor"?"text-blue-600":"",children:"SEKTÃ–R"}),e.jsx(m,{field:"sektor"})]})}),v.mcc!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="mcc"?"bg-blue-50":""}`,onClick:()=>z("mcc"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="mcc"?"text-blue-600":"",children:"MCC"}),e.jsx(m,{field:"mcc"})]})}),v.cariAdi!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="cariAdi"?"bg-blue-50":""}`,onClick:()=>z("cariAdi"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="cariAdi"?"text-blue-600":"",children:"Cari AdÄ±"}),e.jsx(m,{field:"cariAdi"})]})}),v.domain!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="guncelMyPayterDomain"?"bg-blue-50":""}`,onClick:()=>z("guncelMyPayterDomain"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="guncelMyPayterDomain"?"text-blue-600":"",children:"GÃ¼ncel Mypayter Domain"}),e.jsx(m,{field:"guncelMyPayterDomain"})]})}),v.cihazAdedi!==!1&&e.jsx(Fe,{className:`text-center cursor-pointer hover:bg-gray-100 transition-colors ${N==="cihazAdedi"?"bg-blue-50":""}`,onClick:()=>z("cihazAdedi"),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx("span",{className:N==="cihazAdedi"?"text-blue-600":"",children:"Cihaz Adedi"}),e.jsx(m,{field:"cihazAdedi"})]})}),v.domainMatchCount!==!1&&e.jsx(Fe,{className:"text-center",children:e.jsx("div",{className:"flex items-center justify-center space-x-1",children:e.jsx("span",{className:"text-blue-700",children:"Domain EÅŸleÅŸmesi (Debug)"})})}),v.bankaPF!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="bankaPF"?"bg-blue-50":""}`,onClick:()=>z("bankaPF"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="bankaPF"?"text-blue-600":"",children:"Banka/PF"}),e.jsx(m,{field:"bankaPF"})]})}),v.salesRep!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="salesRep"?"bg-blue-50":""}`,onClick:()=>z("salesRep"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="salesRep"?"text-blue-600":"",children:"SatÄ±ÅŸ Temsilcisi"}),e.jsx(m,{field:"salesRep"})]})}),v.yetkili!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="yetkili"?"bg-blue-50":""}`,onClick:()=>z("yetkili"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="yetkili"?"text-blue-600":"",children:"Yetkili"}),e.jsx(m,{field:"yetkili"})]})}),v.tel!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="tel"?"bg-blue-50":""}`,onClick:()=>z("tel"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="tel"?"text-blue-600":"",children:"Tel"}),e.jsx(m,{field:"tel"})]})}),v.email!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="email"?"bg-blue-50":""}`,onClick:()=>z("email"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="email"?"text-blue-600":"",children:"Email"}),e.jsx(m,{field:"email"})]})}),v.vergiDairesi!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="vergiDairesi"?"bg-blue-50":""}`,onClick:()=>z("vergiDairesi"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="vergiDairesi"?"text-blue-600":"",children:"Vergi Dairesi"}),e.jsx(m,{field:"vergiDairesi"})]})}),v.vergiNo!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="vergiNo"?"bg-blue-50":""}`,onClick:()=>z("vergiNo"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="vergiNo"?"text-blue-600":"",children:"Vergi No"}),e.jsx(m,{field:"vergiNo"})]})}),v.adres!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="adres"?"bg-blue-50":""}`,onClick:()=>z("adres"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="adres"?"text-blue-600":"",children:"Adres"}),e.jsx(m,{field:"adres"})]})}),v.ilce!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="ilce"?"bg-blue-50":""}`,onClick:()=>z("ilce"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="ilce"?"text-blue-600":"",children:"Ä°lÃ§e"}),e.jsx(m,{field:"ilce"})]})}),v.postaKodu!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="postaKodu"?"bg-blue-50":""}`,onClick:()=>z("postaKodu"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="postaKodu"?"text-blue-600":"",children:"Posta Kodu"}),e.jsx(m,{field:"postaKodu"})]})}),v.p6x!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="p6x"?"bg-blue-50":""}`,onClick:()=>z("p6x"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="p6x"?"text-blue-600":"",children:"P6X"}),e.jsx(m,{field:"p6x"})]})}),v.apollo!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="apollo"?"bg-blue-50":""}`,onClick:()=>z("apollo"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="apollo"?"text-blue-600":"",children:"APOLLO"}),e.jsx(m,{field:"apollo"})]})}),v.durum!==!1&&e.jsx(Fe,{className:`cursor-pointer hover:bg-gray-100 transition-colors ${N==="durum"?"bg-blue-50":""}`,onClick:()=>z("durum"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:N==="durum"?"text-blue-600":"",children:"Durum"}),e.jsx(m,{field:"durum"})]})}),e.jsx(Fe,{className:"text-right",children:"Ä°ÅŸlemler"})]})}),e.jsx(cs,{children:T.length===0?e.jsx(ga,{children:e.jsx(Ce,{colSpan:21,className:"text-center text-gray-500 py-8",children:"MÃ¼ÅŸteri bulunamadÄ±"})}):ae.map(s=>e.jsxs(ga,{className:`hover:bg-gray-50 cursor-pointer ${ie.includes(s.id)?"bg-blue-50":""}`,onClick:()=>C(s),children:[e.jsx(Ce,{onClick:t=>t.stopPropagation(),children:e.jsx(Oe,{checked:ie.includes(s.id),onCheckedChange:t=>ze(s.id,t),"aria-label":`${s.cariAdi} seÃ§`})}),v.cariHesapKodu!==!1&&e.jsx(Ce,{children:e.jsx("code",{className:`text-sm bg-gray-100 px-2 py-1 rounded ${s.durum==="Pasif"?"line-through text-gray-500":""}`,children:s.cariHesapKodu})}),v.sektor!==!1&&e.jsx(Ce,{children:e.jsx("span",{className:"text-sm",children:s.sektor})}),v.mcc!==!1&&e.jsx(Ce,{children:e.jsx("span",{className:"text-sm",children:s.mcc})}),v.cariAdi!==!1&&e.jsx(Ce,{children:e.jsx("span",{className:s.durum==="Pasif"?"line-through text-gray-500":"",children:s.cariAdi})}),v.domain!==!1&&e.jsx(Ce,{className:"max-w-xs",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[s.guncelMyPayterDomain&&e.jsx("a",{href:`https://${s.guncelMyPayterDomain}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline truncate text-sm",onClick:t=>t.stopPropagation(),children:s.guncelMyPayterDomain}),s.domainHierarchy&&s.domainHierarchy.length>0&&e.jsxs(ne,{variant:"outline",className:"text-xs bg-gray-50 border-gray-300 w-fit",children:["ðŸ“Š ",(()=>{const t=ee=>ee.reduce((y,X)=>y+1+(X.children?t(X.children):0),0);return`${t(s.domainHierarchy)} birim`})()]})]})}),v.cihazAdedi!==!1&&(()=>{const t=F(s);return e.jsx(Ce,{className:"text-center",children:e.jsxs(ne,{variant:t>0?"default":"secondary",className:"tabular-nums",children:["ðŸ–¥ï¸ ",t]})})})(),v.domainMatchCount!==!1&&(()=>{const t=u(s);return e.jsx(Ce,{className:"text-center",children:e.jsx(ne,{variant:t>0?"default":"secondary",className:"tabular-nums bg-blue-600",children:t})})})(),v.bankaPF!==!1&&(()=>{const t=L(s);return e.jsx(Ce,{children:e.jsx("div",{className:"max-w-xs truncate text-sm",title:t,children:t})})})(),v.salesRep!==!1&&e.jsx(Ce,{children:s.salesRepName?e.jsx(ne,{variant:"outline",className:"font-medium",children:s.salesRepName}):e.jsx("span",{className:"text-gray-400 text-sm",children:"-"})}),v.yetkili!==!1&&e.jsx(Ce,{children:s.yetkili}),v.tel!==!1&&e.jsx(Ce,{children:s.tel}),v.email!==!1&&e.jsx(Ce,{children:s.email}),v.vergiDairesi!==!1&&e.jsx(Ce,{children:s.vergiDairesi}),v.vergiNo!==!1&&e.jsx(Ce,{className:"tabular-nums",children:s.vergiNo}),v.adres!==!1&&e.jsx(Ce,{className:"max-w-xs truncate",children:s.adres}),v.ilce!==!1&&e.jsx(Ce,{children:s.ilce}),v.postaKodu!==!1&&e.jsx(Ce,{children:s.postaKodu}),v.p6x!==!1&&e.jsx(Ce,{children:e.jsx("span",{className:"text-sm",children:s.p6x||"-"})}),v.apollo!==!1&&e.jsx(Ce,{children:e.jsx("span",{className:"text-sm",children:s.apollo||"-"})}),v.durum!==!1&&e.jsx(Ce,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ka,{checked:s.durum==="Aktif",onCheckedChange:()=>re(s)}),e.jsx(ne,{variant:s.durum==="Aktif"?"default":"secondary",children:s.durum})]})}),e.jsx(Ce,{className:"text-right",children:e.jsxs("button",{onClick:t=>{t.stopPropagation(),C(s)},className:"inline-flex items-center space-x-1 px-3 py-1 rounded hover:bg-gray-100 transition-colors",children:[e.jsx(vs,{size:16}),e.jsx("span",{children:"Detay"})]})})]},s.id))})]})}),T.length>0&&e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsx(ys,{currentPage:b,totalPages:P,itemsPerPage:H,totalItems:T.length,onPageChange:te,onItemsPerPageChange:ce,startIndex:E,endIndex:ge})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-600",children:["Toplam ",e.jsx("strong",{children:T.length})," cari kayÄ±t"]}),ie.length>0&&e.jsxs(ne,{variant:"default",className:"bg-blue-600",children:[e.jsx(Is,{size:14,className:"mr-1"}),ie.length," seÃ§ili"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600",children:[e.jsxs("span",{children:["Aktif: ",e.jsx("strong",{children:T.filter(s=>s.durum==="Aktif").length})]}),e.jsxs("span",{children:["Pasif: ",e.jsx("strong",{children:T.filter(s=>s.durum==="Pasif").length})]}),e.jsxs("span",{children:["Toplam Cihaz: ",e.jsx("strong",{children:T.reduce((s,t)=>{var I;return s+(((I=t.payterProducts)==null?void 0:I.length)||0)},0)})]})]})]})})]}),e.jsx(Ls,{isOpen:Se,onClose:()=>Ie(!1),selectedCustomers:l,onApplyBatchOperation:x,bankPFRecords:K,banks:q,epkList:ue,okList:me,salesReps:S})]})});function Es({assignments:w=[],onAssignmentsChange:O,banks:C=[],epkList:$=[],okList:D=[],payterProducts:M=[]}){var G,ze,Ne,Me;p.useEffect(()=>{console.log("ðŸŽ¯ BankDeviceManagementTab Props:",{assignmentsCount:(w==null?void 0:w.length)||0,banksCount:(C==null?void 0:C.length)||0,epkListCount:($==null?void 0:$.length)||0,okListCount:(D==null?void 0:D.length)||0,payterProductsCount:(M==null?void 0:M.length)||0})},[w,C,$,D,M]);const[K,S]=p.useState(""),[q,ue]=p.useState(!1),[me,R]=p.useState(""),[he,se]=p.useState(""),[W,Q]=p.useState([]),[i,J]=p.useState(""),[pe,N]=p.useState(""),[Be,ve]=p.useState(""),[ke,v]=p.useState(""),[xe,ie]=p.useState([]),[je,Se]=p.useState([]),[Ie,De]=p.useState([]);p.useEffect(()=>{console.log("ðŸ“Š Dialog State DeÄŸiÅŸti:",{isAddDialogOpen:q,currentAssignmentId:me,selectedDeviceIdsCount:W.length,payterProductsCount:(M==null?void 0:M.length)||0})},[q,me,W,M]);const z=[...C.filter(l=>l.aktif).map(l=>({id:`bank-${l.id}`,kod:l.kod||"",name:l.bankaAdi||"Ä°simsiz Banka",type:"Banka",aciklama:l.aciklama||""})),...$.filter(l=>l.aktif).map(l=>({id:`ok-epk-${l.id}`,kod:l.kod||"",name:l.kurumAdi||"Ä°simsiz EPK",type:"PF",originalType:"EPK",aciklama:l.aciklama||""})),...D.filter(l=>l.aktif).map(l=>({id:`ok-ok-${l.id}`,kod:l.kod||"",name:l.kurumAdi||"Ä°simsiz Ã–K",type:"PF",originalType:"Ã–K",aciklama:l.aciklama||""}))].sort((l,x)=>{const j=l.name||"",s=x.name||"";return j.localeCompare(s,"tr")});z.filter(l=>!w.some(x=>x.bankId===l.id));const m=C.filter(l=>l.aktif&&!w.some(x=>x.bankId===`bank-${l.id}`)),u=$.filter(l=>l.aktif&&!w.some(x=>x.bankId===`ok-epk-${l.id}`)),F=D.filter(l=>l.aktif&&!w.some(x=>x.bankId===`ok-ok-${l.id}`)),L=m.filter(l=>{var x,j;return((x=l.bankaAdi)==null?void 0:x.toLowerCase().includes(pe.toLowerCase()))||((j=l.kod)==null?void 0:j.toLowerCase().includes(pe.toLowerCase()))}),A=u.filter(l=>{var x,j;return((x=l.kurumAdi)==null?void 0:x.toLowerCase().includes(Be.toLowerCase()))||((j=l.kod)==null?void 0:j.toLowerCase().includes(Be.toLowerCase()))}),T=F.filter(l=>{var x,j;return((x=l.kurumAdi)==null?void 0:x.toLowerCase().includes(ke.toLowerCase()))||((j=l.kod)==null?void 0:j.toLowerCase().includes(ke.toLowerCase()))}),ae=()=>{if(xe.length+je.length+Ie.length===0){f.error("LÃ¼tfen en az bir kategori seÃ§in!");return}const x=[];xe.forEach(j=>{const s=C.find(t=>t.id===j);s&&x.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),bankId:`bank-${s.id}`,bankName:s.bankaAdi,bankCode:s.kod,deviceIds:[],createdAt:new Date().toISOString()})}),je.forEach(j=>{const s=$.find(t=>t.id===j);s&&x.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),bankId:`ok-epk-${s.id}`,bankName:s.kurumAdi,bankCode:s.kod,deviceIds:[],createdAt:new Date().toISOString()})}),Ie.forEach(j=>{const s=D.find(t=>t.id===j);s&&x.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),bankId:`ok-ok-${s.id}`,bankName:s.kurumAdi,bankCode:s.kod,deviceIds:[],createdAt:new Date().toISOString()})}),O([...w,...x]),ie([]),Se([]),De([]),N(""),ve(""),v("")},b=l=>{if(!w.find(s=>s.id===l))return;const j=w.filter(s=>s.id!==l);O(j),J("")},P=l=>{console.log("ðŸ”§ handleOpenAddDeviceDialog Ã§aÄŸrÄ±ldÄ±:",{assignmentId:l,payterProductsCount:(M==null?void 0:M.length)||0,currentState:{isAddDialogOpen:q,currentAssignmentId:me,selectedDeviceIds:W.length}}),R(l),Q([]),se(""),ue(!0),console.log("âœ… Dialog aÃ§Ä±ldÄ± - isAddDialogOpen:",!0)},H=()=>{if(W.length===0){f.error("LÃ¼tfen en az bir cihaz seÃ§in!");return}if(!w.find(s=>s.id===me))return;const x=[];if(W.forEach(s=>{w.find(I=>I.id!==me&&I.deviceIds.includes(s))&&x.push(s)}),x.length>0){f.error(`${x.length} cihaz baÅŸka bir banka/PF'ye atanmÄ±ÅŸ! Ã–nce o kategoriden kaldÄ±rmalÄ±sÄ±nÄ±z.`);return}const j=w.map(s=>{if(s.id===me){const t=W.filter(I=>!s.deviceIds.includes(I));return{...s,deviceIds:[...s.deviceIds,...t]}}return s});O(j),ue(!1),R(""),Q([])},E=(l,x)=>{const j=w.map(s=>s.id===l?{...s,deviceIds:s.deviceIds.filter(t=>t!==x)}:s);O(j),f.success("Cihaz kaldÄ±rÄ±ldÄ±")},ge=l=>{const x=w.find(j=>j.id===l);if(x){if(x.deviceIds.length===0){f.info("KaldÄ±rÄ±lacak cihaz yok");return}if(confirm(`${x.deviceIds.length} cihazÄ±n tÃ¼mÃ¼nÃ¼ kaldÄ±rmak istediÄŸinizden emin misiniz?`)){const j=w.map(s=>s.id===l?{...s,deviceIds:[]}:s);O(j),f.success("TÃ¼m cihazlar kaldÄ±rÄ±ldÄ±")}}},te=()=>{console.log("ðŸ” getAvailableDevices Ã§aÄŸrÄ±ldÄ±:",{currentAssignmentId:me,payterProductsTotal:(M==null?void 0:M.length)||0,searchTerm:he});const l=w.find(s=>s.id===me),x=(l==null?void 0:l.deviceIds)||[],j=M.filter(s=>{var ee,y,X;if(x.includes(s.id))return!1;const t=he.toLowerCase();return((ee=s.serialNumber)==null?void 0:ee.toLowerCase().includes(t))||((y=s.name)==null?void 0:y.toLowerCase().includes(t))||((X=s.tid)==null?void 0:X.toLowerCase().includes(t))||s.terminalModel&&s.terminalModel.toLowerCase().includes(t)});return console.log("âœ… FiltrelenmiÅŸ cihaz sayÄ±sÄ±:",j.length),j},ce=l=>M.find(x=>x.id===l),Le=l=>w.find(x=>x.deviceIds.includes(l)),de=w.reduce((l,x)=>l+x.deviceIds.length,0),U=M.length-de,Pe=l=>{Q(x=>x.includes(l)?x.filter(j=>j!==l):[...x,l])},re=()=>{const l=te();W.length===l.length?Q([]):Q(l.map(x=>x.id))};return z.length===0?e.jsx(Y,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(ia,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-gray-600 mb-2",children:"Banka/PF TanÄ±mlanmamÄ±ÅŸ"}),e.jsx("p",{className:"text-sm text-gray-500",children:"LÃ¼tfen Ã¶nce TanÄ±mlar modÃ¼lÃ¼nden aktif Banka, EPK veya Ã–K ekleyiniz."})]})}):M.length===0?e.jsx(Y,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(We,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-gray-600 mb-2",children:"Payter ÃœrÃ¼nÃ¼ BulunamadÄ±"}),e.jsx("p",{className:"text-sm text-gray-500",children:`LÃ¼tfen Ã¶nce "Payter" sekmesinden Ã¼rÃ¼n ekleyiniz veya Excel'den yÃ¼kleyiniz.`})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Toplam Banka/PF Kategorisi"}),e.jsx("h3",{className:"text-blue-600 mt-1",children:w.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(sa,{className:"text-blue-600",size:24})})]})})}),e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Banka/PF'ye AtanmÄ±ÅŸ Cihaz"}),e.jsx("h3",{className:"text-green-600 mt-1",children:de})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(He,{className:"text-green-600",size:24})})]})})}),e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"AtanmamÄ±ÅŸ Cihaz"}),e.jsx("h3",{className:"text-orange-600 mt-1",children:U})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(da,{className:"text-orange-600",size:24})})]})})})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(be,{children:"Banka/PF Kategorisi Ekle"}),e.jsx(ba,{children:"Firmaya ait cihazlarÄ±n iliÅŸkilendirileceÄŸi Banka, EPK veya Ã–K seÃ§in"})]}),e.jsx("div",{className:"flex items-center gap-3",children:(xe.length>0||je.length>0||Ie.length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[xe.length>0&&e.jsxs(ne,{variant:"default",className:"bg-blue-600",children:["ðŸ¦ ",xe.length]}),je.length>0&&e.jsxs(ne,{variant:"default",className:"bg-green-600",children:["EPK ",je.length]}),Ie.length>0&&e.jsxs(ne,{variant:"default",className:"bg-purple-600",children:["Ã–K ",Ie.length]})]}),e.jsxs(B,{type:"button",onClick:ae,children:[e.jsx($e,{size:18,className:"mr-2"}),"Kategorileri Ekle"]})]})})]})}),e.jsx(V,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"pb-2 border-b-2 border-blue-500",children:e.jsx("h3",{className:"font-semibold text-blue-900",children:"Bankalar"})}),e.jsxs("div",{className:"relative",children:[e.jsx(aa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx(ye,{id:"bank-device-bank-search",type:"text",placeholder:"Banka ara...",value:pe,onChange:l=>N(l.target.value),className:"pl-9 h-9 text-sm"})]}),e.jsx("div",{className:"border rounded-lg divide-y",style:{maxHeight:"60vh",overflowY:"auto"},children:L.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:m.length===0?"TÃ¼m bankalar eklenmiÅŸ":"SonuÃ§ bulunamadÄ±"}):L.map(l=>e.jsx("div",{className:`p-3 hover:bg-blue-50 transition-colors cursor-pointer ${xe.includes(l.id)?"bg-blue-50":""}`,onClick:()=>{ie(x=>x.includes(l.id)?x.filter(j=>j!==l.id):[...x,l.id])},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Oe,{id:`bank-${l.id}`,checked:xe.includes(l.id),onCheckedChange:()=>{ie(x=>x.includes(l.id)?x.filter(j=>j!==l.id):[...x,l.id])},onClick:x=>x.stopPropagation(),className:"mt-0.5"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"text-sm",title:l.bankaAdi,children:[e.jsx("span",{className:"text-xs text-gray-500",children:l.kod}),e.jsx("span",{className:"ml-1",children:l.bankaAdi})]})})]})},l.id))}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[xe.length," seÃ§ili"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"pb-2 border-b-2 border-green-500",children:e.jsx("h3",{className:"font-semibold text-green-900",children:"EPK"})}),e.jsxs("div",{className:"relative",children:[e.jsx(aa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx(ye,{id:"bank-device-epk-search",type:"text",placeholder:"EPK ara...",value:Be,onChange:l=>ve(l.target.value),className:"pl-9 h-9 text-sm"})]}),e.jsx("div",{className:"border rounded-lg divide-y",style:{maxHeight:"60vh",overflowY:"auto"},children:A.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:u.length===0?"TÃ¼m EPK'lar eklenmiÅŸ":"SonuÃ§ bulunamadÄ±"}):A.map(l=>e.jsx("div",{className:`p-3 hover:bg-green-50 transition-colors cursor-pointer ${je.includes(l.id)?"bg-green-50":""}`,onClick:()=>{Se(x=>x.includes(l.id)?x.filter(j=>j!==l.id):[...x,l.id])},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Oe,{id:`epk-${l.id}`,checked:je.includes(l.id),onCheckedChange:()=>{Se(x=>x.includes(l.id)?x.filter(j=>j!==l.id):[...x,l.id])},onClick:x=>x.stopPropagation(),className:"mt-0.5"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"text-sm",title:l.kurumAdi,children:[e.jsx("span",{className:"text-xs text-gray-500",children:l.kod}),e.jsx("span",{className:"ml-1",children:l.kurumAdi})]})})]})},l.id))}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[je.length," seÃ§ili"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"pb-2 border-b-2 border-purple-500",children:e.jsx("h3",{className:"font-semibold text-purple-900",children:"Ã–K"})}),e.jsxs("div",{className:"relative",children:[e.jsx(aa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx(ye,{id:"bank-device-ok-search",type:"text",placeholder:"Ã–K ara...",value:ke,onChange:l=>v(l.target.value),className:"pl-9 h-9 text-sm"})]}),e.jsx("div",{className:"border rounded-lg divide-y",style:{maxHeight:"60vh",overflowY:"auto"},children:T.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:F.length===0?"TÃ¼m Ã–K'ler eklenmiÅŸ":"SonuÃ§ bulunamadÄ±"}):T.map(l=>e.jsx("div",{className:`p-3 hover:bg-purple-50 transition-colors cursor-pointer ${Ie.includes(l.id)?"bg-purple-50":""}`,onClick:()=>{De(x=>x.includes(l.id)?x.filter(j=>j!==l.id):[...x,l.id])},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Oe,{id:`ok-${l.id}`,checked:Ie.includes(l.id),onCheckedChange:()=>{De(x=>x.includes(l.id)?x.filter(j=>j!==l.id):[...x,l.id])},onClick:x=>x.stopPropagation(),className:"mt-0.5"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"text-sm",title:l.kurumAdi,children:[e.jsx("span",{className:"text-xs text-gray-500",children:l.kod}),e.jsx("span",{className:"ml-1",children:l.kurumAdi})]})})]})},l.id))}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[Ie.length," seÃ§ili"]})]})]})})]}),e.jsx(Y,{className:"bg-blue-50 border-blue-200",children:e.jsx(V,{className:"py-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($a,{className:"text-blue-600 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ’¡ NasÄ±l Ã‡alÄ±ÅŸÄ±r?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-800",children:[e.jsxs("li",{children:["YukarÄ±daki ",e.jsx("strong",{children:"3 kolonlu listeden"})," istediÄŸiniz ",e.jsx("strong",{children:"Banka, EPK veya Ã–K"})," kategorilerini seÃ§in"]}),e.jsxs("li",{children:["Birden fazla kategori seÃ§ebilir ve ",e.jsx("strong",{children:'"Kategorileri Ekle"'})," butonuna tek tÄ±klayarak tÃ¼mÃ¼nÃ¼ ekleyebilirsiniz"]}),e.jsxs("li",{children:["OluÅŸturulan kategoriye ",e.jsx("strong",{children:'"+ Cihaz Ekle"'})," butonuyla Payter Ã¼rÃ¼nlerini atayÄ±n"]}),e.jsxs("li",{children:["Her cihaz ",e.jsx("strong",{children:"sadece 1 banka/PF'ye"})," atanabilir"]}),e.jsx("li",{children:"CihazlarÄ± istediÄŸiniz zaman kaldÄ±rabilir veya kategoriyi silebilirsiniz"}),e.jsxs("li",{className:"text-green-700 font-medium mt-2",children:["âœ… Bu kategoriye cihaz eklediÄŸinizde mÃ¼ÅŸteri otomatik olarak ",e.jsx("strong",{children:"ÃœÄ°Y Listesinde"})," gÃ¶rÃ¼nÃ¼r hale gelir!"]})]})]})]})})}),w.length===0?e.jsx(Y,{children:e.jsxs(V,{className:"py-12 text-center text-gray-500",children:[e.jsx(sa,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{children:"HenÃ¼z banka/PF kategorisi eklenmedi"}),e.jsx("p",{className:"text-sm mt-2",children:"YukarÄ±daki listelerden Banka, EPK veya Ã–K seÃ§ip kategori oluÅŸturun"})]})}):e.jsx("div",{className:"space-y-4",children:w.map(l=>{const x=l.deviceIds.length;return e.jsxs(Y,{className:"border-l-4 border-l-blue-500",children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(sa,{className:"text-blue-600",size:24})}),e.jsxs("div",{children:[e.jsxs(be,{className:"flex items-center gap-2",children:[l.bankName,e.jsx(ne,{variant:"outline",children:l.bankCode})]}),e.jsxs(ba,{className:"mt-1",children:["Toplam ",x," cihaz atanmÄ±ÅŸ"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:j=>{j.preventDefault(),j.stopPropagation(),console.log("Cihaz Ekle butonuna tÄ±klandÄ± - Assignment ID:",l.id),P(l.id)},children:[e.jsx($e,{size:16,className:"mr-2"}),"Cihaz Ekle"]}),x>0&&e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:()=>ge(l.id),children:[e.jsx(Xe,{size:16,className:"mr-2"}),"TÃ¼mÃ¼nÃ¼ KaldÄ±r"]}),e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:()=>b(l.id),children:e.jsx(Xe,{size:16,className:"text-red-600"})})]})]})}),e.jsx(V,{children:x===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 border-2 border-dashed rounded-lg",children:[e.jsx(We,{className:"mx-auto h-10 w-10 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm",children:"Bu bankaya henÃ¼z cihaz atanmamÄ±ÅŸ"}),e.jsxs(B,{variant:"link",size:"sm",onClick:j=>{j.preventDefault(),j.stopPropagation(),console.log("Ä°lk cihazÄ± ekle butonuna tÄ±klandÄ± - Assignment ID:",l.id),P(l.id)},className:"mt-2",children:[e.jsx($e,{size:14,className:"mr-1"}),"Ä°lk cihazÄ± ekle"]})]}):e.jsx("div",{className:"space-y-2",children:l.deviceIds.map(j=>{const s=ce(j);return s?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-white rounded border",children:e.jsx(We,{className:"text-gray-600",size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("code",{className:"text-sm bg-white px-2 py-0.5 rounded border",children:s.serialNumber}),e.jsx("span",{className:"text-sm truncate",children:s.name}),s.tid&&e.jsxs(ne,{variant:"secondary",className:"text-xs",title:"Terminal ID (Banka tarafÄ±ndan atanan)",children:["TID: ",s.tid]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-600",children:[s.terminalModel&&e.jsxs("span",{children:["Model: ",s.terminalModel]}),s.terminalType&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Tip: ",s.terminalType]})]}),s.onlineStatus&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx(ne,{variant:s.onlineStatus.toLowerCase()==="online"?"default":"secondary",className:"text-xs",children:s.onlineStatus})]})]})]})]}),e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:()=>E(l.id,j),children:e.jsx(Xe,{size:16,className:"text-red-600"})})]},j):e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(da,{className:"text-red-600",size:20}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-red-600",children:["Cihaz bulunamadÄ± (ID: ",j,")"]}),e.jsx("p",{className:"text-xs text-red-500",children:"Bu cihaz Payter sekmesinden silinmiÅŸ olabilir"})]})]}),e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>E(l.id,j),children:e.jsx(Xe,{size:16,className:"text-red-600"})})]},j)})})})]},l.id)})}),e.jsx(la,{open:q,onOpenChange:l=>{console.log("ðŸ”” Dialog onOpenChange:",l),ue(l)},children:e.jsxs(na,{className:"max-w-3xl max-h-[80vh] flex flex-col",children:[e.jsxs(ta,{children:[e.jsx(ra,{children:"Cihaz Ekle"}),e.jsx(ca,{children:me?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:(G=w.find(l=>l.id===me))==null?void 0:G.bankName})," ","kategorisine eklenecek cihazlarÄ± seÃ§in"]}):e.jsx("span",{className:"text-red-600",children:"âš ï¸ Kategori seÃ§ilmedi"})})]}),e.jsxs("div",{className:"space-y-4 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(aa,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx(ye,{id:"bank-device-product-search",placeholder:"Serial number, name, TID veya model ile ara...",value:he,onChange:l=>se(l.target.value),className:"pl-10"})]}),e.jsx(B,{type:"button",variant:"outline",size:"sm",onClick:re,children:W.length===te().length&&te().length>0?"TÃ¼mÃ¼nÃ¼ KaldÄ±r":"TÃ¼mÃ¼nÃ¼ SeÃ§"})]}),W.length>0&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-green-900",children:["âœ“ ",e.jsx("strong",{children:W.length})," cihaz seÃ§ildi"]}),e.jsx(B,{type:"button",onClick:H,children:"KayÄ±t Et"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto border rounded-lg",children:(()=>{const l=te();if(console.log("ðŸ“‹ Dialog iÃ§inde gÃ¶sterilecek cihaz sayÄ±sÄ±:",l.length),l.length===0)return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(We,{className:"mx-auto h-10 w-10 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm",children:he?"Arama kriterine uygun cihaz bulunamadÄ±":"Eklenebilecek cihaz bulunamadÄ±"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Toplam Payter Ã¼rÃ¼nÃ¼: ",(M==null?void 0:M.length)||0]})]});const x=W.length===l.length&&l.length>0;return e.jsxs("div",{className:"divide-y",children:[e.jsx("div",{className:"p-4 bg-blue-50 hover:bg-blue-100 transition-colors cursor-pointer border-b-2 border-blue-200 sticky top-0 z-10",onClick:re,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{checked:x,onCheckedChange:re,onClick:j=>j.stopPropagation(),className:"border-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-blue-900",children:x?"âœ“ TÃ¼mÃ¼nÃ¼ KaldÄ±r":"â˜ TÃ¼mÃ¼nÃ¼ SeÃ§"}),e.jsxs(ne,{variant:"secondary",className:"bg-blue-200 text-blue-900",children:[l.length," cihaz"]})]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:x?"TÃ¼m cihazlarÄ±n seÃ§imini kaldÄ±rmak iÃ§in tÄ±klayÄ±n":"Payter sekmesindeki tÃ¼m cihazlarÄ± seÃ§mek iÃ§in tÄ±klayÄ±n"})]})]})}),l.map(j=>{const s=W.includes(j.id),t=Le(j.id),I=t&&t.id!==me;return e.jsx("div",{className:`p-4 hover:bg-gray-50 transition-colors cursor-pointer ${s?"bg-blue-50":""} ${I?"opacity-60":""}`,onClick:()=>!I&&Pe(j.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Oe,{checked:s,disabled:I,onCheckedChange:()=>!I&&Pe(j.id),onClick:ee=>ee.stopPropagation()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("code",{className:"text-sm bg-gray-100 px-2 py-0.5 rounded",children:j.serialNumber}),e.jsx("span",{className:"text-sm truncate",children:j.name}),j.tid&&e.jsxs(ne,{variant:"secondary",className:"text-xs",children:["TID: ",j.tid]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-600",children:[j.terminalModel&&e.jsxs("span",{children:["Model: ",j.terminalModel]}),j.terminalType&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Tip: ",j.terminalType]})]})]}),I&&t&&e.jsx("div",{className:"mt-2",children:e.jsxs(ne,{variant:"outline",className:"text-xs text-orange-600 border-orange-300",children:["âš ï¸ ",t.bankName," kategorisinde kayÄ±tlÄ±"]})})]})]})},j.id)})]})})()})]}),e.jsx(oa,{children:e.jsx(B,{type:"button",variant:"outline",onClick:()=>ue(!1),children:"Ä°ptal"})})]})}),e.jsx(Va,{open:!!i,onOpenChange:()=>J(""),children:e.jsxs(Ga,{children:[e.jsxs(_a,{children:[e.jsx(Wa,{children:"Banka Kategorisini Sil"}),e.jsx(Xa,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:(ze=w.find(l=>l.id===i))==null?void 0:ze.bankName})," kategorisini silmek istediÄŸinizden emin misiniz?",(Ne=w.find(l=>l.id===i))!=null&&Ne.deviceIds.length?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsxs("span",{className:"text-orange-600",children:["âš ï¸ Bu kategoride"," ",e.jsxs("strong",{children:[(Me=w.find(l=>l.id===i))==null?void 0:Me.deviceIds.length," cihaz"]})," ","atanmÄ±ÅŸ. Kategori silindiÄŸinde cihaz atamalarÄ± da kaldÄ±rÄ±lacak."]})]}):null]})})]}),e.jsxs(Za,{children:[e.jsx(qa,{children:"Ä°ptal"}),e.jsx(Ja,{onClick:()=>b(i),className:"bg-red-600 hover:bg-red-700",children:"Sil"})]})]})})]})}function ss({node:w,path:O,level:C,onUpdate:$,onDelete:D,onAddChild:M,onAddSibling:K}){const[S,q]=p.useState(!0),[ue,me]=p.useState(!w.name),[R,he]=p.useState(w.name),W=((pe,N)=>{const Be=["i","ii","iii","iv","v","vi","vii","viii","ix","x"];return pe===0?`${N+1}.`:pe===1?String.fromCharCode(97+N)+".":pe===2?Be[N]||`${N+1}.`:pe===3?`${N+1}.`:pe===4?Be[N]||`${N+1}.`:`${N+1}.`})(C,O[O.length-1]),Q=C*20,i=()=>{R.trim()&&($(O,R.trim()),me(!1))},J=pe=>{pe.key==="Enter"?i():pe.key==="Escape"&&(he(w.name),me(!1))};return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-2 rounded hover:bg-gray-50 group transition-colors mb-1",style:{marginLeft:`${Q}px`},children:[w.children.length>0&&e.jsx("button",{type:"button",onClick:()=>q(!S),className:"p-0.5 hover:bg-gray-200 rounded transition-colors",title:S?"Daralt":"GeniÅŸlet",children:S?e.jsx(Na,{size:14,className:"text-gray-600"}):e.jsx(ps,{size:14,className:"text-gray-600"})}),w.children.length===0&&e.jsx("div",{className:"w-[18px]"}),e.jsx("span",{className:"text-xs text-gray-600 bg-gray-100 px-1.5 py-0.5 rounded min-w-[28px] text-center tabular-nums",children:W}),ue?e.jsx(ye,{value:R,onChange:pe=>he(pe.target.value),onBlur:i,onKeyDown:J,placeholder:"Birim adÄ± girin...",className:"h-7 text-sm flex-1 max-w-md",autoFocus:!0}):e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-sm flex-1 cursor-pointer text-gray-900 hover:text-blue-600 transition-colors",onClick:()=>me(!0),title:"DÃ¼zenlemek iÃ§in tÄ±klayÄ±n",children:w.name||"(BoÅŸ)"}),w.children.length>0&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:w.children.length})]}),e.jsxs("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:()=>me(!0),className:"h-6 px-1.5 hover:bg-gray-200",title:"DÃ¼zenle",children:e.jsx(Qa,{size:12,className:"text-gray-600"})}),e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(O),className:"h-6 px-1.5 hover:bg-green-50",title:"Alt birim ekle",children:e.jsx($e,{size:12,className:"text-green-600"})}),e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:()=>K(O),className:"h-6 px-1.5 hover:bg-blue-50",title:"Yan birim ekle",children:e.jsx($e,{size:12,className:"text-blue-600"})}),e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:()=>D(O),className:"h-6 px-1.5 hover:bg-red-50",title:"Sil",children:e.jsx(as,{size:12,className:"text-red-600"})})]})]}),S&&w.children.length>0&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2 top-0 bottom-2 w-px bg-gray-200",style:{marginLeft:`${Q}px`}}),w.children.map((pe,N)=>e.jsx(ss,{node:pe,path:[...O,N],level:C+1,onUpdate:$,onDelete:D,onAddChild:M,onAddSibling:K},pe.id))]})]})}function Ka(w,O){const C=[];return console.log("ðŸ” extractBankPFIdsFromAssignments baÅŸladÄ±:",{assignmentsCount:w.length,bankPFRecordsCount:O.length}),w.forEach($=>{var M;const D=$.bankId;if(console.log("ðŸ” Assignment iÅŸleniyor:",{bankId:D,bankName:$.bankName,deviceCount:((M=$.deviceIds)==null?void 0:M.length)||0}),D.startsWith("bank-")){const K=D.replace("bank-","");console.log("  â†’ Banka ID Ã§Ä±karÄ±ldÄ±:",K);const S=O.find(q=>{var ue;return(ue=q.linkedBankIds)==null?void 0:ue.includes(K)});console.log("  â†’ EÅŸleÅŸen BankPF kaydÄ±:",S?{id:S.id,firmaUnvan:S.firmaUnvan,linkedBankIds:S.linkedBankIds}:"BULUNAMADI"),S&&!C.includes(S.id)&&(C.push(S.id),console.log("  âœ… BankPF ID eklendi:",S.id))}else if(D.startsWith("ok-epk-")){const K=D.replace("ok-epk-","");console.log("  â†’ EPK ID Ã§Ä±karÄ±ldÄ±:",K);const S=O.find(q=>{var ue;return(ue=q.linkedEPKIds)==null?void 0:ue.includes(K)});console.log("  â†’ EÅŸleÅŸen BankPF kaydÄ±:",S?{id:S.id,firmaUnvan:S.firmaUnvan,linkedEPKIds:S.linkedEPKIds}:"BULUNAMADI"),S&&!C.includes(S.id)&&(C.push(S.id),console.log("  âœ… BankPF ID eklendi:",S.id))}else if(D.startsWith("ok-ok-")){const K=D.replace("ok-ok-","");console.log("  â†’ Ã–K ID Ã§Ä±karÄ±ldÄ±:",K);const S=O.find(q=>{var ue;return(ue=q.linkedOKIds)==null?void 0:ue.includes(K)});console.log("  â†’ EÅŸleÅŸen BankPF kaydÄ±:",S?{id:S.id,firmaUnvan:S.firmaUnvan,linkedOKIds:S.linkedOKIds}:"BULUNAMADI"),S&&!C.includes(S.id)&&(C.push(S.id),console.log("  âœ… BankPF ID eklendi:",S.id))}}),console.log("âœ… extractBankPFIdsFromAssignments tamamlandÄ±, bulunan IDs:",C),C}const Ks=!1;function $s({customer:w,onSave:O,onCancel:C,onDelete:$,isCreating:D=!1,mccList:M=[],payterProducts:K=[],bankPFRecords:S=[],onBankPFNavigate:q,banks:ue=[],epkList:me=[],okList:R=[],salesReps:he=[],suspensionReasons:se=[],allCustomers:W=[],onNavigateToCustomer:Q}){var X,oe;const[i,J]=p.useState(w||{id:"",cariHesapKodu:"",sektor:"",mcc:"",cariAdi:"",guncelMyPayterDomain:"",domainHierarchy:[],vergiDairesi:"",vergiNo:"",adres:"",ilce:"",postaKodu:"",email:"",yetkili:"",tel:"",durum:"Aktif",p6x:"",apollo:"",bankDeviceAssignments:[]}),[pe,N]=p.useState(!1),[Be,ve]=p.useState(w),[ke,v]=p.useState("genel"),xe=p.useRef(null),ie=p.useRef(!1),je=p.useRef(null),Se=p.useRef(null),[Ie,De]=p.useState(!1),[Ee,z]=p.useState(null),[m,u]=p.useState(""),[F,L]=p.useState(""),A=(se||[]).filter(a=>a.aktif).map(a=>a.reason);typeof localStorage<"u"&&localStorage.getItem("debugSuspensionReasons")==="true"&&(console.group("ðŸ” Dondurma Sebepleri Debug"),console.log("Total sebep sayÄ±sÄ±:",(se==null?void 0:se.length)||0),console.log("Aktif sebep sayÄ±sÄ±:",A.length),console.log("Pasif sebep sayÄ±sÄ±:",((se==null?void 0:se.length)||0)-A.length),console.table(se==null?void 0:se.map(a=>({Sebep:a.reason,Aktif:a.aktif?"âœ…":"âŒ",AÃ§Ä±klama:a.aciklama}))),console.groupEnd());const T=va,ae=p.useMemo(()=>M.map(a=>({value:a.kod,label:`${a.kod} - ${a.kategori}`})),[M]),b=p.useMemo(()=>[{value:"Aktif",label:"Aktif"},{value:"Pasif",label:"Pasif"}],[]),P=p.useMemo(()=>[{value:"unassigned",label:"AtanmamÄ±ÅŸ"},...he.filter(a=>a.aktif).map(a=>({value:a.id,label:a.adSoyad}))],[he]),H=p.useMemo(()=>[{value:"monthly",label:"AylÄ±k Ã–deme"},{value:"yearly",label:"YÄ±llÄ±k Ã–deme"}],[]),E=p.useMemo(()=>{const a=(se||[]).map(n=>({value:n.reason,label:n.aktif?n.reason:`${n.reason} (Pasif)`,isDisabled:!n.aktif}));return typeof localStorage<"u"&&localStorage.getItem("debugSuspensionReasons")==="true"&&console.log("ðŸŽ¯ Dropdown sebep listesi:",{toplam:a.length,aktif:a.filter(n=>!n.isDisabled).length,pasif:a.filter(n=>n.isDisabled).length}),a.filter(n=>!n.isDisabled)},[se]),ge=p.useMemo(()=>{if(K&&K.length>0){const a=[];i.guncelMyPayterDomain&&i.guncelMyPayterDomain.trim()&&a.push(i.guncelMyPayterDomain.trim().toLowerCase());const n=r=>{r.forEach(d=>{d.name&&d.name.trim()&&a.push(d.name.trim().toLowerCase()),d.children&&d.children.length>0&&n(d.children)})};if(i.domainHierarchy&&i.domainHierarchy.length>0&&n(i.domainHierarchy),a.length>0){const r=K.filter(d=>{if(!d.domain||!d.domain.trim())return!1;const g=d.domain.trim().toLowerCase();return a.includes(g)});if(r.length>0)return r.length}}return!i.bankDeviceAssignments||i.bankDeviceAssignments.length===0?0:i.bankDeviceAssignments.reduce((a,n)=>{var r;return a+(((r=n.deviceIds)==null?void 0:r.length)||0)},0)},[i.cariAdi,i.guncelMyPayterDomain,i.domainHierarchy,i.bankDeviceAssignments,K]),te=p.useMemo(()=>{let a=0,n=0;if(!K||K.length===0)return{p6x:a,apollo:n};const r=i.domain||i.guncelMyPayterDomain;return r?(K.forEach(d=>{var k;if(T(d.domain,r,i.ignoreMainDomain||!1)){const h=((k=d.terminalModel)==null?void 0:k.toUpperCase())||"",o=h.includes("P6X")||h.includes("P6-X")||h.includes("P 6 X"),c=h.includes("APOLLO");o?a++:c&&n++}}),{p6x:a,apollo:n}):{p6x:a,apollo:n}},[K,i.guncelMyPayterDomain,i.domainHierarchy,i.domain,i.ignoreMainDomain]);p.useEffect(()=>{w&&w.id!==i.id&&(J(w),ve(w),N(!1),v("genel"))},[w,i.id]),p.useEffect(()=>()=>{xe.current&&clearTimeout(xe.current),je.current&&clearTimeout(je.current)},[]);const ce=p.useMemo(()=>{if(D||!w||W.length===0)return null;const a=[...W].sort((r,d)=>{const g=(r.cariAdi||"").toLowerCase(),k=(d.cariAdi||"").toLowerCase();return g.localeCompare(k,"tr")}),n=a.findIndex(r=>r.id===w.id);return n===-1?null:{currentIndex:n,hasPrevious:n>0,hasNext:n<a.length-1,total:a.length,previousCustomer:n>0?a[n-1]:null,nextCustomer:n<a.length-1?a[n+1]:null}},[D,w==null?void 0:w.id,W]);p.useEffect(()=>{if(!w||!w.cariAdi||S.length===0||w.id!==i.id)return;const a=w.bankDeviceAssignments&&w.bankDeviceAssignments.length>0?Ka(w.bankDeviceAssignments,S):[],n=w.cariAdi.trim().toLowerCase(),r=S.filter(o=>{var Z;const c=((Z=o.firmaUnvan)==null?void 0:Z.trim().toLowerCase())||"";return n===c}).map(o=>o.id),d=w.linkedBankPFIds||[],g=Array.from(new Set([...d,...a,...r])),k=i.linkedBankPFIds||[];JSON.stringify([...k].sort())!==JSON.stringify([...g].sort())&&g.length>0&&(console.log("ðŸ”„ linkedBankPFIds otomatik senkronize ediliyor:",{cariAdi:w.cariAdi,manuallyLinkedIds:d,assignmentBasedIds:a,autoMatchedIds:r,allIds:g}),J(o=>({...o,linkedBankPFIds:g})))},[w,S,i.id]),p.useEffect(()=>{if(!Be||D||!i.id)return;const a=JSON.stringify(i)!==JSON.stringify(Be);N(a),a&&!ie.current&&(xe.current&&clearTimeout(xe.current),xe.current=window.setTimeout(()=>{if(ie.current)return;ie.current=!0;const n=i.cariAdi.trim().toLowerCase(),r=S.filter(h=>{var c;const o=((c=h.firmaUnvan)==null?void 0:c.trim().toLowerCase())||"";return n===o}).map(h=>h.id),d=i.linkedBankPFIds||[],g=Array.from(new Set([...d,...r])),k={...i,linkedBankPFIds:g};O(k,{autoSave:!0}),ve(k),N(!1),console.log("âœ… Otomatik kayÄ±t yapÄ±ldÄ±:",new Date().toLocaleTimeString("tr-TR")),ie.current=!1},1500))},[i,Be,D,S,O]);const Le=a=>{if(ke==="genel"&&!D){const n=[];if(i.cariHesapKodu.trim()||n.push("Cari Hesap Kodu"),i.cariAdi.trim()||n.push("Cari AdÄ±"),(typeof i.mcc=="string"?i.mcc:Array.isArray(i.mcc)?i.mcc.join(","):String(i.mcc||"")).trim()||n.push("MCC"),i.email.trim()||n.push("Email"),n.length>0){f.error(`LÃ¼tfen Ã¶nce zorunlu alanlarÄ± doldurun: ${n.join(", ")}`);return}}if(ke==="domain"&&!D){const n=typeof i.ignoreMainDomainNote=="string"?i.ignoreMainDomainNote:String(i.ignoreMainDomainNote||"");if(i.ignoreMainDomain&&!n.trim()){f.error('LÃ¼tfen "Ana Domaini GÃ¶rmezden Gel" iÃ§in not alanÄ±nÄ± doldurun!');return}}v(a),console.log("âœ… Sekme deÄŸiÅŸtirildi:",ke,"->",a)},de=a=>{if(a.preventDefault(),!i.cariHesapKodu.trim()){alert("Cari Hesap Kodu zorunludur!");return}if(!i.cariAdi.trim()){alert("Cari AdÄ± zorunludur!");return}if(!(typeof i.mcc=="string"?i.mcc:Array.isArray(i.mcc)?i.mcc.join(","):String(i.mcc||"")).trim()){alert("MCC zorunludur!");return}if(!i.email.trim()){alert("Email zorunludur!");return}const r=typeof i.ignoreMainDomainNote=="string"?i.ignoreMainDomainNote:String(i.ignoreMainDomainNote||"");if(i.ignoreMainDomain&&!r.trim()){f.error('"Ana Domaini GÃ¶rmezden Gel" seÃ§eneÄŸi aktifse not alanÄ± zorunludur!'),v("domain");return}const d=i.cariAdi.trim().toLowerCase(),g=S.filter(c=>{const Z=c.firmaUnvan.trim().toLowerCase();return d===Z}).map(c=>c.id),k=i.linkedBankPFIds||[],h=Array.from(new Set([...k,...g])),o={...i,linkedBankPFIds:h};console.log("âœ… Otomatik eÅŸleÅŸtirmeler linkedBankPFIds'e eklendi:",{cariAdi:i.cariAdi,eskiLinkedIds:k,otomatikEslesmeler:g,yeniLinkedIds:h}),O(o),N(!1)},U=(a,n)=>{J(r=>({...r,[a]:n}))},Pe=a=>{const n=new Map;a.guncelMyPayterDomain&&a.guncelMyPayterDomain.trim()&&n.set(a.guncelMyPayterDomain.trim().toLowerCase(),{level:"Ana Domain",order:0});const r=(d,g)=>{d.forEach(k=>{if(k.name&&k.name.trim()){const h=g===0?"Ana Domain":`${g}. Alt Domain`;n.set(k.name.trim().toLowerCase(),{level:h,order:g+1})}k.children&&k.children.length>0&&r(k.children,g+1)})};return a.domainHierarchy&&a.domainHierarchy.length>0&&r(a.domainHierarchy,0),n},re=p.useMemo(()=>{if(!i||K.length===0)return[];const a=i.domain||i.guncelMyPayterDomain;if(!a)return[];const n=K.filter(r=>!r.domain||!r.domain.trim()?!1:T(r.domain,a,i.ignoreMainDomain||!1,i.domainHierarchy));return i.ignoreMainDomain&&console.log(`ðŸ”— Domain EÅŸleÅŸtirme Sonucu: ${i.cariAdi}`,{domain:a,ignoreMainDomain:i.ignoreMainDomain||!1,eÅŸleÅŸenÃœrÃ¼nSayÄ±sÄ±:n.length,toplamÃœrÃ¼n:K.length}),i.ignoreMainDomain&&n.length,n},[i,K]),G=p.useMemo(()=>{const a=Pe(i),n=new Map;return re.forEach(r=>{var g;const d=((g=r.domain)==null?void 0:g.trim())||"Bilinmeyen";n.has(d)||n.set(d,[]),n.get(d).push(r)}),Array.from(n.entries()).map(([r,d])=>{const g=a.get(r.toLowerCase())||{level:"Bilinmeyen",order:999};return{domain:r,domainLevel:g.level,domainOrder:g.order,products:d,count:d.length}}).sort((r,d)=>r.domainOrder!==d.domainOrder?r.domainOrder-d.domainOrder:d.count-r.count)},[re,i]),ze=(a=[])=>{const n={id:`domain-${Date.now()}-${Math.random()}`,name:"",children:[]};J(r=>{const d=[...r.domainHierarchy||[]];if(a.length===0)d.push(n);else{let g=d;for(let k=0;k<a.length-1;k++)g=g[a[k]].children;g[a[a.length-1]].children.push(n)}return{...r,domainHierarchy:d}})},Ne=(a,n)=>{J(r=>{const d=[...r.domainHierarchy||[]];let g=d;for(let k=0;k<a.length-1;k++)g=g[a[k]].children;return g[a[a.length-1]].name=n,{...r,domainHierarchy:d}})},Me=a=>{J(n=>{const r=[...n.domainHierarchy||[]];if(a.length===1)r.splice(a[0],1);else{let d=r;for(let g=0;g<a.length-1;g++)d=d[a[g]].children;d.splice(a[a.length-1],1)}return{...n,domainHierarchy:r}})},l=a=>{const n={id:`domain-${Date.now()}-${Math.random()}`,name:"",children:[]};J(r=>{const d=[...r.domainHierarchy||[]];if(a.length===1)d.splice(a[0]+1,0,n);else{let g=d;for(let k=0;k<a.length-1;k++)g=g[a[k]].children;g.splice(a[a.length-1]+1,0,n)}return{...r,domainHierarchy:d}})},x=(a,n="",r=0)=>{const d=[],g=(k,h)=>{const o=["i","ii","iii","iv","v","vi","vii","viii","ix","x"];return k===0?`${h+1}.`:k===1?String.fromCharCode(97+h)+".":k===2?o[h]||`${h+1}.`:k===3?`${h+1}.`:k===4?o[h]||`${h+1}.`:`${h+1}.`};return a.forEach((k,h)=>{const o=g(r,h),c=n?`${n} ${o}`:o,Z="  ".repeat(r);d.push({level:r+1,Seviye:r+1,NumaralandÄ±rma:o,"Domain AdÄ±":`${Z}${k.name}`,"Tam Yol":c,"Alt Birim SayÄ±sÄ±":k.children.length}),k.children.length>0&&d.push(...x(k.children,c,r+1))}),d},j=a=>{const n={};return a.forEach(r=>{const d=r.level;n[d]||(n[d]=[]),n[d].push(r)}),n},s=()=>{if(!i.domainHierarchy||i.domainHierarchy.length===0){f.error("DÄ±ÅŸa aktarÄ±lacak domain hiyerarÅŸisi bulunamadÄ±!");return}try{const a=x(i.domainHierarchy),n=j(a),r=Te.book_new(),d=[{Alan:"MÃ¼ÅŸteri",DeÄŸer:i.cariAdi||"(BelirtilmemiÅŸ)"},{Alan:"Ana Domain",DeÄŸer:i.guncelMyPayterDomain||"(BelirtilmemiÅŸ)"},{Alan:"Toplam KÃ¶k Birim",DeÄŸer:i.domainHierarchy.length},{Alan:"Rapor Tarihi",DeÄŸer:new Date().toLocaleDateString("tr-TR")}],g=Te.json_to_sheet(d);g["!cols"]=[{wch:20},{wch:40}],Te.book_append_sheet(r,g,"Ã–zet");const k=[{Seviye:0,NumaralandÄ±rma:"Ana","Domain AdÄ±":i.guncelMyPayterDomain||"(BelirtilmemiÅŸ)","Tam Yol":"Ana Domain","Alt Birim SayÄ±sÄ±":i.domainHierarchy.length},...a.map(({level:Ae,...we})=>we)],h=Te.json_to_sheet(k);h["!cols"]=[{wch:8},{wch:15},{wch:40},{wch:30},{wch:18}],Te.book_append_sheet(r,h,"TÃ¼m HiyerarÅŸi");const o=Object.keys(n).sort((Ae,we)=>Number(Ae)-Number(we));o.forEach(Ae=>{const we=Number(Ae),Ke=n[we],Ze=Ke.map(({level:Aa,...xa})=>xa);Ze.push({Seviye:"",NumaralandÄ±rma:"","Domain AdÄ±":`ðŸ”¢ TOPLAM SEVÄ°YE ${we}`,"Tam Yol":"","Alt Birim SayÄ±sÄ±":Ke.reduce((Aa,xa)=>Aa+xa["Alt Birim SayÄ±sÄ±"],0)});const qe=Te.json_to_sheet(Ze);qe["!cols"]=[{wch:8},{wch:15},{wch:40},{wch:30},{wch:18}],Te.book_append_sheet(r,qe,`Seviye ${we}`)});const c=o.map(Ae=>{const we=Number(Ae),Ke=n[we];return{Seviye:we,"Domain SayÄ±sÄ±":Ke.length,"Toplam Alt Birim":Ke.reduce((Ze,qe)=>Ze+qe["Alt Birim SayÄ±sÄ±"],0),"Ortalama Alt Birim":(Ke.reduce((Ze,qe)=>Ze+qe["Alt Birim SayÄ±sÄ±"],0)/Ke.length).toFixed(2)}}),Z=Te.json_to_sheet(c);Z["!cols"]=[{wch:10},{wch:15},{wch:18},{wch:20}],Te.book_append_sheet(r,Z,"Seviye Ã–zeti");const _=`${i.cariAdi||"musteri"}_domain_hiyerarsi_${new Date().toISOString().split("T")[0]}.xlsx`;ha(r,_),f.success(`Domain hiyerarÅŸisi Excel'e aktarÄ±ldÄ±: ${_}`)}catch(a){console.error("Excel export hatasÄ±:",a),f.error("Excel dosyasÄ± oluÅŸturulurken bir hata oluÅŸtu!")}},t=()=>{if(!i.domainHierarchy||i.domainHierarchy.length===0){f.error("DÄ±ÅŸa aktarÄ±lacak domain hiyerarÅŸisi bulunamadÄ±!");return}try{const a=x(i.domainHierarchy),n=j(a),r=new Ma;let d=20;r.setFontSize(18),r.setFont("helvetica","bold"),r.text("Domain HiyerarÅŸisi Raporu",14,d),d+=10,r.setFontSize(10),r.setFont("helvetica","normal"),r.text(`MÃ¼ÅŸteri: ${i.cariAdi||"(BelirtilmemiÅŸ)"}`,14,d),d+=6,r.text(`Ana Domain: ${i.guncelMyPayterDomain||"(BelirtilmemiÅŸ)"}`,14,d),d+=6,r.text(`Toplam KÃ¶k Birim: ${i.domainHierarchy.length}`,14,d),d+=6,r.text(`Rapor Tarihi: ${new Date().toLocaleDateString("tr-TR")}`,14,d),d+=10,r.setFontSize(12),r.setFont("helvetica","bold"),r.text("Seviye Ã–zeti",14,d),d+=2;const g=Object.keys(n).sort((o,c)=>Number(o)-Number(c)),k=g.map(o=>{const c=Number(o),Z=n[c];return[`Seviye ${c}`,Z.length.toString(),Z.reduce((_,Ae)=>_+Ae["Alt Birim SayÄ±sÄ±"],0).toString(),(Z.reduce((_,Ae)=>_+Ae["Alt Birim SayÄ±sÄ±"],0)/Z.length).toFixed(2)]});ja(r,{startY:d,head:[["Seviye","Domain SayÄ±sÄ±","Toplam Alt Birim","Ort. Alt Birim"]],body:k,theme:"striped",headStyles:{fillColor:[59,130,246],fontSize:9,fontStyle:"bold"},styles:{fontSize:8,font:"helvetica"},columnStyles:{0:{cellWidth:40},1:{cellWidth:40},2:{cellWidth:45},3:{cellWidth:45}}}),d=r.lastAutoTable.finalY+15,g.forEach((o,c)=>{const Z=Number(o),_=n[Z];(c>0||d>200)&&(r.addPage(),d=20),r.setFontSize(14),r.setFont("helvetica","bold"),r.text(`Seviye ${Z} - Detay`,14,d),d+=2,r.setFontSize(9),r.setFont("helvetica","normal"),r.text(`Toplam: ${_.length} domain | Alt birim toplamÄ±: ${_.reduce((we,Ke)=>we+Ke["Alt Birim SayÄ±sÄ±"],0)}`,14,d+5),d+=5;const Ae=_.map(we=>[we.NumaralandÄ±rma,we["Domain AdÄ±"],we["Alt Birim SayÄ±sÄ±"].toString()]);ja(r,{startY:d,head:[["No","Domain AdÄ±","Alt Birim"]],body:Ae,theme:"grid",headStyles:{fillColor:[79,70,229],fontSize:9,fontStyle:"bold"},styles:{fontSize:8,font:"helvetica"},columnStyles:{0:{cellWidth:20},1:{cellWidth:130},2:{cellWidth:20}},didDrawPage:we=>{const Ke=r.getNumberOfPages();r.setFontSize(8),r.setFont("helvetica","normal"),r.text(`Sayfa ${Ke}`,r.internal.pageSize.width-30,r.internal.pageSize.height-10)}}),d=r.lastAutoTable.finalY+15});const h=`${i.cariAdi||"musteri"}_domain_hiyerarsi_${new Date().toISOString().split("T")[0]}.pdf`;r.save(h),f.success(`Domain hiyerarÅŸisi PDF'e aktarÄ±ldÄ±: ${h}`)}catch(a){console.error("PDF export hatasÄ±:",a),f.error("PDF dosyasÄ± oluÅŸturulurken bir hata oluÅŸtu!")}},I=()=>{C()},ee=()=>{if(!Ee||!m){f.error("LÃ¼tfen bir dondurma sebebi seÃ§in");return}const a=i.serviceFeeSettings;if(!a)return;const n=[...a.deviceSubscriptions],r=n[Ee.deviceIndex],d={date:new Date().toISOString(),reason:m,action:"suspended",notes:F||void 0};n[Ee.deviceIndex]={...r,isActive:!1,suspensionReason:m,suspensionDate:new Date().toISOString(),suspensionHistory:[...r.suspensionHistory||[],d]},J({...i,serviceFeeSettings:{...a,deviceSubscriptions:n}}),f.success(`Cihaz pasif hale getirildi: ${m}`),De(!1),z(null),u(""),L("")},y=a=>{const n=i.serviceFeeSettings;if(!n)return;const r=[...n.deviceSubscriptions],d=r[a],g={date:new Date().toISOString(),reason:"Yeniden aktifleÅŸtirildi",action:"reactivated",notes:void 0};r[a]={...d,isActive:!0,reactivationDate:new Date().toISOString(),suspensionHistory:[...d.suspensionHistory||[],g]},J({...i,serviceFeeSettings:{...n,deviceSubscriptions:r}}),f.success("Cihaz aktifleÅŸtirildi")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-4 mb-4 -mt-6 pt-6 -mx-6 px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(B,{type:"button",variant:"outline",onClick:I,size:"icon",children:e.jsx(ks,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{children:D?"Yeni Cari Kart Ekle":"Cari Kart DetayÄ±"}),!D&&e.jsxs("p",{className:"text-gray-600",children:[i.cariHesapKodu," - ",i.cariAdi]})]}),ce&&Q&&e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:()=>{ce.previousCustomer&&Q(ce.previousCustomer)},disabled:!ce.hasPrevious,title:ce.previousCustomer?`Ã–nceki Cari: ${ce.previousCustomer.cariAdi}`:"Ã–nceki Cari (Ä°lk KayÄ±tdasÄ±nÄ±z)",children:[e.jsx(Na,{size:16,className:"rotate-90"}),"Ã–nceki"]}),e.jsxs("span",{className:"text-sm text-gray-500 px-2",title:"Alfabetik sÄ±raya gÃ¶re pozisyon",children:[ce.currentIndex+1," / ",ce.total]}),e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:()=>{ce.nextCustomer&&Q(ce.nextCustomer)},disabled:!ce.hasNext,title:ce.nextCustomer?`Sonraki Cari: ${ce.nextCustomer.cariAdi}`:"Sonraki Cari (Son KayÄ±tdasÄ±nÄ±z)",children:["Sonraki",e.jsx(Na,{size:16,className:"-rotate-90"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!pe&&!D&&i.id&&e.jsxs(ne,{variant:"outline",className:"bg-green-50 text-green-700 border-green-300",children:[e.jsx(He,{size:14,className:"mr-1"}),"Otomatik Kaydedildi"]}),pe&&e.jsxs(ne,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-300 animate-pulse",children:[e.jsx(Ds,{size:14,className:"mr-1"}),"Kaydediliyor..."]}),e.jsxs(B,{type:"button",className:"flex items-center space-x-2",variant:pe?"default":"outline",onClick:a=>{a.preventDefault(),console.log("ðŸ”˜ GÃ¼ncelle butonu tÄ±klandÄ±"),console.log("ðŸ“‹ Form Data:",{cariHesapKodu:i.cariHesapKodu,cariAdi:i.cariAdi,email:i.email,mcc:i.mcc}),de(a)},children:[e.jsx(Ia,{size:18}),e.jsx("span",{children:D?"Kaydet":"Manuel Kaydet"})]}),e.jsx(os,{children:e.jsxs(ds,{children:[e.jsx(ms,{asChild:!0,children:e.jsx(B,{type:"button",variant:"outline",size:"sm",onClick:()=>{var r,d;if(console.log("=".repeat(80)),console.log("ðŸ” MÃœÅžTERÄ° DETAY DEBUG BÄ°LGÄ°LERÄ°"),console.log("=".repeat(80)),console.log(""),console.log("ðŸ“Š 1. FORMDATA (Ekrandaki Veriler):"),console.log("   MÃ¼ÅŸteri AdÄ±:",i.cariAdi||"(BoÅŸ)"),console.log("   Ana Domain:",i.guncelMyPayterDomain||"(BoÅŸ)"),console.log("   Domain HiyerarÅŸisi:",{kokSayisi:((r=i.domainHierarchy)==null?void 0:r.length)||0,yapisi:i.domainHierarchy||[]}),console.log(""),console.log("ðŸ“¦ 2. PROPS - PAYTER PRODUCTS (Props'tan Gelen):"),console.log("   Toplam Payter ÃœrÃ¼n:",K.length),K.length>0){console.log("   Ä°lk 10 ÃœrÃ¼n (DetaylÄ±):",K.slice(0,10).map(o=>({name:o.name||"(Ä°simsiz)",domain:o.domain||"(DOMAIN YOK!)",serialNumber:o.serialNumber||"(SN yok)",terminalModel:o.terminalModel||"(Model yok)"})));const g=new Map,k=[];K.forEach(o=>{const c=o.domain||"Domain Yok";(!o.domain||!o.domain.trim())&&k.push(o.serialNumber||o.name||"Bilinmeyen"),g.set(c,(g.get(c)||0)+1)}),console.log("   Domain DaÄŸÄ±lÄ±mÄ±:",Object.fromEntries(g)),k.length>0&&console.warn("   âš ï¸ UYARI: Domain'i olmayan Ã¼rÃ¼nler var!",{sayÄ±:k.length,Ã¶rnekler:k.slice(0,5)});const h=i.domain||i.guncelMyPayterDomain;if(h)if(console.log("   ðŸ” Domain KarÅŸÄ±laÅŸtÄ±rma:"),console.log("      MÃ¼ÅŸteri Domain:",h),console.log("      ignoreMainDomain:",i.ignoreMainDomain||!1),i.ignoreMainDomain){const o=K.filter(c=>c.domain&&c.domain.trim()&&c.domain.endsWith("."+h));console.log("      Alt domain formatÄ±ndaki Ã¼rÃ¼nler:",{sayÄ±:o.length,beklenenFormat:`*.${h}`,Ã¶rnekler:o.slice(0,5).map(c=>c.domain)}),o.length===0&&(console.warn('      âš ï¸ INFO: "Ana Domain HariÃ§" seÃ§eneÄŸi aktif ama hiÃ§ alt domain formatÄ±nda Ã¼rÃ¼n bulunamadÄ±.'),console.warn(`      ðŸ’¡ Beklenen format: subdomain.${h} (Ã¶rnek: vestelevc.${h})`),console.warn(`      ðŸ”§ Ã‡Ã¶zÃ¼m: Domain HiyerarÅŸisi sekmesinden alt domain'leri ekleyin veya "Ana Domain HariÃ§" seÃ§eneÄŸini kapatÄ±n.`))}else{const o=K.filter(c=>c.domain&&c.domain.trim().toLowerCase().replace(/^https?:\/\//,"").replace(/\/$/,"")===h.trim().toLowerCase().replace(/^https?:\/\//,"").replace(/\/$/,""));console.log("      Tam eÅŸleÅŸen Ã¼rÃ¼nler:",{sayÄ±:o.length,beklenenDomain:h})}}else console.log("   âš ï¸ UYARI: HiÃ§ Payter Ã¼rÃ¼nÃ¼ yok!");console.log(""),console.log("ðŸ”— 3. MATCHED PRODUCTS (EÅŸleÅŸen ÃœrÃ¼nler):"),console.log("   Toplam EÅŸleÅŸen:",re.length),re.length>0?console.log("   Ä°lk 5 EÅŸleÅŸen:",re.slice(0,5).map(g=>({name:g.name,domain:g.domain}))):console.log("   âš ï¸ UYARI: HiÃ§ eÅŸleÅŸen Ã¼rÃ¼n yok!"),console.log(""),console.log("ðŸŒ 4. MÃœÅžTERÄ° DOMAIN BÄ°LGÄ°SÄ°:");const a=i.domain||i.guncelMyPayterDomain;console.log("   MÃ¼ÅŸteri Domain:",a||"(YOK)"),console.log("   ignoreMainDomain:",i.ignoreMainDomain||!1),console.log("   ignoreMainDomainNote:",i.ignoreMainDomainNote||"(YOK)"),a||console.log("   âš ï¸ UYARI: MÃ¼ÅŸterinin domain bilgisi yok!"),console.log(""),console.log("ðŸ’¾ 5. LOCALSTORAGE KONTROLÃœ:");try{const g=localStorage.getItem("customers"),k=localStorage.getItem("payterProducts");if(g){const o=JSON.parse(g).find(c=>c.id===i.id);console.log("   Bu mÃ¼ÅŸterinin localStorage kaydÄ±:",o?{cariAdi:o.cariAdi,guncelMyPayterDomain:o.guncelMyPayterDomain,domainHierarchyLength:((d=o.domainHierarchy)==null?void 0:d.length)||0}:"(BulunamadÄ±)")}else console.log("   âš ï¸ UYARI: localStorage'da customers verisi yok!");if(k){const h=JSON.parse(k);console.log("   localStorage'daki Payter ÃœrÃ¼n SayÄ±sÄ±:",h.length)}else console.log("   âš ï¸ UYARI: localStorage'da payterProducts verisi yok!")}catch(g){console.error("   âŒ localStorage okuma hatasÄ±:",g)}console.log(""),console.log("ðŸ“‹ 6. SONUÃ‡ VE Ã–NERÄ°LER:"),K.length===0&&console.log("   âŒ Payter Ã¼rÃ¼nleri yok! ÃœrÃ¼n > Payter modÃ¼lÃ¼nden cihaz ekleyin.");const n=i.domain||i.guncelMyPayterDomain;n||console.log("   âŒ MÃ¼ÅŸteri domain bilgisi yok! Domain sekmesinden domain ekleyin."),K.length>0&&n&&re.length===0&&(console.log("   âš ï¸ Domain eÅŸleÅŸmesi bulunamadÄ±!"),console.log("   ðŸ’¡ Payter cihaz domain'leri:",[...new Set(K.map(g=>g.domain))].slice(0,10)),console.log("   ðŸ’¡ MÃ¼ÅŸteri domain'i:",n),console.log("   ðŸ’¡ ignoreMainDomain:",i.ignoreMainDomain||!1),i.ignoreMainDomain?(console.log(""),console.log('   ðŸ”§ "Ana Domain HariÃ§" seÃ§eneÄŸi aktif!'),console.log("   ðŸ“Œ Bu durumda sadece ALT DOMAIN formatÄ±ndaki cihazlar eÅŸleÅŸir."),console.log(`   ðŸ“Œ Beklenen format: subdomain.${n}`),console.log("   ðŸ“Œ Ã–rnek: vestelevc."+n+", test."+n),console.log(""),console.log("   ðŸ’¡ Ã‡Ã–ZÃœMLERÄ°:"),console.log("      1ï¸âƒ£ Domain HiyerarÅŸisi sekmesinden alt domain'leri ekleyin"),console.log('      2ï¸âƒ£ VEYA "Ana Domain HariÃ§" seÃ§eneÄŸini kapatÄ±n (tam eÅŸleÅŸme iÃ§in)'),console.log("      3ï¸âƒ£ VEYA Manuel Cihaz AtamasÄ± yapÄ±n (Banka/PF sekmesinden)")):(console.log(""),console.log("   ðŸ’¡ Ã‡Ã–ZÃœM: MÃ¼ÅŸteri domain'i ile Payter cihaz domain'leri uyuÅŸmuyor."),console.log("      1ï¸âƒ£ MÃ¼ÅŸteri domain'ini kontrol edin (Domain sekmesi)"),console.log("      2ï¸âƒ£ Payter cihaz domain'lerini kontrol edin (ÃœrÃ¼n > Payter modÃ¼lÃ¼)"),console.log("      3ï¸âƒ£ VEYA Manuel Cihaz AtamasÄ± yapÄ±n (Banka/PF sekmesinden)"))),re.length>0&&console.log("   âœ… Her ÅŸey normal! "+re.length+" cihaz baÅŸarÄ±yla eÅŸleÅŸti."),console.log(""),console.log("=".repeat(80)),f.success("DetaylÄ± debug bilgileri konsola yazdÄ±rÄ±ldÄ± (F12)",{duration:3e3})},className:"text-xs",children:"ðŸ” Debug"})}),e.jsxs(hs,{side:"bottom",className:"max-w-xs",children:[e.jsx("p",{className:"text-xs",children:"Domain eÅŸleÅŸtirme sorunlarÄ±nÄ± analiz eder"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Console'a (F12) detaylÄ± bilgi yazdÄ±rÄ±r"})]})]})}),!D&&e.jsxs(Va,{children:[e.jsx(xs,{asChild:!0,children:e.jsxs("button",{type:"button",className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(Xe,{size:18}),e.jsx("span",{children:"Sil"})]})}),e.jsxs(Ga,{children:[e.jsxs(_a,{children:[e.jsx(Wa,{children:"Cari KartÄ± Sil"}),e.jsx(Xa,{children:"Bu cari kartÄ±nÄ± silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz."})]}),e.jsxs(Za,{children:[e.jsx(qa,{children:"Ä°ptal"}),e.jsx(Ja,{onClick:()=>$(i.id),className:"bg-red-600 hover:bg-red-700",children:"Sil"})]})]})]})]})]})}),e.jsxs("div",{id:"customer-detail-form",className:"space-y-6",children:[e.jsxs(Ha,{value:ke,onValueChange:Le,className:"w-full",children:[e.jsxs(Oa,{className:"grid w-full max-w-4xl grid-cols-5",children:[e.jsx(Ve,{value:"genel",children:"Genel Bilgiler"}),e.jsx(Ve,{value:"domain",children:"ðŸŒ Domain"}),e.jsx(Ve,{value:"payter",children:"ðŸ“± Payter"}),e.jsx(Ve,{value:"bankpf",children:"ðŸ¦ Banka/PF"}),e.jsx(Ve,{value:"hizmetbedeli",children:"ðŸ’° Hizmet Bedeli"})]}),e.jsx(Ge,{value:"genel",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(Y,{className:"lg:col-span-2",children:[e.jsx(fe,{children:e.jsx(be,{children:"Cari Bilgileri"})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"cariHesapKodu",children:"Cari Hesap Kodu *"}),e.jsx(ye,{id:"cariHesapKodu",value:i.cariHesapKodu,onChange:a=>U("cariHesapKodu",a.target.value),required:!0,placeholder:"Ã–rn: 120.01.001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"sektor",children:"SEKTÃ–R"}),e.jsx(ye,{id:"sektor",value:i.sektor,onChange:a=>U("sektor",a.target.value),placeholder:"Ã–rn: Teknoloji"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"mcc",children:"MCC *"}),M.length>0?e.jsx(_e,{label:"MCC SeÃ§iniz",options:ae,value:i.mcc,onChange:a=>U("mcc",a),allLabel:"MCC seÃ§iniz...",allValue:"",className:"w-full"}):e.jsx(ye,{id:"mcc",value:i.mcc,onChange:a=>U("mcc",a.target.value),required:!0,placeholder:"Ã–rn: 5411"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"cariAdi",children:"Cari AdÄ± *"}),e.jsx(ye,{id:"cariAdi",value:i.cariAdi,onChange:a=>U("cariAdi",a.target.value),required:!0,placeholder:"Firma Ã¼nvanÄ±"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"vergiDairesi",children:"Vergi Dairesi"}),e.jsx(ye,{id:"vergiDairesi",value:i.vergiDairesi,onChange:a=>U("vergiDairesi",a.target.value),placeholder:"Vergi dairesi adÄ±"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"vergiNo",children:"Vergi No"}),e.jsx(ye,{id:"vergiNo",value:i.vergiNo,onChange:a=>U("vergiNo",a.target.value),placeholder:"1234567890"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"adres",children:"Adres"}),e.jsx(ma,{id:"adres",value:i.adres,onChange:a=>U("adres",a.target.value),placeholder:"Tam adres bilgisi",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"ilce",children:"Ä°lÃ§e"}),e.jsx(ye,{id:"ilce",value:i.ilce,onChange:a=>U("ilce",a.target.value),placeholder:"Ä°lÃ§e"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"postaKodu",children:"Posta Kodu"}),e.jsx(ye,{id:"postaKodu",value:i.postaKodu,onChange:a=>U("postaKodu",a.target.value),placeholder:"34398"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsx(be,{children:"Ä°letiÅŸim Bilgileri"})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"email",children:"E-posta *"}),e.jsx(ye,{id:"email",type:"email",value:i.email,onChange:a=>U("email",a.target.value),required:!0,placeholder:"ornek@sirket.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"yetkili",children:"Yetkili"}),e.jsx(ye,{id:"yetkili",value:i.yetkili,onChange:a=>U("yetkili",a.target.value),placeholder:"Yetkili kiÅŸi adÄ±"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"tel",children:"Telefon"}),e.jsx(ye,{id:"tel",value:i.tel,onChange:a=>U("tel",a.target.value),placeholder:"0532 111 2233"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"durum",children:"Durum"}),e.jsx(_e,{label:"Durum",options:b,value:i.durum,onChange:a=>U("durum",a),allLabel:"Durum seÃ§iniz",allValue:"",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"salesRep",children:"SatÄ±ÅŸ Temsilcisi"}),e.jsx(_e,{label:"SatÄ±ÅŸ Temsilcisi",options:P,value:i.salesRepId||"unassigned",onChange:a=>{const n=he.find(r=>r.id===a);J({...i,salesRepId:a==="unassigned"?void 0:a,salesRepName:(n==null?void 0:n.adSoyad)||void 0})},allLabel:"SeÃ§iniz...",allValue:"",className:"w-full"}),i.salesRepName&&e.jsxs("p",{className:"text-xs text-gray-600",children:["AtanmÄ±ÅŸ: ",e.jsx("span",{className:"font-medium",children:i.salesRepName})]})]})]})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsx(be,{children:"Ek Bilgiler"})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(le,{htmlFor:"p6x",children:"P6X"}),e.jsxs(ne,{variant:te.p6x>0?"default":"outline",className:"text-xs",children:[te.p6x," Cihaz"]})]}),e.jsx(ye,{id:"p6x",value:i.p6x||"",onChange:a=>U("p6x",a.target.value),placeholder:"P6X bilgisi"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(le,{htmlFor:"apollo",children:"APOLLO"}),e.jsxs(ne,{variant:te.apollo>0?"default":"outline",className:"text-xs",children:[te.apollo," Cihaz"]})]}),e.jsx(ye,{id:"apollo",value:i.apollo||"",onChange:a=>U("apollo",a.target.value),placeholder:"APOLLO bilgisi"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200",children:[e.jsxs(le,{htmlFor:"subscriptionFee",className:"flex items-center gap-2",children:[e.jsx(Ss,{size:16,className:"text-green-600"}),"AylÄ±k Abone Hizmet Bedeli (â‚º)"]}),e.jsx(ye,{id:"subscriptionFee",type:"number",step:"0.01",min:"0",value:i.subscriptionFee||"",onChange:a=>U("subscriptionFee",a.target.value?parseFloat(a.target.value):void 0),placeholder:"0,00"}),i.subscriptionFee&&i.subscriptionFee>0&&e.jsxs("p",{className:"text-xs text-green-600",children:["YÄ±llÄ±k: â‚º",(i.subscriptionFee*12).toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200",children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(We,{size:16,className:"text-blue-600"}),"AtanmÄ±ÅŸ Toplam Cihaz"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ne,{variant:"outline",className:"text-lg px-4 py-2",children:[ge," Cihaz"]}),ge>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",((X=i.bankDeviceAssignments)==null?void 0:X.length)||0," banka/kurum)"]})]}),ge===0&&e.jsx("p",{className:"text-xs text-gray-500",children:"Bu mÃ¼ÅŸteriye henÃ¼z cihaz atamasÄ± yapÄ±lmamÄ±ÅŸ"})]})]})]})]})]})}),e.jsx(Ge,{value:"domain",className:"mt-6",children:ke==="domain"&&e.jsxs(Y,{children:[e.jsxs(fe,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(be,{children:"ðŸŒ Domain HiyerarÅŸisi"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"MÃ¼ÅŸteri domain yapÄ±sÄ±nÄ± yÃ¶netin - HiyerarÅŸik organizasyon yapÄ±sÄ±"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:s,className:"text-green-600 hover:text-green-700 hover:bg-green-50",disabled:!i.domainHierarchy||i.domainHierarchy.length===0,title:"Domain hiyerarÅŸisini Excel'e aktar",children:[e.jsx(es,{size:14,className:"mr-1"}),"Excel"]}),e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:t,className:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:!i.domainHierarchy||i.domainHierarchy.length===0,title:"Domain hiyerarÅŸisini PDF'e aktar",children:[e.jsx(fa,{size:14,className:"mr-1"}),"PDF"]}),e.jsxs(B,{type:"button",variant:"default",size:"sm",onClick:()=>ze([]),children:[e.jsx($e,{size:14,className:"mr-1"}),"KÃ¶k Birim Ekle"]})]})]}),e.jsx("div",{className:"mt-3 bg-gray-50 p-3 rounded border border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"NumaralandÄ±rma:"})," 1. â†’ a. â†’ i. â†’ 1. â†’ i. ÅŸeklinde otosmatik hiyerarÅŸik sÄ±ralama"]})})]}),e.jsxs(V,{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border-2 border-blue-300 p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{htmlFor:"guncelMyPayterDomain",className:"text-blue-900",children:"ðŸŒ Ana Domain (KÃ¶k)"}),e.jsx("span",{className:"text-xs bg-blue-200 text-blue-800 px-2 py-0.5 rounded",children:"Zorunlu"})]}),e.jsx(ye,{id:"guncelMyPayterDomain",value:i.guncelMyPayterDomain,onChange:a=>U("guncelMyPayterDomain",a.target.value),placeholder:"ornek.mypayter.com",className:"bg-white border-blue-300 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-blue-700",children:"ðŸ’¡ Bu alan mÃ¼ÅŸterinin ana domain adresini belirtir. AÅŸaÄŸÄ±daki hiyerarÅŸi yapÄ±sÄ± bu domain iÃ§indeki organizasyonu gÃ¶sterir."})]})}),e.jsx("div",{className:"bg-amber-50 border-2 border-amber-300 p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ka,{id:"ignoreMainDomain",checked:i.ignoreMainDomain||!1,onCheckedChange:a=>{var n;U("ignoreMainDomain",a),a?(f.info("ðŸ”„ Alt domain eÅŸleÅŸtirme modu aktif!",{description:"Cihazlar alt domainlerle yeniden taranÄ±yor..."}),(n=i.ignoreMainDomainNote)!=null&&n.trim()||(f.warning("âš ï¸ LÃ¼tfen not alanÄ±nÄ± doldurmayÄ± unutmayÄ±n!",{description:"Domain eÅŸleÅŸtirmesi baÅŸlatÄ±ldÄ± ama aÃ§Ä±klama zorunludur."}),setTimeout(()=>{Se.current&&Se.current.focus()},100)),setTimeout(()=>{const r={...i,ignoreMainDomain:!0};O(r,{autoSave:!0}),f.success("âœ… Domain eÅŸleÅŸtirmesi gÃ¼ncellendi!",{description:"ArtÄ±k sadece alt domainler (Ã¶rn: TINTCAFE) ile cihaz eÅŸleÅŸtirmesi yapÄ±lacak."})},150)):(U("ignoreMainDomainNote",""),f.info("ðŸ”„ Ana domain eÅŸleÅŸtirmesi normal moda dÃ¶ndÃ¼",{description:"Cihazlar ana domain ile yeniden eÅŸleÅŸtirilecek."}),setTimeout(()=>{const r={...i,ignoreMainDomain:!1,ignoreMainDomainNote:""};O(r,{autoSave:!0}),f.success("âœ… Domain eÅŸleÅŸtirmesi gÃ¼ncellendi!",{description:"Ana domain modu aktif - cihazlar yeniden eÅŸleÅŸtirildi."})},150))}}),e.jsxs("div",{className:"flex-1",children:[e.jsx(le,{htmlFor:"ignoreMainDomain",className:"text-amber-900 cursor-pointer",children:"ðŸ”€ Ana Domaini GÃ¶rmezden Gel (Alt Domain EÅŸleÅŸtirme)"}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"Bu seÃ§enek aktifse, Ã¼rÃ¼n eÅŸleÅŸtirmesi sadece alt domainlerle yapÄ±lÄ±r. Ana domain eÅŸleÅŸtirmede gÃ¶rmezden gelinir."})]})]}),i.ignoreMainDomain&&e.jsxs("div",{className:"space-y-2 pl-11",children:[e.jsx(le,{htmlFor:"ignoreMainDomainNote",className:"text-amber-900",children:"Not (Zorunlu) *"}),e.jsx(ma,{ref:Se,id:"ignoreMainDomainNote",value:i.ignoreMainDomainNote||"",onChange:a=>{const n=a.target.value;U("ignoreMainDomainNote",n),n.trim()&&i.ignoreMainDomain&&!D&&(je.current&&clearTimeout(je.current),je.current=window.setTimeout(()=>{f.info("ðŸ’¾ Not kaydedildi - domain eÅŸleÅŸtirmesi gÃ¼ncelleniyor...");const r={...i,ignoreMainDomain:!0,ignoreMainDomainNote:n};O(r,{autoSave:!0}),f.success("âœ… Domain eÅŸleÅŸtirmesi gÃ¼ncellendi!",{description:"Alt domain modunda cihazlar yeniden eÅŸleÅŸtirildi."})},1500))},placeholder:"Ã–rn: Multi-branch yapÄ± - ÅŸubeler kendi alt domainlerini kullanÄ±yor",rows:3,className:"bg-white border-amber-300 focus:border-amber-500",required:i.ignoreMainDomain}),e.jsx("p",{className:"text-xs text-amber-700",children:"ðŸ’¡ Bu Ã¶zelliÄŸi neden etkinleÅŸtirdiÄŸinizi aÃ§Ä±klayÄ±n. Ã–rnek: ÅŸube yapÄ±sÄ±, multi-domain yÃ¶netimi vb."})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2.5 rounded border border-gray-200",children:[e.jsx(le,{className:"text-gray-700 text-sm",children:"ðŸ“Š Organizasyon YapÄ±sÄ±"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600 bg-white px-2 py-1 rounded border border-gray-200",children:[((oe=i.domainHierarchy)==null?void 0:oe.length)||0," kÃ¶k"]}),i.domainHierarchy&&i.domainHierarchy.length>0&&e.jsxs("span",{className:"text-xs text-gray-600 bg-white px-2 py-1 rounded border border-gray-200",children:[(()=>{const a=n=>n.reduce((r,d)=>r+1+a(d.children),0);return a(i.domainHierarchy)})()," toplam"]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 p-4 min-h-[400px] max-h-[600px] overflow-y-auto",children:i.domainHierarchy&&i.domainHierarchy.length>0?e.jsx("div",{className:"space-y-0.5",children:i.domainHierarchy.map((a,n)=>e.jsx(ss,{node:a,path:[n],level:0,onUpdate:Ne,onDelete:Me,onAddChild:ze,onAddSibling:l},a.id))}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-5xl mb-3 opacity-30",children:"ðŸ“Š"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"HenÃ¼z organizasyon yapÄ±sÄ± eklenmedi"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Organizasyon yapÄ±sÄ±nÄ± modellemek iÃ§in birim ekleyin"}),e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:()=>ze([]),children:[e.jsx($e,{size:14,className:"mr-1"}),"Ä°lk Birimi Ekle"]})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’¡"}),e.jsx("h4",{className:"text-sm text-blue-900",children:"KullanÄ±m KÄ±lavuzu"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-white p-2 rounded border border-blue-200",children:[e.jsx(Qa,{size:12,className:"text-gray-600"}),e.jsx("span",{children:"Birim adÄ±na tÄ±klayarak dÃ¼zenle"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-white p-2 rounded border border-blue-200",children:[e.jsx($e,{size:12,className:"text-green-600"}),e.jsxs("span",{children:[e.jsx("strong",{children:"YeÅŸil:"})," Alt birim ekle"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-white p-2 rounded border border-blue-200",children:[e.jsx($e,{size:12,className:"text-blue-600"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Mavi:"})," Yan birim ekle"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-white p-2 rounded border border-blue-200",children:[e.jsx(as,{size:12,className:"text-red-600"}),e.jsxs("span",{children:[e.jsx("strong",{children:"KÄ±rmÄ±zÄ±:"})," Birimi sil"]})]})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:e.jsx("strong",{children:"Ã–rnek:"})}),e.jsx("p",{className:"text-xs text-gray-700 font-mono",children:"1. Ä°STANBUL â†’ a. Ä°STHASTANE â†’ i. MEDICALPARK â†’ 1. FLORYA"})]}),e.jsx("div",{className:"mt-3 bg-green-50 p-3 rounded border border-green-200",children:e.jsxs("p",{className:"text-xs text-green-900",children:[e.jsx("strong",{children:"ðŸ“¥ Excel Toplu YÃ¼kleme:"}),' Ana liste sayfasÄ±ndaki "ðŸŒ Domain YÃ¼kle" butonunu kullanarak toplu yÃ¼kleme yapabilirsiniz.']})})]})]})]})}),e.jsx(Ge,{value:"payter",className:"mt-6",children:ke==="payter"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Toplam Cihaz"}),e.jsx("h3",{className:"text-blue-600 mt-1",children:re.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(We,{className:"text-blue-600",size:24})})]})})}),e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Online"}),e.jsx("h3",{className:"text-green-600 mt-1",children:re.filter(a=>{var n;return((n=a.onlineStatus)==null?void 0:n.toLowerCase())==="online"}).length})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(He,{className:"text-green-600",size:24})})]})})}),e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Offline"}),e.jsx("h3",{className:"text-red-600 mt-1",children:re.filter(a=>{var n;return((n=a.onlineStatus)==null?void 0:n.toLowerCase())==="offline"}).length})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(da,{className:"text-red-600",size:24})})]})})})]}),re.length>0&&(()=>{const a=new Map;re.forEach(r=>{const d=r.terminalType||"Bilinmeyen";a.set(d,(a.get(d)||0)+1)});const n=Array.from(a.entries()).sort((r,d)=>d[1]-r[1]);return n.length>0?e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsx(be,{children:"ðŸ“Š Terminal Type DaÄŸÄ±lÄ±mÄ±"})}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:n.map(([r,d])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-indigo-600",children:d}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:r})]},r))})})]}):null})(),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(be,{children:"ðŸ“± Domain BazlÄ± Cihaz Listesi"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Domain hiyerarÅŸisi ile eÅŸleÅŸen Payter cihazlarÄ±"})]}),e.jsx("div",{className:"flex items-center gap-2",children:re.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(ne,{variant:"outline",children:[G.length," domain â€¢ ",re.length," cihaz"]}),e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:()=>{try{const a=[];G.forEach(({domain:g,domainLevel:k,products:h})=>{a.push({"Serial Number":"",Name:`${g} (${k})`,TID:"",Model:"",Type:"",Status:""}),h.forEach(o=>{a.push({"Serial Number":o.serialNumber||"-",Name:o.name||"-",TID:o.tid||"-",Model:o.terminalModel||"-",Type:o.terminalType||"-",Status:o.onlineStatus||"-"})}),a.push({"Serial Number":"",Name:"",TID:"",Model:"",Type:"",Status:""})});const n=Te.json_to_sheet(a),r=Te.book_new();n["!cols"]=[{wch:20},{wch:30},{wch:15},{wch:20},{wch:15},{wch:12}],Te.book_append_sheet(r,n,"Cihaz Listesi");const d=`${i.cariAdi.replace(/[^a-z0-9]/gi,"-")}-cihaz-listesi-${new Date().toISOString().split("T")[0]}.xlsx`;ha(r,d),f.success(`Excel baÅŸarÄ±yla oluÅŸturuldu!
${d}`)}catch(a){console.error("Excel oluÅŸturma hatasÄ±:",a),f.error("Excel oluÅŸturulurken hata oluÅŸtu!")}},className:"flex items-center gap-1",children:[e.jsx(Ya,{size:14}),"Excel Ä°ndir"]}),e.jsxs(B,{type:"button",variant:"default",size:"sm",onClick:()=>{try{const a=new Ma({orientation:"landscape",unit:"mm",format:"a4"});a.setFontSize(16),a.text(`${i.cariAdi} - Cihaz Listesi`,14,15),a.setFontSize(10),a.text(`Tarih: ${new Date().toLocaleDateString("tr-TR")}`,14,22),a.text(`Toplam Domain: ${G.length}`,14,28),a.text(`Toplam Cihaz: ${re.length}`,14,34);let n=42;G.forEach((d,g)=>{g>0&&n>170&&(a.addPage(),n=15),a.setFontSize(12),a.text(`${d.domain} (${d.domainLevel}) - ${d.count} cihaz`,14,n),n+=5;const k=[["Serial Number","Name","TID","Model","Type","Status"]],h=d.products.map(o=>[o.serialNumber||"-",o.name||"-",o.tid||"-",o.terminalModel||"-",o.terminalType||"-",o.onlineStatus||"-"]);ja(a,{head:k,body:h,startY:n,styles:{fontSize:8,cellPadding:2,overflow:"linebreak",halign:"left",valign:"middle"},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontSize:8,fontStyle:"bold",halign:"center"},columnStyles:{0:{cellWidth:35},1:{cellWidth:50},2:{cellWidth:30},3:{cellWidth:40},4:{cellWidth:30},5:{cellWidth:25,halign:"center"}},alternateRowStyles:{fillColor:[249,250,251]},margin:{left:14,right:14},theme:"grid"}),n=a.lastAutoTable.finalY+8});const r=`${i.cariAdi.replace(/[^a-z0-9]/gi,"-")}-cihaz-listesi-${new Date().toISOString().split("T")[0]}.pdf`;a.save(r),f.success(`PDF baÅŸarÄ±yla oluÅŸturuldu!
${r}`)}catch(a){console.error("PDF oluÅŸturma hatasÄ±:",a),f.error("PDF oluÅŸturulurken hata oluÅŸtu!")}},className:"flex items-center gap-1",children:[e.jsx(Fa,{size:14}),"PDF"]})]})})]})}),e.jsx(V,{children:re.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-5xl mb-3 opacity-30",children:"ðŸ“±"}),e.jsx("p",{className:"text-gray-900 mb-2",children:"âš ï¸ HenÃ¼z eÅŸleÅŸen cihaz bulunamadÄ±"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2 max-w-2xl mx-auto mt-4",children:[e.jsx("p",{children:e.jsx("strong",{children:"OlasÄ± Nedenler:"})}),e.jsxs("ol",{className:"text-left list-decimal list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Payter ÃœrÃ¼nleri Yok:"}),' ÃœrÃ¼n modÃ¼lÃ¼ndeki "Payter" sekmesinde hiÃ§ cihaz kaydÄ± bulunmuyor']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Domain UyuÅŸmazlÄ±ÄŸÄ±:"})," Payter cihazlarÄ±nÄ±n domain alanlarÄ±, bu mÃ¼ÅŸterinin domain bilgileriyle eÅŸleÅŸmiyor"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Domain Bilgisi Eksik:"})," Bu mÃ¼ÅŸterinin domain hiyerarÅŸisi veya ana domain bilgisi girilmemiÅŸ"]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mt-4",children:e.jsxs("p",{className:"text-blue-900 text-xs",children:["ðŸ’¡ ",e.jsx("strong",{children:"Ã‡Ã¶zÃ¼m:"}),' Ã–nce yukarÄ±daki "ðŸ” Debug" butonuna tÄ±klayÄ±n ve konsolda (F12) hangi verinin eksik olduÄŸunu kontrol edin.']})})]})]}):e.jsx("div",{className:"space-y-6",children:G.map(({domain:a,domainLevel:n,products:r,count:d})=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-gray-900",children:a}),e.jsx(ne,{variant:n==="Ana Domain"?"default":"secondary",className:"text-xs",children:n})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[d," cihaz"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Serial Number"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Name"}),e.jsx("th",{className:"text-left py-2 px-3",children:"TID"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Model"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Type"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:r.map(g=>{var k,h;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3",children:g.serialNumber||"-"}),e.jsx("td",{className:"py-2 px-3",children:g.name||"-"}),e.jsx("td",{className:"py-2 px-3",children:g.tid?e.jsx("span",{className:"text-green-700",children:g.tid}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3",children:g.terminalModel||"-"}),e.jsx("td",{className:"py-2 px-3",children:g.terminalType||"-"}),e.jsx("td",{className:"py-2 px-3",children:((k=g.onlineStatus)==null?void 0:k.toLowerCase())==="online"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:[e.jsx(He,{size:12}),"Online"]}):((h=g.onlineStatus)==null?void 0:h.toLowerCase())==="offline"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs bg-red-100 text-red-700 px-2 py-1 rounded",children:[e.jsx(da,{size:12}),"Offline"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},g.id)})})]})})]},a))})})]})]})}),e.jsx(Ge,{value:"bankpf",className:"mt-6",children:ke==="bankpf"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Es,{assignments:i.bankDeviceAssignments||[],onAssignmentsChange:a=>{J(n=>{const r=Ka(a,S),d=n.cariAdi.trim().toLowerCase(),g=S.filter(c=>{var _;const Z=((_=c.firmaUnvan)==null?void 0:_.trim().toLowerCase())||"";return d===Z}).map(c=>c.id),k=(n.linkedBankPFIds||[]).filter(c=>!r.includes(c)&&!g.includes(c)),h=Array.from(new Set([...k,...r,...g]));console.log("ðŸ”„ BankDeviceAssignments gÃ¼ncellendi, linkedBankPFIds senkronize ediliyor:",{cariAdi:n.cariAdi,assignmentsCount:a.length,assignments:a.map(c=>{var Z;return{bankId:c.bankId,bankName:c.bankName,deviceCount:((Z=c.deviceIds)==null?void 0:Z.length)||0}}),currentManualIds:k,assignmentBasedIds:r,autoMatchedIds:g,allLinkedIds:h,bankPFRecordsCount:S.length,bankPFRecordsSample:S.slice(0,3).map(c=>({id:c.id,firmaUnvan:c.firmaUnvan,linkedBankIds:c.linkedBankIds,linkedEPKIds:c.linkedEPKIds,linkedOKIds:c.linkedOKIds}))});const o={...n,bankDeviceAssignments:a,linkedBankPFIds:h};return xe.current&&clearTimeout(xe.current),ie.current||(xe.current=window.setTimeout(()=>{ie.current=!0,console.log("ðŸ’¾ Otomatik kayÄ±t baÅŸlatÄ±lÄ±yor (Banka/PF deÄŸiÅŸikliÄŸi)..."),O(o,{autoSave:!0}),N(!1),f.success("âœ… Banka/PF atamalarÄ± kaydedildi",{duration:2e3}),setTimeout(()=>{ie.current=!1},1e3)},500)),o})},banks:ue,epkList:me,okList:R,payterProducts:re}),e.jsxs("div",{className:"relative py-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-white px-4 text-sm text-gray-500",children:"Banka/PF ModÃ¼l KayÄ±tlarÄ±"})})]}),e.jsx(e.Fragment,{children:e.jsx(Y,{className:"bg-blue-50 border-blue-200",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ’¡"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm text-blue-900",children:e.jsx("strong",{children:"Banka/PF EÅŸleÅŸtirme:"})}),e.jsxs("div",{className:"text-xs text-blue-800 space-y-1",children:[e.jsxs("p",{children:["âœ“ ",e.jsx("strong",{children:"Otomatik:"})," Cari AdÄ± ile Firma ÃœnvanÄ± eÅŸleÅŸen kayÄ±tlar otomatik gÃ¶sterilir"]}),e.jsxs("p",{children:["âœ“ ",e.jsx("strong",{children:"Manuel:"})," Ana liste sayfasÄ±ndaki ",e.jsx("strong",{children:'"ðŸ¦ Banka/PF YÃ¼kle"'})," butonu ile Excel'den Ã¶zel eÅŸleÅŸtirmeler yapabilirsiniz"]}),e.jsxs("p",{children:["âœ“ ",e.jsx("strong",{children:"Åžablon:"})," Mevcut eÅŸleÅŸtirmeleri gÃ¶rmek iÃ§in ",e.jsx("strong",{children:'"ðŸ¦ Banka/PF Åžablon"'})," butonunu kullanÄ±n"]})]})]})]})})})})]})}),e.jsx(Ge,{value:"hizmetbedeli",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{className:"bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-2xl",children:"âœ¨"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm text-green-900",children:e.jsx("strong",{children:"Otomatik KayÄ±t Aktif:"})}),e.jsxs("div",{className:"text-xs text-green-800 space-y-1",children:[e.jsxs("p",{children:["âœ“ Bu sekmede yaptÄ±ÄŸÄ±nÄ±z tÃ¼m deÄŸiÅŸiklikler ",e.jsx("strong",{children:"otomatik olarak kaydedilir"})]}),e.jsx("p",{children:"âœ“ Cihaz aktif/pasif deÄŸiÅŸiklikleri, aylÄ±k Ã¼cret gÃ¼ncellemeleri ve tÃ¼m ayarlar 1.5 saniye sonra otomatik kaydedilir"}),e.jsxs("p",{children:["âœ“ Ãœstteki yeÅŸil ",e.jsx(He,{size:12,className:"inline"})," ",e.jsx("strong",{children:'"Otomatik Kaydedildi"'})," iÅŸaretini gÃ¶rebilirsiniz"]}),e.jsx("p",{className:"text-gray-600 italic",children:'Ä°sterseniz "Manuel Kaydet" butonunu da kullanabilirsiniz'})]})]})]})})}),(()=>{const a=i.serviceFeeSettings?{...i.serviceFeeSettings,deviceSubscriptions:i.serviceFeeSettings.deviceSubscriptions||[],invoices:i.serviceFeeSettings.invoices||[],reminders:i.serviceFeeSettings.reminders||[]}:{customerId:i.id,paymentType:"monthly",standardFeePerDevice:10,contractStartDate:new Date().toISOString().split("T")[0],isActive:!0,deviceSubscriptions:[],invoices:[],reminders:[]},n=re.map(h=>a.deviceSubscriptions.find(c=>c.deviceId===h.id)||{deviceId:h.id,deviceSerialNumber:h.serialNumber||"",deviceName:h.name||"",monthlyFee:a.customFeePerDevice||a.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending"}),r=n.filter(h=>h.isActive).length,d=n.filter(h=>h.isActive).reduce((h,o)=>h+o.monthlyFee,0),g=a.invoices.filter(h=>h.status==="overdue");a.invoices.filter(h=>h.status==="pending");const k=a.suspensionStartDate?Math.floor((new Date().getTime()-new Date(a.suspensionStartDate).getTime())/(1e3*60*60*24)):0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(We,{className:"text-blue-600",size:24}),e.jsx("div",{className:"text-3xl text-blue-600",children:r})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"Aktif Cihaz"})]})})}),e.jsx(Y,{children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ra,{className:"text-green-600",size:24}),e.jsx("div",{className:"text-3xl text-green-600",children:d})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[a.paymentType==="monthly"?"AylÄ±k":"YÄ±llÄ±k"," Toplam"]})]})})}),e.jsx(Y,{className:g.length>0?"border-red-300 bg-red-50":"",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ue,{className:g.length>0?"text-red-600":"text-gray-400",size:24}),e.jsx("div",{className:`text-3xl ${g.length>0?"text-red-600":"text-gray-400"}`,children:g.length})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"GecikmiÅŸ Fatura"})]})})}),e.jsx(Y,{className:a.suspensionStartDate?"border-orange-300 bg-orange-50":"",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:a.suspensionStartDate?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"text-orange-600",size:24}),e.jsx("div",{className:"text-3xl text-orange-600",children:k})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"text-green-600",size:24}),e.jsx("div",{className:"text-3xl text-green-600",children:"âœ“"})]})}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:a.suspensionStartDate?`${k} gÃ¼n donduruldu`:"Hizmet Aktif"})]})})})]}),a.suspensionStartDate&&k>0&&e.jsx(Y,{className:"border-orange-300 bg-orange-50",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ue,{className:"text-orange-600 mt-0.5",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-orange-900",children:"âš ï¸ Hizmet Donduruldu"}),e.jsxs("p",{className:"text-sm text-orange-800 mt-2",children:["Bu mÃ¼ÅŸterinin hizmeti ",k," gÃ¼ndÃ¼r dondurulmuÅŸ durumda.",k>=30&&" Maksimum dondurma sÃ¼resine ulaÅŸÄ±ldÄ± - hizmet kapatÄ±lacak!"]}),k<30&&e.jsxs("p",{className:"text-sm text-orange-700 mt-1",children:["Kalan sÃ¼re: ",30-k," gÃ¼n"]}),e.jsxs("p",{className:"text-sm text-orange-700 mt-2",children:[e.jsx("strong",{children:"Sebep:"})," ",a.suspensionReason||"Ã–deme gecikmes i"]})]})]})})}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsx(be,{children:"âš™ï¸ Abonelik AyarlarÄ±"})}),e.jsx(V,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Ã–deme Åžekli"}),e.jsx(_e,{label:"Ã–deme Åžekli",options:H,value:a.paymentType,onChange:h=>{J({...i,serviceFeeSettings:{...a,paymentType:h}})},allLabel:"SeÃ§iniz",allValue:"",className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.paymentType==="monthly"?"Her ay fatura kesilir, cihaz sahiplenme tarihinden baÄŸÄ±msÄ±z tam ay Ã¼creti alÄ±nÄ±r":"Ä°lk yÄ±l kalan ay Ã¼zerinden, sonraki yÄ±llarda tam yÄ±l Ã¼creti alÄ±nÄ±r"})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Standart Ãœcret (Cihaz BaÅŸÄ±na/Ay)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{type:"number",step:"0.01",value:a.customFeePerDevice||a.standardFeePerDevice,onChange:h=>{J({...i,serviceFeeSettings:{...a,customFeePerDevice:parseFloat(h.target.value)}})},className:"flex-1"}),e.jsx("span",{className:"text-gray-600",children:"â‚¬"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["VarsayÄ±lan: ",a.standardFeePerDevice," â‚¬ (MÃ¼ÅŸteriye Ã¶zel Ã¼cret tanÄ±mlayabilirsiniz)"]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"SÃ¶zleÅŸme BaÅŸlangÄ±Ã§ Tarihi"}),e.jsx(ye,{type:"date",value:a.contractStartDate,onChange:h=>{J({...i,serviceFeeSettings:{...a,contractStartDate:h.target.value}})}})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{className:"bg-blue-50 border-blue-200",children:e.jsxs(V,{className:"pt-6",children:[e.jsx("h4",{className:"text-blue-900 mb-3",children:"ðŸ’¡ FaturalandÄ±rma KurallarÄ±"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"AylÄ±k Ã–deme:"})," Cihaz hangi gÃ¼n sahiplendirilirse sahiplensin, o ay iÃ§in tam Ã¼cret alÄ±nÄ±r."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"YÄ±llÄ±k Ã–deme:"})," Ä°lk katÄ±lÄ±mda yÄ±l sonuna kadar kalan aylar iÃ§in fatura kesilir. Sonraki yÄ±llarda tam yÄ±l bedeli alÄ±nÄ±r."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pasif Cihazlar:"})," Pasif olarak iÅŸaretlenen cihazlar iÃ§in Ã¼cret alÄ±nmaz."]})]})]})}),e.jsx(Y,{className:"bg-purple-50 border-purple-200",children:e.jsxs(V,{className:"pt-6",children:[e.jsx("h4",{className:"text-purple-900 mb-3",children:"â° Ã–deme Takip Sistemi"}),e.jsxs("div",{className:"space-y-2 text-sm text-purple-800",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"7 gÃ¼n Ã¶nce:"})," Ä°lk hatÄ±rlatma (SMS + Email)"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"3 gÃ¼n Ã¶nce:"})," Ä°kinci hatÄ±rlatma"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Son gÃ¼n:"})," Acil hatÄ±rlatma"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"15 gÃ¼n geÃ§ti:"})," Hizmet dondurma uyarÄ±sÄ±"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"30 gÃ¼n geÃ§ti:"})," Hizmet otomatik kapatÄ±lÄ±r"]})]})]})})]})]})})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(be,{children:"ðŸ“± Cihaz Abonelikleri"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Payter sayfasÄ±ndan otomatik yÃ¼klenen cihazlar ve Ã¼cretlendirme durumlarÄ±"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ne,{variant:"outline",className:"bg-blue-50",children:[re.length," Payter CihazÄ±"]}),e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:h=>{h.preventDefault(),h.stopPropagation();const o=new Set(a.deviceSubscriptions.map(_=>_.deviceId)),c=re.filter(_=>!o.has(_.d));if(c.length===0){f.info("TÃ¼m Payter cihazlarÄ± zaten mevcut");return}const Z=c.map(_=>({deviceId:_.id,deviceSerialNumber:_.serialNumber||"",deviceName:_.name||"",monthlyFee:a.customFeePerDevice||a.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending"}));J({...i,serviceFeeSettings:{...a,deviceSubscriptions:[...a.deviceSubscriptions,...Z]}}),f.success(`${Z.length} yeni cihaz eklendi`)},children:[e.jsx($e,{size:16,className:"mr-2"}),"Yeni CihazlarÄ± Senkronize Et"]})]})]})}),e.jsx(V,{children:(()=>{const h=re.map(o=>{const c=a.deviceSubscriptions.find(Z=>Z.deviceId===o.id);return c||{deviceId:o.id,deviceSerialNumber:o.serialNumber||"",deviceName:o.name||"",monthlyFee:a.customFeePerDevice||a.standardFeePerDevice,isActive:!0,activationDate:new Date().toISOString().split("T")[0],paymentStatus:"pending",_isNew:!0}});return h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"mx-auto text-gray-400 mb-3",size:48}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Payter sayfasÄ±nda cihaz bulunamadÄ±"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Ã–nce Payter sekmesinden domain eÅŸleÅŸtirmesi yapÄ±ldÄ±ÄŸÄ±ndan emin olun"})]}):e.jsxs(e.Fragment,{children:[i.id?e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("div",{className:"text-lg",children:"ðŸ’¡"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-900 mb-1",children:e.jsx("strong",{children:"Cihaz Durumu YÃ¶netimi:"})}),e.jsxs("p",{className:"text-blue-700 text-xs mb-2",children:["Her cihazÄ±n ",e.jsx("strong",{children:'"Durum"'})," sÃ¼tunundaki switch ile ",e.jsx("strong",{children:"Aktif/Pasif"})," durumunu deÄŸiÅŸtirebilirsiniz. Pasif cihazlar gelir raporlarÄ±na ve aidat hesaplamalarÄ±na ",e.jsx("strong",{children:"dahil edilmez"}),"."]}),h.some(o=>o._isNew)&&e.jsxs("p",{className:"text-yellow-700 text-xs bg-yellow-100 p-2 rounded border border-yellow-300",children:["âš ï¸ ",e.jsx("strong",{children:'"Yeni"'})," iÅŸaretli cihazlarÄ±n ayarlarÄ±nÄ± deÄŸiÅŸtirmek iÃ§in Ã¶nce ",e.jsx("strong",{children:'"Kaydet"'})," butonuyla kaydedin."]})]})]})}):e.jsx("div",{className:"mb-4 p-4 bg-red-50 border-2 border-red-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ue,{className:"text-red-600 flex-shrink-0",size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-900 mb-2",children:e.jsx("strong",{children:"Ã–nce MÃ¼ÅŸteriyi Kaydedin!"})}),e.jsxs("p",{className:"text-red-700 text-sm",children:["Cihaz abonelik ayarlarÄ±nÄ± yapabilmek iÃ§in Ã¶nce bu mÃ¼ÅŸteriyi kaydetmelisiniz. LÃ¼tfen ",e.jsx("strong",{children:'"Genel Bilgiler"'})," sekmesine dÃ¶nÃ¼n ve ",e.jsx("strong",{children:'"Kaydet"'})," butonuna tÄ±klayÄ±n."]})]})]})}),h.some(o=>o._isNew)&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"text-blue-600",size:20}),e.jsxs("span",{className:"text-sm",children:[e.jsx("strong",{children:h.filter(o=>o._isNew).length})," yeni cihaz tespit edildi"]})]}),e.jsxs(B,{type:"button",variant:"default",size:"sm",onClick:o=>{o.preventDefault(),o.stopPropagation();const c=h.filter(_=>_._isNew);if(c.length===0){f.info("Kaydedilecek yeni cihaz bulunamadÄ±");return}const Z=c.map(_=>({deviceId:_.deviceId,deviceSerialNumber:_.deviceSerialNumber,deviceName:_.deviceName,monthlyFee:_.monthlyFee,isActive:_.isActive,activationDate:_.activationDate,paymentStatus:_.paymentStatus}));J({...i,serviceFeeSettings:{...a,deviceSubscriptions:[...a.deviceSubscriptions,...Z]}}),f.success(`${c.length} cihaz toplu olarak kaydedildi`)},children:[e.jsx(He,{size:16,className:"mr-2"}),"TÃ¼m Yeni CihazlarÄ± Kaydet (",h.filter(o=>o._isNew).length,")"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"text-left py-3 px-3",children:"Seri No"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Cihaz AdÄ±"}),e.jsx("th",{className:"text-left py-3 px-3",children:"Sahiplenme"}),e.jsx("th",{className:"text-left py-3 px-3",children:"AylÄ±k Ãœcret"}),e.jsx("th",{className:"text-left py-3 px-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Durum",e.jsx("span",{className:"text-xs text-gray-500",children:"(Aktif/Pasif)"})]})}),e.jsx("th",{className:"text-left py-3 px-3",children:"Ã–deme"}),e.jsx("th",{className:"text-center py-3 px-3",children:"KayÄ±t"}),e.jsx("th",{className:"text-center py-3 px-3",children:"Aksiyon"})]})}),e.jsx("tbody",{children:h.map((o,c)=>{const Z=o._isNew,_=a.deviceSubscriptions.findIndex(Ae=>Ae.deviceId===o.deviceId);return e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${Z?"bg-yellow-50":""}`,children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[o.deviceSerialNumber||"-",Z&&e.jsx(ne,{variant:"outline",className:"bg-yellow-100 text-yellow-800 text-xs",children:"Yeni"})]})}),e.jsx("td",{className:"py-3 px-3",children:o.deviceName||"-"}),e.jsx("td",{className:"py-3 px-3",children:o.activationDate?new Date(o.activationDate).toLocaleDateString("tr-TR"):"-"}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{type:"number",step:"0.01",value:o.monthlyFee,onChange:Ae=>{if(Z){f.info('Ã–nce "Kaydet" butonuyla cihazÄ± ekleyin');return}if(_===-1){f.error("Cihaz bulunamadÄ±. LÃ¼tfen sayfayÄ± yenileyip tekrar deneyin.");return}const we=[...a.deviceSubscriptions];we[_].monthlyFee=parseFloat(Ae.target.value),J({...i,serviceFeeSettings:{...a,deviceSubscriptions:we}})},className:"w-20",disabled:Z}),e.jsx("span",{className:"text-gray-600",children:"â‚¬"})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ka,{checked:o.isActive,onCheckedChange:Ae=>{if(Z){f.info('Ã–nce "Kaydet" butonuyla cihazÄ± ekleyin');return}if(_===-1){f.error("Cihaz bulunamadÄ±. LÃ¼tfen sayfayÄ± yenileyip tekrar deneyin.");return}Ae?y(_):(z({deviceId:o.deviceId,deviceIndex:_}),De(!0))},disabled:Z}),e.jsx(ne,{variant:o.isActive?"default":"secondary",className:o.isActive?"bg-green-600":"bg-orange-500 text-white",children:o.isActive?"âœ“ Aktif":"â¸ Pasif"})]}),!o.isActive&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-orange-600",children:"Gelir raporlarÄ±na dahil edilmez"}),o.suspensionReason&&e.jsxs("span",{className:"text-xs text-gray-600",children:["ðŸš« Sebep: ",o.suspensionReason]}),o.suspensionDate&&e.jsxs("span",{className:"text-xs text-gray-500",children:["ðŸ“… ",new Date(o.suspensionDate).toLocaleDateString("tr-TR")]})]})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx(ne,{variant:o.paymentStatus==="paid"?"default":o.paymentStatus==="overdue"?"destructive":o.paymentStatus==="suspended"?"secondary":"outline",children:o.paymentStatus==="paid"?"Ã–dendi":o.paymentStatus==="pending"?"Bekliyor":o.paymentStatus==="overdue"?"Gecikti":o.paymentStatus==="suspended"?"Donduruldu":"Ä°ptal"})}),e.jsx("td",{className:"py-3 px-3 text-center",children:Z?e.jsxs(B,{type:"button",variant:"default",size:"sm",onClick:Ae=>{Ae.preventDefault(),Ae.stopPropagation();const we={deviceId:o.deviceId,deviceSerialNumber:o.deviceSerialNumber,deviceName:o.deviceName,monthlyFee:o.monthlyFee,isActive:o.isActive,activationDate:o.activationDate,paymentStatus:o.paymentStatus};J({...i,serviceFeeSettings:{...a,deviceSubscriptions:[...a.deviceSubscriptions,we]}}),f.success("Cihaz abonelik listesine eklendi")},children:[e.jsx($e,{size:14,className:"mr-1"}),"Kaydet"]}):e.jsx(ne,{variant:"outline",className:"bg-green-50 text-green-700",children:"KayÄ±tlÄ±"})}),e.jsx("td",{className:"py-3 px-3 text-center",children:!Z&&e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:Ae=>{Ae.preventDefault(),Ae.stopPropagation();const we=a.deviceSubscriptions.filter(Ke=>Ke.deviceId!==o.deviceId);J({...i,serviceFeeSettings:{...a,deviceSubscriptions:we}}),f.success("Cihaz abonelikten Ã§Ä±karÄ±ldÄ±")},children:e.jsx(Xe,{size:14})})})]},o.deviceId)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 bg-gray-50",children:[e.jsx("td",{colSpan:3,className:"py-3 px-3 text-right",children:e.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[e.jsxs("strong",{children:["Toplam (",h.filter(o=>o.isActive).length," aktif / ",h.filter(o=>!o.isActive).length," pasif):"]}),h.filter(o=>!o.isActive).length>0&&e.jsx("span",{className:"text-xs text-orange-600",children:"Pasif cihazlar gelir hesaplamalarÄ±na dahil edilmez"})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("strong",{className:"text-green-600",children:[h.filter(o=>o.isActive).reduce((o,c)=>o+c.monthlyFee,0).toFixed(2)," â‚¬"]})}),e.jsx("td",{colSpan:4})]})})]})})]})})()})]}),e.jsxs(Y,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(be,{children:"ðŸ“„ Fatura GeÃ§miÅŸi"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"KesilmiÅŸ ve bekleyen faturalar"})]}),e.jsxs(B,{type:"button",variant:"default",size:"sm",onClick:()=>{const h={id:`INV-${Date.now()}`,invoiceNumber:`FT-${new Date().getFullYear()}-${String(a.invoices.length+1).padStart(4,"0")}`,invoiceDate:new Date().toISOString().split("T")[0],period:new Date().toISOString().substring(0,7),deviceCount:r,totalAmount:d,status:"pending",dueDate:new Date(Date.now()+2592e6).toISOString().split("T")[0],devices:a.deviceSubscriptions.filter(o=>o.isActive)};J({...i,serviceFeeSettings:{...a,invoices:[h,...a.invoices]}}),f.success(`Fatura oluÅŸturuldu: ${h.invoiceNumber}`)},children:[e.jsx($e,{size:16,className:"mr-2"}),"Yeni Fatura OluÅŸtur"]})]})}),e.jsx(V,{children:a.invoices.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fa,{className:"mx-auto text-gray-400 mb-3",size:48}),e.jsx("p",{className:"text-gray-600 mb-2",children:"HenÃ¼z fatura oluÅŸturulmamÄ±ÅŸ"}),e.jsx("p",{className:"text-sm text-gray-500",children:'"Yeni Fatura OluÅŸtur" butonuna tÄ±klayarak ilk faturayÄ± kesin'})]}):e.jsx("div",{className:"space-y-3",children:a.invoices.map(h=>e.jsx("div",{className:`border rounded-lg p-4 ${h.status==="overdue"?"border-red-300 bg-red-50":h.status==="pending"?"border-yellow-300 bg-yellow-50":"border-green-300 bg-green-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{children:h.invoiceNumber}),e.jsx(ne,{variant:h.status==="paid"?"default":h.status==="overdue"?"destructive":"outline",children:h.status==="paid"?"Ã–dendi":h.status==="pending"?"Bekliyor":"Gecikti"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Fatura Tarihi:"}),e.jsx("p",{children:new Date(h.invoiceDate).toLocaleDateString("tr-TR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"DÃ¶nem:"}),e.jsx("p",{children:h.period})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cihaz SayÄ±sÄ±:"}),e.jsx("p",{children:h.deviceCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Tutar:"}),e.jsxs("p",{className:"text-green-600",children:[h.totalAmount.toFixed(2)," â‚¬"]})]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Son Ã–deme:"})," ",e.jsx("span",{className:new Date(h.dueDate)<new Date?"text-red-600":"",children:new Date(h.dueDate).toLocaleDateString("tr-TR")}),h.paymentDate&&e.jsxs(e.Fragment,{children:[" â€¢ ",e.jsxs("span",{className:"text-green-600",children:["Ã–dendi: ",new Date(h.paymentDate).toLocaleDateString("tr-TR")]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[h.status!=="paid"&&e.jsxs(B,{type:"button",variant:"default",size:"sm",onClick:()=>{const o=a.invoices.map(c=>c.id===h.id?{...c,status:"paid",paymentDate:new Date().toISOString().split("T")[0]}:c);J({...i,serviceFeeSettings:{...a,invoices:o}}),f.success("Fatura Ã¶dendi olarak iÅŸaretlendi")},children:[e.jsx(He,{size:14,className:"mr-1"}),"Ã–dendi"]}),e.jsxs(B,{type:"button",variant:"outline",size:"sm",children:[e.jsx(Fa,{size:14,className:"mr-1"}),"Ä°ndir"]})]})]})},h.id))})})]}),e.jsxs(Y,{children:[e.jsxs(fe,{children:[e.jsx(be,{children:"ðŸ”” HatÄ±rlatÄ±cÄ± GeÃ§miÅŸi"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"GÃ¶nderilen Ã¶deme hatÄ±rlatmalarÄ±"})]}),e.jsx(V,{children:a.reminders.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ba,{className:"mx-auto text-gray-400 mb-3",size:48}),e.jsx("p",{className:"text-gray-600 mb-2",children:"HenÃ¼z hatÄ±rlatÄ±cÄ± gÃ¶nderilmemiÅŸ"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sistem otomatik olarak Ã¶deme tarihinden Ã¶nce hatÄ±rlatÄ±cÄ± gÃ¶nderecek"})]}):e.jsx("div",{className:"space-y-2",children:a.reminders.map(h=>e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ba,{size:16,className:h.status==="sent"?"text-green-600":"text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:h.reminderType==="7days"?"7 GÃ¼n Ã–nce HatÄ±rlatma":h.reminderType==="3days"?"3 GÃ¼n Ã–nce HatÄ±rlatma":"Son GÃ¼n HatÄ±rlatma"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(h.sentDate).toLocaleDateString("tr-TR")," -",h.channel==="both"?" SMS + Email":h.channel==="email"?" Email":" SMS"]})]})]}),e.jsx(ne,{variant:h.status==="sent"?"default":"destructive",children:h.status==="sent"?"GÃ¶nderildi":"BaÅŸarÄ±sÄ±z"})]},h.id))})})]}),e.jsxs(Y,{className:"border-orange-300",children:[e.jsx(fe,{children:e.jsx(be,{children:"âš¡ Hizmet YÃ¶netimi"})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[a.suspensionStartDate?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(Je,{className:"text-orange-600",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-orange-900",children:"Hizmet Donduruldu"}),e.jsxs("p",{className:"text-sm text-orange-700 mt-1",children:["Dondurma tarihi: ",new Date(a.suspensionStartDate).toLocaleDateString("tr-TR")]}),e.jsxs("p",{className:"text-sm text-orange-700",children:["GeÃ§en sÃ¼re: ",k," gÃ¼n (Maksimum: 30 gÃ¼n)"]})]}),e.jsxs(B,{variant:"default",onClick:()=>{J({...i,serviceFeeSettings:{...a,suspensionStartDate:void 0,suspensionReason:void 0,isActive:!0}}),f.success("Hizmet yeniden aktifleÅŸtirildi")},children:[e.jsx(ws,{size:16,className:"mr-2"}),"Hizmeti AktifleÅŸtir"]})]})}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(He,{className:"text-green-600",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-green-900",children:"Hizmet Aktif"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"TÃ¼m cihazlar normal ÅŸekilde Ã§alÄ±ÅŸÄ±yor"})]}),e.jsxs(B,{variant:"destructive",onClick:()=>{const h=prompt("Dondurma sebebini girin:");h&&(J({...i,serviceFeeSettings:{...a,suspensionStartDate:new Date().toISOString().split("T")[0],suspensionReason:h,isActive:!1}}),f.warning("Hizmet donduruldu"))},children:[e.jsx(Je,{size:16,className:"mr-2"}),"Hizmeti Dondur"]})]})}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-blue-900 mb-2",children:"ðŸ“Œ Dondurma KurallarÄ±"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Ä°lk 15 gÃ¼n: Sadece hatÄ±rlatÄ±cÄ±lar gÃ¶nderilir, hizmet devam eder"}),e.jsx("li",{children:"15-30 gÃ¼n: Hizmet dondurulur, cihazlar pasif olur"}),e.jsx("li",{children:"30 gÃ¼n sonra: Hizmet tamamen kapatÄ±lÄ±r, cihazlar sistemden Ã§Ä±karÄ±lÄ±r"}),e.jsx("li",{children:"Dondurma sÃ¼resi iÃ§inde Ã¶deme yapÄ±lÄ±rsa hizmet hemen aktifleÅŸir"})]})]})]})})]})]})})()]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(B,{type:"button",variant:"outline",onClick:I,children:[e.jsx(us,{size:18,className:"mr-2"}),"Ä°ptal"]}),e.jsxs(B,{type:"submit",className:"flex items-center space-x-2",children:[e.jsx(Ia,{size:18}),e.jsx("span",{children:D?"Kaydet":"GÃ¼ncelle"})]})]})]})]}),e.jsx(la,{open:Ie,onOpenChange:De,children:e.jsxs(na,{className:"max-w-md",children:[e.jsxs(ta,{children:[e.jsx(ra,{children:"ðŸš« Cihaz PasifleÅŸtirme Sebebi"}),e.jsx(ca,{children:"CihazÄ± pasif hale getirmeden Ã¶nce sebebini belirtin"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"suspension-reason",children:"Dondurma Sebebi *"}),e.jsx(_e,{label:"Dondurma Sebebi",options:E,value:m,onChange:u,allLabel:"Sebep seÃ§in...",allValue:"",className:"w-full mt-2"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"suspension-notes",children:"Ek Notlar (Opsiyonel)"}),e.jsx(ma,{id:"suspension-notes",placeholder:"Ek aÃ§Ä±klama veya notlar...",value:F,onChange:a=>L(a.target.value),className:"mt-2",rows:3})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:e.jsx("p",{className:"text-sm text-blue-900",children:"ðŸ’¡ Bu bilgiler cihaz geÃ§miÅŸine kaydedilecektir"})}),E.length===0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded p-3",children:[e.jsxs("p",{className:"text-sm text-orange-900 mb-2",children:["âš ï¸ ",e.jsx("strong",{children:"Aktif dondurma sebebi yok!"})]}),e.jsxs("p",{className:"text-xs text-orange-800",children:["LÃ¼tfen ",e.jsx("strong",{children:"TanÄ±mlar â†’ Dondurma Sebepleri"})," bÃ¶lÃ¼mÃ¼nden mevcut sebepleri aktif edin veya yeni sebep ekleyin."]})]}),E.length>0&&se&&se.length>E.length&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded p-3",children:[e.jsxs("p",{className:"text-xs text-amber-900",children:["â„¹ï¸ ",e.jsxs("strong",{children:[E.length," aktif"]})," sebep gÃ¶steriliyor â€¢ ",e.jsxs("strong",{children:[se.length-E.length," pasif"]})," sebep gizli"]}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Pasif sebepleri aktif etmek iÃ§in ",e.jsx("strong",{children:"TanÄ±mlar â†’ Dondurma Sebepleri"})," sekmesine gidin."]})]})]}),e.jsxs(oa,{children:[e.jsx(B,{type:"button",variant:"outline",onClick:()=>{De(!1),z(null),u(""),L("")},children:"Ä°ptal"}),e.jsxs(B,{type:"button",variant:"destructive",onClick:ee,disabled:!m,children:[e.jsx(Je,{size:16,className:"mr-2"}),"Pasif Yap"]})]})]})})]})}function Hs({onImport:w,bankPFRecords:O=[]}){const[C,$]=p.useState(!1),[D,M]=p.useState(!1),[K,S]=p.useState(0),[q,ue]=p.useState(null),me=p.useRef(null),R=async W=>{var i;const Q=(i=W.target.files)==null?void 0:i[0];if(Q){M(!0),S(10),ue(null);try{const J=await Q.arrayBuffer();S(30);const pe=Ns(J),N=pe.SheetNames[0],Be=pe.Sheets[N];S(50);const ve=Te.sheet_to_json(Be);S(70);const ke=[],v=[],xe=[],ie={codes:new Set,taxNos:new Set,emails:new Set};let je=0,Se=0;console.log(`
ðŸ” Excel Ä°mport BaÅŸlÄ±yor...`),console.log(`ðŸ“Š Excel'de Toplam SatÄ±r: ${ve.length}`),console.log(`ðŸ“Š Toplam BankPF KayÄ±tlarÄ±: ${O.length}`),ve.forEach((z,m)=>{try{const u={};Object.keys(z).forEach(H=>{u[H.toLowerCase().trim()]=z[H]});const F=(u["banka/pf"]||"").toString().trim();let L=[],A=[],T=[];F&&F!=="-"&&!F.includes("BÄ°LGÄ°")&&!F.includes("(")&&F.split(",").map(E=>E.trim()).filter(E=>E.length>0).forEach(E=>{const ge=O.find(te=>te.firmaUnvan.toLowerCase()===E.toLowerCase());if(ge)L.push(ge.id),A.push(ge),je++,console.log(`  âœ… SatÄ±r ${m+2}: "${E}" eÅŸleÅŸti â†’ ${ge.firmaUnvan} (${ge.tip})`);else{const te=O.find(ce=>ce.firmaUnvan.toLowerCase().includes(E.toLowerCase())||E.toLowerCase().includes(ce.firmaUnvan.toLowerCase()));te?(L.push(te.id),A.push(te),je++,console.log(`  âš ï¸ SatÄ±r ${m+2}: "${E}" kÄ±smi eÅŸleÅŸti â†’ ${te.firmaUnvan} (${te.tip})`)):(T.push(E),Se++,console.warn(`  âŒ SatÄ±r ${m+2}: "${E}" bulunamadÄ±!`))}});let ae=[];A.length>0&&(console.log(`  ðŸ”— SatÄ±r ${m+2}: ${A.length} Banka/PF kaydÄ± iÃ§in kategori oluÅŸturuluyor...`),A.forEach(H=>{let E="",ge="";H.tip==="Banka"?(E=`bank-${H.id}`,ge="Banka"):H.tip==="EPK"?(E=`ok-epk-${H.id}`,ge="EPK"):H.tip==="Ã–K"?(E=`ok-ok-${H.id}`,ge="Ã–K"):(E=`bank-${H.id}`,ge="Banka");const te={id:`assignment-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,bankId:E,bankName:H.firmaUnvan,bankCode:H.kod||"",deviceIds:[],createdAt:new Date().toISOString()};ae.push(te),console.log(`    âž• ${ge} kategorisi oluÅŸturuldu: ${H.firmaUnvan} (ID: ${E})`)}));const b={id:Date.now().toString()+m,cariHesapKodu:(u["cari hesap kodu"]||u.kod||"").toString().trim(),sektor:(u.sektÃ¶r||u.sektor||"").toString().trim(),mcc:(u.mcc||"").toString().trim(),cariAdi:(u["cari adÄ±"]||u["cari adi"]||u.firma||"").toString().trim(),guncelMyPayterDomain:(u["gÃ¼ncel mypayter domain"]||u["guncel mypayter domain"]||u.domain||"").toString().trim(),vergiDairesi:(u["vergi dairesi"]||"").toString().trim(),vergiNo:(u["vergi no"]||u["vergi numarasÄ±"]||u["vergi numarasi"]||"").toString().trim(),adres:(u.adres||"").toString().trim(),ilce:(u.ilÃ§e||u.ilce||"").toString().trim(),postaKodu:(u["posta kodu"]||"").toString().trim(),email:(u.email||u["e-posta"]||u.mail||"").toString().trim(),yetkili:(u.yetkili||"").toString().trim(),tel:(u.tel||u.telefon||"").toString().trim(),durum:u.durum==="Pasif"?"Pasif":"Aktif",p6x:u.p6x?u.p6x.toString().trim():void 0,apollo:u.apollo?u.apollo.toString().trim():void 0,linkedBankPFIds:L.length>0?L:void 0,bankDeviceAssignments:ae.length>0?ae:void 0};if(!b.cariAdi||!b.cariHesapKodu){let H="Zorunlu alan eksik: ";b.cariAdi||(H+="[Cari AdÄ± boÅŸ] "),b.cariHesapKodu||(H+="[Cari Hesap Kodu boÅŸ] ");const E=`SatÄ±r ${m+2}: ${H}`;v.push(E),xe.push({row:m+2,reason:H,data:u}),console.warn(`âš ï¸ ${E}`),console.warn("   ðŸ“„ SatÄ±r Ä°Ã§eriÄŸi:",u);return}const P=b.cariHesapKodu.toLowerCase();if(ie.codes.has(P)){const H=`Cari Hesap Kodu tekrar ediyor: "${b.cariHesapKodu}"`,E=`SatÄ±r ${m+2}: ${H}`;v.push(E),xe.push({row:m+2,reason:H,data:u}),console.warn(`âš ï¸ ${E}`),console.warn("   ðŸ“„ SatÄ±r Ä°Ã§eriÄŸi:",u);return}if(ie.codes.add(P),b.vergiNo&&ie.taxNos.has(b.vergiNo)){const H=`Vergi No tekrar ediyor: "${b.vergiNo}"`,E=`SatÄ±r ${m+2}: ${H}`;v.push(E),xe.push({row:m+2,reason:H,data:u}),console.warn(`âš ï¸ ${E}`),console.warn("   ðŸ“„ SatÄ±r Ä°Ã§eriÄŸi:",u);return}if(b.vergiNo&&ie.taxNos.add(b.vergiNo),b.email&&ie.emails.has(b.email.toLowerCase())){const H=`Email tekrar ediyor: "${b.email}"`,E=`SatÄ±r ${m+2}: ${H}`;v.push(E),xe.push({row:m+2,reason:H,data:u}),console.warn(`âš ï¸ ${E}`),console.warn("   ðŸ“„ SatÄ±r Ä°Ã§eriÄŸi:",u),b.email="",console.warn(`   ðŸ’¡ Ã‡Ã¶zÃ¼m: "${b.cariAdi}" mÃ¼ÅŸterisi iÃ§in duplicate email temizlendi, kayÄ±t ekleniyor`)}else b.email&&ie.emails.add(b.email.toLowerCase());ke.push(b)}catch(u){const F=`SatÄ±r ${m+2}: ${u instanceof Error?u.message:"Bilinmeyen hata"}`;v.push(F),xe.push({row:m+2,reason:u instanceof Error?u.message:"Bilinmeyen hata",data:z}),console.error(`âŒ ${F}`),console.error("   ðŸ“„ SatÄ±r Ä°Ã§eriÄŸi:",z)}}),S(90),console.log(`
ðŸ“Š Excel Ä°mport Ã–zeti:`),console.log(`  ðŸ“ Excel'deki toplam satÄ±r: ${ve.length}`),console.log(`  âœ… BaÅŸarÄ±yla import edilen: ${ke.length}`),console.log(`  âŒ Hata/Atlanan satÄ±r: ${v.length}`),v.length>0&&(console.log(`
âš ï¸ Hata DetaylarÄ±:`),v.forEach(z=>console.log(`  â€¢ ${z}`)),console.log(`
ðŸ” DETAYLI HATA ANALÄ°ZÄ° (Excel'de aramak iÃ§in):`),xe.forEach((z,m)=>{console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`),console.log(`HATA ${m+1}/${xe.length} - Excel SatÄ±r ${z.row}`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log(`ðŸ”´ Sorun: ${z.reason}`),console.log(`
ðŸ“‹ SatÄ±rdaki Veriler:`),console.log(`   â€¢ Cari Hesap Kodu: "${z.data["cari hesap kodu"]||z.data.kod||"(BOÅž)"}"`),console.log(`   â€¢ Cari AdÄ±: "${z.data["cari adÄ±"]||z.data["cari adi"]||z.data.firma||"(BOÅž)"}"`),console.log(`   â€¢ Vergi No: "${z.data["vergi no"]||z.data["vergi numarasÄ±"]||"(BOÅž)"}"`),console.log(`   â€¢ Email: "${z.data.email||z.data["e-posta"]||z.data.mail||"(BOÅž)"}"`),console.log(`   â€¢ SektÃ¶r: "${z.data.sektÃ¶r||z.data.sektor||"(BOÅž)"}"`),console.log(`
ðŸ“„ TÃ¼m SÃ¼tunlar:`),Object.keys(z.data).forEach(u=>{console.log(`   â€¢ ${u}: "${z.data[u]}"`)}),console.log(`
ðŸ’¡ Excel'de Bulmak Ä°Ã§in: Excel'i aÃ§Ä±n, CTRL+F yapÄ±n ve yukarÄ±daki bilgilerden birini arayÄ±n`)}),console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`)),console.log(`
ðŸ“Š Banka/PF EÅŸleÅŸtirme ve Kategori OluÅŸturma Raporu:`),console.log(`  âœ… BaÅŸarÄ±lÄ± eÅŸleÅŸme: ${je}`),console.log(`  âŒ Bulunamayan: ${Se}`);const Ie=ke.filter(z=>z.linkedBankPFIds&&z.linkedBankPFIds.length>0),De=ke.filter(z=>z.bankDeviceAssignments&&z.bankDeviceAssignments.length>0);if(console.log(`  ðŸ“ˆ Banka/PF baÄŸlantÄ±sÄ± olan mÃ¼ÅŸteri: ${Ie.length}/${ke.length}`),console.log(`  ðŸ¦ Otomatik kategori oluÅŸturulan mÃ¼ÅŸteri: ${De.length}/${ke.length}`),De.length>0){const z={Banka:0,EPK:0,Ã–K:0};De.forEach(m=>{var u;(u=m.bankDeviceAssignments)==null||u.forEach(F=>{F.bankId.startsWith("bank-")?z.Banka++:F.bankId.startsWith("ok-epk-")?z.EPK++:F.bankId.startsWith("ok-ok-")&&z.Ã–K++})}),console.log("  ðŸ“Š Kategori DaÄŸÄ±lÄ±mÄ±:"),console.log(`    ðŸ¦ Banka: ${z.Banka}`),console.log(`    ðŸ’³ EPK: ${z.EPK}`),console.log(`    ðŸ”· Ã–K: ${z.Ã–K}`)}ke.length>0&&(w(ke),je>0&&setTimeout(()=>{f.success(`ðŸ”— Banka/PF Ä°ÅŸlemi TamamlandÄ±:
âœ… ${je} eÅŸleÅŸme bulundu
ðŸ¦ ${De.length} mÃ¼ÅŸteri iÃ§in kategori oluÅŸturuldu
${Se>0?`âš ï¸ ${Se} firma bulunamadÄ±`:""}`,{duration:7e3})},1e3));const Ee=v.length;ue({success:ke.length,failed:Ee,errors:v.slice(0,20),detailedErrors:xe}),S(100)}catch(J){ue({success:0,failed:1,errors:[`Dosya okuma hatasÄ±: ${J instanceof Error?J.message:"Bilinmeyen hata"}`],detailedErrors:[]})}finally{M(!1),me.current&&(me.current.value="")}}},he=()=>{$(!1),S(0),ue(null),M(!1)},se=()=>{const W=[{"Cari Hesap Kodu":"120.01.001",SEKTÃ–R:"Teknoloji",MCC:"5411","Cari AdÄ±":"ABC Teknoloji A.Åž.","GÃ¼ncel Mypayter Domain":"abc-teknoloji.mypayter.com","Cihaz Adedi":"(BÄ°LGÄ° - Domain eÅŸleÅŸtirme ile otomatik hesaplanÄ±r)","Banka/PF":"TÃ¼rkiye Ä°ÅŸ BankasÄ± A.Åž., Garanti BBVA",Yetkili:"Ahmet YÄ±lmaz",Tel:"0532 111 2233",Email:"ahmet@abcteknoloji.com","Vergi Dairesi":"Maslak","Vergi No":"1234567890",Adres:"Maslak Mahallesi, BÃ¼yÃ¼kdere Cad. No:123",Ä°lÃ§e:"SarÄ±yer","Posta Kodu":"34398",P6X:"P6X001",APOLLO:"APOLLO001",Durum:"Aktif"},{"Cari Hesap Kodu":"120.01.002",SEKTÃ–R:"Ä°nÅŸaat",MCC:"1520","Cari AdÄ±":"XYZ Ä°nÅŸaat Ltd. Åžti.","GÃ¼ncel Mypayter Domain":"xyz-insaat.mypayter.com","Cihaz Adedi":"(BÄ°LGÄ° - Domain eÅŸleÅŸtirme ile otomatik hesaplanÄ±r)","Banka/PF":"Akbank T.A.Åž.",Yetkili:"AyÅŸe Demir",Tel:"0533 444 5566",Email:"ayse@xyzinsaat.com","Vergi Dairesi":"Ã‡ankaya","Vergi No":"0987654321",Adres:"KÄ±zÄ±lay Mahallesi, AtatÃ¼rk BulvarÄ± No:45",Ä°lÃ§e:"Ã‡ankaya","Posta Kodu":"06420",P6X:"",APOLLO:"APOLLO002",Durum:"Pasif"}],Q=Te.json_to_sheet(W),i=Te.book_new();Te.book_append_sheet(i,Q,"MÃ¼ÅŸteriler"),Q["!cols"]=[{wch:18},{wch:15},{wch:8},{wch:25},{wch:30},{wch:45},{wch:45},{wch:20},{wch:15},{wch:25},{wch:15},{wch:12},{wch:40},{wch:15},{wch:12},{wch:10},{wch:10},{wch:10}],ha(i,"musteri-cari-listesi-sablon.xlsx")};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{onClick:()=>$(!0),variant:"outline",className:"flex items-center space-x-2",children:[e.jsx(Da,{size:18}),e.jsx("span",{children:"Excel'den YÃ¼kle"})]}),e.jsx(la,{open:C,onOpenChange:he,children:e.jsxs(na,{className:"max-w-2xl",children:[e.jsxs(ta,{children:[e.jsx(ra,{children:"Excel'den MÃ¼ÅŸteri Listesi YÃ¼kle"}),e.jsx(ca,{children:"MÃ¼ÅŸteri cari kartlarÄ±nÄ± Excel dosyasÄ±ndan toplu olarak yÃ¼kleyin."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Qe,{children:[e.jsx(es,{className:"h-4 w-4"}),e.jsxs(ea,{children:["Ã–rnek Excel ÅŸablonunu indirmek iÃ§in aÅŸaÄŸÄ±daki butona tÄ±klayÄ±n.",e.jsx(B,{variant:"link",onClick:se,className:"h-auto p-0 ml-2",children:"Åžablonu Ä°ndir"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm",children:e.jsx("strong",{children:"Excel FormatÄ± (SÃ¼tun BaÅŸlÄ±klarÄ±):"})}),e.jsxs("ul",{className:"text-sm space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Cari Hesap Kodu"})," (Zorunlu)"]}),e.jsx("li",{children:e.jsx("strong",{children:"SEKTÃ–R"})}),e.jsx("li",{children:e.jsx("strong",{children:"MCC"})}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cari AdÄ±"})," (Zorunlu)"]}),e.jsx("li",{children:e.jsx("strong",{children:"GÃ¼ncel Mypayter Domain"})}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cihaz Adedi"})," (BÄ°LGÄ° - Sistem tarafÄ±ndan hesaplanÄ±r)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Banka/PF"})," (BÄ°LGÄ° - Sistem tarafÄ±ndan hesaplanÄ±r)"]}),e.jsx("li",{children:e.jsx("strong",{children:"Yetkili"})}),e.jsx("li",{children:e.jsx("strong",{children:"Tel"})}),e.jsx("li",{children:e.jsx("strong",{children:"Email"})}),e.jsx("li",{children:e.jsx("strong",{children:"Vergi Dairesi"})}),e.jsx("li",{children:e.jsx("strong",{children:"Vergi No"})}),e.jsx("li",{children:e.jsx("strong",{children:"Adres"})}),e.jsx("li",{children:e.jsx("strong",{children:"Ä°lÃ§e"})}),e.jsx("li",{children:e.jsx("strong",{children:"Posta Kodu"})}),e.jsx("li",{children:e.jsx("strong",{children:"P6X"})}),e.jsx("li",{children:e.jsx("strong",{children:"APOLLO"})}),e.jsxs("li",{children:[e.jsx("strong",{children:"Durum"})," (Aktif veya Pasif - VarsayÄ±lan: Aktif)"]})]})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("input",{ref:me,type:"file",accept:".xlsx,.xls",onChange:R,className:"hidden",id:"excel-upload",disabled:D}),e.jsxs("label",{htmlFor:"excel-upload",className:`cursor-pointer ${D?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(Da,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"mb-2",children:"Excel dosyasÄ±nÄ± sÃ¼rÃ¼kleyin veya tÄ±klayarak seÃ§in"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Desteklenen formatlar: .xlsx, .xls"})]})]}),D&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Cs,{value:K}),e.jsxs("p",{className:"text-sm text-center text-gray-600",children:["Ä°ÅŸleniyor... ",K,"%"]})]}),q&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Qe,{className:q.failed>0?"bg-yellow-50 border-yellow-300":"bg-green-50 border-green-200",children:[q.failed>0?e.jsx(ia,{className:"h-4 w-4 text-yellow-600"}):e.jsx(He,{className:"h-4 w-4 text-green-600"}),e.jsx(ea,{className:q.failed>0?"text-yellow-800":"text-green-800",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:e.jsx("strong",{children:"Ä°mport Ã–zeti:"})}),e.jsxs("div",{children:["âœ… BaÅŸarÄ±lÄ±: ",q.success," kayÄ±t"]}),q.failed>0&&e.jsxs("div",{children:["âš ï¸ Hata/Atlanan: ",q.failed," satÄ±r"]}),q.failed>0&&e.jsxs("div",{className:"text-sm mt-2 text-yellow-700",children:["âš ï¸ Excel dosyanÄ±zdaki toplam ",q.success+q.failed," satÄ±rdan ",q.failed," tanesi hata nedeniyle atlandÄ±. LÃ¼tfen aÅŸaÄŸÄ±daki hata listesini kontrol ederek Excel'i dÃ¼zeltin."]})]})})]}),q.failed>0&&e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{variant:"destructive",children:[e.jsx(da,{className:"h-4 w-4"}),e.jsxs(ea,{children:[e.jsxs("strong",{children:["Hata DetaylarÄ± (",q.failed," satÄ±r):"]}),e.jsxs("ul",{className:"mt-2 ml-4 list-disc text-sm max-h-60 overflow-y-auto",children:[q.errors.map((W,Q)=>e.jsx("li",{children:W},Q)),q.failed>20&&e.jsxs("li",{className:"text-gray-500",children:["... ve ",q.failed-20," hata daha (Konsola bakÄ±nÄ±z)"]})]})]})]}),q.detailedErrors&&q.detailedErrors.length>0&&e.jsxs(Qe,{className:"bg-amber-50 border-amber-300",children:[e.jsx(ia,{className:"h-4 w-4 text-amber-600"}),e.jsxs(ea,{className:"text-amber-900",children:[e.jsx("strong",{className:"block mb-2",children:"ðŸ” Problemli SatÄ±rlarÄ± Excel'de Bulmak Ä°Ã§in:"}),e.jsx("div",{className:"space-y-3 text-sm max-h-96 overflow-y-auto",children:q.detailedErrors.map((W,Q)=>e.jsxs("div",{className:"border border-amber-200 bg-white p-3 rounded",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("strong",{className:"text-red-600",children:["Hata ",Q+1,"/",q.detailedErrors.length," - Excel SatÄ±r ",W.row]})}),e.jsxs("div",{className:"mb-2 text-red-700",children:["ðŸ”´ ",e.jsx("strong",{children:"Sorun:"})," ",W.reason]}),e.jsx("div",{className:"mb-2",children:e.jsx("strong",{children:"ðŸ“‹ Bu satÄ±rdaki veriler:"})}),e.jsxs("ul",{className:"ml-4 space-y-1 text-xs",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Cari Hesap Kodu:"})," ",e.jsx("code",{className:"bg-gray-100 px-1",children:W.data["cari hesap kodu"]||W.data.kod||"(BOÅž)"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cari AdÄ±:"})," ",e.jsx("code",{className:"bg-gray-100 px-1",children:W.data["cari adÄ±"]||W.data["cari adi"]||W.data.firma||"(BOÅž)"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vergi No:"})," ",e.jsx("code",{className:"bg-gray-100 px-1",children:W.data["vergi no"]||W.data["vergi numarasÄ±"]||"(BOÅž)"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Email:"})," ",e.jsx("code",{className:"bg-gray-100 px-1",children:W.data.email||W.data["e-posta"]||W.data.mail||"(BOÅž)"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"SektÃ¶r:"})," ",e.jsx("code",{className:"bg-gray-100 px-1",children:W.data.sektÃ¶r||W.data.sektor||"(BOÅž)"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-blue-700 bg-blue-50 p-2 rounded",children:["ðŸ’¡ ",e.jsx("strong",{children:"Excel'de bulmak iÃ§in:"})," Excel'i aÃ§Ä±n, ",e.jsx("kbd",{className:"bg-white border px-1",children:"Ctrl+F"})," tuÅŸlarÄ±na basÄ±n ve yukarÄ±daki deÄŸerlerden birini arayÄ±n (Ã¶rn: Cari AdÄ± veya Cari Hesap Kodu)"]})]},Q))}),e.jsxs("div",{className:"mt-3 text-xs text-amber-700 bg-amber-100 p-2 rounded",children:["ðŸ“Š ",e.jsx("strong",{children:"Konsol'da daha fazla detay:"}),' TarayÄ±cÄ± konsolunu aÃ§Ä±n (F12) ve "DETAYLI HATA ANALÄ°ZÄ°" bÃ¶lÃ¼mÃ¼nÃ¼ inceleyin. Orada tÃ¼m sÃ¼tunlarÄ± gÃ¶rebilirsiniz.']})]})]})]}),q.success===0&&q.failed>0&&e.jsxs(Qe,{variant:"destructive",children:[e.jsx(ia,{className:"h-4 w-4"}),e.jsx(ea,{children:"HiÃ§bir kayÄ±t yÃ¼klenemedi. LÃ¼tfen Excel formatÄ±nÄ± kontrol edin."})]})]})]}),e.jsx(oa,{children:e.jsx(B,{onClick:he,children:"Kapat"})})]})})]})}const ci=[],oi=Ua.memo(function({mccList:O=[],customers:C=[],onCustomersChange:$,payterProducts:D=[],bankPFRecords:M=[],onBankPFNavigate:K,banks:S=[],epkList:q=[],okList:ue=[],salesReps:me=[],suspensionReasons:R=[]}){const[he,se]=p.useState(null),[W,Q]=p.useState(!1),i=p.useCallback(m=>{se(m)},[]),J=(m,u)=>{if(C.find(L=>L.id!==u&&L.cariHesapKodu.toLowerCase()===m.cariHesapKodu.toLowerCase()))return`Bu Cari Hesap Kodu (${m.cariHesapKodu}) zaten kayÄ±tlÄ±!`;if(m.vergiNo&&m.vergiNo.trim()!==""){const L=C.find(A=>A.id!==u&&A.vergiNo&&A.vergiNo===m.vergiNo);if(L)return`Bu Vergi No (${m.vergiNo}) zaten kayÄ±tlÄ±! (${L.cariAdi})`}if(m.email&&m.email.trim()!==""){const L=C.find(A=>A.id!==u&&A.email&&A.email.toLowerCase()===m.email.toLowerCase());if(L)return`Bu Email (${m.email}) zaten kayÄ±tlÄ±! (${L.cariAdi})`}return null},pe=m=>{const u=C.map(F=>F.id===m.id?m:F);$==null||$(u)},N=(m,u)=>{const F=J(m,W?void 0:m.id);if(F){f.error(F);return}if(W){const L=[...C,{...m,id:Date.now().toString()}];$==null||$(L),Q(!1),f.success("MÃ¼ÅŸteri baÅŸarÄ±yla eklendi")}else{const L=C.map(A=>A.id===m.id?m:A);$==null||$(L),u!=null&&u.autoSave||(se(null),f.success("MÃ¼ÅŸteri baÅŸarÄ±yla gÃ¼ncellendi"))}},Be=m=>{console.log(`
ðŸ”„ CustomerModule - Import Ä°ÅŸlemi BaÅŸlÄ±yor...`),console.log(`ðŸ“Š Excel'den gelen kayÄ±t sayÄ±sÄ±: ${m.length}`),console.log(`ðŸ“Š Sistemdeki mevcut kayÄ±t sayÄ±sÄ±: ${C.length}`);const u=new Set,F=[];if(m.forEach((ae,b)=>{const P=ae.cariHesapKodu.toLowerCase();u.has(P)&&F.push(`SatÄ±r ${b+2}: Excel iÃ§inde tekrar eden Cari Hesap Kodu: ${ae.cariHesapKodu}`),u.add(P)}),F.length>0){f.error(`Excel dosyasÄ±nda ${F.length} adet duplicate kayÄ±t bulundu! LÃ¼tfen Excel'i dÃ¼zeltin.`,{duration:5e3}),console.error("âŒ Excel Ä°Ã§i Duplicate KayÄ±tlar:",F);return}const L=[],A=[];if(m.forEach(ae=>{const b=C.find(P=>P.cariHesapKodu.toLowerCase()===ae.cariHesapKodu.toLowerCase());b?A.push({imported:ae,existing:b}):L.push(ae)}),A.length===0){if(L.length>0){const ae=[...C,...L];$==null||$(ae),f.success(`âœ… ${L.length} yeni mÃ¼ÅŸteri baÅŸarÄ±yla eklendi
ðŸ“Š Toplam mÃ¼ÅŸteri sayÄ±sÄ±: ${ae.length}`)}else f.info("Eklenecek yeni kayÄ±t bulunamadÄ±");return}const T=`
ðŸ“Š Import Ã–zeti:
â€¢ ${L.length} adet yeni kayÄ±t
â€¢ ${A.length} adet mevcut kayÄ±t (duplicate)

Mevcut kayÄ±tlarÄ± gÃ¼ncellemek ister misiniz?

âœ… EVET = Mevcut kayÄ±tlar gÃ¼ncellenecek + Yeni kayÄ±tlar eklenecek
âŒ HAYIR = Sadece yeni kayÄ±tlar eklenecek (Mevcut kayÄ±tlar korunacak)
    `.trim();if(confirm(T)){const b=[...C.map(P=>{const H=A.find(E=>E.existing.id===P.id);return H?{...H.imported,id:P.id}:P}),...L];$==null||$(b),f.success(`âœ… Import tamamlandÄ±!
${A.length} kayÄ±t gÃ¼ncellendi
${L.length} yeni kayÄ±t eklendi`,{duration:5e3}),console.log("âœ… Import Ã–zeti:",{guncellenen:A.length,yeniEklenen:L.length,toplam:b.length})}else if(L.length>0){const ae=[...C,...L];$==null||$(ae),f.success(`âœ… ${L.length} yeni mÃ¼ÅŸteri eklendi
${A.length} mevcut kayÄ±t atlandÄ±`,{duration:5e3}),console.log("â„¹ï¸ Atlanan Kayitlar:",A.map(b=>b.existing.cariHesapKodu))}else f.info("Sadece mevcut kayÄ±tlar vardÄ± - HiÃ§bir deÄŸiÅŸiklik yapÄ±lmadÄ±")},ve=m=>{const u=C.filter(F=>F.id!==m);$==null||$(u),se(null),f.success("MÃ¼ÅŸteri baÅŸarÄ±yla silindi")},ke=()=>{Q(!0),se({id:"",cariHesapKodu:"",mcc:"",cariAdi:"",guncelMyPayterDomain:"",vergiDairesi:"",vergiNo:"",adres:"",ilce:"",postaKodu:"",email:"",yetkili:"",tel:"",durum:"Aktif"})};if(he||W)return e.jsx($s,{customer:he,onSave:N,onCancel:()=>{se(null),Q(!1)},onDelete:ve,isCreating:W,mccList:O,payterProducts:D,bankPFRecords:M,onBankPFNavigate:K,banks:S,epkList:q,okList:ue,salesReps:me,suspensionReasons:R,allCustomers:C,onNavigateToCustomer:i});const v=m=>m?m.trim().toUpperCase().replace(/\s+/g," ").replace(/Ä°/g,"I").replace(/I/g,"I").replace(/Ä±/g,"I").replace(/Åž/g,"S").replace(/ÅŸ/g,"S").replace(/Äž/g,"G").replace(/ÄŸ/g,"G").replace(/Ãœ/g,"U").replace(/Ã¼/g,"U").replace(/Ã–/g,"O").replace(/Ã¶/g,"O").replace(/Ã‡/g,"C").replace(/Ã§/g,"C").replace(/T\.C\.?\s*/g,"TC").replace(/A\.Åž\.?\s*/g,"AS").replace(/A\.S\.?\s*/g,"AS").replace(/LTD\.?\s*ÅžTÄ°\.?\s*/gi,"LTDSTI").replace(/LTD\.?\s*STI\.?\s*/gi,"LTDSTI").replace(/SAN\.?\s*VE\s*TÄ°C\.?\s*/gi,"SANVETIC").replace(/SAN\.?\s*VE\s*TIC\.?\s*/gi,"SANVETIC").replace(/Ä°TH\.?\s*Ä°HR\.?\s*/gi,"ITHIHR").replace(/ITH\.?\s*IHR\.?\s*/gi,"ITHIHR").replace(/Ä°NS\.?\s*/gi,"INS").replace(/INS\.?\s*/gi,"INS").replace(/GENEL\s*MÃœDÃœRLÃœÄžÃœ/gi,"GENELMUDURLUGU").replace(/GENEL\s*MUDURLUGU/gi,"GENELMUDURLUGU").replace(/[.,\-_()]/g,"").replace(/\s+/g,"").trim():"",xe=(m,u)=>{const F=m.length,L=u.length,A=[];for(let b=0;b<=F;b++)A[b]=[b];for(let b=0;b<=L;b++)A[0][b]=b;for(let b=1;b<=F;b++)for(let P=1;P<=L;P++)m[b-1]===u[P-1]?A[b][P]=A[b-1][P-1]:A[b][P]=Math.min(A[b-1][P-1]+1,A[b][P-1]+1,A[b-1][P]+1);const T=A[F][L],ae=Math.max(F,L);return ae===0?1:1-T/ae},ie=()=>{const m=document.createElement("input");m.type="file",m.accept=".xlsx,.xls",m.onchange=async u=>{var L;const F=(L=u.target.files)==null?void 0:L[0];if(F)try{const A=require("xlsx"),T=await F.arrayBuffer(),ae=A.read(T),b=ae.Sheets[ae.SheetNames[0]],P=A.utils.sheet_to_json(b);if(P.length===0){f.error("âŒ Excel dosyasÄ± boÅŸ!");return}const H=new Map;console.log("ðŸ“Š Excel verisi okunuyor...",{toplamSatÄ±r:P.length});let E=0,ge=0,te=0;P.forEach((G,ze)=>{var s,t;const Ne=(s=G["Cari AdÄ±"])==null?void 0:s.trim(),Me=(t=G["Ana Domain"])==null?void 0:t.trim();if(!Ne){E++;return}if(Ne.startsWith("X CARÄ° KAYDI OLMAYAN")||Ne.startsWith("X CARI KAYDI OLMAYAN")){te++;return}const l=[G["1.Alt"],G["2.Alt"],G["3.Alt"],G["4.Alt"],G["5.Alt"]].filter(Boolean).map(I=>I.trim());if(l.length===0&&!Me){ge++;return}const x=v(Ne);H.has(x)||(H.set(x,{originalName:Ne,anaDomain:Me||"",paths:[]}),console.log(`âœ… Yeni mÃ¼ÅŸteri tespit edildi: ${Ne} (key: ${x})`));const j=H.get(x);Me&&(j.anaDomain=Me),l.length>0&&(j.paths.push(l),console.log(`  ðŸ“ ${Ne} iÃ§in domain yolu: ${l.join(" â†’ ")}`))}),console.log("\\nðŸ“‹ Ä°Ã§e Aktarma Ã–zeti:"),console.log(`  âœ… Ä°ÅŸlenen satÄ±r: ${P.length}`),E>0&&console.log(`  â­ï¸  BoÅŸ satÄ±r atlandÄ±: ${E}`),te>0&&console.log(`  â­ï¸  Placeholder kayÄ±t atlandÄ±: ${te}`),ge>0&&console.log(`  â„¹ï¸  Domain bilgisi olmayan kayÄ±t: ${ge} (atlandÄ±)`),console.log(`
ðŸ“¦ Toplam ${H.size} farklÄ± mÃ¼ÅŸteri iÃ§in domain verisi bulundu`);const ce=new Map;C.forEach(G=>{const ze=v(G.cariAdi);ce.set(ze,G)});let Le=0,de=0;const U=[];console.log(`
ðŸ”„ MÃ¼ÅŸteri kayÄ±tlarÄ± gÃ¼ncelleniyor...
`);const Pe=new Map;H.forEach((G,ze)=>{const Ne=ce.get(ze);if(Ne){console.log(`ðŸ”¹ ${Ne.cariAdi} iÃ§in domain hiyerarÅŸisi oluÅŸturuluyor...`),console.log(`  ðŸ“ Excel'de: ${G.originalName}`),console.log(`  ðŸ“ Sistemde: ${Ne.cariAdi}`),console.log(`  ðŸ“ Normalize Key: ${ze}`),console.log(`  ðŸ“ Ana Domain: ${G.anaDomain||"(yok)"}`),console.log(`  ðŸ“Š Toplam ${G.paths.length} farklÄ± domain yolu`);const Me=je(G.paths);Le++,console.log(`  âœ… ${Ne.cariAdi} gÃ¼ncellendi (${Me.length} kÃ¶k domain)
`),Pe.set(Ne.id,{...Ne,guncelMyPayterDomain:G.anaDomain||Ne.guncelMyPayterDomain,domainHierarchy:Me})}else{if(console.warn(`âš ï¸ MÃ¼ÅŸteri bulunamadÄ±: ${G.originalName}`),console.warn(`   Excel'deki ORIJINAL: "${G.originalName}"`),console.warn(`   Excel'deki NORMALIZE KEY: "${ze}"`),console.warn("   Sistemdeki normalize keyler (ilk 10):"),Array.from(ce.keys()).slice(0,10).forEach((x,j)=>{const s=C.find(t=>v(t.cariAdi)===x);console.warn(`     ${j+1}. "${x}" (orijinal: "${(s==null?void 0:s.cariAdi)||"BULUNAMADI"}")`)}),de++,ze.includes("ZIRAAT")){console.warn(`   ðŸ” Excel'de "ZIRAAT" kelimesi var, sistemdeki "ZIRAAT" iÃ§eren mÃ¼ÅŸteriler:`);const x=C.filter(j=>v(j.cariAdi).includes("ZIRAAT"));x.length>0?x.forEach(j=>{console.warn(`     - Orijinal: "${j.cariAdi}"`),console.warn(`       Normalize: "${v(j.cariAdi)}"`)}):console.warn('     âŒ Sistemde hiÃ§ "ZIRAAT" iÃ§eren mÃ¼ÅŸteri yok!')}const Me=C.map(x=>({name:x.cariAdi,normalizedName:v(x.cariAdi),similarity:xe(ze,v(x.cariAdi))})).filter(x=>x.similarity>.3).sort((x,j)=>j.similarity-x.similarity).slice(0,5),l=Me.slice(0,3).map(x=>x.name);U.push({excel:G.originalName,suggestions:l}),Me.length>0?(console.warn("   En benzer 3 isim (benzerlik skoru ile):"),Me.slice(0,3).forEach(x=>{console.warn(`     - ${x.name} (skor: ${x.similarity.toFixed(2)}, normalize: ${x.normalizedName})`)})):console.warn("   HiÃ§ benzer isim bulunamadÄ± (eÅŸik: 0.3)")}});const re=C.map(G=>Pe.get(G.id)||G);if($==null||$(re),de>0){console.warn("âš ï¸ Sistemde bulunamayan mÃ¼ÅŸteriler:",U);const G=[];G.push(`âš ï¸ ${Le} mÃ¼ÅŸteri gÃ¼ncellendi`),G.push(""),G.push(`âŒ ${de} mÃ¼ÅŸteri bulunamadÄ±:`),G.push(""),U.slice(0,3).forEach(({excel:ze,suggestions:Ne})=>{G.push(`ðŸ“Œ Excel: "${ze}"`),Ne.length>0?G.push(`   ðŸ’¡ Benzer: ${Ne.slice(0,2).join(", ")}`):G.push("   âš ï¸ Sistemde benzer isim yok"),G.push("")}),de>3&&(G.push(`... ve ${de-3} mÃ¼ÅŸteri daha`),G.push("")),G.push("ðŸ’¡ Ä°pucu: Cari adlarÄ±nÄ± sistemdekiyle AYNI yazÄ±n"),G.push("(BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf ve boÅŸluklar Ã¶nemsiz)"),f.warning(G.join("\\n"),{duration:12e3})}else f.success(`âš ï¸ ${Le} mÃ¼ÅŸteri gÃ¼ncellendi

${de} mÃ¼ÅŸteri bulunamadÄ±:
${U.slice(0,5).join(", ")}${de>5?"...":""}`,{duration:8e3}),f.success(`âœ… Domain hiyerarÅŸisi baÅŸarÄ±yla yÃ¼klendi!

${Le} mÃ¼ÅŸteri gÃ¼ncellendi
${P.length} satÄ±r iÅŸlendi`,{duration:5e3});console.log("âœ… Domain import tamamlandÄ±:",{gÃ¼ncellenen:Le,bulunamayan:de,toplamSatÄ±r:P.length})}catch(A){console.error("âŒ Excel import hatasÄ±:",A),f.error(`âŒ Hata!
${A instanceof Error?A.message:"Bilinmeyen hata"}

LÃ¼tfen ÅŸablon dosyasÄ±nÄ± kullandÄ±ÄŸÄ±nÄ±zdan emin olun.`,{duration:8e3})}},m.click()},je=m=>{const u=[];let F=1;return console.log(`  ðŸŒ³ Domain aÄŸacÄ± oluÅŸturuluyor... (${m.length} farklÄ± yol)`),m.forEach((L,A)=>{let T=u,ae="";L.forEach((b,P)=>{if(!b)return;ae+=(P>0?" â†’ ":"")+b;let H=T.find(E=>E.name===b);H?console.log(`    â™»ï¸  Mevcut: ${"  ".repeat(P)}${b} (Seviye ${P+1})`):(H={id:`domain-${F++}`,name:b,children:[]},T.push(H),console.log(`    âœ¨ Yeni node: ${"  ".repeat(P)}${b} (Seviye ${P+1})`)),T=H.children}),console.log(`  ðŸ“ Yol ${A+1}: ${ae}`)}),console.log(`  âœ… Domain aÄŸacÄ± oluÅŸturuldu: ${u.length} kÃ¶k node
`),u},Se=m=>{if(!D||D.length===0)return 0;const u=[];m.guncelMyPayterDomain&&m.guncelMyPayterDomain.trim()&&u.push(m.guncelMyPayterDomain.trim().toLowerCase());const F=A=>{A.forEach(T=>{T.name&&T.name.trim()&&u.push(T.name.trim().toLowerCase()),T.children&&T.children.length>0&&F(T.children)})};return m.domainHierarchy&&m.domainHierarchy.length>0&&F(m.domainHierarchy),u.length===0?0:D.filter(A=>{if(!A.domain||!A.domain.trim())return!1;const T=A.domain.trim().toLowerCase();return u.includes(T)}).length},Ie=()=>{try{const m=require("xlsx"),u=[];C.length>0?C.forEach(P=>{const H=M.filter(E=>{if(P.linkedBankPFIds&&P.linkedBankPFIds.includes(E.id))return!0;const ge=P.cariAdi.trim().toLowerCase(),te=E.firmaUnvan.trim().toLowerCase();return ge===te});H.length>0?H.forEach(E=>{u.push({"Cari AdÄ±":P.cariAdi,"Ana Domain":P.guncelMyPayterDomain||"","Cihaz Adedi":Se(P),"1.Alt":"","2.Alt":"","3.Alt":"","4.Alt":"","5.Alt":"","Banka/PF Firma ÃœnvanÄ±":E.firmaUnvan,"Banka/PF ID":E.id,"Banka/PF Tipi":E.bankaOrPF,"Ã–K Tipi":E.odemeKurulusuTipi||"-",Durum:P.durum})}):u.push({"Cari AdÄ±":P.cariAdi,"Ana Domain":P.guncelMyPayterDomain||"","Cihaz Adedi":Se(P),"1.Alt":"","2.Alt":"","3.Alt":"","4.Alt":"","5.Alt":"","Banka/PF Firma ÃœnvanÄ±":"","Banka/PF ID":"","Banka/PF Tipi":"","Ã–K Tipi":"",Durum:P.durum})}):u.push({"Cari AdÄ±":"ABC Teknoloji A.Åž.","Ana Domain":"abc-teknoloji.mypayter.com","Cihaz Adedi":0,"1.Alt":"Ä°STANBUL","2.Alt":"","3.Alt":"","4.Alt":"","5.Alt":"","Banka/PF Firma ÃœnvanÄ±":"ABC Teknoloji A.Åž.","Banka/PF ID":"1","Banka/PF Tipi":"PF","Ã–K Tipi":"EPK",Durum:"Aktif"},{"Cari AdÄ±":"XYZ Ä°nÅŸaat Ltd. Åžti.","Ana Domain":"xyz-insaat.mypayter.com","Cihaz Adedi":0,"1.Alt":"","2.Alt":"","3.Alt":"","4.Alt":"","5.Alt":"","Banka/PF Firma ÃœnvanÄ±":"","Banka/PF ID":"","Banka/PF Tipi":"","Ã–K Tipi":"",Durum:"Aktif"});const F=m.utils.book_new(),L=m.utils.json_to_sheet(u);L["!cols"]=[{wch:30},{wch:30},{wch:12},{wch:18},{wch:18},{wch:18},{wch:18},{wch:18},{wch:35},{wch:15},{wch:12},{wch:10},{wch:10}],m.utils.book_append_sheet(F,L,"Banka-PF EÅŸleÅŸtirme");const A=[{ALAN:"ðŸ“‹ BANKA/PF EÅžLEÅžTÄ°RME ÅžABLONU",AÃ‡IKLAMA:""},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"ðŸŽ¯ AMAÃ‡",AÃ‡IKLAMA:"MÃ¼ÅŸteriler ile Banka/PF kayÄ±tlarÄ±nÄ± eÅŸleÅŸtirme + Domain bilgileri"},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"ðŸ“Š SÃœTUNLAR",AÃ‡IKLAMA:""},{ALAN:"Cari AdÄ±",AÃ‡IKLAMA:"MÃ¼ÅŸteri cari kartÄ± adÄ± (DEÄžÄ°ÅžTÄ°RMEYÄ°N)"},{ALAN:"Ana Domain",AÃ‡IKLAMA:"MÃ¼ÅŸterinin ana domain adresi (BÄ°LGÄ° AMAÃ‡LI)"},{ALAN:"Cihaz Adedi",AÃ‡IKLAMA:"Payter sekmesindeki toplam cihaz sayÄ±sÄ± (BÄ°LGÄ° AMAÃ‡LI)"},{ALAN:"1.Alt - 5.Alt",AÃ‡IKLAMA:"Domain hiyerarÅŸisi seviyeleri (BÄ°LGÄ° AMAÃ‡LI)"},{ALAN:"Banka/PF Firma ÃœnvanÄ±",AÃ‡IKLAMA:"Banka/PF modÃ¼lÃ¼ndeki firma Ã¼nvanÄ± (MANUEL GÄ°RÄ°N)"},{ALAN:"Banka/PF ID",AÃ‡IKLAMA:"Otomatik doldurulur (BÄ°LGÄ° AMAÃ‡LI)"},{ALAN:"Banka/PF Tipi",AÃ‡IKLAMA:"Banka veya PF (BÄ°LGÄ° AMAÃ‡LI)"},{ALAN:"Ã–K Tipi",AÃ‡IKLAMA:"EPK veya Ã–K (BÄ°LGÄ° AMAÃ‡LI)"},{ALAN:"Durum",AÃ‡IKLAMA:"MÃ¼ÅŸteri durumu (BÄ°LGÄ° AMAÃ‡LI)"},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"âœï¸ NASIL KULLANILIR",AÃ‡IKLAMA:""},{ALAN:"1ï¸âƒ£",AÃ‡IKLAMA:"Åžablonu indirin"},{ALAN:"2ï¸âƒ£",AÃ‡IKLAMA:'Her mÃ¼ÅŸteri iÃ§in "Banka/PF Firma ÃœnvanÄ±" sÃ¼tununu doldurun'},{ALAN:"3ï¸âƒ£",AÃ‡IKLAMA:"Firma Ã¼nvanÄ± Banka/PF modÃ¼lÃ¼ndeki kayÄ±tlarla AYNI olmalÄ±"},{ALAN:"4ï¸âƒ£",AÃ‡IKLAMA:'"Banka/PF YÃ¼kle" butonu ile dosyayÄ± yÃ¼kleyin'},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"ðŸ” OTOMATÄ°K EÅžLEÅžTÄ°RME",AÃ‡IKLAMA:""},{ALAN:"âœ“",AÃ‡IKLAMA:"Cari AdÄ± = Firma ÃœnvanÄ± ise otomatik eÅŸleÅŸir"},{ALAN:"âœ“",AÃ‡IKLAMA:"Manuel yÃ¼kleme ile farklÄ± eÅŸleÅŸtirmeler yapabilirsiniz"},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"âš ï¸ Ã–NEMLÄ°",AÃ‡IKLAMA:""},{ALAN:"â—",AÃ‡IKLAMA:"Cari AdÄ± sÃ¼tununu DEÄžÄ°ÅžTÄ°RMEYÄ°N"},{ALAN:"â—",AÃ‡IKLAMA:"Domain sÃ¼tunlarÄ± (Ana Domain, 1.Alt-5.Alt) sadece BÄ°LGÄ° AMAÃ‡LI"},{ALAN:"â—",AÃ‡IKLAMA:"Firma Ã¼nvanÄ±nÄ± Banka/PF modÃ¼lÃ¼nden kopyalayÄ±n"},{ALAN:"â—",AÃ‡IKLAMA:"BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf farkÄ± gÃ¶zetilmez"}],T=m.utils.json_to_sheet(A);T["!cols"]=[{wch:25},{wch:60}],m.utils.book_append_sheet(F,T,"KullanÄ±m KÄ±lavuzu");const ae=`banka-pf-eslestirme-${new Date().toISOString().split("T")[0]}.xlsx`;m.writeFile(F,ae);const b=u.filter(P=>P["Banka/PF Firma ÃœnvanÄ±"]).length;f.success(`âœ… Åžablon indirildi!\\n\\n${u.length} mÃ¼ÅŸteri\\n${b} eÅŸleÅŸme mevcut`,{duration:4e3})}catch(m){console.error("âŒ Banka/PF ÅŸablon oluÅŸturma hatasÄ±:",m),f.error("Åžablon oluÅŸturulamadÄ±! LÃ¼tfen tekrar deneyin.")}},De=()=>{const m=document.createElement("input");m.type="file",m.accept=".xlsx, .xls",m.onchange=async u=>{var L;const F=(L=u.target.files)==null?void 0:L[0];if(F)try{const A=require("xlsx"),T=await F.arrayBuffer(),ae=A.read(T),b=ae.Sheets[ae.SheetNames[0]],P=A.utils.sheet_to_json(b);if(P.length===0){f.error("âŒ Excel dosyasÄ± boÅŸ!");return}console.log("ðŸ“Š Banka/PF eÅŸleÅŸtirme verisi okunuyor...",{toplamSatÄ±r:P.length});const H=new Map;C.forEach(de=>{const U=v(de.cariAdi);H.set(U,de)});const E=new Map;M.forEach(de=>{const U=v(de.firmaUnvan);E.set(U,de)});let ge=0,te=[],ce=[];P.forEach((de,U)=>{var ee,y,X,oe,a,n,r,d;const Pe=(ee=de["Cari AdÄ±"])==null?void 0:ee.trim(),re=(y=de["Banka/PF Firma ÃœnvanÄ±"])==null?void 0:y.trim(),G=(X=de["Ana Domain"])==null?void 0:X.trim(),ze=(oe=de["1.Alt"])==null?void 0:oe.trim(),Ne=(a=de["2.Alt"])==null?void 0:a.trim(),Me=(n=de["3.Alt"])==null?void 0:n.trim(),l=(r=de["4.Alt"])==null?void 0:r.trim(),x=(d=de["5.Alt"])==null?void 0:d.trim();if(!Pe){console.warn(`âš ï¸ SatÄ±r ${U+2}: Cari AdÄ± boÅŸ, atlanÄ±yor`);return}if(!re){const g=v(Pe),k=H.get(g);k&&(k.linkedBankPFIds=[],ge++);return}const j=v(Pe),s=H.get(j);if(!s){te.push(Pe);return}const t=v(re),I=E.get(t);if(!I){ce.push(re);return}s.linkedBankPFIds||(s.linkedBankPFIds=[]),s.linkedBankPFIds.includes(I.id)||(s.linkedBankPFIds.push(I.id),ge++,console.log(`âœ… EÅŸleÅŸtirme: ${Pe} â†” ${re}`))}),$&&$([...C]);let Le=`âœ… Import tamamlandÄ±!\\n\\n${ge} eÅŸleÅŸtirme yapÄ±ldÄ±`;te.length>0&&(Le+=`\\n\\nâš ï¸ ${te.length} mÃ¼ÅŸteri bulunamadÄ±`),ce.length>0&&(Le+=`\\n\\nâš ï¸ ${ce.length} Banka/PF kaydÄ± bulunamadÄ±`),te.length>0||ce.length>0?(f.warning(Le,{duration:8e3}),te.length>0&&console.warn("âš ï¸ Bulunamayan mÃ¼ÅŸteriler:",te.slice(0,5).join(", ")),ce.length>0&&console.warn("âš ï¸ Bulunamayan Banka/PF kayÄ±tlarÄ±:",ce.slice(0,5).join(", "))):f.success(Le,{duration:5e3})}catch(A){console.error("âŒ Banka/PF import hatasÄ±:",A),f.error(`âŒ Hata!\\n${A instanceof Error?A.message:"Bilinmeyen hata"}`,{duration:6e3})}},m.click()},Ee=()=>{try{const m=require("xlsx"),u=[];C.length>0?C.forEach(b=>{b.domainHierarchy&&b.domainHierarchy.length>0?z(b.domainHierarchy,[],b).forEach(P=>{u.push(P)}):u.push({"Cari AdÄ±":b.cariAdi,"Ana Domain":b.guncelMyPayterDomain||"","Cihaz Adedi":Se(b),"1.Alt":"","2.Alt":"","3.Alt":"","4.Alt":"","5.Alt":""})}):u.push({"Cari AdÄ±":"MACGAL","Ana Domain":"macgal.mypayter.com","Cihaz Adedi":0,"1.Alt":"Ä°STANBUL","2.Alt":"Ä°STHASTANE","3.Alt":"MEDICALPARK","4.Alt":"FLORYA","5.Alt":""},{"Cari AdÄ±":"MACGAL","Ana Domain":"macgal.mypayter.com","Cihaz Adedi":0,"1.Alt":"ANKARA","2.Alt":"Ã‡ANKAYA","3.Alt":"","4.Alt":"","5.Alt":""},{"Cari AdÄ±":"","Ana Domain":"","Cihaz Adedi":0,"1.Alt":"","2.Alt":"","3.Alt":"","4.Alt":"","5.Alt":""});const F=m.utils.json_to_sheet(u);F["!cols"]=[{wch:25},{wch:30},{wch:12},{wch:18},{wch:18},{wch:18},{wch:18},{wch:18}];const L=m.utils.book_new();m.utils.book_append_sheet(L,F,"Domain HiyerarÅŸisi");const A=[{ALAN:"SÃœTUNLAR",AÃ‡IKLAMA:""},{ALAN:"Cari AdÄ±",AÃ‡IKLAMA:"MÃ¼ÅŸteri firma adÄ± (sistemde kayÄ±tlÄ± olmalÄ± - tam eÅŸleÅŸme gerekli)"},{ALAN:"Ana Domain",AÃ‡IKLAMA:"MÃ¼ÅŸterinin ana domain adresi (Ã¶rn: firma.mypayter.com)"},{ALAN:"Cihaz Adedi",AÃ‡IKLAMA:"Payter sekmesindeki toplam cihaz sayÄ±sÄ± (BÄ°LGÄ° AMAÃ‡LI - deÄŸiÅŸtirilemez)"},{ALAN:"1.Alt",AÃ‡IKLAMA:"Birinci seviye domain - KÃ¶k organizasyon (Ã¶rn: Ä°STANBUL, ANKARA)"},{ALAN:"2.Alt",AÃ‡IKLAMA:"Ä°kinci seviye domain - Alt organizasyon (Ã¶rn: Ä°STHASTANE, Ã‡ANKAYA)"},{ALAN:"3.Alt",AÃ‡IKLAMA:"ÃœÃ§Ã¼ncÃ¼ seviye domain - Daha detaylÄ± organizasyon"},{ALAN:"4.Alt",AÃ‡IKLAMA:"DÃ¶rdÃ¼ncÃ¼ seviye domain"},{ALAN:"5.Alt",AÃ‡IKLAMA:"BeÅŸinci seviye domain (maksimum derinlik)"},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"NASIL Ã‡ALIÅžIR?",AÃ‡IKLAMA:""},{ALAN:"ðŸ“ Her SatÄ±r",AÃ‡IKLAMA:"Bir domain hiyerarÅŸi yolunu temsil eder (1.Alt â†’ 2.Alt â†’ 3.Alt...)"},{ALAN:"ðŸ‘¥ AynÄ± MÃ¼ÅŸteri",AÃ‡IKLAMA:"Birden fazla satÄ±r olabilir (farklÄ± domain yollarÄ± iÃ§in)"},{ALAN:"ðŸ”„ BirleÅŸtirme",AÃ‡IKLAMA:"AynÄ± seviyedeki aynÄ± isimli domainler otomatik birleÅŸtirilir"},{ALAN:"âš ï¸ BoÅŸ SÃ¼tun",AÃ‡IKLAMA:"BoÅŸ sÃ¼tunlar gÃ¶z ardÄ± edilir (Ã¶rn: sadece 1.Alt ve 2.Alt dolu ise 3 seviye oluÅŸturulmaz)"},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"Ã–RNEK - MACGAL",AÃ‡IKLAMA:""},{ALAN:"SatÄ±r 1",AÃ‡IKLAMA:"MACGAL | macgal.com | Ä°STANBUL | Ä°STHASTANE | MEDICALPARK | FLORYA | (boÅŸ)"},{ALAN:"SatÄ±r 2",AÃ‡IKLAMA:"MACGAL | macgal.com | Ä°STANBUL | Ã‡ANKAYA | (boÅŸ) | (boÅŸ) | (boÅŸ)"},{ALAN:"SatÄ±r 3",AÃ‡IKLAMA:"MACGAL | macgal.com | ANKARA | (boÅŸ) | (boÅŸ) | (boÅŸ) | (boÅŸ)"},{ALAN:"",AÃ‡IKLAMA:""},{ALAN:"SONUÃ‡",AÃ‡IKLAMA:"Ä°STANBUL â†’ Ä°STHASTANE â†’ MEDICALPARK â†’ FLORYA"},{ALAN:"",AÃ‡IKLAMA:"Ä°STANBUL â†’ Ã‡ANKAYA"},{ALAN:"",AÃ‡IKLAMA:"ANKARA"},{ALAN:"",AÃ‡IKLAMA:"(Ä°STANBUL node'u otomatik birleÅŸtirildi ve 2 alt dalÄ± var)"}],T=m.utils.json_to_sheet(A);T["!cols"]=[{wch:15},{wch:60}],m.utils.book_append_sheet(L,T,"KullanÄ±m KÄ±lavuzu");const ae="domain-hiyerarsi-tum-musteriler.xlsx";m.writeFile(L,ae),f.success(`âœ… Åžablon indirildi: ${ae}`),console.log("âœ… Domain ÅŸablonu oluÅŸturuldu:",{mÃ¼ÅŸteriSayÄ±sÄ±:C.length,satÄ±rSayÄ±sÄ±:u.length})}catch(m){console.error("âŒ Åžablon oluÅŸturma hatasÄ±:",m),f.error("Åžablon oluÅŸturulamadÄ±! LÃ¼tfen tekrar deneyin.")}},z=(m,u,F)=>{const L=[];return m.forEach(A=>{const T=[...u,A.name],ae={"Cari AdÄ±":F.cariAdi,"Ana Domain":F.guncelMyPayterDomain||"","Cihaz Adedi":Se(F),"1.Alt":T[0]||"","2.Alt":T[1]||"","3.Alt":T[2]||"","4.Alt":T[3]||"","5.Alt":T[4]||""};A.children&&A.children.length>0?L.push(...z(A.children,T,F)):L.push(ae)}),L};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"MÃ¼ÅŸteri Cari Kart Listesi"}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"TÃ¼m cari bilgilerini gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-2 border-r pr-2 mr-2",children:[e.jsxs(B,{variant:"outline",size:"sm",onClick:Ie,className:"group relative",title:"MÃ¼ÅŸteri-Banka/PF eÅŸleÅŸtirme ÅŸablonunu indir",children:["ðŸ¦ðŸ“¥ Banka/PF Åžablon",e.jsx("span",{className:"absolute hidden group-hover:block bg-gray-900 text-white text-xs rounded px-2 py-1 -bottom-16 left-0 w-52 z-10",children:"Mevcut mÃ¼ÅŸteri-Banka/PF eÅŸleÅŸtirmelerini Excel'e aktar"})]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:De,className:"group relative",title:"Excel'den mÃ¼ÅŸteri-Banka/PF eÅŸleÅŸtirmelerini yÃ¼kle",children:["ðŸ¦ðŸ“¤ Banka/PF YÃ¼kle",e.jsx("span",{className:"absolute hidden group-hover:block bg-gray-900 text-white text-xs rounded px-2 py-1 -bottom-20 left-0 w-56 z-10",children:`Excel'deki "Cari AdÄ±" ve "Banka/PF Firma ÃœnvanÄ±" ile eÅŸleÅŸtirme`})]})]}),e.jsxs("div",{className:"flex gap-2 border-r pr-2 mr-2",children:[e.jsxs(B,{variant:"outline",size:"sm",onClick:Ee,className:"group relative",title:"TÃ¼m mÃ¼ÅŸterilerin mevcut domain hiyerarÅŸisini Excel'e aktar",children:["ðŸŒðŸ“¥ Domain Åžablon",e.jsx("span",{className:"absolute hidden group-hover:block bg-gray-900 text-white text-xs rounded px-2 py-1 -bottom-16 left-0 w-48 z-10",children:"Mevcut mÃ¼ÅŸteri domain verilerini Excel'e aktar"})]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:ie,className:"group relative",title:"Excel'den tÃ¼m mÃ¼ÅŸteriler iÃ§in domain hiyerarÅŸisini yÃ¼kle (Cari AdÄ± bazlÄ±)",children:["ðŸŒðŸ“¤ Domain YÃ¼kle",e.jsx("span",{className:"absolute hidden group-hover:block bg-gray-900 text-white text-xs rounded px-2 py-1 -bottom-20 left-0 w-56 z-10",children:`Excel'deki "Cari AdÄ±" sÃ¼tununa gÃ¶re her mÃ¼ÅŸteriye domain seviyeleri atanÄ±r`})]})]}),e.jsx(Hs,{onImport:Be,bankPFRecords:M}),e.jsxs(B,{onClick:ke,className:"flex items-center gap-2 shadow-md hover:shadow-lg transition-shadow",children:[e.jsx($e,{size:18}),e.jsx("span",{children:"Yeni Cari Kart"})]})]})]}),e.jsx(Ps,{customers:C,onSelectCustomer:se,onUpdateCustomer:pe,onUpdateCustomers:$,payterProducts:D,bankPFRecords:M,salesReps:me,banks:S,epkList:q,okList:ue})]})});export{oi as CustomerModule,ci as mockCustomers};
