import{c as va,r as T,j as e,C as w,a as re,b as le,d as K,af as ia,v as fe,w as Se,l as pe,a7 as da,y as te,H as Fe,J as De,K as X,M as u,t as ye,N as we,O as h,B as E,G as ja,ag as Ue,ah as Ta,E as Ca,S as oa,e as za,a2 as _e,a3 as Xe,a4 as Je,u as ta,F as fa,D as Pa,f as Aa,g as Sa,h as Fa,i as Da,L as wa,R as Ka,m as ma,n as xa,o as Ke,p as $e,ai as $a,I as Ia}from"./index-B0KDE8pz.js";import{a as ra,F as Me,C as ya}from"./FilterDropdown-bMbRwlaQ.js";import{S as Oa,a as Ma,b as Ba,c as La,d as Re}from"./select-B7kGhMx-.js";import{C as Be}from"./calculator-DiLoS-ef.js";import{D as ba}from"./dollar-sign-DoT4Nf7I.js";import{g as Ea,B as Ze,X as la,Y as na,f as Ha,P as Va,R as ua,C as ha,T as ga,L as pa,a as Ya,b as ea,c as aa}from"./LineChart-B1G-hv-I.js";import{C as Ua}from"./calendar-C6HWCdHQ.js";import{F as Ye,E as qe,a as Ve}from"./jspdf.plugin.autotable-CdshmCxa.js";import{a as Ga}from"./ColumnVisibilityDropdown-ByH42Kf_.js";import{utils as sa,writeFile as Wa}from"./xlsx-D_0l8YDs.js";import{A as Oe}from"./arrow-up-down-Bmlmjhnz.js";import{C as Na}from"./chevron-down-BiFBo6-a.js";import{R as _a,C as Xa,a as Ja}from"./index-DT2FB_rg.js";import{T as qa}from"./trending-down-CiL3vurg.js";import"./scroll-area-BWfeK-bJ.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=va("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var Qa=Ea({chartName:"BarChart",GraphicalChild:Ze,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:la},{axisType:"yAxis",AxisComp:na}],formatAxisMap:Ha});function Ra({bankPFRecords:I}){const[O,g]=T.useState("all"),[W,J]=T.useState("all"),[L,oe]=T.useState("all"),[ce,q]=T.useState(""),[_,G]=T.useState(""),[j,v]=T.useState(""),[Z,ee]=T.useState(""),[xe,z]=T.useState(""),[P,M]=T.useState(""),[t,n]=T.useState(""),[x,s]=T.useState(""),[a,c]=T.useState(""),[i,m]=T.useState("all"),[d,o]=T.useState(""),[r,y]=T.useState(""),b=T.useMemo(()=>I.flatMap(l=>(l.hakedisRecords||[]).map(N=>({...N,pfId:l.id,pfUnvan:l.firmaUnvan,pfTip:l.bankaOrPF==="PF"?l.odemeKurulusuTipi:"Banka"}))),[I]),A=T.useMemo(()=>b.filter(l=>{var N,B,be;if(O!=="all"&&l.pfId!==O||W!=="all"&&l.donem!==W||L!=="all"&&l.durum!==L||ce&&ce.trim()&&!((N=l.pfUnvan)!=null&&N.toLowerCase().includes(ce.toLowerCase()))||_&&_.trim()&&!((B=l.donem)!=null&&B.includes(_)))return!1;if(j&&j.trim()){const V=I.find(ue=>ue.id===l.pfId),D=(be=V==null?void 0:V.tabelaGroups)==null?void 0:be.find(ue=>ue.id===l.tabelaGroupId),Y=(D==null?void 0:D.name)||l.tabelaGroupAd;if(!(Y!=null&&Y.toLowerCase().includes(j.toLowerCase())))return!1}if(Z&&Z.trim()||xe&&xe.trim()){const V=l.totalIslemHacmi??0,D=Z&&Z.trim()?parseFloat(Z):-1/0,Y=xe&&xe.trim()?parseFloat(xe):1/0;if(!(isNaN(D)&&isNaN(Y))){if(!isNaN(D)&&V<D)return!1;if(!isNaN(Y)&&V>Y)return!1}}if(P&&P.trim()||t&&t.trim()){const V=l.totalPFPay??0,D=P&&P.trim()?parseFloat(P):-1/0,Y=t&&t.trim()?parseFloat(t):1/0;if(!(isNaN(D)&&isNaN(Y))){if(!isNaN(D)&&V<D)return!1;if(!isNaN(Y)&&V>Y)return!1}}if(x&&x.trim()||a&&a.trim()){const V=l.totalOxivoPay??0,D=x&&x.trim()?parseFloat(x):-1/0,Y=a&&a.trim()?parseFloat(a):1/0;if(!(isNaN(D)&&isNaN(Y))){if(!isNaN(D)&&V<D)return!1;if(!isNaN(Y)&&V>Y)return!1}}if(i!=="all"&&l.durum!==i)return!1;if(d&&d.trim()||r&&r.trim()){const V=new Date(l.olusturmaTarihi);if(d&&d.trim()){const D=new Date(d);if(D.setHours(0,0,0,0),V<D)return!1}if(r&&r.trim()){const D=new Date(r);if(D.setHours(23,59,59,999),V>D)return!1}}return!0}),[b,O,W,L,ce,_,j,Z,xe,P,t,x,a,i,d,r,I]),f=T.useMemo(()=>Array.from(new Set(b.map(l=>l.pfId))).map(l=>{const N=I.find(B=>B.id===l);return N?{id:N.id,unvan:N.firmaUnvan,tip:N.bankaOrPF==="PF"?N.odemeKurulusuTipi:"Banka"}:null}).filter(l=>l!==null),[b,I]),k=T.useMemo(()=>Array.from(new Set(b.map(l=>l.donem))).sort((l,N)=>N.localeCompare(l)),[b]),p=T.useMemo(()=>f.map(l=>({value:l.id,label:`${l.unvan} (${l.tip})`,count:b.filter(N=>N.pfId===l.id).length})),[f,b]),C=T.useMemo(()=>k.map(l=>({value:l,label:ge(l),count:b.filter(N=>N.donem===l).length})),[k,b]),H=T.useMemo(()=>[{value:"KesinleÅŸmiÅŸ",label:"KesinleÅŸmiÅŸ",count:b.filter(l=>l.durum==="KesinleÅŸmiÅŸ").length},{value:"Taslak",label:"Taslak",count:b.filter(l=>l.durum==="Taslak").length}],[b]),$=T.useMemo(()=>{const l=A,N=Q=>{var Ne;if(Q.totalPFPay!==void 0&&Q.totalOxivoPay!==void 0)return{kazanc:Q.totalPFPay+Q.totalOxivoPay,pfPayi:Q.totalPFPay,oxivoPayi:Q.totalOxivoPay};const U=I.find(R=>R.id===Q.pfId);if(!U||!U.tabelaRecords)return{kazanc:0,pfPayi:0,oxivoPayi:0};const se=(Ne=U.tabelaGroups)==null?void 0:Ne.find(R=>R.id===Q.tabelaGroupId),ve=U.tabelaRecords.filter(R=>{var ke;return((ke=se==null?void 0:se.recordIds)==null?void 0:ke.includes(R.id))||!1});let de=0,me=0,ze=0;return ve.forEach(R=>{var he;const ke=(R.komisyonOranlarÄ±||[]).filter(ne=>ne.aktif!==!1),ae=((he=R.gelirModeli)==null?void 0:he.ad)==="Sabit Komisyon";ke.forEach(ne=>{var je,Te,Pe;const Ce=`${R.id}-${ne.vade}`,ie=parseFloat(((je=Q.islemHacmiMap)==null?void 0:je[Ce])||"0");if(ie>0){let Ae=0;if(ae){const Ie=parseFloat(ne.oran||"0");Ae=ie*(Ie/100)}else{const Ie=parseFloat(ne.alisTL||"0"),He=parseFloat(ne.satisTL||"0"),Qe=ie*(Ie/100);Ae=ie*(He/100)-Qe}const Le=parseFloat(((Te=R.paylaÅŸÄ±mOranlarÄ±)==null?void 0:Te.kurulusOrani)||"0"),Ee=parseFloat(((Pe=R.paylaÅŸÄ±mOranlarÄ±)==null?void 0:Pe.oxivoOrani)||"0"),Ge=Ae*(Le/100),We=Ae*(Ee/100);de+=Ae,me+=Ge,ze+=We}})}),{kazanc:de,pfPayi:me,oxivoPayi:ze}};let B=0,be=0,V=0,D=0,Y=0,ue=0;return l.forEach(Q=>{const U=N(Q);B+=U.kazanc,be+=U.pfPayi,V+=U.oxivoPayi,Q.totalIslemHacmi!==void 0?D+=Q.totalIslemHacmi:Object.values(Q.islemHacmiMap||{}).forEach(se=>{D+=parseFloat(se||"0")}),Q.durum==="KesinleÅŸmiÅŸ"?Y++:ue++}),{totalHakedisSayisi:l.length,totalKazanc:B,totalPFPayi:be,totalOxivoPayi:V,totalIslemHacmi:D,kesinlesmisSayi:Y,taslakSayi:ue,avgKazanc:l.length>0?B/l.length:0}},[A,I]),F=T.useMemo(()=>{const l=new Map;return A.forEach(N=>{const B=I.find(D=>D.id===N.pfId);if(!B)return;const V=(D=>{var ve;if(!B.tabelaRecords)return{kazanc:0,pfPayi:0,oxivoPayi:0};const Y=(ve=B.tabelaGroups)==null?void 0:ve.find(de=>de.id===D.tabelaGroupId),ue=B.tabelaRecords.filter(de=>{var me;return((me=Y==null?void 0:Y.recordIds)==null?void 0:me.includes(de.id))||!1});let Q=0,U=0,se=0;return ue.forEach(de=>{var Ne;const me=(de.komisyonOranlarÄ±||[]).filter(R=>R.aktif!==!1),ze=((Ne=de.gelirModeli)==null?void 0:Ne.ad)==="Sabit Komisyon";me.forEach(R=>{var he,ne,Ce;const ke=`${de.id}-${R.vade}`,ae=parseFloat(((he=D.islemHacmiMap)==null?void 0:he[ke])||"0");if(ae>0){let ie=0;if(ze){const Pe=parseFloat(R.oran||"0");ie=ae*(Pe/100)}else{const Pe=parseFloat(R.alisTL||"0"),Ae=parseFloat(R.satisTL||"0"),Le=ae*(Pe/100);ie=ae*(Ae/100)-Le}const je=parseFloat(((ne=de.paylaÅŸÄ±mOranlarÄ±)==null?void 0:ne.kurulusOrani)||"0"),Te=parseFloat(((Ce=de.paylaÅŸÄ±mOranlarÄ±)==null?void 0:Ce.oxivoOrani)||"0");Q+=ie,U+=ie*(je/100),se+=ie*(Te/100)}})}),{kazanc:Q,pfPayi:U,oxivoPayi:se}})(N);if(l.has(N.pfId)){const D=l.get(N.pfId);l.set(N.pfId,{unvan:D.unvan,kazanc:D.kazanc+V.kazanc,pfPayi:D.pfPayi+V.pfPayi,oxivoPayi:D.oxivoPayi+V.oxivoPayi})}else l.set(N.pfId,{unvan:B.firmaUnvan,kazanc:V.kazanc,pfPayi:V.pfPayi,oxivoPayi:V.oxivoPayi})}),Array.from(l.values()).sort((N,B)=>B.kazanc-N.kazanc)},[A,I]),S=T.useMemo(()=>{const l=new Map;return A.forEach(N=>{var Q;const B=I.find(U=>U.id===N.pfId);if(!B||!B.tabelaRecords)return;const be=(Q=B.tabelaGroups)==null?void 0:Q.find(U=>U.id===N.tabelaGroupId),V=B.tabelaRecords.filter(U=>{var se;return((se=be==null?void 0:be.recordIds)==null?void 0:se.includes(U.id))||!1});let D=0,Y=0,ue=0;if(V.forEach(U=>{var de;const se=(U.komisyonOranlarÄ±||[]).filter(me=>me.aktif!==!1),ve=((de=U.gelirModeli)==null?void 0:de.ad)==="Sabit Komisyon";se.forEach(me=>{var R,ke,ae;const ze=`${U.id}-${me.vade}`,Ne=parseFloat(((R=N.islemHacmiMap)==null?void 0:R[ze])||"0");if(Ne>0){let he=0;if(ve){const ie=parseFloat(me.oran||"0");he=Ne*(ie/100)}else{const ie=parseFloat(me.alisTL||"0"),je=parseFloat(me.satisTL||"0"),Te=Ne*(ie/100);he=Ne*(je/100)-Te}const ne=parseFloat(((ke=U.paylaÅŸÄ±mOranlarÄ±)==null?void 0:ke.kurulusOrani)||"0"),Ce=parseFloat(((ae=U.paylaÅŸÄ±mOranlarÄ±)==null?void 0:ae.oxivoOrani)||"0");D+=he,Y+=he*(ne/100),ue+=he*(Ce/100)}})}),l.has(N.donem)){const U=l.get(N.donem);l.set(N.donem,{kazanc:U.kazanc+D,pfPayi:U.pfPayi+Y,oxivoPayi:U.oxivoPayi+ue})}else l.set(N.donem,{kazanc:D,pfPayi:Y,oxivoPayi:ue})}),Array.from(l.entries()).map(([N,B])=>({donem:N,...B})).sort((N,B)=>N.donem.localeCompare(B.donem))},[A,I]),ge=l=>{const[N,B]=l.split("-");return`${["Ocak","Åžubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"][parseInt(B)-1]} ${N}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(ra,{size:20}),"Filtreler"]})}),e.jsx(K,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Me,{label:"Ã–deme KuruluÅŸu",options:p,value:O,onChange:g,allLabel:"TÃ¼m KuruluÅŸlar",showCount:!0}),e.jsx(Me,{label:"DÃ¶nem",options:C,value:W,onChange:J,allLabel:"TÃ¼m DÃ¶nemler",showCount:!0}),e.jsx(Me,{label:"Durum",options:H,value:L,onChange:oe,allLabel:"TÃ¼m Durumlar",showCount:!0})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(w,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx(re,{className:"pb-2",children:e.jsxs(le,{className:"text-sm flex items-center gap-2",children:[e.jsx(Be,{size:16}),"Toplam HakediÅŸ"]})}),e.jsxs(K,{children:[e.jsx("div",{className:"text-2xl text-blue-900",children:$.totalHakedisSayisi}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:[$.kesinlesmisSayi," kesinleÅŸmiÅŸ, ",$.taslakSayi," taslak"]})]})]}),e.jsxs(w,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx(re,{className:"pb-2",children:e.jsxs(le,{className:"text-sm flex items-center gap-2",children:[e.jsx(ia,{size:16}),"Toplam Ä°ÅŸlem Hacmi"]})}),e.jsxs(K,{children:[e.jsxs("div",{className:"text-2xl text-green-900",children:[$.totalIslemHacmi.toLocaleString("tr-TR",{minimumFractionDigits:2})," â‚º"]}),e.jsxs("div",{className:"text-xs text-green-700 mt-1",children:["Ort: ",($.totalHakedisSayisi>0?$.totalIslemHacmi/$.totalHakedisSayisi:0).toLocaleString("tr-TR",{minimumFractionDigits:2})," â‚º"]})]})]}),e.jsxs(w,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(re,{className:"pb-2",children:e.jsxs(le,{className:"text-sm flex items-center gap-2",children:[e.jsx(fe,{size:16}),"PF PayÄ±"]})}),e.jsxs(K,{children:[e.jsxs("div",{className:"text-2xl text-purple-900",children:[$.totalPFPayi.toLocaleString("tr-TR",{minimumFractionDigits:2})," â‚º"]}),e.jsxs("div",{className:"text-xs text-purple-700 mt-1",children:["%",$.totalKazanc>0?($.totalPFPayi/$.totalKazanc*100).toFixed(1):0," paylaÅŸÄ±m"]})]})]}),e.jsxs(w,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(re,{className:"pb-2",children:e.jsxs(le,{className:"text-sm flex items-center gap-2",children:[e.jsx(ba,{size:16}),"OXÄ°VO PayÄ±"]})}),e.jsxs(K,{children:[e.jsxs("div",{className:"text-2xl text-indigo-900",children:[$.totalOxivoPayi.toLocaleString("tr-TR",{minimumFractionDigits:2})," â‚º"]}),e.jsxs("div",{className:"text-xs text-indigo-700 mt-1",children:["%",$.totalKazanc>0?($.totalOxivoPayi/$.totalKazanc*100).toFixed(1):0," paylaÅŸÄ±m"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(re,{children:[e.jsx(le,{className:"text-sm",children:"PF BazÄ±nda KazanÃ§ DaÄŸÄ±lÄ±mÄ±"}),e.jsx(Se,{children:"Her Ã¶deme kuruluÅŸunun toplam kazancÄ±"})]}),e.jsx(K,{children:F.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Va,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Veri bulunmuyor"})]}):e.jsx(ua,{width:"100%",height:300,children:e.jsxs(Qa,{data:F,children:[e.jsx(ha,{strokeDasharray:"3 3"}),e.jsx(la,{dataKey:"unvan",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(na,{fontSize:12}),e.jsx(ga,{formatter:l=>l.toLocaleString("tr-TR",{minimumFractionDigits:2})+" â‚º"}),e.jsx(pa,{}),e.jsx(Ze,{dataKey:"kazanc",fill:"#10b981",name:"Toplam KazanÃ§"}),e.jsx(Ze,{dataKey:"pfPayi",fill:"#8b5cf6",name:"PF PayÄ±"}),e.jsx(Ze,{dataKey:"oxivoPayi",fill:"#3b82f6",name:"OXÄ°VO PayÄ±"})]})})})]}),e.jsxs(w,{children:[e.jsxs(re,{children:[e.jsx(le,{className:"text-sm",children:"DÃ¶nem BazÄ±nda Trend"}),e.jsx(Se,{children:"AylÄ±k kazanÃ§ geliÅŸimi"})]}),e.jsx(K,{children:S.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ua,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Veri bulunmuyor"})]}):e.jsx(ua,{width:"100%",height:300,children:e.jsxs(Ya,{data:S,children:[e.jsx(ha,{strokeDasharray:"3 3"}),e.jsx(la,{dataKey:"donem",tickFormatter:ge,fontSize:12}),e.jsx(na,{fontSize:12}),e.jsx(ga,{formatter:l=>l.toLocaleString("tr-TR",{minimumFractionDigits:2})+" â‚º",labelFormatter:l=>ge(l)}),e.jsx(pa,{}),e.jsx(ea,{type:"monotone",dataKey:"kazanc",stroke:"#10b981",name:"Toplam KazanÃ§",strokeWidth:2}),e.jsx(ea,{type:"monotone",dataKey:"pfPayi",stroke:"#8b5cf6",name:"PF PayÄ±",strokeWidth:2}),e.jsx(ea,{type:"monotone",dataKey:"oxivoPayi",stroke:"#3b82f6",name:"OXÄ°VO PayÄ±",strokeWidth:2})]})})})]})]}),e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(le,{children:"HakediÅŸ Detay Tablosu"}),e.jsxs(Se,{children:[A.length," kayÄ±t gÃ¶steriliyor",b.length!==A.length&&e.jsxs("span",{className:"text-blue-600",children:[" (toplam ",b.length," kayÄ±ttan)"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(pe,{variant:"outline",size:"sm",onClick:()=>{q(""),G(""),v(""),ee(""),z(""),M(""),n(""),s(""),c(""),m("all"),o(""),y(""),te.success("Tablo filtreleri temizlendi")},children:[e.jsx(da,{size:16,className:"mr-2"}),"Filtreleri Temizle"]}),e.jsxs(pe,{variant:"outline",size:"sm",onClick:()=>{te.info("Excel export Ã¶zelliÄŸi yakÄ±nda eklenecek")},children:[e.jsx(Ye,{size:16,className:"mr-2"}),"Excel Ä°ndir"]})]})]})}),e.jsxs(K,{children:[(()=>{const l=[ce&&ce.trim(),_&&_.trim(),j&&j.trim(),Z&&Z.trim(),xe&&xe.trim(),P&&P.trim(),t&&t.trim(),x&&x.trim(),a&&a.trim(),i!=="all",d&&d.trim(),r&&r.trim()].filter(Boolean).length;return l>0?e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ra,{size:16,className:"text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-700",children:[l," tablo filtresi aktif"]})]}),e.jsxs(pe,{variant:"ghost",size:"sm",className:"h-7 text-xs text-blue-700 hover:text-blue-900 hover:bg-blue-100",onClick:()=>{q(""),G(""),v(""),ee(""),z(""),M(""),n(""),s(""),c(""),m("all"),o(""),y("")},children:[e.jsx(da,{size:14,className:"mr-1"}),"Temizle"]})]}):null})(),A.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Be,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Filtrelere uygun hakediÅŸ kaydÄ± bulunmuyor"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsxs(De,{children:[e.jsxs(X,{children:[e.jsx(u,{children:"PF"}),e.jsx(u,{children:"DÃ¶nem"}),e.jsx(u,{children:"TABELA Grubu"}),e.jsx(u,{className:"text-right",children:"Toplam Ä°ÅŸlem Hacmi"}),e.jsx(u,{className:"text-right",children:"Toplam PF PayÄ±"}),e.jsx(u,{className:"text-right",children:"Toplam OXÄ°VO PayÄ±"}),e.jsx(u,{children:"Durum"}),e.jsx(u,{children:"OluÅŸturma"})]}),e.jsxs(X,{className:"bg-gray-50 border-b-2",children:[e.jsx(u,{className:"p-2",children:e.jsx(ye,{id:"hakedis-pf-filter",placeholder:"ðŸ” PF ara...",value:ce,onChange:l=>q(l.target.value),className:"h-8 text-xs"})}),e.jsx(u,{className:"p-2",children:e.jsx(ye,{id:"hakedis-donem-filter",placeholder:"ðŸ“… 2024-01...",value:_,onChange:l=>G(l.target.value),className:"h-8 text-xs"})}),e.jsx(u,{className:"p-2",children:e.jsx(ye,{id:"hakedis-grup-filter",placeholder:"ðŸ” Grup ara...",value:j,onChange:l=>v(l.target.value),className:"h-8 text-xs"})}),e.jsx(u,{className:"p-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ye,{type:"number",placeholder:"Min",value:Z,onChange:l=>ee(l.target.value),className:"h-8 text-xs w-1/2"}),e.jsx(ye,{type:"number",placeholder:"Max",value:xe,onChange:l=>z(l.target.value),className:"h-8 text-xs w-1/2"})]})}),e.jsx(u,{className:"p-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ye,{type:"number",placeholder:"Min",value:P,onChange:l=>M(l.target.value),className:"h-8 text-xs w-1/2"}),e.jsx(ye,{type:"number",placeholder:"Max",value:t,onChange:l=>n(l.target.value),className:"h-8 text-xs w-1/2"})]})}),e.jsx(u,{className:"p-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ye,{type:"number",placeholder:"Min",value:x,onChange:l=>s(l.target.value),className:"h-8 text-xs w-1/2"}),e.jsx(ye,{type:"number",placeholder:"Max",value:a,onChange:l=>c(l.target.value),className:"h-8 text-xs w-1/2"})]})}),e.jsx(u,{className:"p-2",children:e.jsxs(Oa,{value:i,onValueChange:m,children:[e.jsx(Ma,{className:"h-8 text-xs",children:e.jsx(Ba,{})}),e.jsxs(La,{children:[e.jsx(Re,{value:"all",children:"TÃ¼mÃ¼"}),e.jsx(Re,{value:"KesinleÅŸmiÅŸ",children:"KesinleÅŸmiÅŸ"}),e.jsx(Re,{value:"Taslak",children:"Taslak"})]})]})}),e.jsx(u,{className:"p-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ye,{type:"date",value:d,onChange:l=>o(l.target.value),className:"h-8 text-xs w-1/2",placeholder:"BaÅŸlangÄ±Ã§"}),e.jsx(ye,{type:"date",value:r,onChange:l=>y(l.target.value),className:"h-8 text-xs w-1/2",placeholder:"BitiÅŸ"})]})})]})]}),e.jsx(we,{children:A.map(l=>{var Q,U;const N=I.find(se=>se.id===l.pfId),B=(Q=N==null?void 0:N.tabelaGroups)==null?void 0:Q.find(se=>se.id===l.tabelaGroupId),be=(B==null?void 0:B.name)||l.tabelaGroupAd,V=((U=N==null?void 0:N.tabelaRecords)==null?void 0:U.filter(se=>{var ve;return((ve=B==null?void 0:B.recordIds)==null?void 0:ve.includes(se.id))&&!se.kapanmaTarihi}))||[];let D,Y,ue;if(l.totalIslemHacmi!==void 0&&l.totalPFPay!==void 0&&l.totalOxivoPay!==void 0)D=l.totalIslemHacmi,Y=l.totalPFPay,ue=l.totalOxivoPay;else{const se=V.filter(ae=>!ae.ekGelirDetay),ve=V.filter(ae=>ae.ekGelirDetay);let de=0,me=0,ze=0;se.forEach(ae=>{(ae.komisyonOranlarÄ±||[]).filter(ne=>ne.aktif!==!1).forEach(ne=>{var Ee,Ge,We,Ie;const Ce=`${ae.id}-${ne.vade}`,ie=parseFloat(((Ee=l.islemHacmiMap)==null?void 0:Ee[Ce])||"0");let je=0;if(((Ge=ae.gelirModeli)==null?void 0:Ge.ad)==="Sabit Komisyon"){const He=parseFloat(ne.oran||"0");je=ie*(He/100)}else{const He=parseFloat(ne.alisTL||"0"),Qe=parseFloat(ne.satisTL||"0"),ca=ie*(He/100);je=ie*(Qe/100)-ca}const Te=parseFloat(((We=ae.paylaÅŸÄ±mOranlarÄ±)==null?void 0:We.kurulusOrani)||"0"),Pe=parseFloat(((Ie=ae.paylaÅŸÄ±mOranlarÄ±)==null?void 0:Ie.oxivoOrani)||"0"),Ae=je*(Te/100),Le=je*(Pe/100);de+=ie,me+=Ae,ze+=Le})});let Ne=0,R=0,ke=0;ve.forEach(ae=>{var ie,je,Te;const he=parseFloat(((ie=l.islemHacmiMap)==null?void 0:ie[ae.id])||"0"),ne=parseFloat(((je=ae.ekGelirDetay)==null?void 0:je.pfYuzde)||"0"),Ce=parseFloat(((Te=ae.ekGelirDetay)==null?void 0:Te.oxYuzde)||"0");Ne+=he,R+=he*(ne/100),ke+=he*(Ce/100)}),D=de+Ne,Y=me+R,ue=ze+ke}return e.jsxs(X,{children:[e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{children:l.pfUnvan}),e.jsx(E,{variant:"outline",className:"text-xs mt-1",children:l.pfTip})]})}),e.jsx(h,{children:e.jsx(E,{variant:"outline",className:"bg-blue-50 text-blue-700",children:ge(l.donem)})}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:be}),(B==null?void 0:B.name)!==l.tabelaGroupAd&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["(Eski: ",l.tabelaGroupAd,")"]})]})}),e.jsx(h,{className:"text-right",children:e.jsxs("span",{className:"text-blue-700",children:[D.toLocaleString("tr-TR",{minimumFractionDigits:2})," â‚º"]})}),e.jsx(h,{className:"text-right",children:e.jsxs("span",{className:"text-purple-700",children:[Y.toLocaleString("tr-TR",{minimumFractionDigits:2})," â‚º"]})}),e.jsx(h,{className:"text-right",children:e.jsxs("span",{className:"text-indigo-700",children:[ue.toLocaleString("tr-TR",{minimumFractionDigits:2})," â‚º"]})}),e.jsx(h,{children:e.jsx(E,{variant:l.durum==="KesinleÅŸmiÅŸ"?"default":"secondary",className:l.durum==="KesinleÅŸmiÅŸ"?"bg-green-600":"",children:l.durum})}),e.jsx(h,{children:e.jsx("span",{className:"text-xs text-gray-600",children:new Date(l.olusturmaTarihi).toLocaleDateString("tr-TR")})})]},l.id)})})]})})]})]})]})}const es=[{key:"cariHesapKodu",label:"Cari Hesap Kodu",defaultVisible:!0},{key:"cariAdi",label:"Cari AdÄ±",defaultVisible:!0},{key:"sektor",label:"SektÃ¶r",defaultVisible:!0},{key:"mcc",label:"MCC",defaultVisible:!1},{key:"ilce",label:"Ä°lÃ§e",defaultVisible:!0},{key:"cihazSayisi",label:"Cihaz SayÄ±sÄ±",defaultVisible:!0},{key:"aylÄ±kAidatGeliri",label:"AylÄ±k Aidat (â‚¬)",defaultVisible:!0},{key:"yetkili",label:"Yetkili",defaultVisible:!1},{key:"tel",label:"Telefon",defaultVisible:!1},{key:"durum",label:"Durum",defaultVisible:!0}];function as({customers:I,bankPFRecords:O}){const[g,W]=T.useState(""),[J,L]=T.useState("all"),[oe,ce]=T.useState("all"),[q,_]=T.useState("cihazSayisi"),[G,j]=T.useState("desc"),[v,Z]=T.useState({}),ee=T.useMemo(()=>I.map(a=>{var d;const c=((d=a.serviceFeeSettings)==null?void 0:d.deviceSubscriptions)||[],i=c.filter(o=>o.isActive),m=i.reduce((o,r)=>o+(r.monthlyFee||0),0);return{musteri:a,cihazSayisi:c.length,aktifCihazSayisi:i.length,aylÄ±kAidatGeliri:m}}),[I]),xe=T.useMemo(()=>{const a=new Set;return I.forEach(c=>{c.sektor&&c.sektor.trim()!==""&&a.add(c.sektor)}),Array.from(a).sort().map(c=>({value:c,label:c}))},[I]),z=T.useMemo(()=>[{value:"Aktif",label:"Aktif"},{value:"Pasif",label:"Pasif"}],[]),P=T.useMemo(()=>{let a=ee.filter(c=>{var o,r,y,b;const i=((o=c.musteri.cariAdi)==null?void 0:o.toLowerCase().includes(g.toLowerCase()))||((r=c.musteri.cariHesapKodu)==null?void 0:r.toLowerCase().includes(g.toLowerCase()))||((y=c.musteri.sektor)==null?void 0:y.toLowerCase().includes(g.toLowerCase()))||((b=c.musteri.ilce)==null?void 0:b.toLowerCase().includes(g.toLowerCase())),m=J==="all"||c.musteri.sektor===J,d=oe==="all"||c.musteri.durum===oe;return i&&m&&d});return a.sort((c,i)=>{let m,d;return q==="sektor"||q==="ilce"||q==="cariHesapKodu"||q==="cariAdi"?(m=c.musteri[q],d=i.musteri[q]):(m=c[q],d=i[q]),typeof m=="string"&&typeof d=="string"?G==="asc"?m.localeCompare(d,"tr"):d.localeCompare(m,"tr"):typeof m=="number"&&typeof d=="number"?G==="asc"?m-d:d-m:0}),a},[ee,g,J,oe,q,G]),M=T.useMemo(()=>({toplamMusteri:P.length,toplamCihazSayisi:P.reduce((a,c)=>a+c.cihazSayisi,0),toplamAktifCihaz:P.reduce((a,c)=>a+c.aktifCihazSayisi,0),toplamAylÄ±kAidat:P.reduce((a,c)=>a+c.aylÄ±kAidatGeliri,0),aktifMusteriSayisi:P.filter(a=>a.musteri.durum==="Aktif").length,pasifMusteriSayisi:P.filter(a=>a.musteri.durum==="Pasif").length}),[P]),t=a=>{q===a?j(G==="asc"?"desc":"asc"):(_(a),j("desc"))},n=T.useCallback(a=>{Z(a)},[]),x=()=>{try{const a=P.map(d=>({"Cari Hesap Kodu":d.musteri.cariHesapKodu,"Cari AdÄ±":d.musteri.cariAdi,SektÃ¶r:d.musteri.sektor,MCC:d.musteri.mcc,Ä°lÃ§e:d.musteri.ilce,Yetkili:d.musteri.yetkili,Telefon:d.musteri.tel,"Toplam Cihaz":d.cihazSayisi,"Aktif Cihaz":d.aktifCihazSayisi,"AylÄ±k Aidat (â‚¬)":d.aylÄ±kAidatGeliri.toFixed(2),Durum:d.musteri.durum})),c=sa.json_to_sheet(a),i=sa.book_new();sa.book_append_sheet(i,c,"MÃ¼ÅŸteri Raporu");const m=`musteri-raporu-${new Date().toISOString().split("T")[0]}.xlsx`;Wa(i,m),te.success(`Excel raporu indirildi: ${m}`)}catch(a){console.error("Excel export hatasÄ±:",a),te.error("Excel export sÄ±rasÄ±nda hata oluÅŸtu")}},s=a=>new Intl.NumberFormat("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"MÃ¼ÅŸteri Raporu"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"MÃ¼ÅŸterilerin cihaz sayÄ±sÄ± ve aidat geliri analizi"})]}),e.jsxs(pe,{onClick:x,className:"gap-2",children:[e.jsx(ja,{size:18}),"Excel Ä°ndir"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(w,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Toplam MÃ¼ÅŸteri"}),e.jsx("h3",{className:"text-blue-600 mt-1",children:M.toplamMusteri}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[M.aktifMusteriSayisi," aktif, ",M.pasifMusteriSayisi," pasif"]})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Ue,{className:"text-blue-600",size:24})})]})})}),e.jsx(w,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Toplam Cihaz"}),e.jsx("h3",{className:"text-green-600 mt-1",children:M.toplamCihazSayisi}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[M.toplamAktifCihaz," aktif cihaz"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Ta,{className:"text-green-600",size:24})})]})})}),e.jsx(w,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"AylÄ±k Aidat Geliri"}),e.jsxs("h3",{className:"text-purple-600 mt-1",children:["â‚¬",s(M.toplamAylÄ±kAidat)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Aktif cihazlardan"})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Ca,{className:"text-purple-600",size:24})})]})})}),e.jsx(w,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ort. Cihaz/MÃ¼ÅŸteri"}),e.jsx("h3",{className:"text-orange-600 mt-1",children:M.toplamMusteri>0?(M.toplamCihazSayisi/M.toplamMusteri).toFixed(1):0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Cihaz daÄŸÄ±lÄ±mÄ±"})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(ba,{className:"text-orange-600",size:24})})]})})})]}),e.jsx(w,{children:e.jsxs(K,{className:"pt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(oa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx(ye,{placeholder:"MÃ¼ÅŸteri adÄ±, cari kod, sektÃ¶r, ilÃ§e...",value:g,onChange:a=>W(a.target.value),className:"pl-10"})]})}),e.jsx(Me,{label:"SektÃ¶r",icon:e.jsx(Za,{size:16}),options:xe,value:J,onChange:L,allLabel:"TÃ¼m SektÃ¶rler",allValue:"all"}),e.jsx(Me,{label:"Durum",icon:e.jsx(za,{size:16}),options:z,value:oe,onChange:ce,allLabel:"TÃ¼mÃ¼",allValue:"all"})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx(ra,{size:16,className:"inline mr-2"}),P.length," mÃ¼ÅŸteri listeleniyor",P.length!==ee.length&&e.jsxs("span",{className:"text-blue-600 ml-1",children:["(",ee.length," toplam)"]})]}),e.jsx(Ga,{columns:es,visibility:v,onVisibilityChange:n})]})]})}),e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs(le,{children:["MÃ¼ÅŸteri Listesi",P.length!==ee.length&&e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",P.length," / ",ee.length,")"]})]})}),e.jsx(K,{children:P.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(oa,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Kriterlere uygun mÃ¼ÅŸteri bulunamadÄ±"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(X,{children:[v.cariHesapKodu!==!1&&e.jsx(u,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>t("cariHesapKodu"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Cari Hesap Kodu"}),e.jsx(Oe,{size:14})]})}),v.cariAdi!==!1&&e.jsx(u,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>t("cariAdi"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Cari AdÄ±"}),e.jsx(Oe,{size:14})]})}),v.sektor!==!1&&e.jsx(u,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>t("sektor"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"SektÃ¶r"}),e.jsx(Oe,{size:14})]})}),v.mcc!==!1&&e.jsx(u,{children:"MCC"}),v.ilce!==!1&&e.jsx(u,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>t("ilce"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Ä°lÃ§e"}),e.jsx(Oe,{size:14})]})}),v.cihazSayisi!==!1&&e.jsx(u,{className:"cursor-pointer hover:bg-gray-50 text-center",onClick:()=>t("cihazSayisi"),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx("span",{children:"Cihaz SayÄ±sÄ±"}),e.jsx(Oe,{size:14})]})}),v.aylÄ±kAidatGeliri!==!1&&e.jsx(u,{className:"cursor-pointer hover:bg-gray-50 text-right",onClick:()=>t("aylÄ±kAidatGeliri"),children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx("span",{children:"AylÄ±k Aidat (â‚¬)"}),e.jsx(Oe,{size:14})]})}),v.yetkili!==!1&&e.jsx(u,{children:"Yetkili"}),v.tel!==!1&&e.jsx(u,{children:"Telefon"}),v.durum!==!1&&e.jsx(u,{children:"Durum"})]})}),e.jsx(we,{children:P.map(a=>e.jsxs(X,{className:"hover:bg-gray-50",children:[v.cariHesapKodu!==!1&&e.jsx(h,{children:e.jsx("code",{className:`text-sm bg-gray-100 px-2 py-1 rounded ${a.musteri.durum==="Pasif"?"line-through text-gray-500":""}`,children:a.musteri.cariHesapKodu})}),v.cariAdi!==!1&&e.jsx(h,{className:"max-w-xs",children:e.jsx("div",{className:`truncate ${a.musteri.durum==="Pasif"?"line-through text-gray-500":""}`,title:a.musteri.cariAdi,children:a.musteri.cariAdi})}),v.sektor!==!1&&e.jsx(h,{children:e.jsx("span",{className:"text-sm",children:a.musteri.sektor})}),v.mcc!==!1&&e.jsx(h,{children:e.jsx("span",{className:"text-sm",children:a.musteri.mcc})}),v.ilce!==!1&&e.jsx(h,{children:e.jsx("span",{className:"text-sm",children:a.musteri.ilce})}),v.cihazSayisi!==!1&&e.jsx(h,{className:"text-center",children:e.jsxs(E,{variant:"outline",className:"gap-1",children:[a.cihazSayisi,a.aktifCihazSayisi<a.cihazSayisi&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",a.aktifCihazSayisi," aktif)"]})]})}),v.aylÄ±kAidatGeliri!==!1&&e.jsx(h,{className:"text-right tabular-nums",children:e.jsxs("span",{className:"text-sm text-purple-600",children:["â‚¬",s(a.aylÄ±kAidatGeliri)]})}),v.yetkili!==!1&&e.jsx(h,{children:e.jsx("span",{className:"text-sm",children:a.musteri.yetkili})}),v.tel!==!1&&e.jsx(h,{children:e.jsx("span",{className:"text-sm",children:a.musteri.tel})}),v.durum!==!1&&e.jsx(h,{children:e.jsx(E,{variant:a.musteri.durum==="Aktif"?"default":"secondary",children:a.musteri.durum})})]},a.musteri.id))})]})})})]}),P.length>0&&e.jsx(w,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"MÃ¼ÅŸteri SayÄ±sÄ±"}),e.jsx("p",{className:"text-blue-600 mt-1",children:M.toplamMusteri})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Toplam Cihaz"}),e.jsx("p",{className:"text-green-600 mt-1",children:M.toplamCihazSayisi})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Aktif Cihaz"}),e.jsx("p",{className:"text-green-600 mt-1",children:M.toplamAktifCihaz})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"AylÄ±k Aidat"}),e.jsxs("p",{className:"text-purple-600 mt-1",children:["â‚¬",s(M.toplamAylÄ±kAidat)]})]})]})})})]})}function ka({node:I,level:O,index:g,customerName:W}){const[J,L]=T.useState(!0),ce=((_,G)=>{const j=["i","ii","iii","iv","v","vi","vii","viii","ix","x"];return _===0?`${G+1}.`:_===1?String.fromCharCode(97+G)+".":_===2?j[G]||`${G+1}.`:_===3?`${G+1}.`:_===4?j[G]||`${G+1}.`:`${G+1}.`})(O,g),q=O*20;return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-2 rounded hover:bg-gray-50 transition-colors mb-1",style:{marginLeft:`${q}px`},children:[I.children.length>0&&e.jsx("button",{onClick:()=>L(!J),className:"p-0.5 hover:bg-gray-200 rounded transition-colors",title:J?"Daralt":"GeniÅŸlet",children:J?e.jsx(Na,{size:14,className:"text-gray-600"}):e.jsx(ya,{size:14,className:"text-gray-600"})}),I.children.length===0&&e.jsx("div",{className:"w-[18px]"}),e.jsx("span",{className:"text-xs text-gray-600 bg-gray-100 px-1.5 py-0.5 rounded min-w-[28px] text-center tabular-nums",children:ce}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-sm text-gray-900",children:I.name}),I.children.length>0&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:I.children.length})]})]}),J&&I.children.length>0&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2 top-0 bottom-2 w-px bg-gray-200",style:{marginLeft:`${q}px`}}),I.children.map((_,G)=>e.jsx(ka,{node:_,level:O+1,index:G,customerName:W},_.id))]})]})}function ss({customers:I}){const[O,g]=T.useState(""),W=I.filter(j=>j.domainHierarchy&&j.domainHierarchy.length>0),J=I.filter(j=>!j.domainHierarchy||j.domainHierarchy.length===0),L=W.filter(j=>{var v,Z;return((v=j.cariAdi)==null?void 0:v.toLowerCase().includes(O.toLowerCase()))||((Z=j.guncelMyPayterDomain)==null?void 0:Z.toLowerCase().includes(O.toLowerCase()))}),oe=J.filter(j=>{var v;return(v=j.cariAdi)==null?void 0:v.toLowerCase().includes(O.toLowerCase())}),ce=new Set,q=j=>{j.forEach(v=>{ce.add(v.name),v.children.length>0&&q(v.children)})};W.forEach(j=>{j.domainHierarchy&&q(j.domainHierarchy)});const _=j=>{let v=j.length;return j.forEach(Z=>{Z.children.length>0&&(v+=_(Z.children))}),v},G=W.reduce((j,v)=>j+(v.domainHierarchy?_(v.domainHierarchy):0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(w,{children:[e.jsx(re,{className:"pb-3",children:e.jsx(le,{className:"text-sm text-gray-600",children:"Toplam MÃ¼ÅŸteri"})}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"text-blue-600",size:24}),e.jsxs(_e,{children:[e.jsx(Xe,{asChild:!0,children:e.jsx("span",{className:"text-2xl font-semibold cursor-help",children:I.length})}),e.jsx(Je,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Veri KaynaÄŸÄ±:"}),e.jsx("p",{className:"text-xs",children:"MÃ¼ÅŸteriler modÃ¼lÃ¼ndeki tÃ¼m kayÄ±tlar"}),e.jsx("p",{className:"text-xs opacity-75",children:"Domain tanÄ±mlÄ± + tanÄ±msÄ±z mÃ¼ÅŸteriler"})]})})]})]})})]}),e.jsxs(w,{children:[e.jsx(re,{className:"pb-3",children:e.jsx(le,{className:"text-sm text-gray-600",children:"Domain TanÄ±mlÄ±"})}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"text-green-600",size:24}),e.jsxs(_e,{children:[e.jsx(Xe,{asChild:!0,children:e.jsx("span",{className:"text-2xl font-semibold cursor-help",children:W.length})}),e.jsx(Je,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Veri KaynaÄŸÄ±:"}),e.jsx("p",{className:"text-xs",children:"domainHierarchy verisi olan mÃ¼ÅŸteriler"}),e.jsx("p",{className:"text-xs opacity-75",children:"Domain hiyerarÅŸisi tanÄ±mlanmÄ±ÅŸ mÃ¼ÅŸteri sayÄ±sÄ±"})]})})]})]})})]}),e.jsxs(w,{children:[e.jsx(re,{className:"pb-3",children:e.jsx(le,{className:"text-sm text-gray-600",children:"Domain TanÄ±msÄ±z"})}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fa,{className:"text-orange-600",size:24}),e.jsxs(_e,{children:[e.jsx(Xe,{asChild:!0,children:e.jsx("span",{className:"text-2xl font-semibold cursor-help",children:J.length})}),e.jsx(Je,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Veri KaynaÄŸÄ±:"}),e.jsx("p",{className:"text-xs",children:"domainHierarchy verisi olmayan mÃ¼ÅŸteriler"}),e.jsx("p",{className:"text-xs opacity-75",children:"Domain tanÄ±mÄ± yapÄ±lmasÄ± gereken mÃ¼ÅŸteriler"})]})})]})]})})]}),e.jsxs(w,{children:[e.jsx(re,{className:"pb-3",children:e.jsx(le,{className:"text-sm text-gray-600",children:"Toplam Domain"})}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"text-purple-600",size:24}),e.jsxs(_e,{children:[e.jsx(Xe,{asChild:!0,children:e.jsx("span",{className:"text-2xl font-semibold cursor-help",children:G})}),e.jsx(Je,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Hesaplama:"}),e.jsx("p",{className:"text-xs",children:"TÃ¼m mÃ¼ÅŸterilerdeki toplam domain node sayÄ±sÄ±"}),e.jsx("p",{className:"text-xs opacity-75",children:"Ana domain + alt domainler dahil (recursive)"})]})})]})]})})]})]}),e.jsx("div",{children:e.jsx(ye,{id:"domain-report-search",placeholder:"MÃ¼ÅŸteri adÄ± veya domain ile ara...",value:O,onChange:j=>g(j.target.value),className:"max-w-md"})}),e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(le,{children:"Domain HiyerarÅŸisi TanÄ±mlÄ± MÃ¼ÅŸteriler"}),e.jsxs(E,{variant:"outline",className:"bg-green-50 text-green-700 border-green-300",children:[L.length," MÃ¼ÅŸteri"]})]})}),e.jsx(K,{children:L.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:O?e.jsx("p",{children:"Arama kriterlerine uygun domain tanÄ±mlÄ± mÃ¼ÅŸteri bulunamadÄ±."}):e.jsx("p",{children:"HenÃ¼z domain hiyerarÅŸisi tanÄ±mlÄ± mÃ¼ÅŸteri bulunmuyor."})}):e.jsx("div",{className:"space-y-6",children:L.map(j=>{var v;return e.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 bg-gray-50/30",children:[e.jsx("div",{className:"mb-4 pb-3 border-b-2 border-gray-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:j.durum==="Pasif"?"text-gray-500 line-through":"text-gray-900",children:j.cariAdi}),j.guncelMyPayterDomain&&e.jsxs("p",{className:"text-sm text-gray-600",children:["ðŸŒ ",j.guncelMyPayterDomain]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:"outline",className:j.durum==="Aktif"?"bg-green-50 text-green-700 border-green-300":"bg-gray-100 text-gray-600 border-gray-300",children:j.durum}),j.domainHierarchy&&e.jsxs(E,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-300",children:[_(j.domainHierarchy)," Domain"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"space-y-1",children:(v=j.domainHierarchy)==null?void 0:v.map((Z,ee)=>e.jsx(ka,{node:Z,level:0,index:ee,customerName:j.cariAdi},Z.id))})})]},j.id)})})})]}),e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(le,{children:"Domain HiyerarÅŸisi TanÄ±msÄ±z MÃ¼ÅŸteriler"}),e.jsxs(E,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-300",children:[oe.length," MÃ¼ÅŸteri"]})]})}),e.jsx(K,{children:oe.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:O?e.jsx("p",{children:"Arama kriterlerine uygun domain tanÄ±msÄ±z mÃ¼ÅŸteri bulunamadÄ±."}):e.jsx("p",{children:"TÃ¼m mÃ¼ÅŸterilerde domain hiyerarÅŸisi tanÄ±mlÄ±! ðŸŽ‰"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:oe.map(j=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium truncate ${j.durum==="Pasif"?"line-through text-gray-500":"text-gray-900"}`,children:j.cariAdi}),j.guncelMyPayterDomain&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-1",children:j.guncelMyPayterDomain})]}),e.jsx(E,{variant:"outline",className:j.durum==="Aktif"?"bg-green-50 text-green-700 border-green-300 text-xs":"bg-gray-100 text-gray-600 border-gray-300 text-xs",children:j.durum})]})},j.id))})})]})]})}function is({...I}){return e.jsx(_a,{"data-slot":"collapsible",...I})}function ts({...I}){return e.jsx(Xa,{"data-slot":"collapsible-trigger",...I})}function rs({...I}){return e.jsx(Ja,{"data-slot":"collapsible-content",...I})}function ls({open:I,onOpenChange:O,bankPFRecords:g}){const[W,J]=T.useState("100000"),[L,oe]=T.useState([]),[ce,q]=T.useState(!1),[_,G]=T.useState(new Set),j=()=>{if(!W||parseFloat(W)<=0){te.error("LÃ¼tfen geÃ§erli bir tutar giriniz!");return}const z=parseFloat(W),P=[];g.forEach(M=>{const t=(M.tabelaRecords||[]).filter(i=>i.aktif&&!i.kapanmaTarihi&&!i.ekGelirDetay);if(t.length===0)return;let n=0,x=0,s=0,a=0;const c=[];if(t.forEach(i=>{if(i.gelirModeli.ad==="Gelir OrtaklÄ±ÄŸÄ±")i.komisyonOranlarÄ±.filter(d=>d.aktif).forEach(d=>{const o=parseFloat(String(d.alisTL||"0")),r=parseFloat(String(d.satisTL||"0"));if(o>0&&r>0){const y=z/r,b=(r-o)*y;n+=o*y,x+=r*y,s+=b,a++,c.push({kurulusAdi:i.kurulus.ad,kartTipi:`${i.kartTipi} - ${d.vade}`,gelirModeli:i.gelirModeli.ad,alis:o,satis:r,kar:r-o})}});else if(i.gelirModeli.ad==="Sabit Komisyon")i.komisyonOranlarÄ±.filter(d=>d.aktif).forEach(d=>{var r,y;const o=parseFloat(d.oran||"0");if(o>0){const b=z*o/100;parseFloat(((r=i.paylaÅŸÄ±mOranlarÄ±)==null?void 0:r.kurulusOrani)||"0");const A=parseFloat(((y=i.paylaÅŸÄ±mOranlarÄ±)==null?void 0:y.oxivoOrani)||"0"),f=b*A/100;s+=f,a++,c.push({kurulusAdi:i.kurulus.ad,kartTipi:`${i.kartTipi} - ${d.vade}`,gelirModeli:`${i.gelirModeli.ad} (${o}%)`,alis:0,satis:z,kar:f})}});else if(i.gelirModeli.ad==="Hazine Geliri"&&i.hazineGeliri){const m=parseFloat(i.hazineGeliri.tutarTL||"0"),d=parseFloat(i.hazineGeliri.oxivoYuzde||"0"),o=parseFloat(i.hazineGeliri.kazancTL||"0");if(o>0){const r=z/(m||1),y=o*r;s+=y,a++,c.push({kurulusAdi:i.kurulus.ad,kartTipi:i.kartTipi,gelirModeli:`${i.gelirModeli.ad} (${d}%)`,alis:0,satis:z,kar:y})}}}),a>0){const i=n/a,m=x/a,d=m>0?s/x*100:0;P.push({firmaId:M.id,firmaAdi:M.firmaUnvan,firmaTipi:M.firmaTipi,aktifTabelaSayisi:a,ortalamaAlis:i,ortalamaSatis:m,toplamKar:s,karMarji:d,tabelaDetaylari:c})}}),P.sort((M,t)=>t.toplamKar-M.toplamKar),oe(P),q(!0),P.length===0?te.warning("Hesaplanabilir TABELA kaydÄ± bulunamadÄ±!"):te.success(`${P.length} firma iÃ§in karlÄ±lÄ±k hesaplandÄ±!`)},v=z=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:2,maximumFractionDigits:2}).format(z),Z=z=>`%${z.toFixed(2)}`,ee=()=>{q(!1),oe([]),G(new Set)},xe=z=>{const P=new Set(_);P.has(z)?P.delete(z):P.add(z),G(P)};return e.jsx(Pa,{open:I,onOpenChange:O,children:e.jsxs(Aa,{className:"max-w-full w-screen h-screen max-h-screen overflow-y-auto p-6 rounded-none",children:[e.jsxs(Sa,{children:[e.jsxs(Fa,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"TABELA KarlÄ±lÄ±k SimÃ¼lasyonu"]}),e.jsx(Da,{children:"Belirli bir iÅŸlem tutarÄ± iÃ§in tÃ¼m firmalarÄ±n karlÄ±lÄ±ÄŸÄ±nÄ± karÅŸÄ±laÅŸtÄ±rÄ±n"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(wa,{htmlFor:"tutar",children:"Ä°ÅŸlem TutarÄ± (TL)"}),e.jsx(ye,{id:"tutar",type:"number",value:W,onChange:z=>J(z.target.value),placeholder:"100000",className:"mt-1.5"})]}),e.jsxs(pe,{onClick:j,className:"flex items-center gap-2",children:[e.jsx(Be,{size:16}),"Hesapla"]}),ce&&e.jsx(pe,{onClick:ee,variant:"outline",children:"Temizle"})]})})}),ce&&L.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(w,{children:e.jsxs(K,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"En KarlÄ± Firma"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ia,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"truncate",children:L[0].firmaAdi})]}),e.jsx("div",{className:"text-green-600 mt-1",children:v(L[0].toplamKar)})]})]})}),e.jsx(w,{children:e.jsxs(K,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Toplam Kar"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-green-600",children:v(L.reduce((z,P)=>z+P.toplamKar,0))}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"TÃ¼m firmalar"})]})]})}),e.jsx(w,{children:e.jsxs(K,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Ortalama Kar"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-blue-600",children:v(L.reduce((z,P)=>z+P.toplamKar,0)/L.length)}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Firma baÅŸÄ±na"})]})]})}),e.jsx(w,{children:e.jsxs(K,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Toplam Firma"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"text-gray-900",children:[L.length," firma"]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[L.reduce((z,P)=>z+P.aktifTabelaSayisi,0)," TABELA"]})]})]})})]}),e.jsx(w,{children:e.jsxs(K,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Firma KarlÄ±lÄ±k KarÅŸÄ±laÅŸtÄ±rmasÄ±"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(pe,{variant:"outline",size:"sm",onClick:()=>G(new Set(L.map(z=>z.firmaId))),className:"text-xs",children:"TÃ¼mÃ¼nÃ¼ GeniÅŸlet"}),e.jsx(pe,{variant:"outline",size:"sm",onClick:()=>G(new Set),className:"text-xs",children:"TÃ¼mÃ¼nÃ¼ Daralt"})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(X,{children:[e.jsx(u,{className:"w-12"}),e.jsx(u,{className:"w-12",children:"SÄ±ra"}),e.jsx(u,{children:"Firma AdÄ±"}),e.jsx(u,{children:"Tip"}),e.jsx(u,{className:"text-right",children:"TABELA SayÄ±sÄ±"}),e.jsx(u,{className:"text-right",children:"Ort. AlÄ±ÅŸ"}),e.jsx(u,{className:"text-right",children:"Ort. SatÄ±ÅŸ"}),e.jsx(u,{className:"text-right",children:"Toplam Kar"}),e.jsx(u,{className:"text-right",children:"Kar MarjÄ±"})]})}),e.jsx(we,{children:L.map((z,P)=>e.jsxs(is,{open:_.has(z.firmaId),onOpenChange:()=>xe(z.firmaId),children:[e.jsxs(X,{className:"cursor-pointer hover:bg-gray-50",children:[e.jsx(h,{children:e.jsx(ts,{asChild:!0,children:e.jsx(pe,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:_.has(z.firmaId)?e.jsx(Na,{className:"h-4 w-4"}):e.jsx(ya,{className:"h-4 w-4"})})})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-center",children:[P===0&&e.jsx(E,{className:"bg-yellow-500",children:"1"}),P===1&&e.jsx(E,{className:"bg-gray-400",children:"2"}),P===2&&e.jsx(E,{className:"bg-orange-600",children:"3"}),P>2&&e.jsx("span",{className:"text-gray-500",children:P+1})]})}),e.jsx(h,{children:z.firmaAdi}),e.jsx(h,{children:e.jsx(E,{variant:z.firmaTipi==="Banka"?"default":"secondary",children:z.firmaTipi})}),e.jsx(h,{className:"text-right",children:z.aktifTabelaSayisi}),e.jsx(h,{className:"text-right",children:z.ortalamaAlis>0?v(z.ortalamaAlis):"-"}),e.jsx(h,{className:"text-right",children:z.ortalamaSatis>0?v(z.ortalamaSatis):"-"}),e.jsx(h,{className:"text-right",children:e.jsx("span",{className:z.toplamKar>0?"text-green-600":"text-red-600",children:v(z.toplamKar)})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[z.karMarji>0?e.jsx(ia,{className:"h-4 w-4 text-green-600"}):e.jsx(qa,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:z.karMarji>0?"text-green-600":"text-red-600",children:Z(z.karMarji)})]})})]}),e.jsx(rs,{asChild:!0,children:e.jsx(X,{className:"bg-gray-50/50",children:e.jsx(h,{colSpan:9,className:"p-0",children:e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200",children:[e.jsx("div",{className:"text-sm mb-2",children:e.jsx("span",{className:"text-gray-600",children:"TABELA DetaylarÄ±:"})}),e.jsx("div",{className:"rounded-md border border-gray-200 overflow-hidden",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(X,{className:"bg-gray-100",children:[e.jsx(u,{className:"text-xs",children:"KuruluÅŸ"}),e.jsx(u,{className:"text-xs",children:"Kart Tipi"}),e.jsx(u,{className:"text-xs",children:"Gelir Modeli"}),e.jsx(u,{className:"text-right text-xs",children:"AlÄ±ÅŸ (TL)"}),e.jsx(u,{className:"text-right text-xs",children:"SatÄ±ÅŸ (TL)"}),e.jsx(u,{className:"text-right text-xs",children:"Kar (TL)"})]})}),e.jsx(we,{children:z.tabelaDetaylari.map((M,t)=>e.jsxs(X,{className:"text-sm",children:[e.jsx(h,{children:M.kurulusAdi}),e.jsx(h,{children:M.kartTipi}),e.jsx(h,{children:M.gelirModeli}),e.jsx(h,{className:"text-right",children:M.alis>0?v(M.alis):"-"}),e.jsx(h,{className:"text-right",children:v(M.satis)}),e.jsx(h,{className:"text-right",children:e.jsx("span",{className:M.kar>0?"text-green-600":"text-red-600",children:v(M.kar)})})]},t))})]})})]})})})})]},z.firmaId))})]})})]})})]}),ce&&L.length===0&&e.jsx(w,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["Hesaplanabilir TABELA kaydÄ± bulunamadÄ±.",e.jsx("br",{}),"LÃ¼tfen Gelir OrtaklÄ±ÄŸÄ± modelinde alÄ±ÅŸ-satÄ±ÅŸ oranlarÄ± tanÄ±mlÄ± kayÄ±tlar ekleyin."]})})})]})]})})}const vs=Ka.memo(function({customers:O=[],bankPFRecords:g=[],banks:W=[],epkList:J=[],okList:L=[],kartProgramlar:oe=[]}){const[ce,q]=T.useState("banka-pf"),[_,G]=T.useState(!1),[j,v]=T.useState("ALL"),Z=T.useMemo(()=>{const t=[];return g.sort((n,x)=>n.bankaOrPF==="Banka"&&x.bankaOrPF!=="Banka"?-1:n.bankaOrPF!=="Banka"&&x.bankaOrPF==="Banka"?1:n.odemeKurulusuTipi==="EPK"&&x.odemeKurulusuTipi==="Ã–K"?-1:n.odemeKurulusuTipi==="Ã–K"&&x.odemeKurulusuTipi==="EPK"?1:n.firmaUnvan.localeCompare(x.firmaUnvan,"tr")).forEach(n=>{const x=n.bankaOrPF==="Banka"?"ðŸ¦ Banka":n.odemeKurulusuTipi==="EPK"?"ðŸ’³ EPK":"ðŸ’° Ã–K";t.push({value:n.id,label:`${x} â€¢ ${n.firmaUnvan}`})}),W.filter(n=>n.bankaAdi).sort((n,x)=>(n.bankaAdi||"").localeCompare(x.bankaAdi||"","tr")).forEach(n=>{t.push({value:n.id,label:`ðŸ¦ Banka â€¢ ${n.bankaAdi}`})}),J.filter(n=>n.kurumAdi).sort((n,x)=>(n.kurumAdi||"").localeCompare(x.kurumAdi||"","tr")).forEach(n=>{t.push({value:n.id,label:`ðŸ’³ EPK â€¢ ${n.kurumAdi}`})}),L.filter(n=>n.kurumAdi).sort((n,x)=>(n.kurumAdi||"").localeCompare(x.kurumAdi||"","tr")).forEach(n=>{t.push({value:n.id,label:`ðŸ’° Ã–K â€¢ ${n.kurumAdi}`})}),t},[g,W,J,L]),ee=T.useMemo(()=>{const x=[...g.filter(a=>a.firmaUnvan).map(a=>({id:a.id,name:a.firmaUnvan,source:"bankPF"})),...W.filter(a=>a.bankaAdi).map(a=>({id:a.id,name:a.bankaAdi,source:"definitions"})),...J.filter(a=>a.kurumAdi).map(a=>({id:a.id,name:a.kurumAdi,source:"definitions"})),...L.filter(a=>a.kurumAdi).map(a=>({id:a.id,name:a.kurumAdi,source:"definitions"}))].map(a=>{const c=O.filter(r=>{var y,b;return!!(a.source==="bankPF"&&((y=r.linkedBankPFIds)!=null&&y.includes(a.id))||(b=r.bankDeviceAssignments)!=null&&b.some(A=>A.bankId===a.id||A.bankId===`bank-${a.id}`||A.bankId===`ok-epk-${a.id}`||A.bankId===`ok-ok-${a.id}`))}),i=c.filter(r=>r.durum==="Aktif"),m=c.filter(r=>r.durum!=="Aktif"),d=i.reduce((r,y)=>{var A,f;const b=(A=y.bankDeviceAssignments)==null?void 0:A.find(k=>k.bankId===a.id||k.bankId===`bank-${a.id}`||k.bankId===`ok-epk-${a.id}`||k.bankId===`ok-ok-${a.id}`);return r+(((f=b==null?void 0:b.deviceIds)==null?void 0:f.length)||0)},0),o=m.reduce((r,y)=>{var A,f;const b=(A=y.bankDeviceAssignments)==null?void 0:A.find(k=>k.bankId===a.id||k.bankId===`bank-${a.id}`||k.bankId===`ok-epk-${a.id}`||k.bankId===`ok-ok-${a.id}`);return r+(((f=b==null?void 0:b.deviceIds)==null?void 0:f.length)||0)},0);return{name:a.name,aktifUiy:i.length,aktifCihaz:d,pasifUiy:m.length,pasifCihaz:o,toplamUiy:c.length,toplamCihaz:d+o}}).filter(a=>a.toplamUiy>0).sort((a,c)=>c.toplamCihaz-a.toplamCihaz),s={aktifUiy:x.reduce((a,c)=>a+c.aktifUiy,0),aktifCihaz:x.reduce((a,c)=>a+c.aktifCihaz,0),pasifUiy:x.reduce((a,c)=>a+c.pasifUiy,0),pasifCihaz:x.reduce((a,c)=>a+c.pasifCihaz,0),toplamUiy:x.reduce((a,c)=>a+c.toplamUiy,0),toplamCihaz:x.reduce((a,c)=>a+c.toplamCihaz,0)};return{bankalar:x,genelToplam:s}},[g,W,J,L,O]),xe=()=>{const t=new Set;return g.forEach(n=>{var x;(x=n.iletisimMatrisi)==null||x.forEach(s=>{s.gorevi&&t.add(s.gorevi)})}),Array.from(t).sort()},z=(t,n)=>(t.iletisimMatrisi||[]).filter(x=>x.gorevi===n),P=()=>{try{const t=xe();if(t.length===0||g.length===0){te.error("PDF oluÅŸturmak iÃ§in veri bulunmuyor!");return}const n=new qe({orientation:"landscape",unit:"mm",format:"a4"});n.setFontSize(16),n.text("Iletisim Matrisi - Banka / EPK / OK",14,15),n.setFontSize(10),n.text(`Tarih: ${new Date().toLocaleDateString("tr-TR")}`,14,22);const x=["Gorev"],s=[""];g.forEach(f=>{const k=f.bankaOrPF==="PF"?f.odemeKurulusuTipi:"Banka",p=`${f.firmaUnvan} (${k})`;x.push({content:p,colSpan:3,styles:{halign:"center"}}),s.push("Ad Soyad","Cep","E-Posta")});const a=[x,s],c=[];t.forEach(f=>{const k=[f];g.forEach(p=>{const C=z(p,f);if(C.length>0){const H=C.map(S=>S.adiSoyadi).join(`
`),$=C.map(S=>S.gsm||S.tel||"-").join(`
`),F=C.map(S=>S.mail||"-").join(`
`);k.push(H,$,F)}else k.push("-","-","-")}),c.push(k)});const i=1+g.length*3,m=277,d=30,r=(m-d)/(g.length*3),y={0:{cellWidth:d,halign:"left",fontStyle:"bold",fontSize:6}};for(let f=1;f<i;f++)y[f]={cellWidth:r,halign:"center",fontSize:5,overflow:"linebreak"};Ve(n,{head:a,body:c,startY:28,styles:{fontSize:6,cellPadding:1.5,overflow:"linebreak",halign:"center",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontSize:6,fontStyle:"bold",halign:"center",valign:"middle",cellPadding:2},columnStyles:y,alternateRowStyles:{fillColor:[249,250,251]},margin:{top:28,right:10,bottom:10,left:10},theme:"grid",tableWidth:"auto"});const b=n.lastAutoTable.finalY||28;b>180?(n.addPage(),n.setFontSize(10),n.text("Ozet Istatistikler:",14,15),n.setFontSize(8),[`Toplam Kurulus: ${g.length}`,`Banka: ${g.filter(k=>k.bankaOrPF==="Banka").length}`,`EPK: ${g.filter(k=>k.odemeKurulusuTipi==="EPK").length}`,`OK: ${g.filter(k=>k.odemeKurulusuTipi==="Ã–K").length}`,`Farkli Gorev: ${t.length}`,`Toplam Kisi: ${g.reduce((k,p)=>{var C;return k+(((C=p.iletisimMatrisi)==null?void 0:C.length)||0)},0)}`].forEach((k,p)=>{n.text(k,14,22+p*5)})):(n.setFontSize(10),n.text("Ozet Istatistikler:",14,b+10),n.setFontSize(8),[`Toplam Kurulus: ${g.length}`,`Banka: ${g.filter(k=>k.bankaOrPF==="Banka").length}`,`EPK: ${g.filter(k=>k.odemeKurulusuTipi==="EPK").length}`,`OK: ${g.filter(k=>k.odemeKurulusuTipi==="Ã–K").length}`,`Farkli Gorev: ${t.length}`,`Toplam Kisi: ${g.reduce((k,p)=>{var C;return k+(((C=p.iletisimMatrisi)==null?void 0:C.length)||0)},0)}`].forEach((k,p)=>{n.text(k,14,b+16+p*5)}));const A=`iletisim-matrisi-${new Date().toISOString().split("T")[0]}.pdf`;n.save(A),te.success(`PDF basariyla olusturuldu!
${A}`)}catch(t){console.error("PDF olusturma hatasi:",t),te.error(`PDF olusturulurken hata olustu!
${t instanceof Error?t.message:"Bilinmeyen hata"}`)}},M=xe();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Raporlar"}),e.jsx("p",{className:"text-sm font-medium text-gray-600 mt-1",children:"TÃ¼m verileriniz iÃ§in detaylÄ± raporlar ve analizler"})]})}),e.jsxs(ma,{value:ce,onValueChange:q,children:[e.jsxs(xa,{children:[e.jsxs(Ke,{value:"banka-pf",children:[e.jsx(fe,{size:16,className:"mr-2"}),"Banka/PF"]}),e.jsxs(Ke,{value:"iletisim-matrisi",children:[e.jsx(Ue,{size:16,className:"mr-2"}),"Ä°letiÅŸim Matrisi"]}),e.jsxs(Ke,{value:"musteriler",children:[e.jsx(Ue,{size:16,className:"mr-2"}),"MÃ¼ÅŸteriler"]}),e.jsxs(Ke,{value:"domain",children:[e.jsx(ta,{size:16,className:"mr-2"}),"Domain"]}),e.jsxs(Ke,{value:"tabela",children:[e.jsx(aa,{size:16,className:"mr-2"}),"Tabela"]}),e.jsxs(Ke,{value:"hakedis",children:[e.jsx(Be,{size:16,className:"mr-2"}),"HakediÅŸ"]})]}),e.jsx($e,{value:"iletisim-matrisi",className:"space-y-4",children:e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Ä°letiÅŸim Matrisi - Banka / EPK / Ã–K"}),e.jsx(Se,{children:"TÃ¼m kuruluÅŸlarÄ±n gÃ¶rev bazÄ±nda iletiÅŸim bilgileri"})]}),e.jsxs(pe,{variant:"default",onClick:P,className:"flex items-center gap-2",disabled:g.length===0||M.length===0,children:[e.jsx(Ye,{size:16}),"PDF Ä°ndir"]})]})}),e.jsx(K,{children:g.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(fa,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"HenÃ¼z Banka/PF kaydÄ± bulunmuyor."})]}):M.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ue,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"HenÃ¼z iletiÅŸim matrisi verisi bulunmuyor."}),e.jsx("p",{className:"text-sm mt-2",children:"Banka/PF detay sayfalarÄ±ndan iletiÅŸim kiÅŸileri ekleyin."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsxs(De,{children:[e.jsxs(X,{children:[e.jsx(u,{className:"sticky left-0 bg-white z-10 border-r-2 border-gray-300 min-w-[200px]",children:"GÃ¶rev"}),g.map(t=>e.jsx(u,{colSpan:3,className:"text-center border-r-2 border-gray-300 bg-blue-50",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:t.firmaUnvan}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.bankaOrPF==="PF"&&t.odemeKurulusuTipi&&e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:t.odemeKurulusuTipi}),t.bankaOrPF==="Banka"&&e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Banka"})]})]})},t.id))]}),e.jsxs(X,{children:[e.jsx(u,{className:"sticky left-0 bg-white z-10 border-r-2 border-gray-300"}),g.map(t=>e.jsxs(T.Fragment,{children:[e.jsx(u,{className:"text-center bg-gray-50 text-xs",children:"AdÄ± SoyadÄ±"}),e.jsx(u,{className:"text-center bg-gray-50 text-xs",children:"Cep"}),e.jsx(u,{className:"text-center bg-gray-50 border-r-2 border-gray-300 text-xs",children:"E-Posta"})]},`${t.id}-headers`))]})]}),e.jsx(we,{children:M.map((t,n)=>e.jsxs(X,{className:n%2===0?"bg-gray-50/30":"",children:[e.jsx(h,{className:"sticky left- bg-white z-10 border-r-2 border-gray-300 text-xs",children:t}),g.map(x=>{const s=z(x,t);return e.jsxs(T.Fragment,{children:[e.jsx(h,{className:`text-center text-xs ${s.length>0?"bg-green-50":""}`,children:s.length>0?e.jsx("div",{className:"space-y-1",children:s.map(a=>e.jsx("div",{children:a.adiSoyadi},a.id))}):e.jsx("span",{className:"text-gray-300",children:"-"})}),e.jsx(h,{className:`text-center text-xs ${s.length>0?"bg-green-50":""}`,children:s.length>0?e.jsx("div",{className:"space-y-1",children:s.map(a=>e.jsx("div",{children:a.gsm||a.tel||"-"},a.id))}):e.jsx("span",{className:"text-gray-300",children:"-"})}),e.jsx(h,{className:`text-center text-xs border-r-2 border-gray-300 ${s.length>0?"bg-green-50":""}`,children:s.length>0?e.jsx("div",{className:"space-y-1",children:s.map(a=>e.jsx("div",{className:"truncate max-w-[200px]",children:a.mail||"-"},a.id))}):e.jsx("span",{className:"text-gray-300",children:"-"})})]},`${x.id}-${t}`)})]},t))})]})})})]})}),e.jsx($e,{value:"tabela",className:"space-y-6",children:e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(le,{children:"TABELA Raporu"}),e.jsx(Se,{children:"TÃ¼m firmalarÄ±n TABELA kayÄ±tlarÄ± ve Ã¶zet bilgileri"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(pe,{variant:"outline",onClick:()=>G(!0),className:"flex items-center gap-2",children:[e.jsx(Be,{size:16}),"SimÃ¼lasyon"]}),e.jsxs(pe,{variant:"default",onClick:()=>{try{const t=g.flatMap(m=>(m.tabelaRecords||[]).filter(d=>!d.kapanmaTarihi).map(d=>({...d,firmaUnvan:m.firmaUnvan,firmaTip:m.bankaOrPF==="PF"?m.odemeKurulusuTipi:"Banka"})));if(t.length===0){te.error("PDF oluÅŸturmak iÃ§in TABELA kaydÄ± bulunmuyor!");return}const n=new qe({orientation:"landscape",unit:"mm",format:"a4"});n.setFontSize(16),n.text("TABELA Raporu",14,15),n.setFontSize(10),n.text(`Tarih: ${new Date().toLocaleDateString("tr-TR")}`,14,22);const x=[["Firma","Tip","Gelir Modeli","Urun","Kart Tipi","Yurt","Program","Kurulus%","OXIVO%","Tarih"]],s=t.map(m=>{var d,o;return[m.firmaUnvan||"-",m.firmaTip||"-",((d=m.gelirModeli)==null?void 0:d.ad)||"-",m.urunTipi||"-",m.kartTipi||"-",m.yurtIciDisi||"-",(o=m.kartProgramIds)!=null&&o.includes("ALL")?"TumÃ¼":`${(m.kartProgramIds||[]).length}`,m.kurulusOrani?`${m.kurulusOrani}%`:"-",m.oxivoOrani?`${m.oxivoOrani}%`:"-",new Date(m.olusturmaTarihi).toLocaleDateString("tr-TR")]});Ve(n,{head:x,body:s,startY:28,styles:{fontSize:7,cellPadding:2,overflow:"linebreak",halign:"center",valign:"middle"},headStyles:{fillColor:[249,115,22],textColor:[255,255,255],fontSize:8,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:40,halign:"left"},1:{cellWidth:20},2:{cellWidth:35,halign:"left"},3:{cellWidth:25},4:{cellWidth:25},5:{cellWidth:20},6:{cellWidth:22},7:{cellWidth:22},8:{cellWidth:22},9:{cellWidth:28}},margin:{top:28,right:10,bottom:10,left:10},theme:"grid"});const a=n.lastAutoTable.finalY||28,c=g.filter(m=>{var d,o;return(((o=(d=m.tabelaRecords)==null?void 0:d.filter(r=>!r.kapanmaTarihi))==null?void 0:o.length)||0)>0}).length;a>180?(n.addPage(),n.setFontSize(10),n.text("Ozet Istatistikler:",14,15),n.setFontSize(8),[`Aktif TABELA: ${t.length}`,`Firmalar: ${c}`].forEach((d,o)=>{n.text(d,14,22+o*5)})):(n.setFontSize(10),n.text("Ozet Istatistikler:",14,a+10),n.setFontSize(8),[`Aktif TABELA: ${t.length}`,`Firmalar: ${c}`].forEach((d,o)=>{n.text(d,14,a+16+o*5)}));const i=`tabela-raporu-${new Date().toISOString().split("T")[0]}.pdf`;n.save(i),te.success(`PDF baÅŸarÄ±yla oluÅŸturuldu!\\n${i}`)}catch(t){console.error("PDF oluÅŸturma hatasÄ±:",t),te.error("PDF oluÅŸturulurken hata oluÅŸtu!")}},className:"flex items-center gap-2",disabled:g.reduce((t,n)=>{var x,s;return t+(((s=(x=n.tabelaRecords)==null?void 0:x.filter(a=>!a.kapanmaTarihi))==null?void 0:s.length)||0)},0)===0,children:[e.jsx(Ye,{size:16}),"PDF Ä°ndir"]})]})]})}),e.jsx(K,{children:g.reduce((t,n)=>{var x,s;return t+(((s=(x=n.tabelaRecords)==null?void 0:x.filter(a=>!a.kapanmaTarihi))==null?void 0:s.length)||0)},0)===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(aa,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"HenÃ¼z aktif TABELA kaydÄ± bulunmuyor."}),e.jsx("p",{className:"text-sm mt-2",children:"Banka/PF detay sayfalarÄ±ndan TABELA kayÄ±tlarÄ± ekleyin."})]}):e.jsx("div",{className:"space-y-8",children:g.filter(t=>(t.tabelaRecords||[]).length>0).map(t=>{var x;const n=(t.tabelaRecords||[]).filter(s=>{var c;if(s.kapanmaTarihi)return!1;const a=(c=t.tabelaGroups)==null?void 0:c.find(i=>i.recordIds.includes(s.id));return a&&a.aktif===!0});return n.length===0?null:e.jsxs("div",{className:"border-2 border-orange-200 rounded-lg p-6 bg-orange-50/30",children:[e.jsx("div",{className:"mb-4 pb-3 border-b-2 border-orange-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-orange-900",children:t.firmaUnvan}),t.bankaOrPF==="PF"?e.jsx(E,{className:"bg-blue-100 text-blue-800 border-blue-300",children:t.odemeKurulusuTipi}):e.jsx(E,{className:"bg-green-100 text-green-800 border-green-300",children:"Banka"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[n.length," aktif TABELA"]})]})}),e.jsx("div",{className:"space-y-6",children:(x=t.tabelaGroups)==null?void 0:x.filter(s=>s.aktif!==!1).map(s=>{var y,b,A,f,k;const a=n.filter(p=>s.recordIds.includes(p.id));if(a.length===0)return null;const c=a[0],i=((y=c.gelirModeli)==null?void 0:y.ad)==="Sabit Komisyon",m=a.find(p=>p.yurtIciDisi==="Yurt Ä°Ã§i"),d=a.find(p=>p.yurtIciDisi==="Yurt DÄ±ÅŸÄ±"),o=(c.komisyonOranlarÄ±||[]).filter(p=>p.aktif).map(p=>p.vade);if(o.length===0)return null;let r=[];return(b=c.kartProgramIds)!=null&&b.includes("ALL")?r=oe.filter(p=>p.aktif).map(p=>({id:p.id,ad:p.kartAdi})):c.kartProgramIds&&(r=c.kartProgramIds.map(p=>{const C=oe.find(H=>H.id===p);return C?{id:C.id,ad:C.kartAdi}:null}).filter(p=>p!==null)),r.length===0?null:e.jsxs("div",{className:"bg-white rounded-lg border border-orange-200",children:[e.jsx("div",{className:"px-4 py-3 bg-orange-100 border-b border-orange-200 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs(E,{variant:"outline",className:"bg-white",children:[e.jsxs(E,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-300",children:["Grup: ",s.name]}),e.jsxs(E,{variant:"outline",className:"bg-green-50 text-green-700 border-green-300",children:[new Date(s.gecerlilikBaslangic).toLocaleDateString("tr-TR"),s.gecerlilikBitis&&` - ${new Date(s.gecerlilikBitis).toLocaleDateString("tr-TR")}`]}),((A=c.gelirModeli)==null?void 0:A.ad)||"Gelir Modeli"]}),e.jsx(E,{variant:"outline",className:"bg-white",children:c.urun||"ÃœrÃ¼n"}),e.jsx(E,{variant:"outline",className:"bg-white",children:c.kartTipi}),((f=c.paylaÅŸÄ±mOranlarÄ±)==null?void 0:f.kurulusOrani)&&((k=c.paylaÅŸÄ±mOranlarÄ±)==null?void 0:k.oxivoOrani)&&e.jsxs(E,{variant:"outline",className:"bg-blue-50 text-blue-700",children:["Paylaï¿½ï¿½Ä±m: ",c.paylaÅŸÄ±mOranlarÄ±.kurulusOrani,"% / ",c.paylaÅŸÄ±mOranlarÄ±.oxivoOrani,"%"]})]}),e.jsx("span",{className:"text-xs text-gray-600",children:new Date(c.olusturmaTarihi).toLocaleDateString("tr-TR")})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsxs(De,{children:[e.jsxs(X,{className:"bg-gray-100",children:[e.jsx(u,{rowSpan:4,className:"border-r-2 border-gray-300 bg-white sticky left-0 z-10 align-middle",children:"Kart Tipi"}),e.jsx(u,{colSpan:i?o.length*2:o.length*4,className:"text-center border-r border-gray-200",children:c.kartTipi})]}),e.jsxs(X,{className:"bg-gray-50",children:[e.jsx(u,{colSpan:i?o.length:o.length*2,className:"text-center border-r-2 border-gray-400",children:"Yurt Ä°Ã§i"}),e.jsx(u,{colSpan:i?o.length:o.length*2,className:"text-center border-r border-gray-200",children:"Yurt DÄ±ÅŸÄ±"})]}),e.jsxs(X,{className:"bg-gray-50",children:[o.map((p,C)=>{var F;const H=(F=m==null?void 0:m.komisyonOranlarÄ±)==null?void 0:F.find(S=>S.vade===p),$=(H==null?void 0:H.aktif)===!1;return e.jsx(u,{colSpan:i?1:2,className:`text-center border-r border-gray-200 ${C===o.length-1?"border-r-2 border-gray-400":""} ${$?"line-through text-gray-400":""}`,children:p.replace(" (PeÅŸin)","")},`yurtici-${C}`)}),o.map((p,C)=>{var F;const H=(F=d==null?void 0:d.komisyonOranlarÄ±)==null?void 0:F.find(S=>S.vade===p),$=(H==null?void 0:H.aktif)===!1;return e.jsx(u,{colSpan:i?1:2,className:`text-center border-r border-gray-200 ${$?"line-through text-gray-400":""}`,children:p.replace(" (PeÅŸin)","")},`yurtdisi-${C}`)})]}),e.jsx(X,{className:"bg-gray-50",children:i?e.jsxs(e.Fragment,{children:[o.map((p,C)=>e.jsx(u,{className:`text-center text-xs bg-amber-50 min-w-[80px] ${C===o.length-1?"border-r-2 border-gray-400":"border-r border-gray-200"}`,children:"Kar%"},`yurtici-kar-${C}`)),o.map((p,C)=>e.jsx(u,{className:`text-center text-xs bg-amber-50 min-w-[80px] ${C===o.length-1,"border-r border-gray-200"}`,children:"Kar%"},`yurtdisi-kar-${C}`))]}):e.jsxs(e.Fragment,{children:[o.map((p,C)=>e.jsxs(T.Fragment,{children:[e.jsx(u,{className:"text-center text-xs border-r border-gray-100 bg-blue-50 min-w-[80px]",children:"AlÄ±ÅŸ (%)"}),e.jsx(u,{className:`text-center text-xs bg-green-50 min-w-[80px] ${C===o.length-1?"border-r-2 border-gray-400":"border-r border-gray-200"}`,children:"SatÄ±ÅŸ (%)"})]},`yurtici-subsub-${C}`)),o.map((p,C)=>e.jsxs(T.Fragment,{children:[e.jsx(u,{className:"text-center text-xs border-r border-gray-100 bg-blue-50 min-w-[80px]",children:"AlÄ±ÅŸ (%)"}),e.jsx(u,{className:`text-center text-xs bg-green-50 min-w-[80px] ${C===o.length-1,"border-r border-gray-200"}`,children:"SatÄ±ÅŸ (%)"})]},`yurtdisi-subsub-${C}`))]})})]}),e.jsx(we,{children:r.map((p,C)=>e.jsxs(X,{className:C%2===0?"bg-gray-50/30":"bg-white",children:[e.jsx(h,{className:"border-r-2 border-gray-300 bg-white sticky left-0 z-10",children:p.ad}),o.map((H,$)=>{var ge;const F=(ge=m==null?void 0:m.komisyonOranlarÄ±)==null?void 0:ge.find(l=>l.vade===H),S=(F==null?void 0:F.aktif)===!1;if(i){const l=(F==null?void 0:F.oran)||"";return e.jsx(h,{className:`text-center ${$===o.length-1?"border-r-2 border-gray-400":"border-r border-gray-200"} ${S?"bg-gray-100":"bg-amber-50/30"}`,children:l&&l!==""?e.jsxs("span",{className:`text-sm ${S?"line-through text-gray-400":""}`,children:[parseFloat(l).toFixed(2),"%"]}):e.jsx("span",{className:S?"text-gray-300 line-through":"text-gray-300",children:"-"})},`yurtici-${$}`)}else{const l=(F==null?void 0:F.alisTL)||"",N=(F==null?void 0:F.satisTL)||"";return e.jsxs(T.Fragment,{children:[e.jsx(h,{className:`text-center border-r border-gray-100 ${S?"bg-gray-100":"bg-blue-50/30"}`,children:l&&l!==""?e.jsxs("span",{className:`text-sm ${S?"line-through text-gray-400":""}`,children:[parseFloat(l).toFixed(2),"%"]}):e.jsx("span",{className:S?"text-gray-300 line-through":"text-gray-300",children:"-"})}),e.jsx(h,{className:`text-center ${$===o.length-1?"border-r-2 border-gray-400":"border-r border-gray-200"} ${S?"bg-gray-100":"bg-green-50/30"}`,children:N&&N!==""?e.jsxs("span",{className:`text-sm ${S?"line-through text-gray-400":""}`,children:[parseFloat(N).toFixed(2),"%"]}):e.jsx("span",{className:S?"text-gray-300 line-through":"text-gray-300",children:"-"})})]},`yurtici-${$}`)}}),o.map((H,$)=>{var ge;const F=(ge=d==null?void 0:d.komisyonOranlarÄ±)==null?void 0:ge.find(l=>l.vade===H),S=(F==null?void 0:F.aktif)===!1;if(i){const l=(F==null?void 0:F.oran)||"";return e.jsx(h,{className:`text-center border-r border-gray-200 ${S?"bg-gray-100":"bg-amber-50/30"}`,children:l&&l!==""?e.jsxs("span",{className:`text-sm ${S?"line-through text-gray-400":""}`,children:[parseFloat(l).toFixed(2),"%"]}):e.jsx("span",{className:S?"text-gray-300 line-through":"text-gray-300",children:"-"})},`yurtdisi-${$}`)}else{const l=(F==null?void 0:F.alisTL)||"",N=(F==null?void 0:F.satisTL)||"";return e.jsxs(T.Fragment,{children:[e.jsx(h,{className:`text-center border-r border-gray-100 ${S?"bg-gray-100":"bg-blue-50/30"}`,children:l&&l!==""?e.jsxs("span",{className:`text-sm ${S?"line-through text-gray-400":""}`,children:[parseFloat(l).toFixed(2),"%"]}):e.jsx("span",{className:S?"text-gray-300 line-through":"text-gray-300",children:"-"})}),e.jsx(h,{className:`text-center border-r border-gray-200 ${S?"bg-gray-100":"bg-green-50/30"}`,children:N&&N!==""?e.jsxs("span",{className:`text-sm ${S?"line-through text-gray-400":""}`,children:[parseFloat(N).toFixed(2),"%"]}):e.jsx("span",{className:S?"text-gray-300 line-through":"text-gray-300",children:"-"})})]},`yurtdisi-${$}`)}})]},p.id))})]})}),((m==null?void 0:m.aciklama)||(d==null?void 0:d.aciklama))&&e.jsxs("div",{className:"px-4 py-2 bg-gray-50 border-t border-gray-200 rounded-b-lg space-y-1",children:[(m==null?void 0:m.aciklama)&&e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Yurt Ä°Ã§i Not:"})," ",m.aciklama]}),(d==null?void 0:d.aciklama)&&e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Yurt DÄ±ÅŸÄ± Not:"})," ",d.aciklama]})]})]},`${t.id}-${s.id}`)})})]},t.id)})})})]})}),e.jsx($e,{value:"musteriler",className:"space-y-6",children:e.jsx(as,{customers:O,bankPFRecords:g})}),e.jsx($e,{value:"domain",className:"space-y-6",children:e.jsx(ss,{customers:O})}),e.jsx($e,{value:"banka-pf",className:"space-y-6",children:e.jsxs(w,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Banka/PF Raporu"}),e.jsx(Se,{children:"TÃ¼m Banka ve Ã–deme KuruluÅŸlarÄ±nÄ±n Ã¶zet bilgileri ve Ã¼ye iÅŸyeri iliÅŸkileri"})]}),e.jsx(K,{children:e.jsxs(ma,{defaultValue:"genel-ozet",className:"w-full",children:[e.jsxs(xa,{className:"grid w-full grid-cols-2",children:[e.jsx(Ke,{value:"genel-ozet",children:"Genel Ã–zet"}),e.jsx(Ke,{value:"uiy-listesi",children:"ÃœÄ°Y Listesi"})]}),e.jsxs($e,{value:"genel-ozet",className:"space-y-4 mt-4",children:[e.jsx("div",{className:"flex items-center justify-end mb-4",children:e.jsxs(pe,{variant:"default",onClick:()=>{try{if(g.length===0){te.error("PDF oluÅŸturmak iÃ§in Banka/PF kaydÄ± bulunmuyor!");return}const t=new qe({orientation:"landscape",unit:"mm",format:"a4"});t.setFontSize(16),t.text("Banka / PF Raporu",14,15),t.setFontSize(10),t.text(`Tarih: ${new Date().toLocaleDateString("tr-TR")}`,14,22);let n=30;t.setFontSize(12),t.setFont(void 0,"bold"),t.text("Banka/PF Ozet Tablosu - Uye Isyeri ve Cihaz Sayilari",14,n),n+=8;const x=[["Firma Unvan","Tip","Uye Isyeri","Cihaz"]],s=g.map(f=>{var C,H;const k=((C=f.uyeIsyerleri)==null?void 0:C.length)||0,p=((H=f.uyeIsyerleri)==null?void 0:H.reduce(($,F)=>{var l;const S=O.find(N=>N.id===F.cariId);if(!S)return $;const ge=((l=S.products)==null?void 0:l.filter(N=>N.serialNumber&&N.serialNumber.trim()!==""&&!N.iptalTarihi).length)||0;return $+ge},0))||0;return[f.firmaUnvan||"-",f.bankaOrPF==="PF"?f.odemeKurulusuTipi||"PF":"Banka",k.toString(),p.toString()]});Ve(t,{head:x,body:s,startY:n,styles:{fontSize:8,cellPadding:2,overflow:"linebreak",halign:"center",valign:"middle"},headStyles:{fillColor:[147,51,234],textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:30},2:{cellWidth:30},3:{cellWidth:30}},margin:{top:n,right:10,bottom:10,left:10},theme:"grid"}),t.addPage(),t.setFontSize(12),t.setFont(void 0,"bold"),t.text("Detayli Banka/PF Bilgileri",14,15);const a=[["Firma Ãœnvan","Tip","Muhasebe Kodu","Vergi No","Telefon","E-Posta","Durum"]],c=g.map(f=>[f.firmaUnvan||"-",f.bankaOrPF==="PF"?f.odemeKurulusuTipi||"PF":"Banka",f.muhasebeKodu||"-",f.vergiNo||"-",f.telefon||"-",f.email||"-",f.durum||"Aktif"]);Ve(t,{head:a,body:c,startY:22,styles:{fontSize:8,cellPadding:2,overflow:"linebreak",halign:"center",valign:"middle"},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:50,halign:"left"},1:{cellWidth:25},2:{cellWidth:30},3:{cellWidth:35},4:{cellWidth:35},5:{cellWidth:50,halign:"left"},6:{cellWidth:20}},margin:{top:28,right:10,bottom:10,left:10},theme:"grid"});const i=t.lastAutoTable.finalY||28,m=g.filter(f=>f.bankaOrPF==="Banka").length,d=g.filter(f=>f.odemeKurulusuTipi==="EPK").length,o=g.filter(f=>f.odemeKurulusuTipi==="Ã–K").length,r=g.filter(f=>f.durum==="Aktif").length,y=g.reduce((f,k)=>{var p;return f+(((p=k.uyeIsyerleri)==null?void 0:p.length)||0)},0),b=g.reduce((f,k)=>{var C;const p=((C=k.uyeIsyerleri)==null?void 0:C.reduce((H,$)=>{var ge;const F=O.find(l=>l.id===$.cariId);if(!F)return H;const S=((ge=F.products)==null?void 0:ge.filter(l=>l.serialNumber&&l.serialNumber.trim()!==""&&!l.iptalTarihi).length)||0;return H+S},0))||0;return f+p},0);i>180?(t.addPage(),t.setFontSize(10),t.text("Ozet Istatistikler:",14,15),t.setFontSize(8),[`Toplam Kurulus: ${g.length}`,`Banka: ${m}`,`EPK: ${d}`,`OK: ${o}`,`Aktif: ${r}`,`Pasif: ${g.length-r}`,`Toplam Uye Isyeri: ${y}`,`Toplam Cihaz: ${b}`].forEach((k,p)=>{t.text(k,14,22+p*5)})):(t.setFontSize(10),t.text("Ozet Istatistikler:",14,i+10),t.setFontSize(8),[`Toplam Kurulus: ${g.length}`,`Banka: ${m}`,`EPK: ${d}`,`OK: ${o}`,`Aktif: ${r}`,`Pasif: ${g.length-r}`,`Toplam Uye Isyeri: ${y}`,`Toplam Cihaz: ${b}`].forEach((k,p)=>{t.text(k,14,i+16+p*5)}));const A=`banka-pf-raporu-${new Date().toISOString().split("T")[0]}.pdf`;t.save(A),te.success(`PDF baÅŸarÄ±yla oluÅŸturuldu!
${A}`)}catch(t){console.error("PDF oluÅŸturma hatasÄ±:",t),te.error("PDF oluÅŸturulurken hata oluÅŸtu!")}},className:"flex items-center gap-2",disabled:g.length===0,children:[e.jsx(Ye,{size:16}),"PDF Ä°ndir"]})}),g.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(fe,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"HenÃ¼z Banka/PF kaydÄ± bulunmuyor."}),e.jsx("p",{className:"text-sm mt-2",children:"Banka/PF modÃ¼lÃ¼nden kayÄ±t ekleyin."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(w,{className:"bg-blue-50 border-blue-200",children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Toplam KuruluÅŸ"}),e.jsx("h3",{className:"text-blue-700 mt-1",children:g.length}),e.jsx("p",{className:"text-xs text-blue-500 mt-1",children:`${g.reduce((n,x)=>{const s=O.filter(a=>{var c;return(c=x.uyeIsyerleri)==null?void 0:c.some(i=>i.cariId===a.id)});return n+s.length},0)} atanmÄ±ÅŸ cari`})]}),e.jsx(fe,{className:"text-blue-600",size:32})]})})}),e.jsx(w,{className:"bg-green-50 border-green-200",children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600",children:"Banka"}),e.jsx("h3",{className:"text-green-700 mt-1",children:g.filter(t=>t.bankaOrPF==="Banka").length}),e.jsx("p",{className:"text-xs text-green-500 mt-1",children:`${g.filter(n=>n.bankaOrPF==="Banka").reduce((n,x)=>{const s=O.filter(a=>{var c;return(c=x.uyeIsyerleri)==null?void 0:c.some(i=>i.cariId===a.id)});return n+s.length},0)} atanmÄ±ÅŸ cari`})]}),e.jsx(fe,{className:"text-green-600",size:32})]})})}),e.jsx(w,{className:"bg-purple-50 border-purple-200",children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600",children:"EPK"}),e.jsx("h3",{className:"text-purple-700 mt-1",children:g.filter(t=>t.odemeKurulusuTipi==="EPK").length}),e.jsx("p",{className:"text-xs text-purple-500 mt-1",children:`${g.filter(n=>n.odemeKurulusuTipi==="EPK").reduce((n,x)=>{const s=O.filter(a=>{var c;return(c=x.uyeIsyerleri)==null?void 0:c.some(i=>i.cariId===a.id)});return n+s.length},0)} atanmÄ±ÅŸ cari`})]}),e.jsx(fe,{className:"text-purple-600",size:32})]})})}),e.jsx(w,{className:"bg-orange-50 border-orange-200",children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600",children:"Ã–K"}),e.jsx("h3",{className:"text-orange-700 mt-1",children:g.filter(t=>t.odemeKurulusuTipi==="Ã–K").length}),e.jsx("p",{className:"text-xs text-orange-500 mt-1",children:`${g.filter(n=>n.odemeKurulusuTipi==="Ã–K").reduce((n,x)=>{const s=O.filter(a=>{var c;return(c=x.uyeIsyerleri)==null?void 0:c.some(i=>i.cariId===a.id)});return n+s.length},0)} atanmÄ±ÅŸ cari`})]}),e.jsx(fe,{className:"text-orange-600",size:32})]})})}),e.jsx(w,{className:"bg-indigo-50 border-indigo-200",children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-indigo-600",children:"Toplam Cihaz"}),e.jsx("h3",{className:"text-indigo-700 mt-1",children:g.reduce((n,x)=>{var a;const s=((a=x.uyeIsyerleri)==null?void 0:a.reduce((c,i)=>{var o;const m=O.find(r=>r.id===i.cariId);if(!m)return c;const d=((o=m.products)==null?void 0:o.filter(r=>r.serialNumber&&r.serialNumber.trim()!==""&&!r.iptalTarihi).length)||0;return c+d},0))||0;return n+s},0)}),e.jsx("p",{className:"text-xs text-indigo-500 mt-1",children:`${g.reduce((n,x)=>{var s;return n+(((s=x.uyeIsyerleri)==null?void 0:s.length)||0)},0)} Ã¼ye iÅŸyeri`})]}),e.jsx(fe,{className:"text-indigo-600",size:32})]})})})]}),e.jsxs(w,{className:"mb-6",children:[e.jsxs(re,{children:[e.jsx(le,{className:"text-lg",children:"Banka/PF Ã–zet Tablosu"}),e.jsx(Se,{children:"Her kuruluÅŸ iÃ§in atanmÄ±ÅŸ Ã¼ye iÅŸyeri ve cihaz sayÄ±larÄ±"})]}),e.jsx(K,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[g.filter(t=>t.bankaOrPF==="Banka").length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-green-700 mb-3 flex items-center gap-2",children:[e.jsx(fe,{size:20}),"Bankalar"]}),e.jsx("div",{className:"space-y-2",children:g.filter(t=>t.bankaOrPF==="Banka").map(t=>{var s,a;const n=((s=t.uyeIsyerleri)==null?void 0:s.length)||0,x=((a=t.uyeIsyerleri)==null?void 0:a.reduce((c,i)=>{var o;const m=O.find(r=>r.id===i.cariId);if(!m)return c;const d=((o=m.products)==null?void 0:o.filter(r=>r.serialNumber&&r.serialNumber.trim()!==""&&!r.iptalTarihi).length)||0;return c+d},0))||0;return e.jsx(w,{className:"bg-green-50/30 border-green-200",children:e.jsx(K,{className:"pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-gray-900",children:t.firmaUnvan})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ãœye Ä°ÅŸyeri"}),e.jsx("p",{className:"text-green-700",children:n})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Cihaz"}),e.jsx("p",{className:"text-green-700",children:x})]})]})]})})},t.id)})})]}),g.filter(t=>t.odemeKurulusuTipi==="EPK").length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-purple-700 mb-3 flex items-center gap-2",children:[e.jsx(fe,{size:20}),"EPK (Elektronik Para KuruluÅŸu)"]}),e.jsx("div",{className:"space-y-2",children:g.filter(t=>t.odemeKurulusuTipi==="EPK").map(t=>{var s,a;const n=((s=t.uyeIsyerleri)==null?void 0:s.length)||0,x=((a=t.uyeIsyerleri)==null?void 0:a.reduce((c,i)=>{var o;const m=O.find(r=>r.id===i.cariId);if(!m)return c;const d=((o=m.products)==null?void 0:o.filter(r=>r.serialNumber&&r.serialNumber.trim()!==""&&!r.iptalTarihi).length)||0;return c+d},0))||0;return e.jsx(w,{className:"bg-purple-50/30 border-purple-200",children:e.jsx(K,{className:"pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-gray-900",children:t.firmaUnvan})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ãœye Ä°ÅŸyeri"}),e.jsx("p",{className:"text-purple-700",children:n})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Cihaz"}),e.jsx("p",{className:"text-purple-700",children:x})]})]})]})})},t.id)})})]}),g.filter(t=>t.odemeKurulusuTipi==="Ã–K").length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-orange-700 mb-3 flex items-center gap-2",children:[e.jsx(fe,{size:20}),"Ã–K (Ã–deme KuruluÅŸu)"]}),e.jsx("div",{className:"space-y-2",children:g.filter(t=>t.odemeKurulusuTipi==="Ã–K").map(t=>{var s,a;const n=((s=t.uyeIsyerleri)==null?void 0:s.length)||0,x=((a=t.uyeIsyerleri)==null?void 0:a.reduce((c,i)=>{var o;const m=O.find(r=>r.id===i.cariId);if(!m)return c;const d=((o=m.products)==null?void 0:o.filter(r=>r.serialNumber&&r.serialNumber.trim()!==""&&!r.iptalTarihi).length)||0;return c+d},0))||0;return e.jsx(w,{className:"bg-orange-50/30 border-orange-200",children:e.jsx(K,{className:"pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-gray-900",children:t.firmaUnvan})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ãœye Ä°ÅŸyeri"}),e.jsx("p",{className:"text-orange-700",children:n})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Cihaz"}),e.jsx("p",{className:"text-orange-700",children:x})]})]})]})})},t.id)})})]})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(X,{children:[e.jsx(u,{children:"Firma Ãœnvan"}),e.jsx(u,{className:"text-center",children:"Tip"}),e.jsx(u,{children:"Muhasebe Kodu"}),e.jsx(u,{children:"Vergi No"}),e.jsx(u,{children:"Telefon"}),e.jsx(u,{children:"E-Posta"}),e.jsx(u,{className:"text-center",children:"Ä°letiÅŸim"}),e.jsx(u,{className:"text-center",children:"TABELA"}),e.jsx(u,{className:"text-center",children:"Durum"})]})}),e.jsx(we,{children:g.map((t,n)=>{var x,s;return e.jsxs(X,{className:n%2===0?"bg-gray-50/30":"bg-white",children:[e.jsx(h,{children:t.firmaUnvan}),e.jsx(h,{className:"text-center",children:t.bankaOrPF==="PF"?e.jsx(E,{className:"bg-blue-100 text-blue-800",children:t.odemeKurulusuTipi}):e.jsx(E,{className:"bg-green-100 text-green-800",children:"Banka"})}),e.jsx(h,{children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:t.muhasebeKodu||"-"})}),e.jsx(h,{className:"text-sm",children:t.vergiNo||"-"}),e.jsx(h,{className:"text-sm",children:t.telefon||"-"}),e.jsx(h,{className:"text-sm truncate max-w-[200px]",children:t.email||"-"}),e.jsx(h,{className:"text-center",children:e.jsxs(E,{variant:"outline",children:[((x=t.iletisimMatrisi)==null?void 0:x.length)||0," kiÅŸi"]})}),e.jsx(h,{className:"text-center",children:e.jsx(E,{variant:"outline",className:"bg-orange-50",children:((s=t.tabelaRecords)==null?void 0:s.filter(a=>!a.kapanmaTarihi).length)||0})}),e.jsx(h,{className:"text-center",children:e.jsx(E,{variant:t.durum==="Aktif"?"default":"secondary",className:t.durum==="Aktif"?"bg-green-600":"",children:t.durum})})]},t.id)})})]})})]})]}),e.jsxs($e,{value:"uiy-listesi",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Me,{label:"Banka/PF Filtresi",icon:e.jsx(fe,{size:16}),options:Z,value:j,onChange:v,allLabel:"TÃ¼m Banka/PF/EPK/Ã–K",allValue:"ALL",className:"min-w-[280px]"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(pe,{variant:"outline",onClick:()=>{try{const t=[...g.filter(i=>i.firmaUnvan).map(i=>({id:i.id,name:i.firmaUnvan,type:i.bankaOrPF==="Banka"?"Banka":i.odemeKurulusuTipi||"PF",source:"bankPF"})),...W.filter(i=>i.bankaAdi).map(i=>({id:i.id,name:i.bankaAdi,type:"Banka",source:"definitions"})),...J.filter(i=>i.kurumAdi).map(i=>({id:i.id,name:i.kurumAdi,type:"EPK",source:"definitions"})),...L.filter(i=>i.kurumAdi).map(i=>({id:i.id,name:i.kurumAdi,type:"Ã–K",source:"definitions"}))],x=(j==="ALL"?t:t.filter(i=>i.id===j)).map(i=>{const m=O.filter(d=>{var o;return!!(i.source==="bankPF"&&((o=d.linkedBankPFIds)!=null&&o.includes(i.id))||d.bankDeviceAssignments&&d.bankDeviceAssignments.length>0&&d.bankDeviceAssignments.some(y=>y.bankId===i.id||y.bankId===`bank-${i.id}`||y.bankId===`ok-epk-${i.id}`||y.bankId===`ok-ok-${i.id}`))});return{bankPF:{id:i.id,firmaUnvan:i.name,bankaOrPF:i.type==="Banka"?"Banka":"PF",odemeKurulusuTipi:i.type!=="Banka"?i.type:void 0},customers:m}}).filter(i=>i.customers.length>0);if(x.length===0){te.error("Excel oluÅŸturmak iÃ§in veri bulunmuyor!");return}const s=[];x.forEach(i=>{const m=i.bankPF.bankaOrPF==="PF"?i.bankPF.odemeKurulusuTipi:"Banka",d=i.customers.reduce((o,r)=>{var b,A;const y=(b=r.bankDeviceAssignments)==null?void 0:b.find(f=>f.bankId===i.bankPF.id||f.bankId===`bank-${i.bankPF.id}`||f.bankId===`ok-epk-${i.bankPF.id}`||f.bankId===`ok-ok-${i.bankPF.id}`);return o+(((A=y==null?void 0:y.deviceIds)==null?void 0:A.length)||0)},0);s.push({"Cari Kodu":"","Cari AdÄ±":`${i.bankPF.firmaUnvan} (${m}) - ${i.customers.length} ÃœÄ°Y - ${d} Cihaz`,"Cihaz SayÄ±sÄ±":"",SektÃ¶r:"",MCC:"","GÃ¼ncel Mypayter Domain":"","Vergi Dairesi":"","Vergi No":"",Adres:"",Ä°lÃ§e:"","Posta Kodu":"",Email:"",Tel:"",Yetkili:"",P6X:"",APOLLO:"",Durum:""}),i.customers.forEach(o=>{var b,A;const r=(b=o.bankDeviceAssignments)==null?void 0:b.find(f=>f.bankId===i.bankPF.id||f.bankId===`bank-${i.bankPF.id}`||f.bankId===`ok-epk-${i.bankPF.id}`||f.bankId===`ok-ok-${i.bankPF.id}`),y=((A=r==null?void 0:r.deviceIds)==null?void 0:A.length)||0;s.push({"Cari Kodu":o.cariHesapKodu,"Cari AdÄ±":o.cariAdi,"Cihaz SayÄ±sÄ±":y>0?y:"-",SektÃ¶r:o.sektor||"-",MCC:o.mcc||"-","GÃ¼ncel Mypayter Domain":o.guncelMyPayterDomain||"-","Vergi Dairesi":o.vergiDairesi||"-","Vergi No":o.vergiNo||"-",Adres:o.adres||"-",Ä°lÃ§e:o.ilce||"-","Posta Kodu":o.postaKodu||"-",Email:o.email||"-",Tel:o.tel||"-",Yetkili:o.yetkili||"-",P6X:o.p6x||"-",APOLLO:o.apollo||"-",Durum:o.durum})}),s.push({"Cari Kodu":"","Cari AdÄ±":"","Cihaz SayÄ±sÄ±":"",SektÃ¶r:"",MCC:"","GÃ¼ncel Mypayter Domain":"","Vergi Dairesi":"","Vergi No":"",Adres:"",Ä°lÃ§e:"","Posta Kodu":"",Email:"",Tel:"",Yetkili:"",P6X:"",APOLLO:"",Durum:""})});const a=x.reduce((i,m)=>i+m.customers.length,0),c=x.reduce((i,m)=>i+m.customers.reduce((d,o)=>{var y,b;const r=(y=o.bankDeviceAssignments)==null?void 0:y.find(A=>A.bankId===m.bankPF.id||A.bankId===`bank-${m.bankPF.id}`||A.bankId===`ok-epk-${m.bankPF.id}`||A.bankId===`ok-ok-${m.bankPF.id}`);return d+(((b=r==null?void 0:r.deviceIds)==null?void 0:b.length)||0)},0),0);s.push({"Cari Kodu":"","Cari AdÄ±":"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","Cihaz SayÄ±sÄ±":"",SektÃ¶r:"",MCC:"","GÃ¼ncel Mypayter Domain":"","Vergi Dairesi":"","Vergi No":"",Adres:"",Ä°lÃ§e:"","Posta Kodu":"",Email:"",Tel:"",Yetkili:"",P6X:"",APOLLO:"",Durum:""}),s.push({"Cari Kodu":"","Cari AdÄ±":"Ã–ZET Ä°STATÄ°STÄ°KLER","Cihaz SayÄ±sÄ±":"",SektÃ¶r:"",MCC:"","GÃ¼ncel Mypayter Domain":"","Vergi Dairesi":"","Vergi No":"",Adres:"",Ä°lÃ§e:"","Posta Kodu":"",Email:"",Tel:"",Yetkili:"",P6X:"",APOLLO:"",Durum:""}),s.push({"Cari Kodu":"","Cari AdÄ±":`Toplam Banka/PF: ${x.length}`,"Cihaz SayÄ±sÄ±":"",SektÃ¶r:"",MCC:"","GÃ¼ncel Mypayter Domain":"","Vergi Dairesi":"","Vergi No":"",Adres:"",Ä°lÃ§e:"","Posta Kodu":"",Email:"",Tel:"",Yetkili:"",P6X:"",APOLLO:"",Durum:""}),s.push({"Cari Kodu":"","Cari AdÄ±":`Toplam ÃœÄ°Y: ${a}`,"Cihaz SayÄ±sÄ±":"",SektÃ¶r:"",MCC:"","GÃ¼ncel Mypayter Domain":"","Vergi Dairesi":"","Vergi No":"",Adres:"",Ä°lÃ§e:"","Posta Kodu":"",Email:"",Tel:"",Yetkili:"",P6X:"",APOLLO:"",Durum:""}),s.push({"Cari Kodu":"","Cari AdÄ±":`Toplam Cihaz: ${c}`,"Cihaz SayÄ±sÄ±":c,SektÃ¶r:"",MCC:"","GÃ¼ncel Mypayter Domain":"","Vergi Dairesi":"","Vergi No":"",Adres:"",Ä°lÃ§e:"","Posta Kodu":"",Email:"",Tel:"",Yetkili:"",P6X:"",APOLLO:"",Durum:""}),$a(()=>import("./xlsx-D_0l8YDs.js"),[]).then(i=>{var y;const m=i.utils.json_to_sheet(s),d=i.utils.book_new();m["!cols"]=[{wch:15},{wch:40},{wch:12},{wch:20},{wch:12},{wch:30},{wch:15},{wch:15},{wch:45},{wch:15},{wch:12},{wch:25},{wch:15},{wch:20},{wch:10},{wch:10},{wch:12}];const o=j==="ALL"?"Tum":((y=t.find(b=>b.id===j))==null?void 0:y.name.replace(/[^a-z0-9]/gi,"-"))||"Secili";i.utils.book_append_sheet(d,m,"ÃœÄ°Y Listesi");const r=`uiy-listesi-${o.toLowerCase()}-${new Date().toISOString().split("T")[0]}.xlsx`;i.writeFile(d,r),te.success(`Excel baÅŸarÄ±yla oluÅŸturuldu!
${r}`)})}catch(t){console.error("Excel oluÅŸturma hatasÄ±:",t),te.error("Excel oluÅŸturulurken hata oluÅŸtu!")}},className:"flex items-center gap-2",disabled:(()=>{const t=[...g.filter(s=>s.firmaUnvan).map(s=>({id:s.id,source:"bankPF"})),...W.filter(s=>s.bankaAdi).map(s=>({id:s.id,source:"definitions"})),...J.filter(s=>s.kurumAdi).map(s=>({id:s.id,source:"definitions"})),...L.filter(s=>s.kurumAdi).map(s=>({id:s.id,source:"definitions"}))];return!(j==="ALL"?t:t.filter(s=>s.id===j)).some(s=>O.some(a=>{var c;return s.source==="bankPF"&&((c=a.linkedBankPFIds)!=null&&c.includes(s.id))?!0:a.bankDeviceAssignments&&a.bankDeviceAssignments.length>0?a.bankDeviceAssignments.some(i=>i.bankId===s.id||i.bankId===`bank-${s.id}`||i.bankId===`ok-epk-${s.id}`||i.bankId===`ok-ok-${s.id}`):!1}))})(),children:[e.jsx(ja,{size:16}),"Excel Ä°ndir"]}),e.jsxs(pe,{variant:"default",onClick:()=>{var t;try{const n=[...g.filter(r=>r.firmaUnvan).map(r=>({id:r.id,name:r.firmaUnvan,type:r.bankaOrPF==="Banka"?"Banka":r.odemeKurulusuTipi||"PF",source:"bankPF"})),...W.filter(r=>r.bankaAdi).map(r=>({id:r.id,name:r.bankaAdi,type:"Banka",source:"definitions"})),...J.filter(r=>r.kurumAdi).map(r=>({id:r.id,name:r.kurumAdi,type:"EPK",source:"definitions"})),...L.filter(r=>r.kurumAdi).map(r=>({id:r.id,name:r.kurumAdi,type:"Ã–K",source:"definitions"}))],s=(j==="ALL"?n:n.filter(r=>r.id===j)).map(r=>{const y=O.filter(b=>{var A;return!!(r.source==="bankPF"&&((A=b.linkedBankPFIds)!=null&&A.includes(r.id))||b.bankDeviceAssignments&&b.bankDeviceAssignments.length>0&&b.bankDeviceAssignments.some(k=>k.bankId===r.id||k.bankId===`bank-${r.id}`||k.bankId===`ok-epk-${r.id}`||k.bankId===`ok-ok-${r.id}`))});return{bankPF:{id:r.id,firmaUnvan:r.name,bankaOrPF:r.type==="Banka"?"Banka":"PF",odemeKurulusuTipi:r.type!=="Banka"?r.type:void 0},customers:y}}).filter(r=>r.customers.length>0);if(s.length===0){te.error("PDF oluÅŸturmak iÃ§in veri bulunmuyor!");return}const a=new qe({orientation:"landscape",unit:"mm",format:"a4"});a.setFontSize(16);const c=j==="ALL"?"Tum Banka/PF":((t=n.find(r=>r.id===j))==null?void 0:t.name)||"";a.text(`UÄ°Y Listesi - ${c}`,14,15),a.setFontSize(10),a.text(`Tarih: ${new Date().toLocaleDateString("tr-TR")}`,14,22);let i=30;s.forEach((r,y)=>{y>0&&i>180&&(a.addPage(),i=15),a.setFontSize(12);const b=r.bankPF.bankaOrPF==="PF"?r.bankPF.odemeKurulusuTipi:"Banka",A=r.customers.reduce((p,C)=>{var $,F;const H=($=C.bankDeviceAssignments)==null?void 0:$.find(S=>S.bankId===r.bankPF.id||S.bankId===`bank-${r.bankPF.id}`||S.bankId===`ok-epk-${r.bankPF.id}`||S.bankId===`ok-ok-${r.bankPF.id}`);return p+(((F=H==null?void 0:H.deviceIds)==null?void 0:F.length)||0)},0);a.text(`${r.bankPF.firmaUnvan} (${b}) - ${r.customers.length} UÄ°Y - ${A} Cihaz`,14,i),i+=5;const f=[["Cari Kod","Cari Adi","Cihaz","Sektor","MCC","Domain","V.Dairesi","Vergi No","Adres","Ilce","P.Kodu","Email","Tel","Yetkili","P6X","APOLLO","Durum"]],k=r.customers.map(p=>{var $,F;const C=($=p.bankDeviceAssignments)==null?void 0:$.find(S=>S.bankId===r.bankPF.id||S.bankId===`bank-${r.bankPF.id}`||S.bankId===`ok-epk-${r.bankPF.id}`||S.bankId===`ok-ok-${r.bankPF.id}`),H=((F=C==null?void 0:C.deviceIds)==null?void 0:F.length)||0;return[p.cariHesapKodu,p.cariAdi,H>0?H.toString():"-",p.sektor||"-",p.mcc||"-",p.guncelMyPayterDomain||"-",p.vergiDairesi||"-",p.vergiNo||"-",p.adres||"-",p.ilce||"-",p.postaKodu||"-",p.email||"-",p.tel||"-",p.yetkili||"-",p.p6x||"-",p.apollo||"-",p.durum]});Ve(a,{head:f,body:k,startY:i,styles:{fontSize:5,cellPadding:1,overflow:"linebreak",halign:"left",valign:"middle"},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontSize:5.5,fontStyle:"bold",halign:"center"},columnStyles:{0:{cellWidth:16},1:{cellWidth:28},2:{cellWidth:8,halign:"center"},3:{cellWidth:14},4:{cellWidth:9},5:{cellWidth:20},6:{cellWidth:14},7:{cellWidth:14},8:{cellWidth:26},9:{cellWidth:13},10:{cellWidth:9},11:{cellWidth:18},12:{cellWidth:14},13:{cellWidth:14},14:{cellWidth:7},15:{cellWidth:7},16:{cellWidth:11,halign:"center"}},alternateRowStyles:{fillColor:[249,250,251]},margin:{left:10,right:10},theme:"grid"}),i=a.lastAutoTable.finalY+10});const m=s.reduce((r,y)=>r+y.customers.length,0),d=s.reduce((r,y)=>r+y.customers.reduce((b,A)=>{var k,p;const f=(k=A.bankDeviceAssignments)==null?void 0:k.find(C=>C.bankId===y.bankPF.id||C.bankId===`bank-${y.bankPF.id}`||C.bankId===`ok-epk-${y.bankPF.id}`||C.bankId===`ok-ok-${y.bankPF.id}`);return b+(((p=f==null?void 0:f.deviceIds)==null?void 0:p.length)||0)},0),0);i>180&&(a.addPage(),i=15),a.setFontSize(10),a.text("Ozet Istatistikler:",14,i),a.setFontSize(8),a.text(`Toplam Banka/PF: ${s.length}`,14,i+6),a.text(`Toplam UÄ°Y: ${m}`,14,i+11),a.text(`Toplam Cihaz: ${d}`,14,i+16);const o=j==="ALL"?`uiy-listesi-tumu-${new Date().toISOString().split("T")[0]}.pdf`:`uiy-listesi-${c.replace(/[^a-z0-9]/gi,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.pdf`;a.save(o),te.success(`PDF baÅŸarÄ±yla oluÅŸturuldu!
${o}`)}catch(n){console.error("PDF oluÅŸturma hatasÄ±:",n),te.error("PDF oluÅŸturulurken hata oluÅŸtu!")}},className:"flex items-center gap-2",disabled:(()=>{const t=[...g.filter(s=>s.firmaUnvan).map(s=>({id:s.id,source:"bankPF"})),...W.filter(s=>s.bankaAdi).map(s=>({id:s.id,source:"definitions"})),...J.filter(s=>s.kurumAdi).map(s=>({id:s.id,source:"definitions"})),...L.filter(s=>s.kurumAdi).map(s=>({id:s.id,source:"definitions"}))];return!(j==="ALL"?t:t.filter(s=>s.id===j)).some(s=>O.some(a=>{var c;return s.source==="bankPF"&&((c=a.linkedBankPFIds)!=null&&c.includes(s.id))?!0:a.bankDeviceAssignments&&a.bankDeviceAssignments.length>0?a.bankDeviceAssignments.some(i=>i.bankId===s.id||i.bankId===`bank-${s.id}`||i.bankId===`ok-epk-${s.id}`||i.bankId===`ok-ok-${s.id}`):!1}))})(),children:[e.jsx(Ye,{size:16}),"PDF Ä°ndir"]})]})]}),e.jsx(w,{className:"bg-green-50 border-green-200",children:e.jsx(K,{className:"py-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ia,{className:"text-green-600 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-green-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ’¡ ÃœÄ°Y Listesi HakkÄ±nda"}),e.jsx("p",{className:"text-green-800 mb-2",children:"Bu liste, aÅŸaÄŸÄ±daki iki yÃ¶ntemden biriyle Banka/PF'ye baÄŸlanmÄ±ÅŸ mÃ¼ÅŸterileri gÃ¶sterir:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-green-800",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"YÃ¶ntem 1:"})," MÃ¼ÅŸteri Cari Kart modÃ¼lÃ¼nde ",e.jsx("strong",{children:'"ðŸ’¾ Otomatik EÅŸleÅŸtirmeleri Kaydet"'})," butonuyla veya manuel Excel import ile linkedBankPFIds alanÄ±na kayÄ±t edilmiÅŸ mÃ¼ÅŸteriler"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"YÃ¶ntem 2:"})," MÃ¼ÅŸteri DetayÄ± > Banka/PF sekmesinde ",e.jsx("strong",{children:'"Banka/PF Kategorisi"'}),"altÄ±nda cihaz iliÅŸkilendirmesi yapÄ±lmÄ±ÅŸ mÃ¼ÅŸteriler"]})]}),e.jsx("p",{className:"text-green-800 mt-2 text-xs italic",children:"â„¹ï¸ Her iki yÃ¶ntem de bu listede gÃ¶rÃ¼ntÃ¼lenir. Sipay gibi EPK kategorilerinde cihaz atamÄ±ÅŸ mÃ¼ÅŸteriler de artÄ±k gÃ¶rÃ¼nÃ¼r olacaktÄ±r."})]})]})})}),e.jsxs(w,{children:[e.jsxs(re,{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(aa,{size:20}),"ÃœÄ°Y Ä°cmal Tablosu"]}),e.jsx(Se,{children:"Banka/PF bazÄ±nda mÃ¼ÅŸteri durumlarÄ±na gÃ¶re ÃœÄ°Y ve cihaz sayÄ±larÄ±"})]}),e.jsxs(K,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsxs(De,{children:[e.jsxs(X,{className:"bg-gray-50",children:[e.jsx(u,{className:"border-r-2 border-gray-300",rowSpan:2,children:e.jsx("div",{className:"py-2",children:"Banka/PF AdÄ±"})}),e.jsx(u,{className:"text-center border-r-2 border-gray-300 bg-green-50",colSpan:2,children:"Aktif"}),e.jsx(u,{className:"text-center border-r-2 border-gray-300 bg-yellow-50",colSpan:2,children:"Pasif"}),e.jsx(u,{className:"text-center bg-blue-50",colSpan:2,children:"Toplam"})]}),e.jsxs(X,{className:"bg-gray-50",children:[e.jsx(u,{className:"text-center text-xs bg-green-50 border-r",children:"ÃœÄ°Y"}),e.jsx(u,{className:"text-center text-xs bg-green-50 border-r-2 border-gray-300",children:"Cihaz"}),e.jsx(u,{className:"text-center text-xs bg-yellow-50 border-r",children:"ÃœÄ°Y"}),e.jsx(u,{className:"text-center text-xs bg-yellow-50 border-r-2 border-gray-300",children:"Cihaz"}),e.jsx(u,{className:"text-center text-xs bg-blue-50 border-r",children:"ÃœÄ°Y"}),e.jsx(u,{className:"text-center text-xs bg-blue-50",children:"Cihaz"})]})]}),e.jsx(we,{children:ee.bankalar.length===0?e.jsx(X,{children:e.jsx(h,{colSpan:7,className:"text-center py-8 text-gray-500",children:"HenÃ¼z ÃœÄ°Y verisi bulunmuyor"})}):e.jsxs(e.Fragment,{children:[ee.bankalar.map((t,n)=>e.jsxs(X,{className:n%2===0?"bg-white hover:bg-gray-50":"bg-gray-50/50 hover:bg-gray-100",children:[e.jsx(h,{className:"border-r-2 border-gray-300",children:t.name}),e.jsx(h,{className:"text-center text-green-700 border-r",children:t.aktifUiy}),e.jsx(h,{className:"text-center text-green-700 border-r-2 border-gray-300",children:t.aktifCihaz}),e.jsx(h,{className:"text-center text-yellow-700 border-r",children:t.pasifUiy}),e.jsx(h,{className:"text-center text-yellow-700 border-r-2 border-gray-300",children:t.pasifCihaz}),e.jsx(h,{className:"text-center text-blue-700 border-r",children:t.toplamUiy}),e.jsx(h,{className:"text-center text-blue-700",children:t.toplamCihaz})]},n)),e.jsxs(X,{className:"bg-blue-100 border-t-2 border-blue-400 hover:bg-blue-100",children:[e.jsx(h,{className:"border-r-2 border-gray-300",children:e.jsx("strong",{children:"Genel Toplam"})}),e.jsx(h,{className:"text-center border-r",children:e.jsx("strong",{className:"text-green-700",children:ee.genelToplam.aktifUiy})}),e.jsx(h,{className:"text-center border-r-2 border-gray-300",children:e.jsx("strong",{className:"text-green-700",children:ee.genelToplam.aktifCihaz})}),e.jsx(h,{className:"text-center border-r",children:e.jsx("strong",{className:"text-yellow-700",children:ee.genelToplam.pasifUiy})}),e.jsx(h,{className:"text-center border-r-2 border-gray-300",children:e.jsx("strong",{className:"text-yellow-700",children:ee.genelToplam.pasifCihaz})}),e.jsx(h,{className:"text-center border-r",children:e.jsx("strong",{className:"text-blue-700",children:ee.genelToplam.toplamUiy})}),e.jsx(h,{className:"text-center",children:e.jsx("strong",{className:"text-blue-700",children:ee.genelToplam.toplamCihaz})})]})]})})]})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"ðŸ“Š Not:"})," Bu tablo, en az 1 ÃœÄ°Y'si olan Banka/PF kayÄ±tlarÄ±nÄ± gÃ¶sterir. MÃ¼ÅŸteriler durum alanÄ±na gÃ¶re (Aktif/Pasif) ayrÄ±lmÄ±ÅŸtÄ±r. Toplam cihaz sayÄ±sÄ±na gÃ¶re sÄ±ralÄ±dÄ±r."]})})]})]}),e.jsx("div",{className:"space-y-4",children:(()=>{const t=[...g.filter(s=>s.firmaUnvan).map(s=>({id:s.id,name:s.firmaUnvan,type:s.bankaOrPF==="Banka"?"Banka":s.odemeKurulusuTipi||"PF",source:"bankPF"})),...W.filter(s=>s.bankaAdi).map(s=>({id:s.id,name:s.bankaAdi,type:"Banka",source:"definitions"})),...J.filter(s=>s.kurumAdi).map(s=>({id:s.id,name:s.kurumAdi,type:"EPK",source:"definitions"})),...L.filter(s=>s.kurumAdi).map(s=>({id:s.id,name:s.kurumAdi,type:"Ã–K",source:"definitions"}))],n=j==="ALL"?t:t.filter(s=>s.id===j),x=n.map(s=>{const a=O.filter(c=>{var m;let i="";return s.source==="bankPF"&&((m=c.linkedBankPFIds)!=null&&m.includes(s.id))?(i="linkedBankPFIds",console.log(`âœ… ÃœÄ°Y Match: ${c.cariAdi} <-> ${s.name} (${i})`),!0):c.bankDeviceAssignments&&c.bankDeviceAssignments.length>0&&c.bankDeviceAssignments.some(o=>o.bankId===s.id?(i="bankDeviceAssignments (direct)",!0):o.bankId===`bank-${s.id}`?(i="bankDeviceAssignments (bank prefix)",!0):o.bankId===`ok-epk-${s.id}`?(i="bankDeviceAssignments (ok-epk prefix)",!0):o.bankId===`ok-ok-${s.id}`?(i="bankDeviceAssignments (ok-ok prefix)",!0):!1)?(console.log(`âœ… ÃœÄ°Y Match: ${c.cariAdi} <-> ${s.name} (${i})`),!0):!1});return{bankPF:{id:s.id,firmaUnvan:s.name,bankaOrPF:s.type==="Banka"?"Banka":"PF",odemeKurulusuTipi:s.type!=="Banka"?s.type:void 0},customers:a}}).filter(s=>s.customers.length>0);if(console.log("ðŸ“Š ÃœÄ°Y Listesi Ã–zeti:",{toplamBankPF:n.length,musteriOlanBankPF:x.length,toplamMusteri:x.reduce((s,a)=>s+a.customers.length,0)}),x.length===0){if(j==="ALL")return e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(fe,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"HenÃ¼z Banka/PF ile iliÅŸkilendirilmiÅŸ mÃ¼ÅŸteri bulunmuyor."}),e.jsx("p",{className:"text-sm mt-2",children:"MÃ¼ÅŸteri Cari Kart modÃ¼lÃ¼nden Banka/PF iliÅŸkilendirmesi yapÄ±n."})]});{const s=t.find(a=>a.id===j);return e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(fe,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsxs("p",{children:[e.jsx("strong",{children:s==null?void 0:s.name})," ile iliÅŸkilendirilmiÅŸ mÃ¼ÅŸteri bulunmuyor."]}),e.jsx("p",{className:"text-sm mt-2",children:"MÃ¼ÅŸteri Cari Kart modÃ¼lÃ¼nden bu Banka/PF ile iliÅŸkilendirme yapÄ±n."})]})}}return x.map(({bankPF:s,customers:a})=>{const c=a.reduce((i,m)=>{var o,r;const d=(o=m.bankDeviceAssignments)==null?void 0:o.find(y=>y.bankId===s.id||y.bankId===`bank-${s.id}`||y.bankId===`ok-epk-${s.id}`||y.bankId===`ok-ok-${s.id}`);return i+(((r=d==null?void 0:d.deviceIds)==null?void 0:r.length)||0)},0);return e.jsxs(w,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[s.firmaUnvan,s.bankaOrPF==="PF"?e.jsx(E,{className:"bg-blue-100 text-blue-800",children:s.odemeKurulusuTipi}):e.jsx(E,{className:"bg-green-100 text-green-800",children:"Banka"})]}),e.jsxs(Se,{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{children:[a.length," Ã¼ye iÅŸyeri ile Ã§alÄ±ÅŸmaktadÄ±r"]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx("span",{className:"flex items-center gap-1",children:e.jsxs(E,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[c," Cihaz"]})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Muhasebe Kodu"}),e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.muhasebeKodu})]})]})}),e.jsx(K,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(X,{children:[e.jsx(u,{children:"Cari Hesap Kodu"}),e.jsx(u,{children:"Cari AdÄ±"}),e.jsx(u,{className:"text-center",children:"Cihaz SayÄ±sÄ±"}),e.jsx(u,{children:"SektÃ¶r"}),e.jsx(u,{children:"MCC"}),e.jsx(u,{children:"GÃ¼ncel Mypayter Domain"}),e.jsx(u,{children:"Vergi Dairesi"}),e.jsx(u,{children:"Vergi No"}),e.jsx(u,{children:"Adres"}),e.jsx(u,{children:"Ä°lÃ§e"}),e.jsx(u,{children:"Posta Kodu"}),e.jsx(u,{children:"Email"}),e.jsx(u,{children:"Tel"}),e.jsx(u,{children:"Yetkili"}),e.jsx(u,{children:"P6X"}),e.jsx(u,{children:"APOLLO"}),e.jsx(u,{className:"text-center",children:"Durum"})]})}),e.jsx(we,{children:a.map((i,m)=>{var r,y;const d=(r=i.bankDeviceAssignments)==null?void 0:r.find(b=>b.bankId===s.id||b.bankId===`bank-${s.id}`||b.bankId===`ok-epk-${s.id}`||b.bankId===`ok-ok-${s.id}`),o=((y=d==null?void 0:d.deviceIds)==null?void 0:y.length)||0;return e.jsxs(X,{className:m%2===0?"bg-gray-50/30":"bg-white",children:[e.jsx(h,{children:e.jsx("code",{className:`text-xs bg-blue-50 px-2 py-1 rounded ${i.durum==="Pasif"?"line-through text-gray-500":""}`,children:i.cariHesapKodu})}),e.jsx(h,{children:e.jsx("span",{className:i.durum==="Pasif"?"line-through text-gray-500":"",children:i.cariAdi})}),e.jsx(h,{className:"text-center",children:o>0?e.jsx(E,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:o}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),e.jsx(h,{className:"text-sm",children:i.sektor||"-"}),e.jsx(h,{children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:i.mcc||"-"})}),e.jsx(h,{className:"text-sm truncate max-w-[200px]",children:i.guncelMyPayterDomain||"-"}),e.jsx(h,{className:"text-sm",children:i.vergiDairesi||"-"}),e.jsx(h,{className:"text-sm",children:i.vergiNo||"-"}),e.jsx(h,{className:"text-sm truncate max-w-[250px]",children:i.adres||"-"}),e.jsx(h,{className:"text-sm",children:i.ilce||"-"}),e.jsx(h,{className:"text-sm",children:i.postaKodu||"-"}),e.jsx(h,{className:"text-sm truncate max-w-[200px]",children:i.email||"-"}),e.jsx(h,{className:"text-sm",children:i.tel||"-"}),e.jsx(h,{className:"text-sm",children:i.yetkili||"-"}),e.jsx(h,{className:"text-sm",children:i.p6x||"-"}),e.jsx(h,{className:"text-sm",children:i.apollo||"-"}),e.jsx(h,{className:"text-center",children:e.jsx(E,{variant:i.durum==="Aktif"?"default":"secondary",className:i.durum==="Aktif"?"bg-green-600":"",children:i.durum})})]},i.id)})})]})})})]},s.id)})})()})]})]})})]})}),e.jsx($e,{value:"hakedis",className:"space-y-6",children:e.jsx(Ra,{bankPFRecords:g})})]}),e.jsx(ls,{open:_,onOpenChange:G,bankPFRecords:g})]})});export{vs as ReportsModule};
