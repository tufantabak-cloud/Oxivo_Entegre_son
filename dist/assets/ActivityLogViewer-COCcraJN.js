import{r as c,aW as F,aX as V,j as e,C as H,a as R,aY as Y,b as $,w as I,l as i,a7 as w,aZ as j,d as K,S as P,t as G,G as U,s as y,a9 as W,aa as Q,a_ as X,B as k,a$ as J,b0 as Z,b1 as _,y as p,b2 as q,b3 as ee}from"./index-B0KDE8pz.js";import{S as L,a as T,b as C,c as S,d as a}from"./select-B7kGhMx-.js";import{S as se}from"./scroll-area-BWfeK-bJ.js";import{S as ae}from"./separator-CqtGMYUT.js";import{C as te}from"./circle-alert-BColZMCl.js";import{C as le}from"./clock-7gicNhvX.js";import"./chevron-down-BiFBo6-a.js";function me({isOpen:D,onClose:E}){const[d,f]=c.useState(""),[x,v]=c.useState("ALL"),[m,N]=c.useState("ALL"),[n,o]=c.useState("ALL"),h=c.useMemo(()=>{const s=new Date;let t;switch(n){case"TODAY":t=new Date(s.getFullYear(),s.getMonth(),s.getDate());break;case"WEEK":t=new Date(s.getTime()-7*24*60*60*1e3);break;case"MONTH":t=new Date(s.getFullYear(),s.getMonth(),1);break}return F({action:x!=="ALL"?x:void 0,category:m!=="ALL"?m:void 0,fromDate:t,searchQuery:d||void 0})},[d,x,m,n]),u=c.useMemo(()=>V(),[]),O=()=>{const s=_(),t=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download=`activity-log-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),p.success("Aktivite günlüğü başarıyla dışa aktarıldı!")},z=()=>{const s=q(90);p.success(`${s} eski kayıt temizlendi (90 günden eski)`)},M=()=>{confirm("Tüm aktivite geçmişini silmek istediğinizden emin misiniz?")&&(ee(),p.success("Aktivite günlüğü temizlendi"))},B=s=>{const t=new Date(s),l=new Date().getTime()-t.getTime(),g=Math.floor(l/6e4),b=Math.floor(l/36e5),A=Math.floor(l/864e5);return g<1?"Az önce":g<60?`${g} dakika önce`:b<24?`${b} saat önce`:A<7?`${A} gün önce`:t.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})};return D?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs(H,{className:"w-full max-w-5xl max-h-[90vh] flex flex-col shadow-2xl",children:[e.jsxs(R,{className:"border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Y,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx($,{children:"Aktivite Günlüğü"}),e.jsx(I,{children:"Tüm sistem değişikliklerinin kaydı"})]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:E,children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Toplam Kayıt"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:u.totalEntries})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Bugün"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:j().filter(s=>new Date(s.timestamp).toDateString()===new Date().toDateString()).length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Bu Hafta"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:j().filter(s=>s.timestamp>=new Date().getTime()-7*24*60*60*1e3).length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Bu Ay"}),e.jsx("p",{className:"text-xl font-bold text-purple-600",children:j().filter(s=>{const t=new Date(s.timestamp),r=new Date;return t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear()}).length})]})]})]}),e.jsxs(K,{className:"flex-1 overflow-hidden p-6 flex flex-col gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(G,{type:"text",placeholder:"Arama...",value:d,onChange:s=>f(s.target.value),className:"pl-10"})]})}),e.jsx("div",{children:e.jsxs(L,{value:x,onValueChange:s=>v(s),children:[e.jsx(T,{children:e.jsx(C,{placeholder:"İşlem Türü"})}),e.jsxs(S,{children:[e.jsx(a,{value:"ALL",children:"Tüm İşlemler"}),e.jsx(a,{value:"CREATE",children:"Oluşturma"}),e.jsx(a,{value:"UPDATE",children:"Güncelleme"}),e.jsx(a,{value:"DELETE",children:"Silme"}),e.jsx(a,{value:"EXPORT",children:"Dışa Aktarma"}),e.jsx(a,{value:"IMPORT",children:"İçe Aktarma"}),e.jsx(a,{value:"APPROVE",children:"Onay"}),e.jsx(a,{value:"FINALIZE",children:"Kesinleştirme"})]})]})}),e.jsx("div",{children:e.jsxs(L,{value:m,onValueChange:s=>N(s),children:[e.jsx(T,{children:e.jsx(C,{placeholder:"Kategori"})}),e.jsxs(S,{children:[e.jsx(a,{value:"ALL",children:"Tüm Kategoriler"}),e.jsx(a,{value:"Müşteri",children:"Müşteri"}),e.jsx(a,{value:"Banka/PF",children:"Banka/PF"}),e.jsx(a,{value:"Ürün",children:"Ürün"}),e.jsx(a,{value:"TABELA",children:"TABELA"}),e.jsx(a,{value:"Hakediş",children:"Hakediş"}),e.jsx(a,{value:"Tanımlar",children:"Tanımlar"}),e.jsx(a,{value:"Gelir",children:"Gelir"}),e.jsx(a,{value:"Sistem",children:"Sistem"})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:n==="ALL"?"default":"outline",size:"sm",onClick:()=>o("ALL"),children:"Tümü"}),e.jsx(i,{variant:n==="TODAY"?"default":"outline",size:"sm",onClick:()=>o("TODAY"),children:"Bugün"}),e.jsx(i,{variant:n==="WEEK"?"default":"outline",size:"sm",onClick:()=>o("WEEK"),children:"Bu Hafta"}),e.jsx(i,{variant:n==="MONTH"?"default":"outline",size:"sm",onClick:()=>o("MONTH"),children:"Bu Ay"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:O,className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Export"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:z,className:"gap-2 hover:bg-orange-50",children:[e.jsx(y,{className:"h-4 w-4"}),"Eskileri Temizle"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:M,className:"gap-2 hover:bg-red-50 hover:text-red-600",children:[e.jsx(y,{className:"h-4 w-4"}),"Tümünü Temizle"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[h.length," kayıt gösteriliyor",d&&` (arama: "${d}")`]}),h.length===0&&u.totalEntries>0&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{f(""),v("ALL"),N("ALL"),o("ALL")},children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),"Filtreleri Temizle"]})]})]}),e.jsx(ae,{}),e.jsx(se,{className:"flex-1",children:e.jsxs("div",{className:"space-y-3 pr-4",children:[h.length===0&&e.jsxs(W,{children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(Q,{children:u.totalEntries===0?"Henüz aktivite kaydı bulunmuyor.":"Seçili filtrelere uygun kayıt bulunamadı."})]}),h.map(s=>e.jsx("div",{className:"bg-white border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"text-2xl",children:X(s.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx(k,{variant:"outline",className:`text-xs ${Z(s.action)}`,children:J(s.action)}),e.jsx(k,{variant:"outline",className:"text-xs",children:s.category})]}),e.jsx("p",{className:"font-medium text-gray-900 mb-1",children:s.entityName}),s.details&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.details}),(s.oldValue!==void 0||s.newValue!==void 0)&&e.jsxs("div",{className:"bg-gray-50 rounded p-2 text-xs mt-2 space-y-1",children:[s.oldValue!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Eski: "}),e.jsx("span",{className:"text-red-600 line-through",children:JSON.stringify(s.oldValue)})]}),s.newValue!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Yeni: "}),e.jsx("span",{className:"text-green-600 font-medium",children:JSON.stringify(s.newValue)})]})]}),s.metadata&&Object.keys(s.metadata).length>0&&e.jsx("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:Object.entries(s.metadata).map(([t,r])=>e.jsxs("span",{className:"text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded",children:[t,": ",String(r)]},t))})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-400 whitespace-nowrap",children:[e.jsx(le,{className:"h-3 w-3"}),B(s.timestamp)]})]})},s.id))]})})]})]})}):null}export{me as ActivityLogViewer};
