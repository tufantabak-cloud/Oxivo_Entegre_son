name: Scheduled Auto-Sync Check

# Bu workflow zamanlanmÄ±ÅŸ otomatik kontrol yapar
# Not: Sadece GitHub'daki deÄŸiÅŸiklikleri kontrol eder, 
# Figma Make'ten otomatik sync yapamaz (manuel export gerekir)

on:
  schedule:
    # Her 4 saatte bir Ã§alÄ±ÅŸÄ±r (UTC timezone)
    - cron: '0 */4 * * *'
  
  # Manuel tetikleme
  workflow_dispatch:

jobs:
  check-and-notify:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Check for updates
      run: |
        echo "ğŸ” Repository durumu kontrol ediliyor..."
        git fetch origin
        
        BEHIND=$(git rev-list --count HEAD..origin/main)
        
        if [ "$BEHIND" -gt 0 ]; then
          echo "âš ï¸  Local branch $BEHIND commit geride!"
          echo "ğŸ”„ Pull gerekiyor..."
        else
          echo "âœ… Repository gÃ¼ncel!"
        fi
        
    - name: Build and test
      run: |
        echo "ğŸ—ï¸  Build testi yapÄ±lÄ±yor..."
        npm ci
        npm run build
      env:
        VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
        VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}
        
    - name: Repository stats
      run: |
        echo "ğŸ“Š Repository Ä°statistikleri:"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "Son commit: $(git log -1 --pretty=format:'%h - %s (%ar)')"
        echo "Toplam commit: $(git rev-list --count HEAD)"
        echo "Branch: $(git branch --show-current)"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
    # Uncomment to send notification (requires setup)
    # - name: Send notification
    #   if: failure()
    #   uses: 8398a7/action-slack@v3
    #   with:
    #     status: ${{ job.status }}
    #     webhook_url: ${{ secrets.SLACK_WEBHOOK }}
